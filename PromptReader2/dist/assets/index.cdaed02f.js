(function(){const it=document.createElement("link").relList;if(it&&it.supports&&it.supports("modulepreload"))return;for(const vt of document.querySelectorAll('link[rel="modulepreload"]'))st(vt);new MutationObserver(vt=>{for(const _t of vt)if(_t.type==="childList")for(const bt of _t.addedNodes)bt.tagName==="LINK"&&bt.rel==="modulepreload"&&st(bt)}).observe(document,{childList:!0,subtree:!0});function nt(vt){const _t={};return vt.integrity&&(_t.integrity=vt.integrity),vt.referrerpolicy&&(_t.referrerPolicy=vt.referrerpolicy),vt.crossorigin==="use-credentials"?_t.credentials="include":vt.crossorigin==="anonymous"?_t.credentials="omit":_t.credentials="same-origin",_t}function st(vt){if(vt.ep)return;vt.ep=!0;const _t=nt(vt);fetch(vt.href,_t)}})();function makeMap(rt,it){const nt=Object.create(null),st=rt.split(",");for(let vt=0;vt<st.length;vt++)nt[st[vt]]=!0;return it?vt=>!!nt[vt.toLowerCase()]:vt=>!!nt[vt]}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(rt){return!!rt||rt===""}function normalizeStyle(rt){if(isArray$1(rt)){const it={};for(let nt=0;nt<rt.length;nt++){const st=rt[nt],vt=isString(st)?parseStringStyle(st):normalizeStyle(st);if(vt)for(const _t in vt)it[_t]=vt[_t]}return it}else{if(isString(rt))return rt;if(isObject(rt))return rt}}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:(.+)/;function parseStringStyle(rt){const it={};return rt.split(listDelimiterRE).forEach(nt=>{if(nt){const st=nt.split(propertyDelimiterRE);st.length>1&&(it[st[0].trim()]=st[1].trim())}}),it}function normalizeClass(rt){let it="";if(isString(rt))it=rt;else if(isArray$1(rt))for(let nt=0;nt<rt.length;nt++){const st=normalizeClass(rt[nt]);st&&(it+=st+" ")}else if(isObject(rt))for(const nt in rt)rt[nt]&&(it+=nt+" ");return it.trim()}const toDisplayString=rt=>isString(rt)?rt:rt==null?"":isArray$1(rt)||isObject(rt)&&(rt.toString===objectToString||!isFunction(rt.toString))?JSON.stringify(rt,replacer,2):String(rt),replacer=(rt,it)=>it&&it.__v_isRef?replacer(rt,it.value):isMap(it)?{[`Map(${it.size})`]:[...it.entries()].reduce((nt,[st,vt])=>(nt[`${st} =>`]=vt,nt),{})}:isSet(it)?{[`Set(${it.size})`]:[...it.values()]}:isObject(it)&&!isArray$1(it)&&!isPlainObject(it)?String(it):it,EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,onRE=/^on[^a-z]/,isOn=rt=>onRE.test(rt),isModelListener=rt=>rt.startsWith("onUpdate:"),extend=Object.assign,remove=(rt,it)=>{const nt=rt.indexOf(it);nt>-1&&rt.splice(nt,1)},hasOwnProperty=Object.prototype.hasOwnProperty,hasOwn=(rt,it)=>hasOwnProperty.call(rt,it),isArray$1=Array.isArray,isMap=rt=>toTypeString(rt)==="[object Map]",isSet=rt=>toTypeString(rt)==="[object Set]",isFunction=rt=>typeof rt=="function",isString=rt=>typeof rt=="string",isSymbol=rt=>typeof rt=="symbol",isObject=rt=>rt!==null&&typeof rt=="object",isPromise=rt=>isObject(rt)&&isFunction(rt.then)&&isFunction(rt.catch),objectToString=Object.prototype.toString,toTypeString=rt=>objectToString.call(rt),toRawType=rt=>toTypeString(rt).slice(8,-1),isPlainObject=rt=>toTypeString(rt)==="[object Object]",isIntegerKey=rt=>isString(rt)&&rt!=="NaN"&&rt[0]!=="-"&&""+parseInt(rt,10)===rt,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=rt=>{const it=Object.create(null);return nt=>it[nt]||(it[nt]=rt(nt))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(rt=>rt.replace(camelizeRE,(it,nt)=>nt?nt.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(rt=>rt.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(rt=>rt.charAt(0).toUpperCase()+rt.slice(1)),toHandlerKey=cacheStringFunction(rt=>rt?`on${capitalize(rt)}`:""),hasChanged=(rt,it)=>!Object.is(rt,it),invokeArrayFns=(rt,it)=>{for(let nt=0;nt<rt.length;nt++)rt[nt](it)},def=(rt,it,nt)=>{Object.defineProperty(rt,it,{configurable:!0,enumerable:!1,value:nt})},toNumber=rt=>{const it=parseFloat(rt);return isNaN(it)?rt:it};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let activeEffectScope;class EffectScope{constructor(it=!1){this.active=!0,this.effects=[],this.cleanups=[],!it&&activeEffectScope&&(this.parent=activeEffectScope,this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}run(it){if(this.active){const nt=activeEffectScope;try{return activeEffectScope=this,it()}finally{activeEffectScope=nt}}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(it){if(this.active){let nt,st;for(nt=0,st=this.effects.length;nt<st;nt++)this.effects[nt].stop();for(nt=0,st=this.cleanups.length;nt<st;nt++)this.cleanups[nt]();if(this.scopes)for(nt=0,st=this.scopes.length;nt<st;nt++)this.scopes[nt].stop(!0);if(this.parent&&!it){const vt=this.parent.scopes.pop();vt&&vt!==this&&(this.parent.scopes[this.index]=vt,vt.index=this.index)}this.active=!1}}}function effectScope(rt){return new EffectScope(rt)}function recordEffectScope(rt,it=activeEffectScope){it&&it.active&&it.effects.push(rt)}const createDep=rt=>{const it=new Set(rt);return it.w=0,it.n=0,it},wasTracked=rt=>(rt.w&trackOpBit)>0,newTracked=rt=>(rt.n&trackOpBit)>0,initDepMarkers=({deps:rt})=>{if(rt.length)for(let it=0;it<rt.length;it++)rt[it].w|=trackOpBit},finalizeDepMarkers=rt=>{const{deps:it}=rt;if(it.length){let nt=0;for(let st=0;st<it.length;st++){const vt=it[st];wasTracked(vt)&&!newTracked(vt)?vt.delete(rt):it[nt++]=vt,vt.w&=~trackOpBit,vt.n&=~trackOpBit}it.length=nt}},targetMap=new WeakMap;let effectTrackDepth=0,trackOpBit=1;const maxMarkerBits=30;let activeEffect;const ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol("");class ReactiveEffect{constructor(it,nt=null,st){this.fn=it,this.scheduler=nt,this.active=!0,this.deps=[],this.parent=void 0,recordEffectScope(this,st)}run(){if(!this.active)return this.fn();let it=activeEffect,nt=shouldTrack;for(;it;){if(it===this)return;it=it.parent}try{return this.parent=activeEffect,activeEffect=this,shouldTrack=!0,trackOpBit=1<<++effectTrackDepth,effectTrackDepth<=maxMarkerBits?initDepMarkers(this):cleanupEffect(this),this.fn()}finally{effectTrackDepth<=maxMarkerBits&&finalizeDepMarkers(this),trackOpBit=1<<--effectTrackDepth,activeEffect=this.parent,shouldTrack=nt,this.parent=void 0,this.deferStop&&this.stop()}}stop(){activeEffect===this?this.deferStop=!0:this.active&&(cleanupEffect(this),this.onStop&&this.onStop(),this.active=!1)}}function cleanupEffect(rt){const{deps:it}=rt;if(it.length){for(let nt=0;nt<it.length;nt++)it[nt].delete(rt);it.length=0}}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const rt=trackStack.pop();shouldTrack=rt===void 0?!0:rt}function track(rt,it,nt){if(shouldTrack&&activeEffect){let st=targetMap.get(rt);st||targetMap.set(rt,st=new Map);let vt=st.get(nt);vt||st.set(nt,vt=createDep()),trackEffects(vt)}}function trackEffects(rt,it){let nt=!1;effectTrackDepth<=maxMarkerBits?newTracked(rt)||(rt.n|=trackOpBit,nt=!wasTracked(rt)):nt=!rt.has(activeEffect),nt&&(rt.add(activeEffect),activeEffect.deps.push(rt))}function trigger(rt,it,nt,st,vt,_t){const bt=targetMap.get(rt);if(!bt)return;let xt=[];if(it==="clear")xt=[...bt.values()];else if(nt==="length"&&isArray$1(rt))bt.forEach((Tt,Et)=>{(Et==="length"||Et>=st)&&xt.push(Tt)});else switch(nt!==void 0&&xt.push(bt.get(nt)),it){case"add":isArray$1(rt)?isIntegerKey(nt)&&xt.push(bt.get("length")):(xt.push(bt.get(ITERATE_KEY)),isMap(rt)&&xt.push(bt.get(MAP_KEY_ITERATE_KEY)));break;case"delete":isArray$1(rt)||(xt.push(bt.get(ITERATE_KEY)),isMap(rt)&&xt.push(bt.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(rt)&&xt.push(bt.get(ITERATE_KEY));break}if(xt.length===1)xt[0]&&triggerEffects(xt[0]);else{const Tt=[];for(const Et of xt)Et&&Tt.push(...Et);triggerEffects(createDep(Tt))}}function triggerEffects(rt,it){const nt=isArray$1(rt)?rt:[...rt];for(const st of nt)st.computed&&triggerEffect(st);for(const st of nt)st.computed||triggerEffect(st)}function triggerEffect(rt,it){(rt!==activeEffect||rt.allowRecurse)&&(rt.scheduler?rt.scheduler():rt.run())}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(rt=>rt!=="arguments"&&rt!=="caller").map(rt=>Symbol[rt]).filter(isSymbol)),get=createGetter(),shallowGet=createGetter(!1,!0),readonlyGet=createGetter(!0),arrayInstrumentations=createArrayInstrumentations();function createArrayInstrumentations(){const rt={};return["includes","indexOf","lastIndexOf"].forEach(it=>{rt[it]=function(...nt){const st=toRaw(this);for(let _t=0,bt=this.length;_t<bt;_t++)track(st,"get",_t+"");const vt=st[it](...nt);return vt===-1||vt===!1?st[it](...nt.map(toRaw)):vt}}),["push","pop","shift","unshift","splice"].forEach(it=>{rt[it]=function(...nt){pauseTracking();const st=toRaw(this)[it].apply(this,nt);return resetTracking(),st}}),rt}function createGetter(rt=!1,it=!1){return function(st,vt,_t){if(vt==="__v_isReactive")return!rt;if(vt==="__v_isReadonly")return rt;if(vt==="__v_isShallow")return it;if(vt==="__v_raw"&&_t===(rt?it?shallowReadonlyMap:readonlyMap:it?shallowReactiveMap:reactiveMap).get(st))return st;const bt=isArray$1(st);if(!rt&&bt&&hasOwn(arrayInstrumentations,vt))return Reflect.get(arrayInstrumentations,vt,_t);const xt=Reflect.get(st,vt,_t);return(isSymbol(vt)?builtInSymbols.has(vt):isNonTrackableKeys(vt))||(rt||track(st,"get",vt),it)?xt:isRef(xt)?bt&&isIntegerKey(vt)?xt:xt.value:isObject(xt)?rt?readonly(xt):reactive(xt):xt}}const set=createSetter(),shallowSet=createSetter(!0);function createSetter(rt=!1){return function(nt,st,vt,_t){let bt=nt[st];if(isReadonly(bt)&&isRef(bt)&&!isRef(vt))return!1;if(!rt&&(!isShallow(vt)&&!isReadonly(vt)&&(bt=toRaw(bt),vt=toRaw(vt)),!isArray$1(nt)&&isRef(bt)&&!isRef(vt)))return bt.value=vt,!0;const xt=isArray$1(nt)&&isIntegerKey(st)?Number(st)<nt.length:hasOwn(nt,st),Tt=Reflect.set(nt,st,vt,_t);return nt===toRaw(_t)&&(xt?hasChanged(vt,bt)&&trigger(nt,"set",st,vt):trigger(nt,"add",st,vt)),Tt}}function deleteProperty(rt,it){const nt=hasOwn(rt,it);rt[it];const st=Reflect.deleteProperty(rt,it);return st&&nt&&trigger(rt,"delete",it,void 0),st}function has(rt,it){const nt=Reflect.has(rt,it);return(!isSymbol(it)||!builtInSymbols.has(it))&&track(rt,"has",it),nt}function ownKeys$1(rt){return track(rt,"iterate",isArray$1(rt)?"length":ITERATE_KEY),Reflect.ownKeys(rt)}const mutableHandlers={get,set,deleteProperty,has,ownKeys:ownKeys$1},readonlyHandlers={get:readonlyGet,set(rt,it){return!0},deleteProperty(rt,it){return!0}},shallowReactiveHandlers=extend({},mutableHandlers,{get:shallowGet,set:shallowSet}),toShallow=rt=>rt,getProto=rt=>Reflect.getPrototypeOf(rt);function get$1(rt,it,nt=!1,st=!1){rt=rt.__v_raw;const vt=toRaw(rt),_t=toRaw(it);nt||(it!==_t&&track(vt,"get",it),track(vt,"get",_t));const{has:bt}=getProto(vt),xt=st?toShallow:nt?toReadonly:toReactive;if(bt.call(vt,it))return xt(rt.get(it));if(bt.call(vt,_t))return xt(rt.get(_t));rt!==vt&&rt.get(it)}function has$1(rt,it=!1){const nt=this.__v_raw,st=toRaw(nt),vt=toRaw(rt);return it||(rt!==vt&&track(st,"has",rt),track(st,"has",vt)),rt===vt?nt.has(rt):nt.has(rt)||nt.has(vt)}function size(rt,it=!1){return rt=rt.__v_raw,!it&&track(toRaw(rt),"iterate",ITERATE_KEY),Reflect.get(rt,"size",rt)}function add(rt){rt=toRaw(rt);const it=toRaw(this);return getProto(it).has.call(it,rt)||(it.add(rt),trigger(it,"add",rt,rt)),this}function set$1(rt,it){it=toRaw(it);const nt=toRaw(this),{has:st,get:vt}=getProto(nt);let _t=st.call(nt,rt);_t||(rt=toRaw(rt),_t=st.call(nt,rt));const bt=vt.call(nt,rt);return nt.set(rt,it),_t?hasChanged(it,bt)&&trigger(nt,"set",rt,it):trigger(nt,"add",rt,it),this}function deleteEntry(rt){const it=toRaw(this),{has:nt,get:st}=getProto(it);let vt=nt.call(it,rt);vt||(rt=toRaw(rt),vt=nt.call(it,rt)),st&&st.call(it,rt);const _t=it.delete(rt);return vt&&trigger(it,"delete",rt,void 0),_t}function clear(){const rt=toRaw(this),it=rt.size!==0,nt=rt.clear();return it&&trigger(rt,"clear",void 0,void 0),nt}function createForEach(rt,it){return function(st,vt){const _t=this,bt=_t.__v_raw,xt=toRaw(bt),Tt=it?toShallow:rt?toReadonly:toReactive;return!rt&&track(xt,"iterate",ITERATE_KEY),bt.forEach((Et,wt)=>st.call(vt,Tt(Et),Tt(wt),_t))}}function createIterableMethod(rt,it,nt){return function(...st){const vt=this.__v_raw,_t=toRaw(vt),bt=isMap(_t),xt=rt==="entries"||rt===Symbol.iterator&&bt,Tt=rt==="keys"&&bt,Et=vt[rt](...st),wt=nt?toShallow:it?toReadonly:toReactive;return!it&&track(_t,"iterate",Tt?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:Ot,done:It}=Et.next();return It?{value:Ot,done:It}:{value:xt?[wt(Ot[0]),wt(Ot[1])]:wt(Ot),done:It}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(rt){return function(...it){return rt==="delete"?!1:this}}function createInstrumentations(){const rt={get(_t){return get$1(this,_t)},get size(){return size(this)},has:has$1,add,set:set$1,delete:deleteEntry,clear,forEach:createForEach(!1,!1)},it={get(_t){return get$1(this,_t,!1,!0)},get size(){return size(this)},has:has$1,add,set:set$1,delete:deleteEntry,clear,forEach:createForEach(!1,!0)},nt={get(_t){return get$1(this,_t,!0)},get size(){return size(this,!0)},has(_t){return has$1.call(this,_t,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},st={get(_t){return get$1(this,_t,!0,!0)},get size(){return size(this,!0)},has(_t){return has$1.call(this,_t,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(_t=>{rt[_t]=createIterableMethod(_t,!1,!1),nt[_t]=createIterableMethod(_t,!0,!1),it[_t]=createIterableMethod(_t,!1,!0),st[_t]=createIterableMethod(_t,!0,!0)}),[rt,nt,it,st]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(rt,it){const nt=it?rt?shallowReadonlyInstrumentations:shallowInstrumentations:rt?readonlyInstrumentations:mutableInstrumentations;return(st,vt,_t)=>vt==="__v_isReactive"?!rt:vt==="__v_isReadonly"?rt:vt==="__v_raw"?st:Reflect.get(hasOwn(nt,vt)&&vt in st?nt:st,vt,_t)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(rt){switch(rt){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(rt){return rt.__v_skip||!Object.isExtensible(rt)?0:targetTypeMap(toRawType(rt))}function reactive(rt){return isReadonly(rt)?rt:createReactiveObject(rt,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(rt){return createReactiveObject(rt,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(rt){return createReactiveObject(rt,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function createReactiveObject(rt,it,nt,st,vt){if(!isObject(rt)||rt.__v_raw&&!(it&&rt.__v_isReactive))return rt;const _t=vt.get(rt);if(_t)return _t;const bt=getTargetType(rt);if(bt===0)return rt;const xt=new Proxy(rt,bt===2?st:nt);return vt.set(rt,xt),xt}function isReactive(rt){return isReadonly(rt)?isReactive(rt.__v_raw):!!(rt&&rt.__v_isReactive)}function isReadonly(rt){return!!(rt&&rt.__v_isReadonly)}function isShallow(rt){return!!(rt&&rt.__v_isShallow)}function isProxy(rt){return isReactive(rt)||isReadonly(rt)}function toRaw(rt){const it=rt&&rt.__v_raw;return it?toRaw(it):rt}function markRaw(rt){return def(rt,"__v_skip",!0),rt}const toReactive=rt=>isObject(rt)?reactive(rt):rt,toReadonly=rt=>isObject(rt)?readonly(rt):rt;function trackRefValue(rt){shouldTrack&&activeEffect&&(rt=toRaw(rt),trackEffects(rt.dep||(rt.dep=createDep())))}function triggerRefValue(rt,it){rt=toRaw(rt),rt.dep&&triggerEffects(rt.dep)}function isRef(rt){return!!(rt&&rt.__v_isRef===!0)}function ref(rt){return createRef(rt,!1)}function shallowRef(rt){return createRef(rt,!0)}function createRef(rt,it){return isRef(rt)?rt:new RefImpl(rt,it)}class RefImpl{constructor(it,nt){this.__v_isShallow=nt,this.dep=void 0,this.__v_isRef=!0,this._rawValue=nt?it:toRaw(it),this._value=nt?it:toReactive(it)}get value(){return trackRefValue(this),this._value}set value(it){const nt=this.__v_isShallow||isShallow(it)||isReadonly(it);it=nt?it:toRaw(it),hasChanged(it,this._rawValue)&&(this._rawValue=it,this._value=nt?it:toReactive(it),triggerRefValue(this))}}function unref(rt){return isRef(rt)?rt.value:rt}const shallowUnwrapHandlers={get:(rt,it,nt)=>unref(Reflect.get(rt,it,nt)),set:(rt,it,nt,st)=>{const vt=rt[it];return isRef(vt)&&!isRef(nt)?(vt.value=nt,!0):Reflect.set(rt,it,nt,st)}};function proxyRefs(rt){return isReactive(rt)?rt:new Proxy(rt,shallowUnwrapHandlers)}var _a;class ComputedRefImpl{constructor(it,nt,st,vt){this._setter=nt,this.dep=void 0,this.__v_isRef=!0,this[_a]=!1,this._dirty=!0,this.effect=new ReactiveEffect(it,()=>{this._dirty||(this._dirty=!0,triggerRefValue(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!vt,this.__v_isReadonly=st}get value(){const it=toRaw(this);return trackRefValue(it),(it._dirty||!it._cacheable)&&(it._dirty=!1,it._value=it.effect.run()),it._value}set value(it){this._setter(it)}}_a="__v_isReadonly";function computed$1(rt,it,nt=!1){let st,vt;const _t=isFunction(rt);return _t?(st=rt,vt=NOOP):(st=rt.get,vt=rt.set),new ComputedRefImpl(st,vt,_t||!vt,nt)}function callWithErrorHandling(rt,it,nt,st){let vt;try{vt=st?rt(...st):rt()}catch(_t){handleError(_t,it,nt)}return vt}function callWithAsyncErrorHandling(rt,it,nt,st){if(isFunction(rt)){const _t=callWithErrorHandling(rt,it,nt,st);return _t&&isPromise(_t)&&_t.catch(bt=>{handleError(bt,it,nt)}),_t}const vt=[];for(let _t=0;_t<rt.length;_t++)vt.push(callWithAsyncErrorHandling(rt[_t],it,nt,st));return vt}function handleError(rt,it,nt,st=!0){const vt=it?it.vnode:null;if(it){let _t=it.parent;const bt=it.proxy,xt=nt;for(;_t;){const Et=_t.ec;if(Et){for(let wt=0;wt<Et.length;wt++)if(Et[wt](rt,bt,xt)===!1)return}_t=_t.parent}const Tt=it.appContext.config.errorHandler;if(Tt){callWithErrorHandling(Tt,null,10,[rt,bt,xt]);return}}logError(rt,nt,vt,st)}function logError(rt,it,nt,st=!0){console.error(rt)}let isFlushing=!1,isFlushPending=!1;const queue=[];let flushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick(rt){const it=currentFlushPromise||resolvedPromise;return rt?it.then(this?rt.bind(this):rt):it}function findInsertionIndex(rt){let it=flushIndex+1,nt=queue.length;for(;it<nt;){const st=it+nt>>>1;getId(queue[st])<rt?it=st+1:nt=st}return it}function queueJob(rt){(!queue.length||!queue.includes(rt,isFlushing&&rt.allowRecurse?flushIndex+1:flushIndex))&&(rt.id==null?queue.push(rt):queue.splice(findInsertionIndex(rt.id),0,rt),queueFlush())}function queueFlush(){!isFlushing&&!isFlushPending&&(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function invalidateJob(rt){const it=queue.indexOf(rt);it>flushIndex&&queue.splice(it,1)}function queuePostFlushCb(rt){isArray$1(rt)?pendingPostFlushCbs.push(...rt):(!activePostFlushCbs||!activePostFlushCbs.includes(rt,rt.allowRecurse?postFlushIndex+1:postFlushIndex))&&pendingPostFlushCbs.push(rt),queueFlush()}function flushPreFlushCbs(rt,it=isFlushing?flushIndex+1:0){for(;it<queue.length;it++){const nt=queue[it];nt&&nt.pre&&(queue.splice(it,1),it--,nt())}}function flushPostFlushCbs(rt){if(pendingPostFlushCbs.length){const it=[...new Set(pendingPostFlushCbs)];if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...it);return}for(activePostFlushCbs=it,activePostFlushCbs.sort((nt,st)=>getId(nt)-getId(st)),postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++)activePostFlushCbs[postFlushIndex]();activePostFlushCbs=null,postFlushIndex=0}}const getId=rt=>rt.id==null?1/0:rt.id,comparator=(rt,it)=>{const nt=getId(rt)-getId(it);if(nt===0){if(rt.pre&&!it.pre)return-1;if(it.pre&&!rt.pre)return 1}return nt};function flushJobs(rt){isFlushPending=!1,isFlushing=!0,queue.sort(comparator);const it=NOOP;try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const nt=queue[flushIndex];nt&&nt.active!==!1&&callWithErrorHandling(nt,null,14)}}finally{flushIndex=0,queue.length=0,flushPostFlushCbs(),isFlushing=!1,currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs()}}function emit$1(rt,it,...nt){if(rt.isUnmounted)return;const st=rt.vnode.props||EMPTY_OBJ;let vt=nt;const _t=it.startsWith("update:"),bt=_t&&it.slice(7);if(bt&&bt in st){const wt=`${bt==="modelValue"?"model":bt}Modifiers`,{number:Ot,trim:It}=st[wt]||EMPTY_OBJ;It&&(vt=nt.map(At=>At.trim())),Ot&&(vt=nt.map(toNumber))}let xt,Tt=st[xt=toHandlerKey(it)]||st[xt=toHandlerKey(camelize(it))];!Tt&&_t&&(Tt=st[xt=toHandlerKey(hyphenate(it))]),Tt&&callWithAsyncErrorHandling(Tt,rt,6,vt);const Et=st[xt+"Once"];if(Et){if(!rt.emitted)rt.emitted={};else if(rt.emitted[xt])return;rt.emitted[xt]=!0,callWithAsyncErrorHandling(Et,rt,6,vt)}}function normalizeEmitsOptions(rt,it,nt=!1){const st=it.emitsCache,vt=st.get(rt);if(vt!==void 0)return vt;const _t=rt.emits;let bt={},xt=!1;if(!isFunction(rt)){const Tt=Et=>{const wt=normalizeEmitsOptions(Et,it,!0);wt&&(xt=!0,extend(bt,wt))};!nt&&it.mixins.length&&it.mixins.forEach(Tt),rt.extends&&Tt(rt.extends),rt.mixins&&rt.mixins.forEach(Tt)}return!_t&&!xt?(isObject(rt)&&st.set(rt,null),null):(isArray$1(_t)?_t.forEach(Tt=>bt[Tt]=null):extend(bt,_t),isObject(rt)&&st.set(rt,bt),bt)}function isEmitListener(rt,it){return!rt||!isOn(it)?!1:(it=it.slice(2).replace(/Once$/,""),hasOwn(rt,it[0].toLowerCase()+it.slice(1))||hasOwn(rt,hyphenate(it))||hasOwn(rt,it))}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(rt){const it=currentRenderingInstance;return currentRenderingInstance=rt,currentScopeId=rt&&rt.type.__scopeId||null,it}function pushScopeId(rt){currentScopeId=rt}function popScopeId(){currentScopeId=null}function withCtx(rt,it=currentRenderingInstance,nt){if(!it||rt._n)return rt;const st=(...vt)=>{st._d&&setBlockTracking(-1);const _t=setCurrentRenderingInstance(it),bt=rt(...vt);return setCurrentRenderingInstance(_t),st._d&&setBlockTracking(1),bt};return st._n=!0,st._c=!0,st._d=!0,st}function markAttrsAccessed(){}function renderComponentRoot(rt){const{type:it,vnode:nt,proxy:st,withProxy:vt,props:_t,propsOptions:[bt],slots:xt,attrs:Tt,emit:Et,render:wt,renderCache:Ot,data:It,setupState:At,ctx:Dt,inheritAttrs:kt}=rt;let Mt,zt;const Pt=setCurrentRenderingInstance(rt);try{if(nt.shapeFlag&4){const Bt=vt||st;Mt=normalizeVNode(wt.call(Bt,Bt,Ot,_t,At,It,Dt)),zt=Tt}else{const Bt=it;Mt=normalizeVNode(Bt.length>1?Bt(_t,{attrs:Tt,slots:xt,emit:Et}):Bt(_t,null)),zt=it.props?Tt:getFunctionalFallthrough(Tt)}}catch(Bt){blockStack.length=0,handleError(Bt,rt,1),Mt=createVNode(Comment)}let Lt=Mt;if(zt&&kt!==!1){const Bt=Object.keys(zt),{shapeFlag:Gt}=Lt;Bt.length&&Gt&7&&(bt&&Bt.some(isModelListener)&&(zt=filterModelListeners(zt,bt)),Lt=cloneVNode(Lt,zt))}return nt.dirs&&(Lt=cloneVNode(Lt),Lt.dirs=Lt.dirs?Lt.dirs.concat(nt.dirs):nt.dirs),nt.transition&&(Lt.transition=nt.transition),Mt=Lt,setCurrentRenderingInstance(Pt),Mt}const getFunctionalFallthrough=rt=>{let it;for(const nt in rt)(nt==="class"||nt==="style"||isOn(nt))&&((it||(it={}))[nt]=rt[nt]);return it},filterModelListeners=(rt,it)=>{const nt={};for(const st in rt)(!isModelListener(st)||!(st.slice(9)in it))&&(nt[st]=rt[st]);return nt};function shouldUpdateComponent(rt,it,nt){const{props:st,children:vt,component:_t}=rt,{props:bt,children:xt,patchFlag:Tt}=it,Et=_t.emitsOptions;if(it.dirs||it.transition)return!0;if(nt&&Tt>=0){if(Tt&1024)return!0;if(Tt&16)return st?hasPropsChanged(st,bt,Et):!!bt;if(Tt&8){const wt=it.dynamicProps;for(let Ot=0;Ot<wt.length;Ot++){const It=wt[Ot];if(bt[It]!==st[It]&&!isEmitListener(Et,It))return!0}}}else return(vt||xt)&&(!xt||!xt.$stable)?!0:st===bt?!1:st?bt?hasPropsChanged(st,bt,Et):!0:!!bt;return!1}function hasPropsChanged(rt,it,nt){const st=Object.keys(it);if(st.length!==Object.keys(rt).length)return!0;for(let vt=0;vt<st.length;vt++){const _t=st[vt];if(it[_t]!==rt[_t]&&!isEmitListener(nt,_t))return!0}return!1}function updateHOCHostEl({vnode:rt,parent:it},nt){for(;it&&it.subTree===rt;)(rt=it.vnode).el=nt,it=it.parent}const isSuspense=rt=>rt.__isSuspense;function queueEffectWithSuspense(rt,it){it&&it.pendingBranch?isArray$1(rt)?it.effects.push(...rt):it.effects.push(rt):queuePostFlushCb(rt)}function provide(rt,it){if(currentInstance){let nt=currentInstance.provides;const st=currentInstance.parent&&currentInstance.parent.provides;st===nt&&(nt=currentInstance.provides=Object.create(st)),nt[rt]=it}}function inject(rt,it,nt=!1){const st=currentInstance||currentRenderingInstance;if(st){const vt=st.parent==null?st.vnode.appContext&&st.vnode.appContext.provides:st.parent.provides;if(vt&&rt in vt)return vt[rt];if(arguments.length>1)return nt&&isFunction(it)?it.call(st.proxy):it}}const INITIAL_WATCHER_VALUE={};function watch(rt,it,nt){return doWatch(rt,it,nt)}function doWatch(rt,it,{immediate:nt,deep:st,flush:vt,onTrack:_t,onTrigger:bt}=EMPTY_OBJ){const xt=currentInstance;let Tt,Et=!1,wt=!1;if(isRef(rt)?(Tt=()=>rt.value,Et=isShallow(rt)):isReactive(rt)?(Tt=()=>rt,st=!0):isArray$1(rt)?(wt=!0,Et=rt.some(zt=>isReactive(zt)||isShallow(zt)),Tt=()=>rt.map(zt=>{if(isRef(zt))return zt.value;if(isReactive(zt))return traverse(zt);if(isFunction(zt))return callWithErrorHandling(zt,xt,2)})):isFunction(rt)?it?Tt=()=>callWithErrorHandling(rt,xt,2):Tt=()=>{if(!(xt&&xt.isUnmounted))return Ot&&Ot(),callWithAsyncErrorHandling(rt,xt,3,[It])}:Tt=NOOP,it&&st){const zt=Tt;Tt=()=>traverse(zt())}let Ot,It=zt=>{Ot=Mt.onStop=()=>{callWithErrorHandling(zt,xt,4)}};if(isInSSRComponentSetup)return It=NOOP,it?nt&&callWithAsyncErrorHandling(it,xt,3,[Tt(),wt?[]:void 0,It]):Tt(),NOOP;let At=wt?[]:INITIAL_WATCHER_VALUE;const Dt=()=>{if(!!Mt.active)if(it){const zt=Mt.run();(st||Et||(wt?zt.some((Pt,Lt)=>hasChanged(Pt,At[Lt])):hasChanged(zt,At)))&&(Ot&&Ot(),callWithAsyncErrorHandling(it,xt,3,[zt,At===INITIAL_WATCHER_VALUE?void 0:At,It]),At=zt)}else Mt.run()};Dt.allowRecurse=!!it;let kt;vt==="sync"?kt=Dt:vt==="post"?kt=()=>queuePostRenderEffect(Dt,xt&&xt.suspense):(Dt.pre=!0,xt&&(Dt.id=xt.uid),kt=()=>queueJob(Dt));const Mt=new ReactiveEffect(Tt,kt);return it?nt?Dt():At=Mt.run():vt==="post"?queuePostRenderEffect(Mt.run.bind(Mt),xt&&xt.suspense):Mt.run(),()=>{Mt.stop(),xt&&xt.scope&&remove(xt.scope.effects,Mt)}}function instanceWatch(rt,it,nt){const st=this.proxy,vt=isString(rt)?rt.includes(".")?createPathGetter(st,rt):()=>st[rt]:rt.bind(st,st);let _t;isFunction(it)?_t=it:(_t=it.handler,nt=it);const bt=currentInstance;setCurrentInstance(this);const xt=doWatch(vt,_t.bind(st),nt);return bt?setCurrentInstance(bt):unsetCurrentInstance(),xt}function createPathGetter(rt,it){const nt=it.split(".");return()=>{let st=rt;for(let vt=0;vt<nt.length&&st;vt++)st=st[nt[vt]];return st}}function traverse(rt,it){if(!isObject(rt)||rt.__v_skip||(it=it||new Set,it.has(rt)))return rt;if(it.add(rt),isRef(rt))traverse(rt.value,it);else if(isArray$1(rt))for(let nt=0;nt<rt.length;nt++)traverse(rt[nt],it);else if(isSet(rt)||isMap(rt))rt.forEach(nt=>{traverse(nt,it)});else if(isPlainObject(rt))for(const nt in rt)traverse(rt[nt],it);return rt}function defineComponent(rt){return isFunction(rt)?{setup:rt,name:rt.name}:rt}const isAsyncWrapper=rt=>!!rt.type.__asyncLoader,isKeepAlive=rt=>rt.type.__isKeepAlive;function onActivated(rt,it){registerKeepAliveHook(rt,"a",it)}function onDeactivated(rt,it){registerKeepAliveHook(rt,"da",it)}function registerKeepAliveHook(rt,it,nt=currentInstance){const st=rt.__wdc||(rt.__wdc=()=>{let vt=nt;for(;vt;){if(vt.isDeactivated)return;vt=vt.parent}return rt()});if(injectHook(it,st,nt),nt){let vt=nt.parent;for(;vt&&vt.parent;)isKeepAlive(vt.parent.vnode)&&injectToKeepAliveRoot(st,it,nt,vt),vt=vt.parent}}function injectToKeepAliveRoot(rt,it,nt,st){const vt=injectHook(it,rt,st,!0);onUnmounted(()=>{remove(st[it],vt)},nt)}function injectHook(rt,it,nt=currentInstance,st=!1){if(nt){const vt=nt[rt]||(nt[rt]=[]),_t=it.__weh||(it.__weh=(...bt)=>{if(nt.isUnmounted)return;pauseTracking(),setCurrentInstance(nt);const xt=callWithAsyncErrorHandling(it,nt,rt,bt);return unsetCurrentInstance(),resetTracking(),xt});return st?vt.unshift(_t):vt.push(_t),_t}}const createHook=rt=>(it,nt=currentInstance)=>(!isInSSRComponentSetup||rt==="sp")&&injectHook(rt,it,nt),onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(rt,it=currentInstance){injectHook("ec",rt,it)}function invokeDirectiveHook(rt,it,nt,st){const vt=rt.dirs,_t=it&&it.dirs;for(let bt=0;bt<vt.length;bt++){const xt=vt[bt];_t&&(xt.oldValue=_t[bt].value);let Tt=xt.dir[st];Tt&&(pauseTracking(),callWithAsyncErrorHandling(Tt,nt,8,[rt.el,xt,rt,it]),resetTracking())}}const NULL_DYNAMIC_COMPONENT=Symbol();function renderList(rt,it,nt,st){let vt;const _t=nt&&nt[st];if(isArray$1(rt)||isString(rt)){vt=new Array(rt.length);for(let bt=0,xt=rt.length;bt<xt;bt++)vt[bt]=it(rt[bt],bt,void 0,_t&&_t[bt])}else if(typeof rt=="number"){vt=new Array(rt);for(let bt=0;bt<rt;bt++)vt[bt]=it(bt+1,bt,void 0,_t&&_t[bt])}else if(isObject(rt))if(rt[Symbol.iterator])vt=Array.from(rt,(bt,xt)=>it(bt,xt,void 0,_t&&_t[xt]));else{const bt=Object.keys(rt);vt=new Array(bt.length);for(let xt=0,Tt=bt.length;xt<Tt;xt++){const Et=bt[xt];vt[xt]=it(rt[Et],Et,xt,_t&&_t[xt])}}else vt=[];return nt&&(nt[st]=vt),vt}function renderSlot(rt,it,nt={},st,vt){if(currentRenderingInstance.isCE||currentRenderingInstance.parent&&isAsyncWrapper(currentRenderingInstance.parent)&&currentRenderingInstance.parent.isCE)return createVNode("slot",it==="default"?null:{name:it},st&&st());let _t=rt[it];_t&&_t._c&&(_t._d=!1),openBlock();const bt=_t&&ensureValidVNode(_t(nt)),xt=createBlock(Fragment,{key:nt.key||bt&&bt.key||`_${it}`},bt||(st?st():[]),bt&&rt._===1?64:-2);return!vt&&xt.scopeId&&(xt.slotScopeIds=[xt.scopeId+"-s"]),_t&&_t._c&&(_t._d=!0),xt}function ensureValidVNode(rt){return rt.some(it=>isVNode(it)?!(it.type===Comment||it.type===Fragment&&!ensureValidVNode(it.children)):!0)?rt:null}const getPublicInstance=rt=>rt?isStatefulComponent(rt)?getExposeProxy(rt)||rt.proxy:getPublicInstance(rt.parent):null,publicPropertiesMap=extend(Object.create(null),{$:rt=>rt,$el:rt=>rt.vnode.el,$data:rt=>rt.data,$props:rt=>rt.props,$attrs:rt=>rt.attrs,$slots:rt=>rt.slots,$refs:rt=>rt.refs,$parent:rt=>getPublicInstance(rt.parent),$root:rt=>getPublicInstance(rt.root),$emit:rt=>rt.emit,$options:rt=>resolveMergedOptions(rt),$forceUpdate:rt=>rt.f||(rt.f=()=>queueJob(rt.update)),$nextTick:rt=>rt.n||(rt.n=nextTick.bind(rt.proxy)),$watch:rt=>instanceWatch.bind(rt)}),PublicInstanceProxyHandlers={get({_:rt},it){const{ctx:nt,setupState:st,data:vt,props:_t,accessCache:bt,type:xt,appContext:Tt}=rt;let Et;if(it[0]!=="$"){const At=bt[it];if(At!==void 0)switch(At){case 1:return st[it];case 2:return vt[it];case 4:return nt[it];case 3:return _t[it]}else{if(st!==EMPTY_OBJ&&hasOwn(st,it))return bt[it]=1,st[it];if(vt!==EMPTY_OBJ&&hasOwn(vt,it))return bt[it]=2,vt[it];if((Et=rt.propsOptions[0])&&hasOwn(Et,it))return bt[it]=3,_t[it];if(nt!==EMPTY_OBJ&&hasOwn(nt,it))return bt[it]=4,nt[it];shouldCacheAccess&&(bt[it]=0)}}const wt=publicPropertiesMap[it];let Ot,It;if(wt)return it==="$attrs"&&track(rt,"get",it),wt(rt);if((Ot=xt.__cssModules)&&(Ot=Ot[it]))return Ot;if(nt!==EMPTY_OBJ&&hasOwn(nt,it))return bt[it]=4,nt[it];if(It=Tt.config.globalProperties,hasOwn(It,it))return It[it]},set({_:rt},it,nt){const{data:st,setupState:vt,ctx:_t}=rt;return vt!==EMPTY_OBJ&&hasOwn(vt,it)?(vt[it]=nt,!0):st!==EMPTY_OBJ&&hasOwn(st,it)?(st[it]=nt,!0):hasOwn(rt.props,it)||it[0]==="$"&&it.slice(1)in rt?!1:(_t[it]=nt,!0)},has({_:{data:rt,setupState:it,accessCache:nt,ctx:st,appContext:vt,propsOptions:_t}},bt){let xt;return!!nt[bt]||rt!==EMPTY_OBJ&&hasOwn(rt,bt)||it!==EMPTY_OBJ&&hasOwn(it,bt)||(xt=_t[0])&&hasOwn(xt,bt)||hasOwn(st,bt)||hasOwn(publicPropertiesMap,bt)||hasOwn(vt.config.globalProperties,bt)},defineProperty(rt,it,nt){return nt.get!=null?rt._.accessCache[it]=0:hasOwn(nt,"value")&&this.set(rt,it,nt.value,null),Reflect.defineProperty(rt,it,nt)}};let shouldCacheAccess=!0;function applyOptions(rt){const it=resolveMergedOptions(rt),nt=rt.proxy,st=rt.ctx;shouldCacheAccess=!1,it.beforeCreate&&callHook(it.beforeCreate,rt,"bc");const{data:vt,computed:_t,methods:bt,watch:xt,provide:Tt,inject:Et,created:wt,beforeMount:Ot,mounted:It,beforeUpdate:At,updated:Dt,activated:kt,deactivated:Mt,beforeDestroy:zt,beforeUnmount:Pt,destroyed:Lt,unmounted:Bt,render:Gt,renderTracked:Ut,renderTriggered:Zt,errorCaptured:Jt,serverPrefetch:ei,expose:ii,inheritAttrs:li,components:pi,directives:ci,filters:Wt}=it;if(Et&&resolveInjections(Et,st,null,rt.appContext.config.unwrapInjectedRef),bt)for(const Yt in bt){const Ht=bt[Yt];isFunction(Ht)&&(st[Yt]=Ht.bind(nt))}if(vt){const Yt=vt.call(nt,nt);isObject(Yt)&&(rt.data=reactive(Yt))}if(shouldCacheAccess=!0,_t)for(const Yt in _t){const Ht=_t[Yt],jt=isFunction(Ht)?Ht.bind(nt,nt):isFunction(Ht.get)?Ht.get.bind(nt,nt):NOOP,qt=!isFunction(Ht)&&isFunction(Ht.set)?Ht.set.bind(nt):NOOP,ri=computed({get:jt,set:qt});Object.defineProperty(st,Yt,{enumerable:!0,configurable:!0,get:()=>ri.value,set:oi=>ri.value=oi})}if(xt)for(const Yt in xt)createWatcher(xt[Yt],st,nt,Yt);if(Tt){const Yt=isFunction(Tt)?Tt.call(nt):Tt;Reflect.ownKeys(Yt).forEach(Ht=>{provide(Ht,Yt[Ht])})}wt&&callHook(wt,rt,"c");function Rt(Yt,Ht){isArray$1(Ht)?Ht.forEach(jt=>Yt(jt.bind(nt))):Ht&&Yt(Ht.bind(nt))}if(Rt(onBeforeMount,Ot),Rt(onMounted,It),Rt(onBeforeUpdate,At),Rt(onUpdated,Dt),Rt(onActivated,kt),Rt(onDeactivated,Mt),Rt(onErrorCaptured,Jt),Rt(onRenderTracked,Ut),Rt(onRenderTriggered,Zt),Rt(onBeforeUnmount,Pt),Rt(onUnmounted,Bt),Rt(onServerPrefetch,ei),isArray$1(ii))if(ii.length){const Yt=rt.exposed||(rt.exposed={});ii.forEach(Ht=>{Object.defineProperty(Yt,Ht,{get:()=>nt[Ht],set:jt=>nt[Ht]=jt})})}else rt.exposed||(rt.exposed={});Gt&&rt.render===NOOP&&(rt.render=Gt),li!=null&&(rt.inheritAttrs=li),pi&&(rt.components=pi),ci&&(rt.directives=ci)}function resolveInjections(rt,it,nt=NOOP,st=!1){isArray$1(rt)&&(rt=normalizeInject(rt));for(const vt in rt){const _t=rt[vt];let bt;isObject(_t)?"default"in _t?bt=inject(_t.from||vt,_t.default,!0):bt=inject(_t.from||vt):bt=inject(_t),isRef(bt)&&st?Object.defineProperty(it,vt,{enumerable:!0,configurable:!0,get:()=>bt.value,set:xt=>bt.value=xt}):it[vt]=bt}}function callHook(rt,it,nt){callWithAsyncErrorHandling(isArray$1(rt)?rt.map(st=>st.bind(it.proxy)):rt.bind(it.proxy),it,nt)}function createWatcher(rt,it,nt,st){const vt=st.includes(".")?createPathGetter(nt,st):()=>nt[st];if(isString(rt)){const _t=it[rt];isFunction(_t)&&watch(vt,_t)}else if(isFunction(rt))watch(vt,rt.bind(nt));else if(isObject(rt))if(isArray$1(rt))rt.forEach(_t=>createWatcher(_t,it,nt,st));else{const _t=isFunction(rt.handler)?rt.handler.bind(nt):it[rt.handler];isFunction(_t)&&watch(vt,_t,rt)}}function resolveMergedOptions(rt){const it=rt.type,{mixins:nt,extends:st}=it,{mixins:vt,optionsCache:_t,config:{optionMergeStrategies:bt}}=rt.appContext,xt=_t.get(it);let Tt;return xt?Tt=xt:!vt.length&&!nt&&!st?Tt=it:(Tt={},vt.length&&vt.forEach(Et=>mergeOptions$1(Tt,Et,bt,!0)),mergeOptions$1(Tt,it,bt)),isObject(it)&&_t.set(it,Tt),Tt}function mergeOptions$1(rt,it,nt,st=!1){const{mixins:vt,extends:_t}=it;_t&&mergeOptions$1(rt,_t,nt,!0),vt&&vt.forEach(bt=>mergeOptions$1(rt,bt,nt,!0));for(const bt in it)if(!(st&&bt==="expose")){const xt=internalOptionMergeStrats[bt]||nt&&nt[bt];rt[bt]=xt?xt(rt[bt],it[bt]):it[bt]}return rt}const internalOptionMergeStrats={data:mergeDataFn,props:mergeObjectOptions,emits:mergeObjectOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(rt,it){return it?rt?function(){return extend(isFunction(rt)?rt.call(this,this):rt,isFunction(it)?it.call(this,this):it)}:it:rt}function mergeInject(rt,it){return mergeObjectOptions(normalizeInject(rt),normalizeInject(it))}function normalizeInject(rt){if(isArray$1(rt)){const it={};for(let nt=0;nt<rt.length;nt++)it[rt[nt]]=rt[nt];return it}return rt}function mergeAsArray(rt,it){return rt?[...new Set([].concat(rt,it))]:it}function mergeObjectOptions(rt,it){return rt?extend(extend(Object.create(null),rt),it):it}function mergeWatchOptions(rt,it){if(!rt)return it;if(!it)return rt;const nt=extend(Object.create(null),rt);for(const st in it)nt[st]=mergeAsArray(rt[st],it[st]);return nt}function initProps(rt,it,nt,st=!1){const vt={},_t={};def(_t,InternalObjectKey,1),rt.propsDefaults=Object.create(null),setFullProps(rt,it,vt,_t);for(const bt in rt.propsOptions[0])bt in vt||(vt[bt]=void 0);nt?rt.props=st?vt:shallowReactive(vt):rt.type.props?rt.props=vt:rt.props=_t,rt.attrs=_t}function updateProps(rt,it,nt,st){const{props:vt,attrs:_t,vnode:{patchFlag:bt}}=rt,xt=toRaw(vt),[Tt]=rt.propsOptions;let Et=!1;if((st||bt>0)&&!(bt&16)){if(bt&8){const wt=rt.vnode.dynamicProps;for(let Ot=0;Ot<wt.length;Ot++){let It=wt[Ot];if(isEmitListener(rt.emitsOptions,It))continue;const At=it[It];if(Tt)if(hasOwn(_t,It))At!==_t[It]&&(_t[It]=At,Et=!0);else{const Dt=camelize(It);vt[Dt]=resolvePropValue(Tt,xt,Dt,At,rt,!1)}else At!==_t[It]&&(_t[It]=At,Et=!0)}}}else{setFullProps(rt,it,vt,_t)&&(Et=!0);let wt;for(const Ot in xt)(!it||!hasOwn(it,Ot)&&((wt=hyphenate(Ot))===Ot||!hasOwn(it,wt)))&&(Tt?nt&&(nt[Ot]!==void 0||nt[wt]!==void 0)&&(vt[Ot]=resolvePropValue(Tt,xt,Ot,void 0,rt,!0)):delete vt[Ot]);if(_t!==xt)for(const Ot in _t)(!it||!hasOwn(it,Ot)&&!0)&&(delete _t[Ot],Et=!0)}Et&&trigger(rt,"set","$attrs")}function setFullProps(rt,it,nt,st){const[vt,_t]=rt.propsOptions;let bt=!1,xt;if(it)for(let Tt in it){if(isReservedProp(Tt))continue;const Et=it[Tt];let wt;vt&&hasOwn(vt,wt=camelize(Tt))?!_t||!_t.includes(wt)?nt[wt]=Et:(xt||(xt={}))[wt]=Et:isEmitListener(rt.emitsOptions,Tt)||(!(Tt in st)||Et!==st[Tt])&&(st[Tt]=Et,bt=!0)}if(_t){const Tt=toRaw(nt),Et=xt||EMPTY_OBJ;for(let wt=0;wt<_t.length;wt++){const Ot=_t[wt];nt[Ot]=resolvePropValue(vt,Tt,Ot,Et[Ot],rt,!hasOwn(Et,Ot))}}return bt}function resolvePropValue(rt,it,nt,st,vt,_t){const bt=rt[nt];if(bt!=null){const xt=hasOwn(bt,"default");if(xt&&st===void 0){const Tt=bt.default;if(bt.type!==Function&&isFunction(Tt)){const{propsDefaults:Et}=vt;nt in Et?st=Et[nt]:(setCurrentInstance(vt),st=Et[nt]=Tt.call(null,it),unsetCurrentInstance())}else st=Tt}bt[0]&&(_t&&!xt?st=!1:bt[1]&&(st===""||st===hyphenate(nt))&&(st=!0))}return st}function normalizePropsOptions(rt,it,nt=!1){const st=it.propsCache,vt=st.get(rt);if(vt)return vt;const _t=rt.props,bt={},xt=[];let Tt=!1;if(!isFunction(rt)){const wt=Ot=>{Tt=!0;const[It,At]=normalizePropsOptions(Ot,it,!0);extend(bt,It),At&&xt.push(...At)};!nt&&it.mixins.length&&it.mixins.forEach(wt),rt.extends&&wt(rt.extends),rt.mixins&&rt.mixins.forEach(wt)}if(!_t&&!Tt)return isObject(rt)&&st.set(rt,EMPTY_ARR),EMPTY_ARR;if(isArray$1(_t))for(let wt=0;wt<_t.length;wt++){const Ot=camelize(_t[wt]);validatePropName(Ot)&&(bt[Ot]=EMPTY_OBJ)}else if(_t)for(const wt in _t){const Ot=camelize(wt);if(validatePropName(Ot)){const It=_t[wt],At=bt[Ot]=isArray$1(It)||isFunction(It)?{type:It}:It;if(At){const Dt=getTypeIndex(Boolean,At.type),kt=getTypeIndex(String,At.type);At[0]=Dt>-1,At[1]=kt<0||Dt<kt,(Dt>-1||hasOwn(At,"default"))&&xt.push(Ot)}}}const Et=[bt,xt];return isObject(rt)&&st.set(rt,Et),Et}function validatePropName(rt){return rt[0]!=="$"}function getType(rt){const it=rt&&rt.toString().match(/^\s*function (\w+)/);return it?it[1]:rt===null?"null":""}function isSameType(rt,it){return getType(rt)===getType(it)}function getTypeIndex(rt,it){return isArray$1(it)?it.findIndex(nt=>isSameType(nt,rt)):isFunction(it)&&isSameType(it,rt)?0:-1}const isInternalKey=rt=>rt[0]==="_"||rt==="$stable",normalizeSlotValue=rt=>isArray$1(rt)?rt.map(normalizeVNode):[normalizeVNode(rt)],normalizeSlot$1=(rt,it,nt)=>{if(it._n)return it;const st=withCtx((...vt)=>normalizeSlotValue(it(...vt)),nt);return st._c=!1,st},normalizeObjectSlots=(rt,it,nt)=>{const st=rt._ctx;for(const vt in rt){if(isInternalKey(vt))continue;const _t=rt[vt];if(isFunction(_t))it[vt]=normalizeSlot$1(vt,_t,st);else if(_t!=null){const bt=normalizeSlotValue(_t);it[vt]=()=>bt}}},normalizeVNodeSlots=(rt,it)=>{const nt=normalizeSlotValue(it);rt.slots.default=()=>nt},initSlots=(rt,it)=>{if(rt.vnode.shapeFlag&32){const nt=it._;nt?(rt.slots=toRaw(it),def(it,"_",nt)):normalizeObjectSlots(it,rt.slots={})}else rt.slots={},it&&normalizeVNodeSlots(rt,it);def(rt.slots,InternalObjectKey,1)},updateSlots=(rt,it,nt)=>{const{vnode:st,slots:vt}=rt;let _t=!0,bt=EMPTY_OBJ;if(st.shapeFlag&32){const xt=it._;xt?nt&&xt===1?_t=!1:(extend(vt,it),!nt&&xt===1&&delete vt._):(_t=!it.$stable,normalizeObjectSlots(it,vt)),bt=it}else it&&(normalizeVNodeSlots(rt,it),bt={default:1});if(_t)for(const xt in vt)!isInternalKey(xt)&&!(xt in bt)&&delete vt[xt]};function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid=0;function createAppAPI(rt,it){return function(st,vt=null){isFunction(st)||(st=Object.assign({},st)),vt!=null&&!isObject(vt)&&(vt=null);const _t=createAppContext(),bt=new Set;let xt=!1;const Tt=_t.app={_uid:uid++,_component:st,_props:vt,_container:null,_context:_t,_instance:null,version,get config(){return _t.config},set config(Et){},use(Et,...wt){return bt.has(Et)||(Et&&isFunction(Et.install)?(bt.add(Et),Et.install(Tt,...wt)):isFunction(Et)&&(bt.add(Et),Et(Tt,...wt))),Tt},mixin(Et){return _t.mixins.includes(Et)||_t.mixins.push(Et),Tt},component(Et,wt){return wt?(_t.components[Et]=wt,Tt):_t.components[Et]},directive(Et,wt){return wt?(_t.directives[Et]=wt,Tt):_t.directives[Et]},mount(Et,wt,Ot){if(!xt){const It=createVNode(st,vt);return It.appContext=_t,wt&&it?it(It,Et):rt(It,Et,Ot),xt=!0,Tt._container=Et,Et.__vue_app__=Tt,getExposeProxy(It.component)||It.component.proxy}},unmount(){xt&&(rt(null,Tt._container),delete Tt._container.__vue_app__)},provide(Et,wt){return _t.provides[Et]=wt,Tt}};return Tt}}function setRef(rt,it,nt,st,vt=!1){if(isArray$1(rt)){rt.forEach((It,At)=>setRef(It,it&&(isArray$1(it)?it[At]:it),nt,st,vt));return}if(isAsyncWrapper(st)&&!vt)return;const _t=st.shapeFlag&4?getExposeProxy(st.component)||st.component.proxy:st.el,bt=vt?null:_t,{i:xt,r:Tt}=rt,Et=it&&it.r,wt=xt.refs===EMPTY_OBJ?xt.refs={}:xt.refs,Ot=xt.setupState;if(Et!=null&&Et!==Tt&&(isString(Et)?(wt[Et]=null,hasOwn(Ot,Et)&&(Ot[Et]=null)):isRef(Et)&&(Et.value=null)),isFunction(Tt))callWithErrorHandling(Tt,xt,12,[bt,wt]);else{const It=isString(Tt),At=isRef(Tt);if(It||At){const Dt=()=>{if(rt.f){const kt=It?wt[Tt]:Tt.value;vt?isArray$1(kt)&&remove(kt,_t):isArray$1(kt)?kt.includes(_t)||kt.push(_t):It?(wt[Tt]=[_t],hasOwn(Ot,Tt)&&(Ot[Tt]=wt[Tt])):(Tt.value=[_t],rt.k&&(wt[rt.k]=Tt.value))}else It?(wt[Tt]=bt,hasOwn(Ot,Tt)&&(Ot[Tt]=bt)):At&&(Tt.value=bt,rt.k&&(wt[rt.k]=bt))};bt?(Dt.id=-1,queuePostRenderEffect(Dt,nt)):Dt()}}}const queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(rt){return baseCreateRenderer(rt)}function baseCreateRenderer(rt,it){const nt=getGlobalThis();nt.__VUE__=!0;const{insert:st,remove:vt,patchProp:_t,createElement:bt,createText:xt,createComment:Tt,setText:Et,setElementText:wt,parentNode:Ot,nextSibling:It,setScopeId:At=NOOP,cloneNode:Dt,insertStaticContent:kt}=rt,Mt=(Vt,Kt,ni,hi=null,ui=null,gi=null,mi=!1,yi=null,_i=!!Kt.dynamicChildren)=>{if(Vt===Kt)return;Vt&&!isSameVNodeType(Vt,Kt)&&(hi=Ft(Vt),fi(Vt,ui,gi,!0),Vt=null),Kt.patchFlag===-2&&(_i=!1,Kt.dynamicChildren=null);const{type:vi,ref:Ti,shapeFlag:xi}=Kt;switch(vi){case Text:zt(Vt,Kt,ni,hi);break;case Comment:Pt(Vt,Kt,ni,hi);break;case Static:Vt==null&&Lt(Kt,ni,hi,mi);break;case Fragment:ci(Vt,Kt,ni,hi,ui,gi,mi,yi,_i);break;default:xi&1?Ut(Vt,Kt,ni,hi,ui,gi,mi,yi,_i):xi&6?Wt(Vt,Kt,ni,hi,ui,gi,mi,yi,_i):(xi&64||xi&128)&&vi.process(Vt,Kt,ni,hi,ui,gi,mi,yi,_i,Qt)}Ti!=null&&ui&&setRef(Ti,Vt&&Vt.ref,gi,Kt||Vt,!Kt)},zt=(Vt,Kt,ni,hi)=>{if(Vt==null)st(Kt.el=xt(Kt.children),ni,hi);else{const ui=Kt.el=Vt.el;Kt.children!==Vt.children&&Et(ui,Kt.children)}},Pt=(Vt,Kt,ni,hi)=>{Vt==null?st(Kt.el=Tt(Kt.children||""),ni,hi):Kt.el=Vt.el},Lt=(Vt,Kt,ni,hi)=>{[Vt.el,Vt.anchor]=kt(Vt.children,Kt,ni,hi,Vt.el,Vt.anchor)},Bt=({el:Vt,anchor:Kt},ni,hi)=>{let ui;for(;Vt&&Vt!==Kt;)ui=It(Vt),st(Vt,ni,hi),Vt=ui;st(Kt,ni,hi)},Gt=({el:Vt,anchor:Kt})=>{let ni;for(;Vt&&Vt!==Kt;)ni=It(Vt),vt(Vt),Vt=ni;vt(Kt)},Ut=(Vt,Kt,ni,hi,ui,gi,mi,yi,_i)=>{mi=mi||Kt.type==="svg",Vt==null?Zt(Kt,ni,hi,ui,gi,mi,yi,_i):ii(Vt,Kt,ui,gi,mi,yi,_i)},Zt=(Vt,Kt,ni,hi,ui,gi,mi,yi)=>{let _i,vi;const{type:Ti,props:xi,shapeFlag:Ei,transition:wi,patchFlag:Ci,dirs:Ii}=Vt;if(Vt.el&&Dt!==void 0&&Ci===-1)_i=Vt.el=Dt(Vt.el);else{if(_i=Vt.el=bt(Vt.type,gi,xi&&xi.is,xi),Ei&8?wt(_i,Vt.children):Ei&16&&ei(Vt.children,_i,null,hi,ui,gi&&Ti!=="foreignObject",mi,yi),Ii&&invokeDirectiveHook(Vt,null,hi,"created"),xi){for(const Si in xi)Si!=="value"&&!isReservedProp(Si)&&_t(_i,Si,null,xi[Si],gi,Vt.children,hi,ui,Nt);"value"in xi&&_t(_i,"value",null,xi.value),(vi=xi.onVnodeBeforeMount)&&invokeVNodeHook(vi,hi,Vt)}Jt(_i,Vt,Vt.scopeId,mi,hi)}Ii&&invokeDirectiveHook(Vt,null,hi,"beforeMount");const Li=(!ui||ui&&!ui.pendingBranch)&&wi&&!wi.persisted;Li&&wi.beforeEnter(_i),st(_i,Kt,ni),((vi=xi&&xi.onVnodeMounted)||Li||Ii)&&queuePostRenderEffect(()=>{vi&&invokeVNodeHook(vi,hi,Vt),Li&&wi.enter(_i),Ii&&invokeDirectiveHook(Vt,null,hi,"mounted")},ui)},Jt=(Vt,Kt,ni,hi,ui)=>{if(ni&&At(Vt,ni),hi)for(let gi=0;gi<hi.length;gi++)At(Vt,hi[gi]);if(ui){let gi=ui.subTree;if(Kt===gi){const mi=ui.vnode;Jt(Vt,mi,mi.scopeId,mi.slotScopeIds,ui.parent)}}},ei=(Vt,Kt,ni,hi,ui,gi,mi,yi,_i=0)=>{for(let vi=_i;vi<Vt.length;vi++){const Ti=Vt[vi]=yi?cloneIfMounted(Vt[vi]):normalizeVNode(Vt[vi]);Mt(null,Ti,Kt,ni,hi,ui,gi,mi,yi)}},ii=(Vt,Kt,ni,hi,ui,gi,mi)=>{const yi=Kt.el=Vt.el;let{patchFlag:_i,dynamicChildren:vi,dirs:Ti}=Kt;_i|=Vt.patchFlag&16;const xi=Vt.props||EMPTY_OBJ,Ei=Kt.props||EMPTY_OBJ;let wi;ni&&toggleRecurse(ni,!1),(wi=Ei.onVnodeBeforeUpdate)&&invokeVNodeHook(wi,ni,Kt,Vt),Ti&&invokeDirectiveHook(Kt,Vt,ni,"beforeUpdate"),ni&&toggleRecurse(ni,!0);const Ci=ui&&Kt.type!=="foreignObject";if(vi?li(Vt.dynamicChildren,vi,yi,ni,hi,Ci,gi):mi||jt(Vt,Kt,yi,null,ni,hi,Ci,gi,!1),_i>0){if(_i&16)pi(yi,Kt,xi,Ei,ni,hi,ui);else if(_i&2&&xi.class!==Ei.class&&_t(yi,"class",null,Ei.class,ui),_i&4&&_t(yi,"style",xi.style,Ei.style,ui),_i&8){const Ii=Kt.dynamicProps;for(let Li=0;Li<Ii.length;Li++){const Si=Ii[Li],Ai=xi[Si],Di=Ei[Si];(Di!==Ai||Si==="value")&&_t(yi,Si,Ai,Di,ui,Vt.children,ni,hi,Nt)}}_i&1&&Vt.children!==Kt.children&&wt(yi,Kt.children)}else!mi&&vi==null&&pi(yi,Kt,xi,Ei,ni,hi,ui);((wi=Ei.onVnodeUpdated)||Ti)&&queuePostRenderEffect(()=>{wi&&invokeVNodeHook(wi,ni,Kt,Vt),Ti&&invokeDirectiveHook(Kt,Vt,ni,"updated")},hi)},li=(Vt,Kt,ni,hi,ui,gi,mi)=>{for(let yi=0;yi<Kt.length;yi++){const _i=Vt[yi],vi=Kt[yi],Ti=_i.el&&(_i.type===Fragment||!isSameVNodeType(_i,vi)||_i.shapeFlag&70)?Ot(_i.el):ni;Mt(_i,vi,Ti,null,hi,ui,gi,mi,!0)}},pi=(Vt,Kt,ni,hi,ui,gi,mi)=>{if(ni!==hi){for(const yi in hi){if(isReservedProp(yi))continue;const _i=hi[yi],vi=ni[yi];_i!==vi&&yi!=="value"&&_t(Vt,yi,vi,_i,mi,Kt.children,ui,gi,Nt)}if(ni!==EMPTY_OBJ)for(const yi in ni)!isReservedProp(yi)&&!(yi in hi)&&_t(Vt,yi,ni[yi],null,mi,Kt.children,ui,gi,Nt);"value"in hi&&_t(Vt,"value",ni.value,hi.value)}},ci=(Vt,Kt,ni,hi,ui,gi,mi,yi,_i)=>{const vi=Kt.el=Vt?Vt.el:xt(""),Ti=Kt.anchor=Vt?Vt.anchor:xt("");let{patchFlag:xi,dynamicChildren:Ei,slotScopeIds:wi}=Kt;wi&&(yi=yi?yi.concat(wi):wi),Vt==null?(st(vi,ni,hi),st(Ti,ni,hi),ei(Kt.children,ni,Ti,ui,gi,mi,yi,_i)):xi>0&&xi&64&&Ei&&Vt.dynamicChildren?(li(Vt.dynamicChildren,Ei,ni,ui,gi,mi,yi),(Kt.key!=null||ui&&Kt===ui.subTree)&&traverseStaticChildren(Vt,Kt,!0)):jt(Vt,Kt,ni,Ti,ui,gi,mi,yi,_i)},Wt=(Vt,Kt,ni,hi,ui,gi,mi,yi,_i)=>{Kt.slotScopeIds=yi,Vt==null?Kt.shapeFlag&512?ui.ctx.activate(Kt,ni,hi,mi,_i):$t(Kt,ni,hi,ui,gi,mi,_i):Rt(Vt,Kt,_i)},$t=(Vt,Kt,ni,hi,ui,gi,mi)=>{const yi=Vt.component=createComponentInstance(Vt,hi,ui);if(isKeepAlive(Vt)&&(yi.ctx.renderer=Qt),setupComponent(yi),yi.asyncDep){if(ui&&ui.registerDep(yi,Yt),!Vt.el){const _i=yi.subTree=createVNode(Comment);Pt(null,_i,Kt,ni)}return}Yt(yi,Vt,Kt,ni,ui,gi,mi)},Rt=(Vt,Kt,ni)=>{const hi=Kt.component=Vt.component;if(shouldUpdateComponent(Vt,Kt,ni))if(hi.asyncDep&&!hi.asyncResolved){Ht(hi,Kt,ni);return}else hi.next=Kt,invalidateJob(hi.update),hi.update();else Kt.el=Vt.el,hi.vnode=Kt},Yt=(Vt,Kt,ni,hi,ui,gi,mi)=>{const yi=()=>{if(Vt.isMounted){let{next:Ti,bu:xi,u:Ei,parent:wi,vnode:Ci}=Vt,Ii=Ti,Li;toggleRecurse(Vt,!1),Ti?(Ti.el=Ci.el,Ht(Vt,Ti,mi)):Ti=Ci,xi&&invokeArrayFns(xi),(Li=Ti.props&&Ti.props.onVnodeBeforeUpdate)&&invokeVNodeHook(Li,wi,Ti,Ci),toggleRecurse(Vt,!0);const Si=renderComponentRoot(Vt),Ai=Vt.subTree;Vt.subTree=Si,Mt(Ai,Si,Ot(Ai.el),Ft(Ai),Vt,ui,gi),Ti.el=Si.el,Ii===null&&updateHOCHostEl(Vt,Si.el),Ei&&queuePostRenderEffect(Ei,ui),(Li=Ti.props&&Ti.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(Li,wi,Ti,Ci),ui)}else{let Ti;const{el:xi,props:Ei}=Kt,{bm:wi,m:Ci,parent:Ii}=Vt,Li=isAsyncWrapper(Kt);if(toggleRecurse(Vt,!1),wi&&invokeArrayFns(wi),!Li&&(Ti=Ei&&Ei.onVnodeBeforeMount)&&invokeVNodeHook(Ti,Ii,Kt),toggleRecurse(Vt,!0),xi&&si){const Si=()=>{Vt.subTree=renderComponentRoot(Vt),si(xi,Vt.subTree,Vt,ui,null)};Li?Kt.type.__asyncLoader().then(()=>!Vt.isUnmounted&&Si()):Si()}else{const Si=Vt.subTree=renderComponentRoot(Vt);Mt(null,Si,ni,hi,Vt,ui,gi),Kt.el=Si.el}if(Ci&&queuePostRenderEffect(Ci,ui),!Li&&(Ti=Ei&&Ei.onVnodeMounted)){const Si=Kt;queuePostRenderEffect(()=>invokeVNodeHook(Ti,Ii,Si),ui)}(Kt.shapeFlag&256||Ii&&isAsyncWrapper(Ii.vnode)&&Ii.vnode.shapeFlag&256)&&Vt.a&&queuePostRenderEffect(Vt.a,ui),Vt.isMounted=!0,Kt=ni=hi=null}},_i=Vt.effect=new ReactiveEffect(yi,()=>queueJob(vi),Vt.scope),vi=Vt.update=()=>_i.run();vi.id=Vt.uid,toggleRecurse(Vt,!0),vi()},Ht=(Vt,Kt,ni)=>{Kt.component=Vt;const hi=Vt.vnode.props;Vt.vnode=Kt,Vt.next=null,updateProps(Vt,Kt.props,hi,ni),updateSlots(Vt,Kt.children,ni),pauseTracking(),flushPreFlushCbs(),resetTracking()},jt=(Vt,Kt,ni,hi,ui,gi,mi,yi,_i=!1)=>{const vi=Vt&&Vt.children,Ti=Vt?Vt.shapeFlag:0,xi=Kt.children,{patchFlag:Ei,shapeFlag:wi}=Kt;if(Ei>0){if(Ei&128){ri(vi,xi,ni,hi,ui,gi,mi,yi,_i);return}else if(Ei&256){qt(vi,xi,ni,hi,ui,gi,mi,yi,_i);return}}wi&8?(Ti&16&&Nt(vi,ui,gi),xi!==vi&&wt(ni,xi)):Ti&16?wi&16?ri(vi,xi,ni,hi,ui,gi,mi,yi,_i):Nt(vi,ui,gi,!0):(Ti&8&&wt(ni,""),wi&16&&ei(xi,ni,hi,ui,gi,mi,yi,_i))},qt=(Vt,Kt,ni,hi,ui,gi,mi,yi,_i)=>{Vt=Vt||EMPTY_ARR,Kt=Kt||EMPTY_ARR;const vi=Vt.length,Ti=Kt.length,xi=Math.min(vi,Ti);let Ei;for(Ei=0;Ei<xi;Ei++){const wi=Kt[Ei]=_i?cloneIfMounted(Kt[Ei]):normalizeVNode(Kt[Ei]);Mt(Vt[Ei],wi,ni,null,ui,gi,mi,yi,_i)}vi>Ti?Nt(Vt,ui,gi,!0,!1,xi):ei(Kt,ni,hi,ui,gi,mi,yi,_i,xi)},ri=(Vt,Kt,ni,hi,ui,gi,mi,yi,_i)=>{let vi=0;const Ti=Kt.length;let xi=Vt.length-1,Ei=Ti-1;for(;vi<=xi&&vi<=Ei;){const wi=Vt[vi],Ci=Kt[vi]=_i?cloneIfMounted(Kt[vi]):normalizeVNode(Kt[vi]);if(isSameVNodeType(wi,Ci))Mt(wi,Ci,ni,null,ui,gi,mi,yi,_i);else break;vi++}for(;vi<=xi&&vi<=Ei;){const wi=Vt[xi],Ci=Kt[Ei]=_i?cloneIfMounted(Kt[Ei]):normalizeVNode(Kt[Ei]);if(isSameVNodeType(wi,Ci))Mt(wi,Ci,ni,null,ui,gi,mi,yi,_i);else break;xi--,Ei--}if(vi>xi){if(vi<=Ei){const wi=Ei+1,Ci=wi<Ti?Kt[wi].el:hi;for(;vi<=Ei;)Mt(null,Kt[vi]=_i?cloneIfMounted(Kt[vi]):normalizeVNode(Kt[vi]),ni,Ci,ui,gi,mi,yi,_i),vi++}}else if(vi>Ei)for(;vi<=xi;)fi(Vt[vi],ui,gi,!0),vi++;else{const wi=vi,Ci=vi,Ii=new Map;for(vi=Ci;vi<=Ei;vi++){const Oi=Kt[vi]=_i?cloneIfMounted(Kt[vi]):normalizeVNode(Kt[vi]);Oi.key!=null&&Ii.set(Oi.key,vi)}let Li,Si=0;const Ai=Ei-Ci+1;let Di=!1,ki=0;const Gi=new Array(Ai);for(vi=0;vi<Ai;vi++)Gi[vi]=0;for(vi=wi;vi<=xi;vi++){const Oi=Vt[vi];if(Si>=Ai){fi(Oi,ui,gi,!0);continue}let Ni;if(Oi.key!=null)Ni=Ii.get(Oi.key);else for(Li=Ci;Li<=Ei;Li++)if(Gi[Li-Ci]===0&&isSameVNodeType(Oi,Kt[Li])){Ni=Li;break}Ni===void 0?fi(Oi,ui,gi,!0):(Gi[Ni-Ci]=vi+1,Ni>=ki?ki=Ni:Di=!0,Mt(Oi,Kt[Ni],ni,null,ui,gi,mi,yi,_i),Si++)}const Ri=Di?getSequence(Gi):EMPTY_ARR;for(Li=Ri.length-1,vi=Ai-1;vi>=0;vi--){const Oi=Ci+vi,Ni=Kt[Oi],Pi=Oi+1<Ti?Kt[Oi+1].el:hi;Gi[vi]===0?Mt(null,Ni,ni,Pi,ui,gi,mi,yi,_i):Di&&(Li<0||vi!==Ri[Li]?oi(Ni,ni,Pi,2):Li--)}}},oi=(Vt,Kt,ni,hi,ui=null)=>{const{el:gi,type:mi,transition:yi,children:_i,shapeFlag:vi}=Vt;if(vi&6){oi(Vt.component.subTree,Kt,ni,hi);return}if(vi&128){Vt.suspense.move(Kt,ni,hi);return}if(vi&64){mi.move(Vt,Kt,ni,Qt);return}if(mi===Fragment){st(gi,Kt,ni);for(let xi=0;xi<_i.length;xi++)oi(_i[xi],Kt,ni,hi);st(Vt.anchor,Kt,ni);return}if(mi===Static){Bt(Vt,Kt,ni);return}if(hi!==2&&vi&1&&yi)if(hi===0)yi.beforeEnter(gi),st(gi,Kt,ni),queuePostRenderEffect(()=>yi.enter(gi),ui);else{const{leave:xi,delayLeave:Ei,afterLeave:wi}=yi,Ci=()=>st(gi,Kt,ni),Ii=()=>{xi(gi,()=>{Ci(),wi&&wi()})};Ei?Ei(gi,Ci,Ii):Ii()}else st(gi,Kt,ni)},fi=(Vt,Kt,ni,hi=!1,ui=!1)=>{const{type:gi,props:mi,ref:yi,children:_i,dynamicChildren:vi,shapeFlag:Ti,patchFlag:xi,dirs:Ei}=Vt;if(yi!=null&&setRef(yi,null,ni,Vt,!0),Ti&256){Kt.ctx.deactivate(Vt);return}const wi=Ti&1&&Ei,Ci=!isAsyncWrapper(Vt);let Ii;if(Ci&&(Ii=mi&&mi.onVnodeBeforeUnmount)&&invokeVNodeHook(Ii,Kt,Vt),Ti&6)di(Vt.component,ni,hi);else{if(Ti&128){Vt.suspense.unmount(ni,hi);return}wi&&invokeDirectiveHook(Vt,null,Kt,"beforeUnmount"),Ti&64?Vt.type.remove(Vt,Kt,ni,ui,Qt,hi):vi&&(gi!==Fragment||xi>0&&xi&64)?Nt(vi,Kt,ni,!1,!0):(gi===Fragment&&xi&384||!ui&&Ti&16)&&Nt(_i,Kt,ni),hi&&bi(Vt)}(Ci&&(Ii=mi&&mi.onVnodeUnmounted)||wi)&&queuePostRenderEffect(()=>{Ii&&invokeVNodeHook(Ii,Kt,Vt),wi&&invokeDirectiveHook(Vt,null,Kt,"unmounted")},ni)},bi=Vt=>{const{type:Kt,el:ni,anchor:hi,transition:ui}=Vt;if(Kt===Fragment){ai(ni,hi);return}if(Kt===Static){Gt(Vt);return}const gi=()=>{vt(ni),ui&&!ui.persisted&&ui.afterLeave&&ui.afterLeave()};if(Vt.shapeFlag&1&&ui&&!ui.persisted){const{leave:mi,delayLeave:yi}=ui,_i=()=>mi(ni,gi);yi?yi(Vt.el,gi,_i):_i()}else gi()},ai=(Vt,Kt)=>{let ni;for(;Vt!==Kt;)ni=It(Vt),vt(Vt),Vt=ni;vt(Kt)},di=(Vt,Kt,ni)=>{const{bum:hi,scope:ui,update:gi,subTree:mi,um:yi}=Vt;hi&&invokeArrayFns(hi),ui.stop(),gi&&(gi.active=!1,fi(mi,Vt,Kt,ni)),yi&&queuePostRenderEffect(yi,Kt),queuePostRenderEffect(()=>{Vt.isUnmounted=!0},Kt),Kt&&Kt.pendingBranch&&!Kt.isUnmounted&&Vt.asyncDep&&!Vt.asyncResolved&&Vt.suspenseId===Kt.pendingId&&(Kt.deps--,Kt.deps===0&&Kt.resolve())},Nt=(Vt,Kt,ni,hi=!1,ui=!1,gi=0)=>{for(let mi=gi;mi<Vt.length;mi++)fi(Vt[mi],Kt,ni,hi,ui)},Ft=Vt=>Vt.shapeFlag&6?Ft(Vt.component.subTree):Vt.shapeFlag&128?Vt.suspense.next():It(Vt.anchor||Vt.el),Xt=(Vt,Kt,ni)=>{Vt==null?Kt._vnode&&fi(Kt._vnode,null,null,!0):Mt(Kt._vnode||null,Vt,Kt,null,null,null,ni),flushPreFlushCbs(),flushPostFlushCbs(),Kt._vnode=Vt},Qt={p:Mt,um:fi,m:oi,r:bi,mt:$t,mc:ei,pc:jt,pbc:li,n:Ft,o:rt};let ti,si;return it&&([ti,si]=it(Qt)),{render:Xt,hydrate:ti,createApp:createAppAPI(Xt,ti)}}function toggleRecurse({effect:rt,update:it},nt){rt.allowRecurse=it.allowRecurse=nt}function traverseStaticChildren(rt,it,nt=!1){const st=rt.children,vt=it.children;if(isArray$1(st)&&isArray$1(vt))for(let _t=0;_t<st.length;_t++){const bt=st[_t];let xt=vt[_t];xt.shapeFlag&1&&!xt.dynamicChildren&&((xt.patchFlag<=0||xt.patchFlag===32)&&(xt=vt[_t]=cloneIfMounted(vt[_t]),xt.el=bt.el),nt||traverseStaticChildren(bt,xt))}}function getSequence(rt){const it=rt.slice(),nt=[0];let st,vt,_t,bt,xt;const Tt=rt.length;for(st=0;st<Tt;st++){const Et=rt[st];if(Et!==0){if(vt=nt[nt.length-1],rt[vt]<Et){it[st]=vt,nt.push(st);continue}for(_t=0,bt=nt.length-1;_t<bt;)xt=_t+bt>>1,rt[nt[xt]]<Et?_t=xt+1:bt=xt;Et<rt[nt[_t]]&&(_t>0&&(it[st]=nt[_t-1]),nt[_t]=st)}}for(_t=nt.length,bt=nt[_t-1];_t-- >0;)nt[_t]=bt,bt=it[bt];return nt}const isTeleport=rt=>rt.__isTeleport,Fragment=Symbol(void 0),Text=Symbol(void 0),Comment=Symbol(void 0),Static=Symbol(void 0),blockStack=[];let currentBlock=null;function openBlock(rt=!1){blockStack.push(currentBlock=rt?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(rt){isBlockTreeEnabled+=rt}function setupBlock(rt){return rt.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(rt),rt}function createElementBlock(rt,it,nt,st,vt,_t){return setupBlock(createBaseVNode(rt,it,nt,st,vt,_t,!0))}function createBlock(rt,it,nt,st,vt){return setupBlock(createVNode(rt,it,nt,st,vt,!0))}function isVNode(rt){return rt?rt.__v_isVNode===!0:!1}function isSameVNodeType(rt,it){return rt.type===it.type&&rt.key===it.key}const InternalObjectKey="__vInternal",normalizeKey=({key:rt})=>rt!=null?rt:null,normalizeRef=({ref:rt,ref_key:it,ref_for:nt})=>rt!=null?isString(rt)||isRef(rt)||isFunction(rt)?{i:currentRenderingInstance,r:rt,k:it,f:!!nt}:rt:null;function createBaseVNode(rt,it=null,nt=null,st=0,vt=null,_t=rt===Fragment?0:1,bt=!1,xt=!1){const Tt={__v_isVNode:!0,__v_skip:!0,type:rt,props:it,key:it&&normalizeKey(it),ref:it&&normalizeRef(it),scopeId:currentScopeId,slotScopeIds:null,children:nt,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:_t,patchFlag:st,dynamicProps:vt,dynamicChildren:null,appContext:null};return xt?(normalizeChildren(Tt,nt),_t&128&&rt.normalize(Tt)):nt&&(Tt.shapeFlag|=isString(nt)?8:16),isBlockTreeEnabled>0&&!bt&&currentBlock&&(Tt.patchFlag>0||_t&6)&&Tt.patchFlag!==32&&currentBlock.push(Tt),Tt}const createVNode=_createVNode;function _createVNode(rt,it=null,nt=null,st=0,vt=null,_t=!1){if((!rt||rt===NULL_DYNAMIC_COMPONENT)&&(rt=Comment),isVNode(rt)){const xt=cloneVNode(rt,it,!0);return nt&&normalizeChildren(xt,nt),isBlockTreeEnabled>0&&!_t&&currentBlock&&(xt.shapeFlag&6?currentBlock[currentBlock.indexOf(rt)]=xt:currentBlock.push(xt)),xt.patchFlag|=-2,xt}if(isClassComponent(rt)&&(rt=rt.__vccOpts),it){it=guardReactiveProps(it);let{class:xt,style:Tt}=it;xt&&!isString(xt)&&(it.class=normalizeClass(xt)),isObject(Tt)&&(isProxy(Tt)&&!isArray$1(Tt)&&(Tt=extend({},Tt)),it.style=normalizeStyle(Tt))}const bt=isString(rt)?1:isSuspense(rt)?128:isTeleport(rt)?64:isObject(rt)?4:isFunction(rt)?2:0;return createBaseVNode(rt,it,nt,st,vt,bt,_t,!0)}function guardReactiveProps(rt){return rt?isProxy(rt)||InternalObjectKey in rt?extend({},rt):rt:null}function cloneVNode(rt,it,nt=!1){const{props:st,ref:vt,patchFlag:_t,children:bt}=rt,xt=it?mergeProps(st||{},it):st;return{__v_isVNode:!0,__v_skip:!0,type:rt.type,props:xt,key:xt&&normalizeKey(xt),ref:it&&it.ref?nt&&vt?isArray$1(vt)?vt.concat(normalizeRef(it)):[vt,normalizeRef(it)]:normalizeRef(it):vt,scopeId:rt.scopeId,slotScopeIds:rt.slotScopeIds,children:bt,target:rt.target,targetAnchor:rt.targetAnchor,staticCount:rt.staticCount,shapeFlag:rt.shapeFlag,patchFlag:it&&rt.type!==Fragment?_t===-1?16:_t|16:_t,dynamicProps:rt.dynamicProps,dynamicChildren:rt.dynamicChildren,appContext:rt.appContext,dirs:rt.dirs,transition:rt.transition,component:rt.component,suspense:rt.suspense,ssContent:rt.ssContent&&cloneVNode(rt.ssContent),ssFallback:rt.ssFallback&&cloneVNode(rt.ssFallback),el:rt.el,anchor:rt.anchor}}function createTextVNode(rt=" ",it=0){return createVNode(Text,null,rt,it)}function createStaticVNode(rt,it){const nt=createVNode(Static,null,rt);return nt.staticCount=it,nt}function createCommentVNode(rt="",it=!1){return it?(openBlock(),createBlock(Comment,null,rt)):createVNode(Comment,null,rt)}function normalizeVNode(rt){return rt==null||typeof rt=="boolean"?createVNode(Comment):isArray$1(rt)?createVNode(Fragment,null,rt.slice()):typeof rt=="object"?cloneIfMounted(rt):createVNode(Text,null,String(rt))}function cloneIfMounted(rt){return rt.el===null||rt.memo?rt:cloneVNode(rt)}function normalizeChildren(rt,it){let nt=0;const{shapeFlag:st}=rt;if(it==null)it=null;else if(isArray$1(it))nt=16;else if(typeof it=="object")if(st&65){const vt=it.default;vt&&(vt._c&&(vt._d=!1),normalizeChildren(rt,vt()),vt._c&&(vt._d=!0));return}else{nt=32;const vt=it._;!vt&&!(InternalObjectKey in it)?it._ctx=currentRenderingInstance:vt===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?it._=1:(it._=2,rt.patchFlag|=1024))}else isFunction(it)?(it={default:it,_ctx:currentRenderingInstance},nt=32):(it=String(it),st&64?(nt=16,it=[createTextVNode(it)]):nt=8);rt.children=it,rt.shapeFlag|=nt}function mergeProps(...rt){const it={};for(let nt=0;nt<rt.length;nt++){const st=rt[nt];for(const vt in st)if(vt==="class")it.class!==st.class&&(it.class=normalizeClass([it.class,st.class]));else if(vt==="style")it.style=normalizeStyle([it.style,st.style]);else if(isOn(vt)){const _t=it[vt],bt=st[vt];bt&&_t!==bt&&!(isArray$1(_t)&&_t.includes(bt))&&(it[vt]=_t?[].concat(_t,bt):bt)}else vt!==""&&(it[vt]=st[vt])}return it}function invokeVNodeHook(rt,it,nt,st=null){callWithAsyncErrorHandling(rt,it,7,[nt,st])}const emptyAppContext=createAppContext();let uid$1=0;function createComponentInstance(rt,it,nt){const st=rt.type,vt=(it?it.appContext:rt.appContext)||emptyAppContext,_t={uid:uid$1++,vnode:rt,type:st,parent:it,appContext:vt,root:null,next:null,subTree:null,effect:null,update:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:it?it.provides:Object.create(vt.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(st,vt),emitsOptions:normalizeEmitsOptions(st,vt),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:st.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,suspense:nt,suspenseId:nt?nt.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return _t.ctx={_:_t},_t.root=it?it.root:_t,_t.emit=emit$1.bind(null,_t),rt.ce&&rt.ce(_t),_t}let currentInstance=null;const setCurrentInstance=rt=>{currentInstance=rt,rt.scope.on()},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),currentInstance=null};function isStatefulComponent(rt){return rt.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(rt,it=!1){isInSSRComponentSetup=it;const{props:nt,children:st}=rt.vnode,vt=isStatefulComponent(rt);initProps(rt,nt,vt,it),initSlots(rt,st);const _t=vt?setupStatefulComponent(rt,it):void 0;return isInSSRComponentSetup=!1,_t}function setupStatefulComponent(rt,it){const nt=rt.type;rt.accessCache=Object.create(null),rt.proxy=markRaw(new Proxy(rt.ctx,PublicInstanceProxyHandlers));const{setup:st}=nt;if(st){const vt=rt.setupContext=st.length>1?createSetupContext(rt):null;setCurrentInstance(rt),pauseTracking();const _t=callWithErrorHandling(st,rt,0,[rt.props,vt]);if(resetTracking(),unsetCurrentInstance(),isPromise(_t)){if(_t.then(unsetCurrentInstance,unsetCurrentInstance),it)return _t.then(bt=>{handleSetupResult(rt,bt,it)}).catch(bt=>{handleError(bt,rt,0)});rt.asyncDep=_t}else handleSetupResult(rt,_t,it)}else finishComponentSetup(rt,it)}function handleSetupResult(rt,it,nt){isFunction(it)?rt.type.__ssrInlineRender?rt.ssrRender=it:rt.render=it:isObject(it)&&(rt.setupState=proxyRefs(it)),finishComponentSetup(rt,nt)}let compile;function finishComponentSetup(rt,it,nt){const st=rt.type;if(!rt.render){if(!it&&compile&&!st.render){const vt=st.template||resolveMergedOptions(rt).template;if(vt){const{isCustomElement:_t,compilerOptions:bt}=rt.appContext.config,{delimiters:xt,compilerOptions:Tt}=st,Et=extend(extend({isCustomElement:_t,delimiters:xt},bt),Tt);st.render=compile(vt,Et)}}rt.render=st.render||NOOP}setCurrentInstance(rt),pauseTracking(),applyOptions(rt),resetTracking(),unsetCurrentInstance()}function createAttrsProxy(rt){return new Proxy(rt.attrs,{get(it,nt){return track(rt,"get","$attrs"),it[nt]}})}function createSetupContext(rt){const it=st=>{rt.exposed=st||{}};let nt;return{get attrs(){return nt||(nt=createAttrsProxy(rt))},slots:rt.slots,emit:rt.emit,expose:it}}function getExposeProxy(rt){if(rt.exposed)return rt.exposeProxy||(rt.exposeProxy=new Proxy(proxyRefs(markRaw(rt.exposed)),{get(it,nt){if(nt in it)return it[nt];if(nt in publicPropertiesMap)return publicPropertiesMap[nt](rt)}}))}function isClassComponent(rt){return isFunction(rt)&&"__vccOpts"in rt}const computed=(rt,it)=>computed$1(rt,it,isInSSRComponentSetup);function h$1(rt,it,nt){const st=arguments.length;return st===2?isObject(it)&&!isArray$1(it)?isVNode(it)?createVNode(rt,null,[it]):createVNode(rt,it):createVNode(rt,null,it):(st>3?nt=Array.prototype.slice.call(arguments,2):st===3&&isVNode(nt)&&(nt=[nt]),createVNode(rt,it,nt))}const version="3.2.39",svgNS="http://www.w3.org/2000/svg",doc=typeof document<"u"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(rt,it,nt)=>{it.insertBefore(rt,nt||null)},remove:rt=>{const it=rt.parentNode;it&&it.removeChild(rt)},createElement:(rt,it,nt,st)=>{const vt=it?doc.createElementNS(svgNS,rt):doc.createElement(rt,nt?{is:nt}:void 0);return rt==="select"&&st&&st.multiple!=null&&vt.setAttribute("multiple",st.multiple),vt},createText:rt=>doc.createTextNode(rt),createComment:rt=>doc.createComment(rt),setText:(rt,it)=>{rt.nodeValue=it},setElementText:(rt,it)=>{rt.textContent=it},parentNode:rt=>rt.parentNode,nextSibling:rt=>rt.nextSibling,querySelector:rt=>doc.querySelector(rt),setScopeId(rt,it){rt.setAttribute(it,"")},cloneNode(rt){const it=rt.cloneNode(!0);return"_value"in rt&&(it._value=rt._value),it},insertStaticContent(rt,it,nt,st,vt,_t){const bt=nt?nt.previousSibling:it.lastChild;if(vt&&(vt===_t||vt.nextSibling))for(;it.insertBefore(vt.cloneNode(!0),nt),!(vt===_t||!(vt=vt.nextSibling)););else{templateContainer.innerHTML=st?`<svg>${rt}</svg>`:rt;const xt=templateContainer.content;if(st){const Tt=xt.firstChild;for(;Tt.firstChild;)xt.appendChild(Tt.firstChild);xt.removeChild(Tt)}it.insertBefore(xt,nt)}return[bt?bt.nextSibling:it.firstChild,nt?nt.previousSibling:it.lastChild]}};function patchClass(rt,it,nt){const st=rt._vtc;st&&(it=(it?[it,...st]:[...st]).join(" ")),it==null?rt.removeAttribute("class"):nt?rt.setAttribute("class",it):rt.className=it}function patchStyle(rt,it,nt){const st=rt.style,vt=isString(nt);if(nt&&!vt){for(const _t in nt)setStyle(st,_t,nt[_t]);if(it&&!isString(it))for(const _t in it)nt[_t]==null&&setStyle(st,_t,"")}else{const _t=st.display;vt?it!==nt&&(st.cssText=nt):it&&rt.removeAttribute("style"),"_vod"in rt&&(st.display=_t)}}const importantRE=/\s*!important$/;function setStyle(rt,it,nt){if(isArray$1(nt))nt.forEach(st=>setStyle(rt,it,st));else if(nt==null&&(nt=""),it.startsWith("--"))rt.setProperty(it,nt);else{const st=autoPrefix(rt,it);importantRE.test(nt)?rt.setProperty(hyphenate(st),nt.replace(importantRE,""),"important"):rt[st]=nt}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(rt,it){const nt=prefixCache[it];if(nt)return nt;let st=camelize(it);if(st!=="filter"&&st in rt)return prefixCache[it]=st;st=capitalize(st);for(let vt=0;vt<prefixes.length;vt++){const _t=prefixes[vt]+st;if(_t in rt)return prefixCache[it]=_t}return it}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(rt,it,nt,st,vt){if(st&&it.startsWith("xlink:"))nt==null?rt.removeAttributeNS(xlinkNS,it.slice(6,it.length)):rt.setAttributeNS(xlinkNS,it,nt);else{const _t=isSpecialBooleanAttr(it);nt==null||_t&&!includeBooleanAttr(nt)?rt.removeAttribute(it):rt.setAttribute(it,_t?"":nt)}}function patchDOMProp(rt,it,nt,st,vt,_t,bt){if(it==="innerHTML"||it==="textContent"){st&&bt(st,vt,_t),rt[it]=nt==null?"":nt;return}if(it==="value"&&rt.tagName!=="PROGRESS"&&!rt.tagName.includes("-")){rt._value=nt;const Tt=nt==null?"":nt;(rt.value!==Tt||rt.tagName==="OPTION")&&(rt.value=Tt),nt==null&&rt.removeAttribute(it);return}let xt=!1;if(nt===""||nt==null){const Tt=typeof rt[it];Tt==="boolean"?nt=includeBooleanAttr(nt):nt==null&&Tt==="string"?(nt="",xt=!0):Tt==="number"&&(nt=0,xt=!0)}try{rt[it]=nt}catch{}xt&&rt.removeAttribute(it)}const[_getNow,skipTimestampCheck]=(()=>{let rt=Date.now,it=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(rt=performance.now.bind(performance));const nt=navigator.userAgent.match(/firefox\/(\d+)/i);it=!!(nt&&Number(nt[1])<=53)}return[rt,it]})();let cachedNow=0;const p$2=Promise.resolve(),reset=()=>{cachedNow=0},getNow=()=>cachedNow||(p$2.then(reset),cachedNow=_getNow());function addEventListener(rt,it,nt,st){rt.addEventListener(it,nt,st)}function removeEventListener(rt,it,nt,st){rt.removeEventListener(it,nt,st)}function patchEvent(rt,it,nt,st,vt=null){const _t=rt._vei||(rt._vei={}),bt=_t[it];if(st&&bt)bt.value=st;else{const[xt,Tt]=parseName(it);if(st){const Et=_t[it]=createInvoker(st,vt);addEventListener(rt,xt,Et,Tt)}else bt&&(removeEventListener(rt,xt,bt,Tt),_t[it]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(rt){let it;if(optionsModifierRE.test(rt)){it={};let st;for(;st=rt.match(optionsModifierRE);)rt=rt.slice(0,rt.length-st[0].length),it[st[0].toLowerCase()]=!0}return[rt[2]===":"?rt.slice(3):hyphenate(rt.slice(2)),it]}function createInvoker(rt,it){const nt=st=>{const vt=st.timeStamp||_getNow();(skipTimestampCheck||vt>=nt.attached-1)&&callWithAsyncErrorHandling(patchStopImmediatePropagation(st,nt.value),it,5,[st])};return nt.value=rt,nt.attached=getNow(),nt}function patchStopImmediatePropagation(rt,it){if(isArray$1(it)){const nt=rt.stopImmediatePropagation;return rt.stopImmediatePropagation=()=>{nt.call(rt),rt._stopped=!0},it.map(st=>vt=>!vt._stopped&&st&&st(vt))}else return it}const nativeOnRE=/^on[a-z]/,patchProp=(rt,it,nt,st,vt=!1,_t,bt,xt,Tt)=>{it==="class"?patchClass(rt,st,vt):it==="style"?patchStyle(rt,nt,st):isOn(it)?isModelListener(it)||patchEvent(rt,it,nt,st,bt):(it[0]==="."?(it=it.slice(1),!0):it[0]==="^"?(it=it.slice(1),!1):shouldSetAsProp(rt,it,st,vt))?patchDOMProp(rt,it,st,_t,bt,xt,Tt):(it==="true-value"?rt._trueValue=st:it==="false-value"&&(rt._falseValue=st),patchAttr(rt,it,st,vt))};function shouldSetAsProp(rt,it,nt,st){return st?!!(it==="innerHTML"||it==="textContent"||it in rt&&nativeOnRE.test(it)&&isFunction(nt)):it==="spellcheck"||it==="draggable"||it==="translate"||it==="form"||it==="list"&&rt.tagName==="INPUT"||it==="type"&&rt.tagName==="TEXTAREA"||nativeOnRE.test(it)&&isString(nt)?!1:it in rt}const rendererOptions=extend({patchProp},nodeOps);let renderer;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}const createApp=(...rt)=>{const it=ensureRenderer().createApp(...rt),{mount:nt}=it;return it.mount=st=>{const vt=normalizeContainer(st);if(!vt)return;const _t=it._component;!isFunction(_t)&&!_t.render&&!_t.template&&(_t.template=vt.innerHTML),vt.innerHTML="";const bt=nt(vt,!1,vt instanceof SVGElement);return vt instanceof Element&&(vt.removeAttribute("v-cloak"),vt.setAttribute("data-v-app","")),bt},it};function normalizeContainer(rt){return isString(rt)?document.querySelector(rt):rt}var isVue2=!1;/*!
  * pinia v2.0.22
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const piniaSymbol=Symbol();var MutationType;(function(rt){rt.direct="direct",rt.patchObject="patch object",rt.patchFunction="patch function"})(MutationType||(MutationType={}));function createPinia(){const rt=effectScope(!0),it=rt.run(()=>ref({}));let nt=[],st=[];const vt=markRaw({install(_t){vt._a=_t,_t.provide(piniaSymbol,vt),_t.config.globalProperties.$pinia=vt,st.forEach(bt=>nt.push(bt)),st=[]},use(_t){return!this._a&&!isVue2?st.push(_t):nt.push(_t),this},_p:nt,_a:null,_e:rt,_s:new Map,state:it});return vt}/*!
  * vue-router v4.1.5
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const isBrowser=typeof window<"u";function isESModule(rt){return rt.__esModule||rt[Symbol.toStringTag]==="Module"}const assign=Object.assign;function applyToParams(rt,it){const nt={};for(const st in it){const vt=it[st];nt[st]=isArray(vt)?vt.map(rt):rt(vt)}return nt}const noop=()=>{},isArray=Array.isArray,TRAILING_SLASH_RE=/\/$/,removeTrailingSlash=rt=>rt.replace(TRAILING_SLASH_RE,"");function parseURL(rt,it,nt="/"){let st,vt={},_t="",bt="";const xt=it.indexOf("#");let Tt=it.indexOf("?");return xt<Tt&&xt>=0&&(Tt=-1),Tt>-1&&(st=it.slice(0,Tt),_t=it.slice(Tt+1,xt>-1?xt:it.length),vt=rt(_t)),xt>-1&&(st=st||it.slice(0,xt),bt=it.slice(xt,it.length)),st=resolveRelativePath(st!=null?st:it,nt),{fullPath:st+(_t&&"?")+_t+bt,path:st,query:vt,hash:bt}}function stringifyURL(rt,it){const nt=it.query?rt(it.query):"";return it.path+(nt&&"?")+nt+(it.hash||"")}function stripBase(rt,it){return!it||!rt.toLowerCase().startsWith(it.toLowerCase())?rt:rt.slice(it.length)||"/"}function isSameRouteLocation(rt,it,nt){const st=it.matched.length-1,vt=nt.matched.length-1;return st>-1&&st===vt&&isSameRouteRecord(it.matched[st],nt.matched[vt])&&isSameRouteLocationParams(it.params,nt.params)&&rt(it.query)===rt(nt.query)&&it.hash===nt.hash}function isSameRouteRecord(rt,it){return(rt.aliasOf||rt)===(it.aliasOf||it)}function isSameRouteLocationParams(rt,it){if(Object.keys(rt).length!==Object.keys(it).length)return!1;for(const nt in rt)if(!isSameRouteLocationParamsValue(rt[nt],it[nt]))return!1;return!0}function isSameRouteLocationParamsValue(rt,it){return isArray(rt)?isEquivalentArray(rt,it):isArray(it)?isEquivalentArray(it,rt):rt===it}function isEquivalentArray(rt,it){return isArray(it)?rt.length===it.length&&rt.every((nt,st)=>nt===it[st]):rt.length===1&&rt[0]===it}function resolveRelativePath(rt,it){if(rt.startsWith("/"))return rt;if(!rt)return it;const nt=it.split("/"),st=rt.split("/");let vt=nt.length-1,_t,bt;for(_t=0;_t<st.length;_t++)if(bt=st[_t],bt!==".")if(bt==="..")vt>1&&vt--;else break;return nt.slice(0,vt).join("/")+"/"+st.slice(_t-(_t===st.length?1:0)).join("/")}var NavigationType;(function(rt){rt.pop="pop",rt.push="push"})(NavigationType||(NavigationType={}));var NavigationDirection;(function(rt){rt.back="back",rt.forward="forward",rt.unknown=""})(NavigationDirection||(NavigationDirection={}));function normalizeBase(rt){if(!rt)if(isBrowser){const it=document.querySelector("base");rt=it&&it.getAttribute("href")||"/",rt=rt.replace(/^\w+:\/\/[^\/]+/,"")}else rt="/";return rt[0]!=="/"&&rt[0]!=="#"&&(rt="/"+rt),removeTrailingSlash(rt)}const BEFORE_HASH_RE=/^[^#]+#/;function createHref(rt,it){return rt.replace(BEFORE_HASH_RE,"#")+it}function getElementPosition(rt,it){const nt=document.documentElement.getBoundingClientRect(),st=rt.getBoundingClientRect();return{behavior:it.behavior,left:st.left-nt.left-(it.left||0),top:st.top-nt.top-(it.top||0)}}const computeScrollPosition=()=>({left:window.pageXOffset,top:window.pageYOffset});function scrollToPosition(rt){let it;if("el"in rt){const nt=rt.el,st=typeof nt=="string"&&nt.startsWith("#"),vt=typeof nt=="string"?st?document.getElementById(nt.slice(1)):document.querySelector(nt):nt;if(!vt)return;it=getElementPosition(vt,rt)}else it=rt;"scrollBehavior"in document.documentElement.style?window.scrollTo(it):window.scrollTo(it.left!=null?it.left:window.pageXOffset,it.top!=null?it.top:window.pageYOffset)}function getScrollKey(rt,it){return(history.state?history.state.position-it:-1)+rt}const scrollPositions=new Map;function saveScrollPosition(rt,it){scrollPositions.set(rt,it)}function getSavedScrollPosition(rt){const it=scrollPositions.get(rt);return scrollPositions.delete(rt),it}let createBaseLocation=()=>location.protocol+"//"+location.host;function createCurrentLocation(rt,it){const{pathname:nt,search:st,hash:vt}=it,_t=rt.indexOf("#");if(_t>-1){let xt=vt.includes(rt.slice(_t))?rt.slice(_t).length:1,Tt=vt.slice(xt);return Tt[0]!=="/"&&(Tt="/"+Tt),stripBase(Tt,"")}return stripBase(nt,rt)+st+vt}function useHistoryListeners(rt,it,nt,st){let vt=[],_t=[],bt=null;const xt=({state:It})=>{const At=createCurrentLocation(rt,location),Dt=nt.value,kt=it.value;let Mt=0;if(It){if(nt.value=At,it.value=It,bt&&bt===Dt){bt=null;return}Mt=kt?It.position-kt.position:0}else st(At);vt.forEach(zt=>{zt(nt.value,Dt,{delta:Mt,type:NavigationType.pop,direction:Mt?Mt>0?NavigationDirection.forward:NavigationDirection.back:NavigationDirection.unknown})})};function Tt(){bt=nt.value}function Et(It){vt.push(It);const At=()=>{const Dt=vt.indexOf(It);Dt>-1&&vt.splice(Dt,1)};return _t.push(At),At}function wt(){const{history:It}=window;!It.state||It.replaceState(assign({},It.state,{scroll:computeScrollPosition()}),"")}function Ot(){for(const It of _t)It();_t=[],window.removeEventListener("popstate",xt),window.removeEventListener("beforeunload",wt)}return window.addEventListener("popstate",xt),window.addEventListener("beforeunload",wt),{pauseListeners:Tt,listen:Et,destroy:Ot}}function buildState(rt,it,nt,st=!1,vt=!1){return{back:rt,current:it,forward:nt,replaced:st,position:window.history.length,scroll:vt?computeScrollPosition():null}}function useHistoryStateNavigation(rt){const{history:it,location:nt}=window,st={value:createCurrentLocation(rt,nt)},vt={value:it.state};vt.value||_t(st.value,{back:null,current:st.value,forward:null,position:it.length-1,replaced:!0,scroll:null},!0);function _t(Tt,Et,wt){const Ot=rt.indexOf("#"),It=Ot>-1?(nt.host&&document.querySelector("base")?rt:rt.slice(Ot))+Tt:createBaseLocation()+rt+Tt;try{it[wt?"replaceState":"pushState"](Et,"",It),vt.value=Et}catch(At){console.error(At),nt[wt?"replace":"assign"](It)}}function bt(Tt,Et){const wt=assign({},it.state,buildState(vt.value.back,Tt,vt.value.forward,!0),Et,{position:vt.value.position});_t(Tt,wt,!0),st.value=Tt}function xt(Tt,Et){const wt=assign({},vt.value,it.state,{forward:Tt,scroll:computeScrollPosition()});_t(wt.current,wt,!0);const Ot=assign({},buildState(st.value,Tt,null),{position:wt.position+1},Et);_t(Tt,Ot,!1),st.value=Tt}return{location:st,state:vt,push:xt,replace:bt}}function createWebHistory(rt){rt=normalizeBase(rt);const it=useHistoryStateNavigation(rt),nt=useHistoryListeners(rt,it.state,it.location,it.replace);function st(_t,bt=!0){bt||nt.pauseListeners(),history.go(_t)}const vt=assign({location:"",base:rt,go:st,createHref:createHref.bind(null,rt)},it,nt);return Object.defineProperty(vt,"location",{enumerable:!0,get:()=>it.location.value}),Object.defineProperty(vt,"state",{enumerable:!0,get:()=>it.state.value}),vt}function isRouteLocation(rt){return typeof rt=="string"||rt&&typeof rt=="object"}function isRouteName(rt){return typeof rt=="string"||typeof rt=="symbol"}const START_LOCATION_NORMALIZED={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},NavigationFailureSymbol=Symbol("");var NavigationFailureType;(function(rt){rt[rt.aborted=4]="aborted",rt[rt.cancelled=8]="cancelled",rt[rt.duplicated=16]="duplicated"})(NavigationFailureType||(NavigationFailureType={}));function createRouterError(rt,it){return assign(new Error,{type:rt,[NavigationFailureSymbol]:!0},it)}function isNavigationFailure(rt,it){return rt instanceof Error&&NavigationFailureSymbol in rt&&(it==null||!!(rt.type&it))}const BASE_PARAM_PATTERN="[^/]+?",BASE_PATH_PARSER_OPTIONS={sensitive:!1,strict:!1,start:!0,end:!0},REGEX_CHARS_RE=/[.+*?^${}()[\]/\\]/g;function tokensToParser(rt,it){const nt=assign({},BASE_PATH_PARSER_OPTIONS,it),st=[];let vt=nt.start?"^":"";const _t=[];for(const Et of rt){const wt=Et.length?[]:[90];nt.strict&&!Et.length&&(vt+="/");for(let Ot=0;Ot<Et.length;Ot++){const It=Et[Ot];let At=40+(nt.sensitive?.25:0);if(It.type===0)Ot||(vt+="/"),vt+=It.value.replace(REGEX_CHARS_RE,"\\$&"),At+=40;else if(It.type===1){const{value:Dt,repeatable:kt,optional:Mt,regexp:zt}=It;_t.push({name:Dt,repeatable:kt,optional:Mt});const Pt=zt||BASE_PARAM_PATTERN;if(Pt!==BASE_PARAM_PATTERN){At+=10;try{new RegExp(`(${Pt})`)}catch(Bt){throw new Error(`Invalid custom RegExp for param "${Dt}" (${Pt}): `+Bt.message)}}let Lt=kt?`((?:${Pt})(?:/(?:${Pt}))*)`:`(${Pt})`;Ot||(Lt=Mt&&Et.length<2?`(?:/${Lt})`:"/"+Lt),Mt&&(Lt+="?"),vt+=Lt,At+=20,Mt&&(At+=-8),kt&&(At+=-20),Pt===".*"&&(At+=-50)}wt.push(At)}st.push(wt)}if(nt.strict&&nt.end){const Et=st.length-1;st[Et][st[Et].length-1]+=.7000000000000001}nt.strict||(vt+="/?"),nt.end?vt+="$":nt.strict&&(vt+="(?:/|$)");const bt=new RegExp(vt,nt.sensitive?"":"i");function xt(Et){const wt=Et.match(bt),Ot={};if(!wt)return null;for(let It=1;It<wt.length;It++){const At=wt[It]||"",Dt=_t[It-1];Ot[Dt.name]=At&&Dt.repeatable?At.split("/"):At}return Ot}function Tt(Et){let wt="",Ot=!1;for(const It of rt){(!Ot||!wt.endsWith("/"))&&(wt+="/"),Ot=!1;for(const At of It)if(At.type===0)wt+=At.value;else if(At.type===1){const{value:Dt,repeatable:kt,optional:Mt}=At,zt=Dt in Et?Et[Dt]:"";if(isArray(zt)&&!kt)throw new Error(`Provided param "${Dt}" is an array but it is not repeatable (* or + modifiers)`);const Pt=isArray(zt)?zt.join("/"):zt;if(!Pt)if(Mt)It.length<2&&(wt.endsWith("/")?wt=wt.slice(0,-1):Ot=!0);else throw new Error(`Missing required param "${Dt}"`);wt+=Pt}}return wt||"/"}return{re:bt,score:st,keys:_t,parse:xt,stringify:Tt}}function compareScoreArray(rt,it){let nt=0;for(;nt<rt.length&&nt<it.length;){const st=it[nt]-rt[nt];if(st)return st;nt++}return rt.length<it.length?rt.length===1&&rt[0]===40+40?-1:1:rt.length>it.length?it.length===1&&it[0]===40+40?1:-1:0}function comparePathParserScore(rt,it){let nt=0;const st=rt.score,vt=it.score;for(;nt<st.length&&nt<vt.length;){const _t=compareScoreArray(st[nt],vt[nt]);if(_t)return _t;nt++}if(Math.abs(vt.length-st.length)===1){if(isLastScoreNegative(st))return 1;if(isLastScoreNegative(vt))return-1}return vt.length-st.length}function isLastScoreNegative(rt){const it=rt[rt.length-1];return rt.length>0&&it[it.length-1]<0}const ROOT_TOKEN={type:0,value:""},VALID_PARAM_RE=/[a-zA-Z0-9_]/;function tokenizePath(rt){if(!rt)return[[]];if(rt==="/")return[[ROOT_TOKEN]];if(!rt.startsWith("/"))throw new Error(`Invalid path "${rt}"`);function it(At){throw new Error(`ERR (${nt})/"${Et}": ${At}`)}let nt=0,st=nt;const vt=[];let _t;function bt(){_t&&vt.push(_t),_t=[]}let xt=0,Tt,Et="",wt="";function Ot(){!Et||(nt===0?_t.push({type:0,value:Et}):nt===1||nt===2||nt===3?(_t.length>1&&(Tt==="*"||Tt==="+")&&it(`A repeatable param (${Et}) must be alone in its segment. eg: '/:ids+.`),_t.push({type:1,value:Et,regexp:wt,repeatable:Tt==="*"||Tt==="+",optional:Tt==="*"||Tt==="?"})):it("Invalid state to consume buffer"),Et="")}function It(){Et+=Tt}for(;xt<rt.length;){if(Tt=rt[xt++],Tt==="\\"&&nt!==2){st=nt,nt=4;continue}switch(nt){case 0:Tt==="/"?(Et&&Ot(),bt()):Tt===":"?(Ot(),nt=1):It();break;case 4:It(),nt=st;break;case 1:Tt==="("?nt=2:VALID_PARAM_RE.test(Tt)?It():(Ot(),nt=0,Tt!=="*"&&Tt!=="?"&&Tt!=="+"&&xt--);break;case 2:Tt===")"?wt[wt.length-1]=="\\"?wt=wt.slice(0,-1)+Tt:nt=3:wt+=Tt;break;case 3:Ot(),nt=0,Tt!=="*"&&Tt!=="?"&&Tt!=="+"&&xt--,wt="";break;default:it("Unknown state");break}}return nt===2&&it(`Unfinished custom RegExp for param "${Et}"`),Ot(),bt(),vt}function createRouteRecordMatcher(rt,it,nt){const st=tokensToParser(tokenizePath(rt.path),nt),vt=assign(st,{record:rt,parent:it,children:[],alias:[]});return it&&!vt.record.aliasOf==!it.record.aliasOf&&it.children.push(vt),vt}function createRouterMatcher(rt,it){const nt=[],st=new Map;it=mergeOptions({strict:!1,end:!0,sensitive:!1},it);function vt(wt){return st.get(wt)}function _t(wt,Ot,It){const At=!It,Dt=normalizeRouteRecord(wt);Dt.aliasOf=It&&It.record;const kt=mergeOptions(it,wt),Mt=[Dt];if("alias"in wt){const Lt=typeof wt.alias=="string"?[wt.alias]:wt.alias;for(const Bt of Lt)Mt.push(assign({},Dt,{components:It?It.record.components:Dt.components,path:Bt,aliasOf:It?It.record:Dt}))}let zt,Pt;for(const Lt of Mt){const{path:Bt}=Lt;if(Ot&&Bt[0]!=="/"){const Gt=Ot.record.path,Ut=Gt[Gt.length-1]==="/"?"":"/";Lt.path=Ot.record.path+(Bt&&Ut+Bt)}if(zt=createRouteRecordMatcher(Lt,Ot,kt),It?It.alias.push(zt):(Pt=Pt||zt,Pt!==zt&&Pt.alias.push(zt),At&&wt.name&&!isAliasRecord(zt)&&bt(wt.name)),Dt.children){const Gt=Dt.children;for(let Ut=0;Ut<Gt.length;Ut++)_t(Gt[Ut],zt,It&&It.children[Ut])}It=It||zt,Tt(zt)}return Pt?()=>{bt(Pt)}:noop}function bt(wt){if(isRouteName(wt)){const Ot=st.get(wt);Ot&&(st.delete(wt),nt.splice(nt.indexOf(Ot),1),Ot.children.forEach(bt),Ot.alias.forEach(bt))}else{const Ot=nt.indexOf(wt);Ot>-1&&(nt.splice(Ot,1),wt.record.name&&st.delete(wt.record.name),wt.children.forEach(bt),wt.alias.forEach(bt))}}function xt(){return nt}function Tt(wt){let Ot=0;for(;Ot<nt.length&&comparePathParserScore(wt,nt[Ot])>=0&&(wt.record.path!==nt[Ot].record.path||!isRecordChildOf(wt,nt[Ot]));)Ot++;nt.splice(Ot,0,wt),wt.record.name&&!isAliasRecord(wt)&&st.set(wt.record.name,wt)}function Et(wt,Ot){let It,At={},Dt,kt;if("name"in wt&&wt.name){if(It=st.get(wt.name),!It)throw createRouterError(1,{location:wt});kt=It.record.name,At=assign(paramsFromLocation(Ot.params,It.keys.filter(Pt=>!Pt.optional).map(Pt=>Pt.name)),wt.params&&paramsFromLocation(wt.params,It.keys.map(Pt=>Pt.name))),Dt=It.stringify(At)}else if("path"in wt)Dt=wt.path,It=nt.find(Pt=>Pt.re.test(Dt)),It&&(At=It.parse(Dt),kt=It.record.name);else{if(It=Ot.name?st.get(Ot.name):nt.find(Pt=>Pt.re.test(Ot.path)),!It)throw createRouterError(1,{location:wt,currentLocation:Ot});kt=It.record.name,At=assign({},Ot.params,wt.params),Dt=It.stringify(At)}const Mt=[];let zt=It;for(;zt;)Mt.unshift(zt.record),zt=zt.parent;return{name:kt,path:Dt,params:At,matched:Mt,meta:mergeMetaFields(Mt)}}return rt.forEach(wt=>_t(wt)),{addRoute:_t,resolve:Et,removeRoute:bt,getRoutes:xt,getRecordMatcher:vt}}function paramsFromLocation(rt,it){const nt={};for(const st of it)st in rt&&(nt[st]=rt[st]);return nt}function normalizeRouteRecord(rt){return{path:rt.path,redirect:rt.redirect,name:rt.name,meta:rt.meta||{},aliasOf:void 0,beforeEnter:rt.beforeEnter,props:normalizeRecordProps(rt),children:rt.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in rt?rt.components||null:rt.component&&{default:rt.component}}}function normalizeRecordProps(rt){const it={},nt=rt.props||!1;if("component"in rt)it.default=nt;else for(const st in rt.components)it[st]=typeof nt=="boolean"?nt:nt[st];return it}function isAliasRecord(rt){for(;rt;){if(rt.record.aliasOf)return!0;rt=rt.parent}return!1}function mergeMetaFields(rt){return rt.reduce((it,nt)=>assign(it,nt.meta),{})}function mergeOptions(rt,it){const nt={};for(const st in rt)nt[st]=st in it?it[st]:rt[st];return nt}function isRecordChildOf(rt,it){return it.children.some(nt=>nt===rt||isRecordChildOf(rt,nt))}const HASH_RE=/#/g,AMPERSAND_RE=/&/g,SLASH_RE=/\//g,EQUAL_RE=/=/g,IM_RE=/\?/g,PLUS_RE=/\+/g,ENC_BRACKET_OPEN_RE=/%5B/g,ENC_BRACKET_CLOSE_RE=/%5D/g,ENC_CARET_RE=/%5E/g,ENC_BACKTICK_RE=/%60/g,ENC_CURLY_OPEN_RE=/%7B/g,ENC_PIPE_RE=/%7C/g,ENC_CURLY_CLOSE_RE=/%7D/g,ENC_SPACE_RE=/%20/g;function commonEncode(rt){return encodeURI(""+rt).replace(ENC_PIPE_RE,"|").replace(ENC_BRACKET_OPEN_RE,"[").replace(ENC_BRACKET_CLOSE_RE,"]")}function encodeHash(rt){return commonEncode(rt).replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryValue(rt){return commonEncode(rt).replace(PLUS_RE,"%2B").replace(ENC_SPACE_RE,"+").replace(HASH_RE,"%23").replace(AMPERSAND_RE,"%26").replace(ENC_BACKTICK_RE,"`").replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryKey(rt){return encodeQueryValue(rt).replace(EQUAL_RE,"%3D")}function encodePath(rt){return commonEncode(rt).replace(HASH_RE,"%23").replace(IM_RE,"%3F")}function encodeParam(rt){return rt==null?"":encodePath(rt).replace(SLASH_RE,"%2F")}function decode(rt){try{return decodeURIComponent(""+rt)}catch{}return""+rt}function parseQuery(rt){const it={};if(rt===""||rt==="?")return it;const st=(rt[0]==="?"?rt.slice(1):rt).split("&");for(let vt=0;vt<st.length;++vt){const _t=st[vt].replace(PLUS_RE," "),bt=_t.indexOf("="),xt=decode(bt<0?_t:_t.slice(0,bt)),Tt=bt<0?null:decode(_t.slice(bt+1));if(xt in it){let Et=it[xt];isArray(Et)||(Et=it[xt]=[Et]),Et.push(Tt)}else it[xt]=Tt}return it}function stringifyQuery(rt){let it="";for(let nt in rt){const st=rt[nt];if(nt=encodeQueryKey(nt),st==null){st!==void 0&&(it+=(it.length?"&":"")+nt);continue}(isArray(st)?st.map(_t=>_t&&encodeQueryValue(_t)):[st&&encodeQueryValue(st)]).forEach(_t=>{_t!==void 0&&(it+=(it.length?"&":"")+nt,_t!=null&&(it+="="+_t))})}return it}function normalizeQuery(rt){const it={};for(const nt in rt){const st=rt[nt];st!==void 0&&(it[nt]=isArray(st)?st.map(vt=>vt==null?null:""+vt):st==null?st:""+st)}return it}const matchedRouteKey=Symbol(""),viewDepthKey=Symbol(""),routerKey=Symbol(""),routeLocationKey=Symbol(""),routerViewLocationKey=Symbol("");function useCallbacks(){let rt=[];function it(st){return rt.push(st),()=>{const vt=rt.indexOf(st);vt>-1&&rt.splice(vt,1)}}function nt(){rt=[]}return{add:it,list:()=>rt,reset:nt}}function guardToPromiseFn(rt,it,nt,st,vt){const _t=st&&(st.enterCallbacks[vt]=st.enterCallbacks[vt]||[]);return()=>new Promise((bt,xt)=>{const Tt=Ot=>{Ot===!1?xt(createRouterError(4,{from:nt,to:it})):Ot instanceof Error?xt(Ot):isRouteLocation(Ot)?xt(createRouterError(2,{from:it,to:Ot})):(_t&&st.enterCallbacks[vt]===_t&&typeof Ot=="function"&&_t.push(Ot),bt())},Et=rt.call(st&&st.instances[vt],it,nt,Tt);let wt=Promise.resolve(Et);rt.length<3&&(wt=wt.then(Tt)),wt.catch(Ot=>xt(Ot))})}function extractComponentsGuards(rt,it,nt,st){const vt=[];for(const _t of rt)for(const bt in _t.components){let xt=_t.components[bt];if(!(it!=="beforeRouteEnter"&&!_t.instances[bt]))if(isRouteComponent(xt)){const Et=(xt.__vccOpts||xt)[it];Et&&vt.push(guardToPromiseFn(Et,nt,st,_t,bt))}else{let Tt=xt();vt.push(()=>Tt.then(Et=>{if(!Et)return Promise.reject(new Error(`Couldn't resolve component "${bt}" at "${_t.path}"`));const wt=isESModule(Et)?Et.default:Et;_t.components[bt]=wt;const It=(wt.__vccOpts||wt)[it];return It&&guardToPromiseFn(It,nt,st,_t,bt)()}))}}return vt}function isRouteComponent(rt){return typeof rt=="object"||"displayName"in rt||"props"in rt||"__vccOpts"in rt}function useLink(rt){const it=inject(routerKey),nt=inject(routeLocationKey),st=computed(()=>it.resolve(unref(rt.to))),vt=computed(()=>{const{matched:Tt}=st.value,{length:Et}=Tt,wt=Tt[Et-1],Ot=nt.matched;if(!wt||!Ot.length)return-1;const It=Ot.findIndex(isSameRouteRecord.bind(null,wt));if(It>-1)return It;const At=getOriginalPath(Tt[Et-2]);return Et>1&&getOriginalPath(wt)===At&&Ot[Ot.length-1].path!==At?Ot.findIndex(isSameRouteRecord.bind(null,Tt[Et-2])):It}),_t=computed(()=>vt.value>-1&&includesParams(nt.params,st.value.params)),bt=computed(()=>vt.value>-1&&vt.value===nt.matched.length-1&&isSameRouteLocationParams(nt.params,st.value.params));function xt(Tt={}){return guardEvent(Tt)?it[unref(rt.replace)?"replace":"push"](unref(rt.to)).catch(noop):Promise.resolve()}return{route:st,href:computed(()=>st.value.href),isActive:_t,isExactActive:bt,navigate:xt}}const RouterLinkImpl=defineComponent({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink,setup(rt,{slots:it}){const nt=reactive(useLink(rt)),{options:st}=inject(routerKey),vt=computed(()=>({[getLinkClass(rt.activeClass,st.linkActiveClass,"router-link-active")]:nt.isActive,[getLinkClass(rt.exactActiveClass,st.linkExactActiveClass,"router-link-exact-active")]:nt.isExactActive}));return()=>{const _t=it.default&&it.default(nt);return rt.custom?_t:h$1("a",{"aria-current":nt.isExactActive?rt.ariaCurrentValue:null,href:nt.href,onClick:nt.navigate,class:vt.value},_t)}}}),RouterLink=RouterLinkImpl;function guardEvent(rt){if(!(rt.metaKey||rt.altKey||rt.ctrlKey||rt.shiftKey)&&!rt.defaultPrevented&&!(rt.button!==void 0&&rt.button!==0)){if(rt.currentTarget&&rt.currentTarget.getAttribute){const it=rt.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(it))return}return rt.preventDefault&&rt.preventDefault(),!0}}function includesParams(rt,it){for(const nt in it){const st=it[nt],vt=rt[nt];if(typeof st=="string"){if(st!==vt)return!1}else if(!isArray(vt)||vt.length!==st.length||st.some((_t,bt)=>_t!==vt[bt]))return!1}return!0}function getOriginalPath(rt){return rt?rt.aliasOf?rt.aliasOf.path:rt.path:""}const getLinkClass=(rt,it,nt)=>rt!=null?rt:it!=null?it:nt,RouterViewImpl=defineComponent({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(rt,{attrs:it,slots:nt}){const st=inject(routerViewLocationKey),vt=computed(()=>rt.route||st.value),_t=inject(viewDepthKey,0),bt=computed(()=>{let Et=unref(_t);const{matched:wt}=vt.value;let Ot;for(;(Ot=wt[Et])&&!Ot.components;)Et++;return Et}),xt=computed(()=>vt.value.matched[bt.value]);provide(viewDepthKey,computed(()=>bt.value+1)),provide(matchedRouteKey,xt),provide(routerViewLocationKey,vt);const Tt=ref();return watch(()=>[Tt.value,xt.value,rt.name],([Et,wt,Ot],[It,At,Dt])=>{wt&&(wt.instances[Ot]=Et,At&&At!==wt&&Et&&Et===It&&(wt.leaveGuards.size||(wt.leaveGuards=At.leaveGuards),wt.updateGuards.size||(wt.updateGuards=At.updateGuards))),Et&&wt&&(!At||!isSameRouteRecord(wt,At)||!It)&&(wt.enterCallbacks[Ot]||[]).forEach(kt=>kt(Et))},{flush:"post"}),()=>{const Et=vt.value,wt=rt.name,Ot=xt.value,It=Ot&&Ot.components[wt];if(!It)return normalizeSlot(nt.default,{Component:It,route:Et});const At=Ot.props[wt],Dt=At?At===!0?Et.params:typeof At=="function"?At(Et):At:null,Mt=h$1(It,assign({},Dt,it,{onVnodeUnmounted:zt=>{zt.component.isUnmounted&&(Ot.instances[wt]=null)},ref:Tt}));return normalizeSlot(nt.default,{Component:Mt,route:Et})||Mt}}});function normalizeSlot(rt,it){if(!rt)return null;const nt=rt(it);return nt.length===1?nt[0]:nt}const RouterView=RouterViewImpl;function createRouter(rt){const it=createRouterMatcher(rt.routes,rt),nt=rt.parseQuery||parseQuery,st=rt.stringifyQuery||stringifyQuery,vt=rt.history,_t=useCallbacks(),bt=useCallbacks(),xt=useCallbacks(),Tt=shallowRef(START_LOCATION_NORMALIZED);let Et=START_LOCATION_NORMALIZED;isBrowser&&rt.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const wt=applyToParams.bind(null,ai=>""+ai),Ot=applyToParams.bind(null,encodeParam),It=applyToParams.bind(null,decode);function At(ai,di){let Nt,Ft;return isRouteName(ai)?(Nt=it.getRecordMatcher(ai),Ft=di):Ft=ai,it.addRoute(Ft,Nt)}function Dt(ai){const di=it.getRecordMatcher(ai);di&&it.removeRoute(di)}function kt(){return it.getRoutes().map(ai=>ai.record)}function Mt(ai){return!!it.getRecordMatcher(ai)}function zt(ai,di){if(di=assign({},di||Tt.value),typeof ai=="string"){const si=parseURL(nt,ai,di.path),Vt=it.resolve({path:si.path},di),Kt=vt.createHref(si.fullPath);return assign(si,Vt,{params:It(Vt.params),hash:decode(si.hash),redirectedFrom:void 0,href:Kt})}let Nt;if("path"in ai)Nt=assign({},ai,{path:parseURL(nt,ai.path,di.path).path});else{const si=assign({},ai.params);for(const Vt in si)si[Vt]==null&&delete si[Vt];Nt=assign({},ai,{params:Ot(ai.params)}),di.params=Ot(di.params)}const Ft=it.resolve(Nt,di),Xt=ai.hash||"";Ft.params=wt(It(Ft.params));const Qt=stringifyURL(st,assign({},ai,{hash:encodeHash(Xt),path:Ft.path})),ti=vt.createHref(Qt);return assign({fullPath:Qt,hash:Xt,query:st===stringifyQuery?normalizeQuery(ai.query):ai.query||{}},Ft,{redirectedFrom:void 0,href:ti})}function Pt(ai){return typeof ai=="string"?parseURL(nt,ai,Tt.value.path):assign({},ai)}function Lt(ai,di){if(Et!==ai)return createRouterError(8,{from:di,to:ai})}function Bt(ai){return Zt(ai)}function Gt(ai){return Bt(assign(Pt(ai),{replace:!0}))}function Ut(ai){const di=ai.matched[ai.matched.length-1];if(di&&di.redirect){const{redirect:Nt}=di;let Ft=typeof Nt=="function"?Nt(ai):Nt;return typeof Ft=="string"&&(Ft=Ft.includes("?")||Ft.includes("#")?Ft=Pt(Ft):{path:Ft},Ft.params={}),assign({query:ai.query,hash:ai.hash,params:"path"in Ft?{}:ai.params},Ft)}}function Zt(ai,di){const Nt=Et=zt(ai),Ft=Tt.value,Xt=ai.state,Qt=ai.force,ti=ai.replace===!0,si=Ut(Nt);if(si)return Zt(assign(Pt(si),{state:typeof si=="object"?assign({},Xt,si.state):Xt,force:Qt,replace:ti}),di||Nt);const Vt=Nt;Vt.redirectedFrom=di;let Kt;return!Qt&&isSameRouteLocation(st,Ft,Nt)&&(Kt=createRouterError(16,{to:Vt,from:Ft}),qt(Ft,Ft,!0,!1)),(Kt?Promise.resolve(Kt):ei(Vt,Ft)).catch(ni=>isNavigationFailure(ni)?isNavigationFailure(ni,2)?ni:jt(ni):Yt(ni,Vt,Ft)).then(ni=>{if(ni){if(isNavigationFailure(ni,2))return Zt(assign({replace:ti},Pt(ni.to),{state:typeof ni.to=="object"?assign({},Xt,ni.to.state):Xt,force:Qt}),di||Vt)}else ni=li(Vt,Ft,!0,ti,Xt);return ii(Vt,Ft,ni),ni})}function Jt(ai,di){const Nt=Lt(ai,di);return Nt?Promise.reject(Nt):Promise.resolve()}function ei(ai,di){let Nt;const[Ft,Xt,Qt]=extractChangingRecords(ai,di);Nt=extractComponentsGuards(Ft.reverse(),"beforeRouteLeave",ai,di);for(const si of Ft)si.leaveGuards.forEach(Vt=>{Nt.push(guardToPromiseFn(Vt,ai,di))});const ti=Jt.bind(null,ai,di);return Nt.push(ti),runGuardQueue(Nt).then(()=>{Nt=[];for(const si of _t.list())Nt.push(guardToPromiseFn(si,ai,di));return Nt.push(ti),runGuardQueue(Nt)}).then(()=>{Nt=extractComponentsGuards(Xt,"beforeRouteUpdate",ai,di);for(const si of Xt)si.updateGuards.forEach(Vt=>{Nt.push(guardToPromiseFn(Vt,ai,di))});return Nt.push(ti),runGuardQueue(Nt)}).then(()=>{Nt=[];for(const si of ai.matched)if(si.beforeEnter&&!di.matched.includes(si))if(isArray(si.beforeEnter))for(const Vt of si.beforeEnter)Nt.push(guardToPromiseFn(Vt,ai,di));else Nt.push(guardToPromiseFn(si.beforeEnter,ai,di));return Nt.push(ti),runGuardQueue(Nt)}).then(()=>(ai.matched.forEach(si=>si.enterCallbacks={}),Nt=extractComponentsGuards(Qt,"beforeRouteEnter",ai,di),Nt.push(ti),runGuardQueue(Nt))).then(()=>{Nt=[];for(const si of bt.list())Nt.push(guardToPromiseFn(si,ai,di));return Nt.push(ti),runGuardQueue(Nt)}).catch(si=>isNavigationFailure(si,8)?si:Promise.reject(si))}function ii(ai,di,Nt){for(const Ft of xt.list())Ft(ai,di,Nt)}function li(ai,di,Nt,Ft,Xt){const Qt=Lt(ai,di);if(Qt)return Qt;const ti=di===START_LOCATION_NORMALIZED,si=isBrowser?history.state:{};Nt&&(Ft||ti?vt.replace(ai.fullPath,assign({scroll:ti&&si&&si.scroll},Xt)):vt.push(ai.fullPath,Xt)),Tt.value=ai,qt(ai,di,Nt,ti),jt()}let pi;function ci(){pi||(pi=vt.listen((ai,di,Nt)=>{if(!bi.listening)return;const Ft=zt(ai),Xt=Ut(Ft);if(Xt){Zt(assign(Xt,{replace:!0}),Ft).catch(noop);return}Et=Ft;const Qt=Tt.value;isBrowser&&saveScrollPosition(getScrollKey(Qt.fullPath,Nt.delta),computeScrollPosition()),ei(Ft,Qt).catch(ti=>isNavigationFailure(ti,12)?ti:isNavigationFailure(ti,2)?(Zt(ti.to,Ft).then(si=>{isNavigationFailure(si,20)&&!Nt.delta&&Nt.type===NavigationType.pop&&vt.go(-1,!1)}).catch(noop),Promise.reject()):(Nt.delta&&vt.go(-Nt.delta,!1),Yt(ti,Ft,Qt))).then(ti=>{ti=ti||li(Ft,Qt,!1),ti&&(Nt.delta&&!isNavigationFailure(ti,8)?vt.go(-Nt.delta,!1):Nt.type===NavigationType.pop&&isNavigationFailure(ti,20)&&vt.go(-1,!1)),ii(Ft,Qt,ti)}).catch(noop)}))}let Wt=useCallbacks(),$t=useCallbacks(),Rt;function Yt(ai,di,Nt){jt(ai);const Ft=$t.list();return Ft.length?Ft.forEach(Xt=>Xt(ai,di,Nt)):console.error(ai),Promise.reject(ai)}function Ht(){return Rt&&Tt.value!==START_LOCATION_NORMALIZED?Promise.resolve():new Promise((ai,di)=>{Wt.add([ai,di])})}function jt(ai){return Rt||(Rt=!ai,ci(),Wt.list().forEach(([di,Nt])=>ai?Nt(ai):di()),Wt.reset()),ai}function qt(ai,di,Nt,Ft){const{scrollBehavior:Xt}=rt;if(!isBrowser||!Xt)return Promise.resolve();const Qt=!Nt&&getSavedScrollPosition(getScrollKey(ai.fullPath,0))||(Ft||!Nt)&&history.state&&history.state.scroll||null;return nextTick().then(()=>Xt(ai,di,Qt)).then(ti=>ti&&scrollToPosition(ti)).catch(ti=>Yt(ti,ai,di))}const ri=ai=>vt.go(ai);let oi;const fi=new Set,bi={currentRoute:Tt,listening:!0,addRoute:At,removeRoute:Dt,hasRoute:Mt,getRoutes:kt,resolve:zt,options:rt,push:Bt,replace:Gt,go:ri,back:()=>ri(-1),forward:()=>ri(1),beforeEach:_t.add,beforeResolve:bt.add,afterEach:xt.add,onError:$t.add,isReady:Ht,install(ai){const di=this;ai.component("RouterLink",RouterLink),ai.component("RouterView",RouterView),ai.config.globalProperties.$router=di,Object.defineProperty(ai.config.globalProperties,"$route",{enumerable:!0,get:()=>unref(Tt)}),isBrowser&&!oi&&Tt.value===START_LOCATION_NORMALIZED&&(oi=!0,Bt(vt.location).catch(Xt=>{}));const Nt={};for(const Xt in START_LOCATION_NORMALIZED)Nt[Xt]=computed(()=>Tt.value[Xt]);ai.provide(routerKey,di),ai.provide(routeLocationKey,reactive(Nt)),ai.provide(routerViewLocationKey,Tt);const Ft=ai.unmount;fi.add(ai),ai.unmount=function(){fi.delete(ai),fi.size<1&&(Et=START_LOCATION_NORMALIZED,pi&&pi(),pi=null,Tt.value=START_LOCATION_NORMALIZED,oi=!1,Rt=!1),Ft()}}};return bi}function runGuardQueue(rt){return rt.reduce((it,nt)=>it.then(()=>nt()),Promise.resolve())}function extractChangingRecords(rt,it){const nt=[],st=[],vt=[],_t=Math.max(it.matched.length,rt.matched.length);for(let bt=0;bt<_t;bt++){const xt=it.matched[bt];xt&&(rt.matched.find(Et=>isSameRouteRecord(Et,xt))?st.push(xt):nt.push(xt));const Tt=rt.matched[bt];Tt&&(it.matched.find(Et=>isSameRouteRecord(Et,Tt))||vt.push(Tt))}return[nt,st,vt]}const MainFooter_vue_vue_type_style_index_0_scoped_2d989b9d_lang="",_export_sfc=(rt,it)=>{const nt=rt.__vccOpts||rt;for(const[st,vt]of it)nt[st]=vt;return nt},_hoisted_1$e={class:"flex items-center justify-center w-full"},_hoisted_2$e={class:"flex items-center justify-between w-full max-w-screen-lg flex-col sm:flex-row"},_hoisted_3$b={class:"m-4 sm:m-0"},_hoisted_4$3=createTextVNode("Home"),_hoisted_5$3=createTextVNode("About"),_hoisted_6$3=createStaticVNode('<div class="links flex items-center" data-v-2d989b9d><a href="https://github.com/Ikari132/sd-prompt-reader" alt="Link to github" target="_blank" data-v-2d989b9d><button type="button" class="hover:fill-white dark:fill-white px-3 py-2 mr-2 text-xs font-medium text-gray-900 hover:text-white border border-gray-800 hover:bg-gray-900 focus:ring-4 focus:outline-none focus:ring-gray-300 rounded-lg text-center dark:border-gray-600 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-800" data-v-2d989b9d><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 512 512" data-v-2d989b9d><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 003.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 01-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0025.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 015-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 01112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 015 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 004-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z" data-v-2d989b9d></path></svg></button></a><a href="https://www.ayamaru.com/more" alt="Link to apps page" target="_blank" data-v-2d989b9d><button type="button" class="px-3 py-2 mr-2 text-xs font-medium text-gray-900 hover:text-white border border-gray-800 hover:bg-gray-900 focus:ring-4 focus:outline-none focus:ring-gray-300 rounded-lg text-center dark:border-gray-600 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-800" data-v-2d989b9d> More apps \u{1F517} </button></a><a href="https://forms.gle/NLuhoMf6zxQd1Y9y5" alt="Link to suggest a feature form" target="_blank" data-v-2d989b9d><button type="button" class="px-3 py-2 mr-2 text-xs font-medium text-gray-900 hover:text-white border border-gray-800 hover:bg-gray-900 focus:ring-4 focus:outline-none focus:ring-gray-300 rounded-lg text-center dark:border-gray-600 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-800" data-v-2d989b9d> Ideas / bugs \u{1F4CB} </button></a><a href="https://ko-fi.com/L3L4HYJ79" alt="Link to support the project page" target="_blank" data-v-2d989b9d><button type="button" class="px-3 py-2 text-xs font-medium text-center text-white bg-rose-700 rounded-lg hover:bg-rose-800 focus:ring-4 focus:outline-none focus:ring-rose-300 dark:bg-rose-600 dark:hover:bg-rose-700 dark:focus:ring-rose-800" data-v-2d989b9d> Support \u2764\uFE0F </button></a></div>',1),_sfc_main$e={__name:"MainFooter",setup(rt){return(it,nt)=>(openBlock(),createElementBlock("footer",_hoisted_1$e,[createBaseVNode("div",_hoisted_2$e,[createBaseVNode("nav",_hoisted_3$b,[createVNode(unref(RouterLink),{to:"/"},{default:withCtx(()=>[_hoisted_4$3]),_:1}),createVNode(unref(RouterLink),{to:"/about"},{default:withCtx(()=>[_hoisted_5$3]),_:1})]),_hoisted_6$3])]))}},MainFooter=_export_sfc(_sfc_main$e,[["__scopeId","data-v-2d989b9d"]]),MainHeader_vue_vue_type_style_index_0_scoped_6d573cbe_lang="",_sfc_main$d={},_withScopeId=rt=>(pushScopeId("data-v-6d573cbe"),rt=rt(),popScopeId(),rt),_hoisted_1$d=_withScopeId(()=>createBaseVNode("a",{href:"/"},[createBaseVNode("h1",{class:"mb-4 text-center text-3xl font-extrabold text-gray-900 dark:text-white md:text-5xl lg:text-6xl"},[createTextVNode(" SD "),createBaseVNode("span",{class:"text-transparent font-extrabold bg-clip-text bg-gradient-to-r to-purple-600 from-rose-400"},"Image Info")]),createBaseVNode("h2",{class:"text-center text-lg"}," Read prompts from your Stable Diffusion images with ease ")],-1)),_hoisted_2$d=[_hoisted_1$d];function _sfc_render$6(rt,it){return openBlock(),createElementBlock("header",null,_hoisted_2$d)}const MainHeader=_export_sfc(_sfc_main$d,[["render",_sfc_render$6],["__scopeId","data-v-6d573cbe"]]),_hoisted_1$c={class:"flex flex-col items-center my-10"},_hoisted_2$c={class:"w-full h-full max-w-screen-lg"},_sfc_main$c={__name:"App",setup(rt){return(it,nt)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(MainHeader),createBaseVNode("main",_hoisted_1$c,[createBaseVNode("div",_hoisted_2$c,[createVNode(unref(RouterView))])]),createVNode(MainFooter)],64))}},scriptRel="modulepreload",assetsURL=function(rt){return"/"+rt},seen={},__vitePreload=function(it,nt,st){if(!nt||nt.length===0)return it();const vt=document.getElementsByTagName("link");return Promise.all(nt.map(_t=>{if(_t=assetsURL(_t),_t in seen)return;seen[_t]=!0;const bt=_t.endsWith(".css"),xt=bt?'[rel="stylesheet"]':"";if(!!st)for(let wt=vt.length-1;wt>=0;wt--){const Ot=vt[wt];if(Ot.href===_t&&(!bt||Ot.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_t}"]${xt}`))return;const Et=document.createElement("link");if(Et.rel=bt?"stylesheet":scriptRel,bt||(Et.as="script",Et.crossOrigin=""),Et.href=_t,document.head.appendChild(Et),bt)return new Promise((wt,Ot)=>{Et.addEventListener("load",wt),Et.addEventListener("error",()=>Ot(new Error(`Unable to preload CSS for ${_t}`)))})})).then(()=>it())};var e=typeof self<"u"?self:global;const t=typeof navigator<"u",i$1=t&&typeof HTMLImageElement>"u",n=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),s=e.Buffer,r=e.BigInt,a=!!s,o=rt=>rt;function l(rt,it=o){if(n)try{return typeof require=="function"?Promise.resolve(it(require(rt))):__vitePreload(()=>import(rt),[]).then(it)}catch{console.warn(`Couldn't load ${rt}`)}}let h=e.fetch;const u=rt=>h=rt;if(!e.fetch){const rt=l("http",st=>st),it=l("https",st=>st),nt=(st,{headers:vt}={})=>new Promise(async(_t,bt)=>{let{port:xt,hostname:Tt,pathname:Et,protocol:wt,search:Ot}=new URL(st);const It={method:"GET",hostname:Tt,path:encodeURI(Et)+Ot,headers:vt};xt!==""&&(It.port=Number(xt));const At=(wt==="https:"?await it:await rt).request(It,Dt=>{if(Dt.statusCode===301||Dt.statusCode===302){let kt=new URL(Dt.headers.location,st).toString();return nt(kt,{headers:vt}).then(_t).catch(bt)}_t({status:Dt.statusCode,arrayBuffer:()=>new Promise(kt=>{let Mt=[];Dt.on("data",zt=>Mt.push(zt)),Dt.on("end",()=>kt(Buffer.concat(Mt)))})})});At.on("error",bt),At.end()});u(nt)}function c(rt,it,nt){return it in rt?Object.defineProperty(rt,it,{value:nt,enumerable:!0,configurable:!0,writable:!0}):rt[it]=nt,rt}const f=rt=>p$1(rt)?void 0:rt,d=rt=>rt!==void 0;function p$1(rt){return rt===void 0||(rt instanceof Map?rt.size===0:Object.values(rt).filter(d).length===0)}function g(rt){let it=new Error(rt);throw delete it.stack,it}function m(rt){return(rt=function(it){for(;it.endsWith("\0");)it=it.slice(0,-1);return it}(rt).trim())===""?void 0:rt}function S(rt){let it=function(nt){let st=0;return nt.ifd0.enabled&&(st+=1024),nt.exif.enabled&&(st+=2048),nt.makerNote&&(st+=2048),nt.userComment&&(st+=1024),nt.gps.enabled&&(st+=512),nt.interop.enabled&&(st+=100),nt.ifd1.enabled&&(st+=1024),st+2048}(rt);return rt.jfif.enabled&&(it+=50),rt.xmp.enabled&&(it+=2e4),rt.iptc.enabled&&(it+=14e3),rt.icc.enabled&&(it+=6e3),it}const C=rt=>String.fromCharCode.apply(null,rt),y=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function b(rt){return y?y.decode(rt):a?Buffer.from(rt).toString("utf8"):decodeURIComponent(escape(C(rt)))}class I{static from(it,nt){return it instanceof this&&it.le===nt?it:new I(it,void 0,void 0,nt)}constructor(it,nt=0,st,vt){if(typeof vt=="boolean"&&(this.le=vt),Array.isArray(it)&&(it=new Uint8Array(it)),it===0)this.byteOffset=0,this.byteLength=0;else if(it instanceof ArrayBuffer){st===void 0&&(st=it.byteLength-nt);let _t=new DataView(it,nt,st);this._swapDataView(_t)}else if(it instanceof Uint8Array||it instanceof DataView||it instanceof I){st===void 0&&(st=it.byteLength-nt),(nt+=it.byteOffset)+st>it.byteOffset+it.byteLength&&g("Creating view outside of available memory in ArrayBuffer");let _t=new DataView(it.buffer,nt,st);this._swapDataView(_t)}else if(typeof it=="number"){let _t=new DataView(new ArrayBuffer(it));this._swapDataView(_t)}else g("Invalid input argument for BufferView: "+it)}_swapArrayBuffer(it){this._swapDataView(new DataView(it))}_swapBuffer(it){this._swapDataView(new DataView(it.buffer,it.byteOffset,it.byteLength))}_swapDataView(it){this.dataView=it,this.buffer=it.buffer,this.byteOffset=it.byteOffset,this.byteLength=it.byteLength}_lengthToEnd(it){return this.byteLength-it}set(it,nt,st=I){return it instanceof DataView||it instanceof I?it=new Uint8Array(it.buffer,it.byteOffset,it.byteLength):it instanceof ArrayBuffer&&(it=new Uint8Array(it)),it instanceof Uint8Array||g("BufferView.set(): Invalid data argument."),this.toUint8().set(it,nt),new st(this,nt,it.byteLength)}subarray(it,nt){return nt=nt||this._lengthToEnd(it),new I(this,it,nt)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(it,nt){return new Uint8Array(this.buffer,this.byteOffset+it,nt)}getString(it=0,nt=this.byteLength){return b(this.getUint8Array(it,nt))}getLatin1String(it=0,nt=this.byteLength){let st=this.getUint8Array(it,nt);return C(st)}getUnicodeString(it=0,nt=this.byteLength){const st=[];for(let vt=0;vt<nt&&it+vt<this.byteLength;vt+=2)st.push(this.getUint16(it+vt));return C(st)}getInt8(it){return this.dataView.getInt8(it)}getUint8(it){return this.dataView.getUint8(it)}getInt16(it,nt=this.le){return this.dataView.getInt16(it,nt)}getInt32(it,nt=this.le){return this.dataView.getInt32(it,nt)}getUint16(it,nt=this.le){return this.dataView.getUint16(it,nt)}getUint32(it,nt=this.le){return this.dataView.getUint32(it,nt)}getFloat32(it,nt=this.le){return this.dataView.getFloat32(it,nt)}getFloat64(it,nt=this.le){return this.dataView.getFloat64(it,nt)}getFloat(it,nt=this.le){return this.dataView.getFloat32(it,nt)}getDouble(it,nt=this.le){return this.dataView.getFloat64(it,nt)}getUintBytes(it,nt,st){switch(nt){case 1:return this.getUint8(it,st);case 2:return this.getUint16(it,st);case 4:return this.getUint32(it,st);case 8:return this.getUint64&&this.getUint64(it,st)}}getUint(it,nt,st){switch(nt){case 8:return this.getUint8(it,st);case 16:return this.getUint16(it,st);case 32:return this.getUint32(it,st);case 64:return this.getUint64&&this.getUint64(it,st)}}toString(it){return this.dataView.toString(it,this.constructor.name)}ensureChunk(){}}function P(rt,it){g(`${rt} '${it}' was not loaded, try using full build of exifr.`)}class k extends Map{constructor(it){super(),this.kind=it}get(it,nt){return this.has(it)||P(this.kind,it),nt&&(it in nt||function(st,vt){g(`Unknown ${st} '${vt}'.`)}(this.kind,it),nt[it].enabled||P(this.kind,it)),super.get(it)}keyList(){return Array.from(this.keys())}}var w=new k("file parser"),T=new k("segment parser"),A=new k("file reader");function D(rt,it){return typeof rt=="string"?O(rt,it):t&&!i$1&&rt instanceof HTMLImageElement?O(rt.src,it):rt instanceof Uint8Array||rt instanceof ArrayBuffer||rt instanceof DataView?new I(rt):t&&rt instanceof Blob?x(rt,it,"blob",R):void g("Invalid input argument")}function O(rt,it){return(nt=rt).startsWith("data:")||nt.length>1e4?v(rt,it,"base64"):n&&rt.includes("://")?x(rt,it,"url",M):n?v(rt,it,"fs"):t?x(rt,it,"url",M):void g("Invalid input argument");var nt}async function x(rt,it,nt,st){return A.has(nt)?v(rt,it,nt):st?async function(vt,_t){let bt=await _t(vt);return new I(bt)}(rt,st):void g(`Parser ${nt} is not loaded`)}async function v(rt,it,nt){let st=new(A.get(nt))(rt,it);return await st.read(),st}const M=rt=>h(rt).then(it=>it.arrayBuffer()),R=rt=>new Promise((it,nt)=>{let st=new FileReader;st.onloadend=()=>it(st.result||new ArrayBuffer),st.onerror=nt,st.readAsArrayBuffer(rt)});class L extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function U(rt,it,nt){let st=new L;for(let[vt,_t]of nt)st.set(vt,_t);if(Array.isArray(it))for(let vt of it)rt.set(vt,st);else rt.set(it,st);return st}function F(rt,it,nt){let st,vt=rt.get(it);for(st of nt)vt.set(st[0],st[1])}const E=new Map,B=new Map,N=new Map,G=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],V=["jfif","xmp","icc","iptc","ihdr"],z=["tiff",...V],H=["ifd0","ifd1","exif","gps","interop"],j=[...z,...H],W=["makerNote","userComment"],K=["translateKeys","translateValues","reviveValues","multiSegment"],X=[...K,"sanitize","mergeOutput","silentErrors"];class _{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class Y extends _{get needed(){return this.enabled||this.deps.size>0}constructor(it,nt,st,vt){if(super(),c(this,"enabled",!1),c(this,"skip",new Set),c(this,"pick",new Set),c(this,"deps",new Set),c(this,"translateKeys",!1),c(this,"translateValues",!1),c(this,"reviveValues",!1),this.key=it,this.enabled=nt,this.parse=this.enabled,this.applyInheritables(vt),this.canBeFiltered=H.includes(it),this.canBeFiltered&&(this.dict=E.get(it)),st!==void 0)if(Array.isArray(st))this.parse=this.enabled=!0,this.canBeFiltered&&st.length>0&&this.translateTagSet(st,this.pick);else if(typeof st=="object"){if(this.enabled=!0,this.parse=st.parse!==!1,this.canBeFiltered){let{pick:_t,skip:bt}=st;_t&&_t.length>0&&this.translateTagSet(_t,this.pick),bt&&bt.length>0&&this.translateTagSet(bt,this.skip)}this.applyInheritables(st)}else st===!0||st===!1?this.parse=this.enabled=st:g(`Invalid options argument: ${st}`)}applyInheritables(it){let nt,st;for(nt of K)st=it[nt],st!==void 0&&(this[nt]=st)}translateTagSet(it,nt){if(this.dict){let st,vt,{tagKeys:_t,tagValues:bt}=this.dict;for(st of it)typeof st=="string"?(vt=bt.indexOf(st),vt===-1&&(vt=_t.indexOf(Number(st))),vt!==-1&&nt.add(Number(_t[vt]))):nt.add(st)}else for(let st of it)nt.add(st)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,ee(this.pick,this.deps)):this.enabled&&this.pick.size>0&&ee(this.pick,this.deps)}}var $={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},J=new Map;class q extends _{static useCached(it){let nt=J.get(it);return nt!==void 0||(nt=new this(it),J.set(it,nt)),nt}constructor(it){super(),it===!0?this.setupFromTrue():it===void 0?this.setupFromUndefined():Array.isArray(it)?this.setupFromArray(it):typeof it=="object"?this.setupFromObject(it):g(`Invalid options argument ${it}`),this.firstChunkSize===void 0&&(this.firstChunkSize=t?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let it;for(it of G)this[it]=$[it];for(it of X)this[it]=$[it];for(it of W)this[it]=$[it];for(it of j)this[it]=new Y(it,$[it],void 0,this)}setupFromTrue(){let it;for(it of G)this[it]=$[it];for(it of X)this[it]=$[it];for(it of W)this[it]=!0;for(it of j)this[it]=new Y(it,!0,void 0,this)}setupFromArray(it){let nt;for(nt of G)this[nt]=$[nt];for(nt of X)this[nt]=$[nt];for(nt of W)this[nt]=$[nt];for(nt of j)this[nt]=new Y(nt,!1,void 0,this);this.setupGlobalFilters(it,void 0,H)}setupFromObject(it){let nt;for(nt of(H.ifd0=H.ifd0||H.image,H.ifd1=H.ifd1||H.thumbnail,Object.assign(this,it),G))this[nt]=Z(it[nt],$[nt]);for(nt of X)this[nt]=Z(it[nt],$[nt]);for(nt of W)this[nt]=Z(it[nt],$[nt]);for(nt of z)this[nt]=new Y(nt,$[nt],it[nt],this);for(nt of H)this[nt]=new Y(nt,$[nt],it[nt],this.tiff);this.setupGlobalFilters(it.pick,it.skip,H,j),it.tiff===!0?this.batchEnableWithBool(H,!0):it.tiff===!1?this.batchEnableWithUserValue(H,it):Array.isArray(it.tiff)?this.setupGlobalFilters(it.tiff,void 0,H):typeof it.tiff=="object"&&this.setupGlobalFilters(it.tiff.pick,it.tiff.skip,H)}batchEnableWithBool(it,nt){for(let st of it)this[st].enabled=nt}batchEnableWithUserValue(it,nt){for(let st of it){let vt=nt[st];this[st].enabled=vt!==!1&&vt!==void 0}}setupGlobalFilters(it,nt,st,vt=st){if(it&&it.length){for(let bt of vt)this[bt].enabled=!1;let _t=Q(it,st);for(let[bt,xt]of _t)ee(this[bt].pick,xt),this[bt].enabled=!0}else if(nt&&nt.length){let _t=Q(nt,st);for(let[bt,xt]of _t)ee(this[bt].skip,xt)}}filterNestedSegmentTags(){let{ifd0:it,exif:nt,xmp:st,iptc:vt,icc:_t}=this;this.makerNote?nt.deps.add(37500):nt.skip.add(37500),this.userComment?nt.deps.add(37510):nt.skip.add(37510),st.enabled||it.skip.add(700),vt.enabled||it.skip.add(33723),_t.enabled||it.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:it,exif:nt,gps:st,interop:vt}=this;vt.needed&&(nt.deps.add(40965),it.deps.add(40965)),nt.needed&&it.deps.add(34665),st.needed&&it.deps.add(34853),this.tiff.enabled=H.some(_t=>this[_t].enabled===!0)||this.makerNote||this.userComment;for(let _t of H)this[_t].finalizeFilters()}get onlyTiff(){return!V.map(it=>this[it].enabled).some(it=>it===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let it of z)this[it].enabled&&!T.has(it)&&P("segment parser",it)}}function Q(rt,it){let nt,st,vt,_t,bt=[];for(vt of it){for(_t of(nt=E.get(vt),st=[],nt))(rt.includes(_t[0])||rt.includes(_t[1]))&&st.push(_t[0]);st.length&&bt.push([vt,st])}return bt}function Z(rt,it){return rt!==void 0?rt:it!==void 0?it:void 0}function ee(rt,it){for(let nt of it)rt.add(nt)}c(q,"default",$);class te{constructor(it){c(this,"parsers",{}),c(this,"output",{}),c(this,"errors",[]),c(this,"pushToErrors",nt=>this.errors.push(nt)),this.options=q.useCached(it)}async read(it){this.file=await D(it,this.options)}setup(){if(this.fileParser)return;let{file:it}=this,nt=it.getUint16(0);for(let[st,vt]of w)if(vt.canHandle(it,nt))return this.fileParser=new vt(this.options,this.file,this.parsers),it[st]=!0;this.file.close&&this.file.close(),g("Unknown file format")}async parse(){let{output:it,errors:nt}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),nt.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&nt.length>0&&(it.errors=nt),f(it)}async executeParsers(){let{output:it}=this;await this.fileParser.parse();let nt=Object.values(this.parsers).map(async st=>{let vt=await st.parse();st.assignToOutput(it,vt)});this.options.silentErrors&&(nt=nt.map(st=>st.catch(this.pushToErrors))),await Promise.all(nt)}async extractThumbnail(){this.setup();let{options:it,file:nt}=this,st=T.get("tiff",it);var vt;if(nt.tiff?vt={start:0,type:"tiff"}:nt.jpeg&&(vt=await this.fileParser.getOrFindSegment("tiff")),vt===void 0)return;let _t=await this.fileParser.ensureSegmentChunk(vt),bt=this.parsers.tiff=new st(_t,it,nt),xt=await bt.extractThumbnail();return nt.close&&nt.close(),xt}}async function ie(rt,it){let nt=new te(it);return await nt.read(rt),nt.parse()}var ne=Object.freeze({__proto__:null,parse:ie,Exifr:te,fileParsers:w,segmentParsers:T,fileReaders:A,tagKeys:E,tagValues:B,tagRevivers:N,createDictionary:U,extendDictionary:F,fetchUrlAsArrayBuffer:M,readBlobAsArrayBuffer:R,chunkedProps:G,otherSegments:V,segments:z,tiffBlocks:H,segmentsAndBlocks:j,tiffExtractables:W,inheritables:K,allFormatters:X,Options:q});class se{constructor(it,nt,st){c(this,"errors",[]),c(this,"ensureSegmentChunk",async vt=>{let _t=vt.start,bt=vt.size||65536;if(this.file.chunked)if(this.file.available(_t,bt))vt.chunk=this.file.subarray(_t,bt);else try{vt.chunk=await this.file.readChunk(_t,bt)}catch(xt){g(`Couldn't read segment: ${JSON.stringify(vt)}. ${xt.message}`)}else this.file.byteLength>_t+bt?vt.chunk=this.file.subarray(_t,bt):vt.size===void 0?vt.chunk=this.file.subarray(_t):g("Segment unreachable: "+JSON.stringify(vt));return vt.chunk}),this.extendOptions&&this.extendOptions(it),this.options=it,this.file=nt,this.parsers=st}injectSegment(it,nt){this.options[it].enabled&&this.createParser(it,nt)}createParser(it,nt){let st=new(T.get(it))(nt,this.options,this.file);return this.parsers[it]=st}createParsers(it){for(let nt of it){let{type:st,chunk:vt}=nt,_t=this.options[st];if(_t&&_t.enabled){let bt=this.parsers[st];bt&&bt.append||bt||this.createParser(st,vt)}}}async readSegments(it){let nt=it.map(this.ensureSegmentChunk);await Promise.all(nt)}}class re{static findPosition(it,nt){let st=it.getUint16(nt+2)+2,vt=typeof this.headerLength=="function"?this.headerLength(it,nt,st):this.headerLength,_t=nt+vt,bt=st-vt;return{offset:nt,length:st,headerLength:vt,start:_t,size:bt,end:_t+bt}}static parse(it,nt={}){return new this(it,new q({[this.type]:nt}),it).parse()}normalizeInput(it){return it instanceof I?it:new I(it)}constructor(it,nt={},st){c(this,"errors",[]),c(this,"raw",new Map),c(this,"handleError",vt=>{if(!this.options.silentErrors)throw vt;this.errors.push(vt.message)}),this.chunk=this.normalizeInput(it),this.file=st,this.type=this.constructor.type,this.globalOptions=this.options=nt,this.localOptions=nt[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(it,nt){let st=N.get(nt),vt=B.get(nt),_t=E.get(nt),bt=this.options[nt],xt=bt.reviveValues&&!!st,Tt=bt.translateValues&&!!vt,Et=bt.translateKeys&&!!_t,wt={};for(let[Ot,It]of it)xt&&st.has(Ot)?It=st.get(Ot)(It):Tt&&vt.has(Ot)&&(It=this.translateValue(It,vt.get(Ot))),Et&&_t.has(Ot)&&(Ot=_t.get(Ot)||Ot),wt[Ot]=It;return wt}translateValue(it,nt){return nt[it]||nt.DEFAULT||it}assignToOutput(it,nt){this.assignObjectToOutput(it,this.constructor.type,nt)}assignObjectToOutput(it,nt,st){if(this.globalOptions.mergeOutput)return Object.assign(it,st);it[nt]?Object.assign(it[nt],st):it[nt]=st}}c(re,"headerLength",4),c(re,"type",void 0),c(re,"multiSegment",!1),c(re,"canHandle",()=>!1);function ae(rt){return rt===192||rt===194||rt===196||rt===219||rt===221||rt===218||rt===254}function oe(rt){return rt>=224&&rt<=239}function le(rt,it,nt){for(let[st,vt]of T)if(vt.canHandle(rt,it,nt))return st}class he extends se{constructor(...it){super(...it),c(this,"appSegments",[]),c(this,"jpegSegments",[]),c(this,"unknownSegments",[])}static canHandle(it,nt){return nt===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(it){it===!0?(this.findAll=!0,this.wanted=new Set(T.keyList())):(it=it===void 0?T.keyList().filter(nt=>this.options[nt].enabled):it.filter(nt=>this.options[nt].enabled&&T.has(nt)),this.findAll=!1,this.remaining=new Set(it),this.wanted=new Set(it)),this.unfinishedMultiSegment=!1}async findAppSegments(it=0,nt){this.setupSegmentFinderArgs(nt);let{file:st,findAll:vt,wanted:_t,remaining:bt}=this;if(!vt&&this.file.chunked&&(vt=Array.from(_t).some(xt=>{let Tt=T.get(xt),Et=this.options[xt];return Tt.multiSegment&&Et.multiSegment}),vt&&await this.file.readWhole()),it=this.findAppSegmentsInRange(it,st.byteLength),!this.options.onlyTiff&&st.chunked){let xt=!1;for(;bt.size>0&&!xt&&(st.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:Tt}=st,Et=this.appSegments.some(wt=>!this.file.available(wt.offset||wt.start,wt.length||wt.size));if(xt=it>Tt&&!Et?!await st.readNextChunk(it):!await st.readNextChunk(Tt),(it=this.findAppSegmentsInRange(it,st.byteLength))===void 0)return}}}findAppSegmentsInRange(it,nt){nt-=2;let st,vt,_t,bt,xt,Tt,{file:Et,findAll:wt,wanted:Ot,remaining:It,options:At}=this;for(;it<nt;it++)if(Et.getUint8(it)===255){if(st=Et.getUint8(it+1),oe(st)){if(vt=Et.getUint16(it+2),_t=le(Et,it,vt),_t&&Ot.has(_t)&&(bt=T.get(_t),xt=bt.findPosition(Et,it),Tt=At[_t],xt.type=_t,this.appSegments.push(xt),!wt&&(bt.multiSegment&&Tt.multiSegment?(this.unfinishedMultiSegment=xt.chunkNumber<xt.chunkCount,this.unfinishedMultiSegment||It.delete(_t)):It.delete(_t),It.size===0)))break;At.recordUnknownSegments&&(xt=re.findPosition(Et,it),xt.marker=st,this.unknownSegments.push(xt)),it+=vt+1}else if(ae(st)){if(vt=Et.getUint16(it+2),st===218&&At.stopAfterSos!==!1)return;At.recordJpegSegments&&this.jpegSegments.push({offset:it,length:vt,marker:st}),it+=vt+1}}return it}mergeMultiSegments(){if(!this.appSegments.some(nt=>nt.multiSegment))return;let it=function(nt,st){let vt,_t,bt,xt=new Map;for(let Tt=0;Tt<nt.length;Tt++)vt=nt[Tt],_t=vt[st],xt.has(_t)?bt=xt.get(_t):xt.set(_t,bt=[]),bt.push(vt);return Array.from(xt)}(this.appSegments,"type");this.mergedAppSegments=it.map(([nt,st])=>{let vt=T.get(nt,this.options);return vt.handleMultiSegments?{type:nt,chunk:vt.handleMultiSegments(st)}:st[0]})}getSegment(it){return this.appSegments.find(nt=>nt.type===it)}async getOrFindSegment(it){let nt=this.getSegment(it);return nt===void 0&&(await this.findAppSegments(0,[it]),nt=this.getSegment(it)),nt}}c(he,"type","jpeg"),w.set("jpeg",he);const ue=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class ce extends re{parseHeader(){var it=this.chunk.getUint16();it===18761?this.le=!0:it===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(it,nt,st=new Map){let{pick:vt,skip:_t}=this.options[nt];vt=new Set(vt);let bt=vt.size>0,xt=_t.size===0,Tt=this.chunk.getUint16(it);it+=2;for(let Et=0;Et<Tt;Et++){let wt=this.chunk.getUint16(it);if(bt){if(vt.has(wt)&&(st.set(wt,this.parseTag(it,wt,nt)),vt.delete(wt),vt.size===0))break}else!xt&&_t.has(wt)||st.set(wt,this.parseTag(it,wt,nt));it+=12}return st}parseTag(it,nt,st){let{chunk:vt}=this,_t=vt.getUint16(it+2),bt=vt.getUint32(it+4),xt=ue[_t];if(xt*bt<=4?it+=8:it=vt.getUint32(it+8),(_t<1||_t>13)&&g(`Invalid TIFF value type. block: ${st.toUpperCase()}, tag: ${nt.toString(16)}, type: ${_t}, offset ${it}`),it>vt.byteLength&&g(`Invalid TIFF value offset. block: ${st.toUpperCase()}, tag: ${nt.toString(16)}, type: ${_t}, offset ${it} is outside of chunk size ${vt.byteLength}`),_t===1)return vt.getUint8Array(it,bt);if(_t===2)return m(vt.getString(it,bt));if(_t===7)return vt.getUint8Array(it,bt);if(bt===1)return this.parseTagValue(_t,it);{let Tt=new(function(wt){switch(wt){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(_t))(bt),Et=xt;for(let wt=0;wt<bt;wt++)Tt[wt]=this.parseTagValue(_t,it),it+=Et;return Tt}}parseTagValue(it,nt){let{chunk:st}=this;switch(it){case 1:return st.getUint8(nt);case 3:return st.getUint16(nt);case 4:return st.getUint32(nt);case 5:return st.getUint32(nt)/st.getUint32(nt+4);case 6:return st.getInt8(nt);case 8:return st.getInt16(nt);case 9:return st.getInt32(nt);case 10:return st.getInt32(nt)/st.getInt32(nt+4);case 11:return st.getFloat(nt);case 12:return st.getDouble(nt);case 13:return st.getUint32(nt);default:g(`Invalid tiff type ${it}`)}}}class fe extends ce{static canHandle(it,nt){return it.getUint8(nt+1)===225&&it.getUint32(nt+4)===1165519206&&it.getUint16(nt+8)===0}async parse(){this.parseHeader();let{options:it}=this;return it.ifd0.enabled&&await this.parseIfd0Block(),it.exif.enabled&&await this.safeParse("parseExifBlock"),it.gps.enabled&&await this.safeParse("parseGpsBlock"),it.interop.enabled&&await this.safeParse("parseInteropBlock"),it.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(it){let nt=this[it]();return nt.catch!==void 0&&(nt=nt.catch(this.handleError)),nt}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let it=this.chunk.getUint16(this.ifd0Offset),nt=this.ifd0Offset+2+12*it;this.ifd1Offset=this.chunk.getUint32(nt)}}parseBlock(it,nt){let st=new Map;return this[nt]=st,this.parseTags(it,nt,st),st}async parseIfd0Block(){if(this.ifd0)return;let{file:it}=this;this.findIfd0Offset(),this.ifd0Offset<8&&g("Malformed EXIF data"),!it.chunked&&this.ifd0Offset>it.byteLength&&g(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${it.byteLength}`),it.tiff&&await it.ensureChunk(this.ifd0Offset,S(this.options));let nt=this.parseBlock(this.ifd0Offset,"ifd0");return nt.size!==0?(this.exifOffset=nt.get(34665),this.interopOffset=nt.get(40965),this.gpsOffset=nt.get(34853),this.xmp=nt.get(700),this.iptc=nt.get(33723),this.icc=nt.get(34675),this.options.sanitize&&(nt.delete(34665),nt.delete(40965),nt.delete(34853),nt.delete(700),nt.delete(33723),nt.delete(34675)),nt):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,S(this.options));let it=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=it.get(40965)),this.makerNote=it.get(37500),this.userComment=it.get(37510),this.options.sanitize&&(it.delete(40965),it.delete(37500),it.delete(37510)),this.unpack(it,41728),this.unpack(it,41729),it}unpack(it,nt){let st=it.get(nt);st&&st.length===1&&it.set(nt,st[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let it=this.parseBlock(this.gpsOffset,"gps");return it&&it.has(2)&&it.has(4)&&(it.set("latitude",de(...it.get(2),it.get(1))),it.set("longitude",de(...it.get(4),it.get(3)))),it}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(it=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||it))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let it=this.ifd1.get(513),nt=this.ifd1.get(514);return this.chunk.getUint8Array(it,nt)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let it,nt,st,vt={};for(nt of H)if(it=this[nt],!p$1(it))if(st=this.canTranslate?this.translateBlock(it,nt):Object.fromEntries(it),this.options.mergeOutput){if(nt==="ifd1")continue;Object.assign(vt,st)}else vt[nt]=st;return this.makerNote&&(vt.makerNote=this.makerNote),this.userComment&&(vt.userComment=this.userComment),vt}assignToOutput(it,nt){if(this.globalOptions.mergeOutput)Object.assign(it,nt);else for(let[st,vt]of Object.entries(nt))this.assignObjectToOutput(it,st,vt)}}function de(rt,it,nt,st){var vt=rt+it/60+nt/3600;return st!=="S"&&st!=="W"||(vt*=-1),vt}c(fe,"type","tiff"),c(fe,"headerLength",10),T.set("tiff",fe);var pe=Object.freeze({__proto__:null,default:ne,Exifr:te,fileParsers:w,segmentParsers:T,fileReaders:A,tagKeys:E,tagValues:B,tagRevivers:N,createDictionary:U,extendDictionary:F,fetchUrlAsArrayBuffer:M,readBlobAsArrayBuffer:R,chunkedProps:G,otherSegments:V,segments:z,tiffBlocks:H,segmentsAndBlocks:j,tiffExtractables:W,inheritables:K,allFormatters:X,Options:q,parse:ie});const ge={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},me=Object.assign({},ge,{firstChunkSize:4e4,gps:[1,2,3,4]});async function Se(rt){let it=new te(me);await it.read(rt);let nt=await it.parse();if(nt&&nt.gps){let{latitude:st,longitude:vt}=nt.gps;return{latitude:st,longitude:vt}}}const Ce=Object.assign({},ge,{tiff:!1,ifd1:!0,mergeOutput:!1});async function ye(rt){let it=new te(Ce);await it.read(rt);let nt=await it.extractThumbnail();return nt&&a?s.from(nt):nt}async function be(rt){let it=await this.thumbnail(rt);if(it!==void 0){let nt=new Blob([it]);return URL.createObjectURL(nt)}}const Ie=Object.assign({},ge,{firstChunkSize:4e4,ifd0:[274]});async function Pe(rt){let it=new te(Ie);await it.read(rt);let nt=await it.parse();if(nt&&nt.ifd0)return nt.ifd0[274]}const ke=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let we=!0,Te=!0;if(typeof navigator=="object"){let rt=navigator.userAgent;if(rt.includes("iPad")||rt.includes("iPhone")){let it=rt.match(/OS (\d+)_(\d+)/);if(it){let[,nt,st]=it;we=Number(nt)+.1*Number(st)<13.4,Te=!1}}else if(rt.includes("OS X 10")){let[,it]=rt.match(/OS X 10[_.](\d+)/);we=Te=Number(it)<15}if(rt.includes("Chrome/")){let[,it]=rt.match(/Chrome\/(\d+)/);we=Te=Number(it)<81}else if(rt.includes("Firefox/")){let[,it]=rt.match(/Firefox\/(\d+)/);we=Te=Number(it)<77}}async function Ae(rt){let it=await Pe(rt);return Object.assign({canvas:we,css:Te},ke[it])}class De extends I{constructor(...it){super(...it),c(this,"ranges",new Oe),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(it,nt,st){if(it===0&&this.byteLength===0&&st){let vt=new DataView(st.buffer||st,st.byteOffset,st.byteLength);this._swapDataView(vt)}else{let vt=it+nt;if(vt>this.byteLength){let{dataView:_t}=this._extend(vt);this._swapDataView(_t)}}}_extend(it){let nt;nt=a?s.allocUnsafe(it):new Uint8Array(it);let st=new DataView(nt.buffer,nt.byteOffset,nt.byteLength);return nt.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:nt,dataView:st}}subarray(it,nt,st=!1){return nt=nt||this._lengthToEnd(it),st&&this._tryExtend(it,nt),this.ranges.add(it,nt),super.subarray(it,nt)}set(it,nt,st=!1){st&&this._tryExtend(nt,it.byteLength,it);let vt=super.set(it,nt);return this.ranges.add(nt,vt.byteLength),vt}async ensureChunk(it,nt){this.chunked&&(this.ranges.available(it,nt)||await this.readChunk(it,nt))}available(it,nt){return this.ranges.available(it,nt)}}class Oe{constructor(){c(this,"list",[])}get length(){return this.list.length}add(it,nt,st=0){let vt=it+nt,_t=this.list.filter(bt=>xe(it,bt.offset,vt)||xe(it,bt.end,vt));if(_t.length>0){it=Math.min(it,..._t.map(xt=>xt.offset)),vt=Math.max(vt,..._t.map(xt=>xt.end)),nt=vt-it;let bt=_t.shift();bt.offset=it,bt.length=nt,bt.end=vt,this.list=this.list.filter(xt=>!_t.includes(xt))}else this.list.push({offset:it,length:nt,end:vt})}available(it,nt){let st=it+nt;return this.list.some(vt=>vt.offset<=it&&st<=vt.end)}}function xe(rt,it,nt){return rt<=it&&it<=nt}class ve extends De{constructor(it,nt){super(0),c(this,"chunksRead",0),this.input=it,this.options=nt}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(it=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let nt=this.options.chunkSize,st=await this.readChunk(it,nt);return!!st&&st.byteLength===nt}async readChunk(it,nt){if(this.chunksRead++,(nt=this.safeWrapAddress(it,nt))!==0)return this._readChunk(it,nt)}safeWrapAddress(it,nt){return this.size!==void 0&&it+nt>this.size?Math.max(0,this.size-it):nt}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}A.set("blob",class extends ve{async readWhole(){this.chunked=!1;let rt=await R(this.input);this._swapArrayBuffer(rt)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(rt,it){let nt=it?rt+it:void 0,st=this.input.slice(rt,nt),vt=await R(st);return this.set(vt,rt,!0)}});var Me=Object.freeze({__proto__:null,default:pe,Exifr:te,fileParsers:w,segmentParsers:T,fileReaders:A,tagKeys:E,tagValues:B,tagRevivers:N,createDictionary:U,extendDictionary:F,fetchUrlAsArrayBuffer:M,readBlobAsArrayBuffer:R,chunkedProps:G,otherSegments:V,segments:z,tiffBlocks:H,segmentsAndBlocks:j,tiffExtractables:W,inheritables:K,allFormatters:X,Options:q,parse:ie,gpsOnlyOptions:me,gps:Se,thumbnailOnlyOptions:Ce,thumbnail:ye,thumbnailUrl:be,orientationOnlyOptions:Ie,orientation:Pe,rotations:ke,get rotateCanvas(){return we},get rotateCss(){return Te},rotation:Ae});A.set("url",class extends ve{async readWhole(){this.chunked=!1;let rt=await M(this.input);rt instanceof ArrayBuffer?this._swapArrayBuffer(rt):rt instanceof Uint8Array&&this._swapBuffer(rt)}async _readChunk(rt,it){let nt=it?rt+it-1:void 0,st=this.options.httpHeaders||{};(rt||nt)&&(st.range=`bytes=${[rt,nt].join("-")}`);let vt=await h(this.input,{headers:st}),_t=await vt.arrayBuffer(),bt=_t.byteLength;if(vt.status!==416)return bt!==it&&(this.size=rt+bt),this.set(_t,rt,!0)}});I.prototype.getUint64=function(rt){let it=this.getUint32(rt),nt=this.getUint32(rt+4);return it<1048575?it<<32|nt:typeof r!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),r(it)<<r(32)|r(nt)):void g("Trying to read 64b value but JS can only handle 53b numbers.")};class Re extends se{parseBoxes(it=0){let nt=[];for(;it<this.file.byteLength-4;){let st=this.parseBoxHead(it);if(nt.push(st),st.length===0)break;it+=st.length}return nt}parseSubBoxes(it){it.boxes=this.parseBoxes(it.start)}findBox(it,nt){return it.boxes===void 0&&this.parseSubBoxes(it),it.boxes.find(st=>st.kind===nt)}parseBoxHead(it){let nt=this.file.getUint32(it),st=this.file.getString(it+4,4),vt=it+8;return nt===1&&(nt=this.file.getUint64(it+8),vt+=8),{offset:it,length:nt,kind:st,start:vt}}parseBoxFullHead(it){if(it.version!==void 0)return;let nt=this.file.getUint32(it.start);it.version=nt>>24,it.start+=4}}class Le extends Re{static canHandle(it,nt){if(nt!==0)return!1;let st=it.getUint16(2);if(st>50)return!1;let vt=16,_t=[];for(;vt<st;)_t.push(it.getString(vt,4)),vt+=4;return _t.includes(this.type)}async parse(){let it=this.file.getUint32(0),nt=this.parseBoxHead(it);for(;nt.kind!=="meta";)it+=nt.length,await this.file.ensureChunk(it,16),nt=this.parseBoxHead(it);await this.file.ensureChunk(nt.offset,nt.length),this.parseBoxFullHead(nt),this.parseSubBoxes(nt),this.options.icc.enabled&&await this.findIcc(nt),this.options.tiff.enabled&&await this.findExif(nt)}async registerSegment(it,nt,st){await this.file.ensureChunk(nt,st);let vt=this.file.subarray(nt,st);this.createParser(it,vt)}async findIcc(it){let nt=this.findBox(it,"iprp");if(nt===void 0)return;let st=this.findBox(nt,"ipco");if(st===void 0)return;let vt=this.findBox(st,"colr");vt!==void 0&&await this.registerSegment("icc",vt.offset+12,vt.length)}async findExif(it){let nt=this.findBox(it,"iinf");if(nt===void 0)return;let st=this.findBox(it,"iloc");if(st===void 0)return;let vt=this.findExifLocIdInIinf(nt),_t=this.findExtentInIloc(st,vt);if(_t===void 0)return;let[bt,xt]=_t;await this.file.ensureChunk(bt,xt);let Tt=4+this.file.getUint32(bt);bt+=Tt,xt-=Tt,await this.registerSegment("tiff",bt,xt)}findExifLocIdInIinf(it){this.parseBoxFullHead(it);let nt,st,vt,_t,bt=it.start,xt=this.file.getUint16(bt);for(bt+=2;xt--;){if(nt=this.parseBoxHead(bt),this.parseBoxFullHead(nt),st=nt.start,nt.version>=2&&(vt=nt.version===3?4:2,_t=this.file.getString(st+vt+2,4),_t==="Exif"))return this.file.getUintBytes(st,vt);bt+=nt.length}}get8bits(it){let nt=this.file.getUint8(it);return[nt>>4,15&nt]}findExtentInIloc(it,nt){this.parseBoxFullHead(it);let st=it.start,[vt,_t]=this.get8bits(st++),[bt,xt]=this.get8bits(st++),Tt=it.version===2?4:2,Et=it.version===1||it.version===2?2:0,wt=xt+vt+_t,Ot=it.version===2?4:2,It=this.file.getUintBytes(st,Ot);for(st+=Ot;It--;){let At=this.file.getUintBytes(st,Tt);st+=Tt+Et+2+bt;let Dt=this.file.getUint16(st);if(st+=2,At===nt)return Dt>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(st+xt,vt),this.file.getUintBytes(st+xt+vt,_t)];st+=Dt*wt}}}class Ue extends Le{}c(Ue,"type","heic");class Fe extends Le{}c(Fe,"type","avif"),w.set("heic",Ue),w.set("avif",Fe),U(E,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),U(E,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),U(E,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),U(B,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let Ee=U(B,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const Be={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};Ee.set(37392,Be),Ee.set(41488,Be);const Ne={0:"Normal",1:"Low",2:"High"};function Ge(rt){return typeof rt=="object"&&rt.length!==void 0?rt[0]:rt}function Ve(rt){let it=Array.from(rt).slice(1);return it[1]>15&&(it=it.map(nt=>String.fromCharCode(nt))),it[2]!=="0"&&it[2]!==0||it.pop(),it.join(".")}function ze(rt){if(typeof rt=="string"){var[it,nt,st,vt,_t,bt]=rt.trim().split(/[-: ]/g).map(Number),xt=new Date(it,nt-1,st);return Number.isNaN(vt)||Number.isNaN(_t)||Number.isNaN(bt)||(xt.setHours(vt),xt.setMinutes(_t),xt.setSeconds(bt)),Number.isNaN(+xt)?rt:xt}}function He(rt){if(typeof rt=="string")return rt;let it=[];if(rt[1]===0&&rt[rt.length-1]===0)for(let nt=0;nt<rt.length;nt+=2)it.push(je(rt[nt+1],rt[nt]));else for(let nt=0;nt<rt.length;nt+=2)it.push(je(rt[nt],rt[nt+1]));return m(String.fromCodePoint(...it))}function je(rt,it){return rt<<8|it}Ee.set(41992,Ne),Ee.set(41993,Ne),Ee.set(41994,Ne),U(N,["ifd0","ifd1"],[[50827,function(rt){return typeof rt!="string"?b(rt):rt}],[306,ze],[40091,He],[40092,He],[40093,He],[40094,He],[40095,He]]),U(N,"exif",[[40960,Ve],[36864,Ve],[36867,ze],[36868,ze],[40962,Ge],[40963,Ge]]),U(N,"gps",[[0,rt=>Array.from(rt).join(".")],[7,rt=>Array.from(rt).join(":")]]);class We extends re{static canHandle(it,nt){return it.getUint8(nt+1)===225&&it.getUint32(nt+4)===1752462448&&it.getString(nt+4,20)==="http://ns.adobe.com/"}static headerLength(it,nt){return it.getString(nt+4,34)==="http://ns.adobe.com/xmp/extension/"?79:4+28+1}static findPosition(it,nt){let st=super.findPosition(it,nt);return st.multiSegment=st.extended=st.headerLength===79,st.multiSegment?(st.chunkCount=it.getUint8(nt+72),st.chunkNumber=it.getUint8(nt+76),it.getUint8(nt+77)!==0&&st.chunkNumber++):(st.chunkCount=1/0,st.chunkNumber=-1),st}static handleMultiSegments(it){return it.map(nt=>nt.chunk.getString()).join("")}normalizeInput(it){return typeof it=="string"?it:I.from(it).getString()}parse(it=this.chunk){if(!this.localOptions.parse)return it;it=function(_t){let bt={},xt={};for(let Tt of Ze)bt[Tt]=[],xt[Tt]=0;return _t.replace(et,(Tt,Et,wt)=>{if(Et==="<"){let Ot=++xt[wt];return bt[wt].push(Ot),`${Tt}#${Ot}`}return`${Tt}#${bt[wt].pop()}`})}(it);let nt=Xe.findAll(it,"rdf","Description");nt.length===0&&nt.push(new Xe("rdf","Description",void 0,it));let st,vt={};for(let _t of nt)for(let bt of _t.properties)st=Je(bt.ns,vt),_e(bt,st);return function(_t){let bt;for(let xt in _t)bt=_t[xt]=f(_t[xt]),bt===void 0&&delete _t[xt];return f(_t)}(vt)}assignToOutput(it,nt){if(this.localOptions.parse)for(let[st,vt]of Object.entries(nt))switch(st){case"tiff":this.assignObjectToOutput(it,"ifd0",vt);break;case"exif":this.assignObjectToOutput(it,"exif",vt);break;case"xmlns":break;default:this.assignObjectToOutput(it,st,vt)}else it.xmp=nt}}c(We,"type","xmp"),c(We,"multiSegment",!0),T.set("xmp",We);class Ke{static findAll(it){return qe(it,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Ke.unpackMatch)}static unpackMatch(it){let nt=it[1],st=it[2],vt=it[3].slice(1,-1);return vt=Qe(vt),new Ke(nt,st,vt)}constructor(it,nt,st){this.ns=it,this.name=nt,this.value=st}serialize(){return this.value}}class Xe{static findAll(it,nt,st){if(nt!==void 0||st!==void 0){nt=nt||"[\\w\\d-]+",st=st||"[\\w\\d-]+";var vt=new RegExp(`<(${nt}):(${st})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else vt=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return qe(it,vt).map(Xe.unpackMatch)}static unpackMatch(it){let nt=it[1],st=it[2],vt=it[4],_t=it[8];return new Xe(nt,st,vt,_t)}constructor(it,nt,st,vt){this.ns=it,this.name=nt,this.attrString=st,this.innerXml=vt,this.attrs=Ke.findAll(st),this.children=Xe.findAll(vt),this.value=this.children.length===0?Qe(vt):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:it,name:nt}=this;return it==="rdf"&&(nt==="Seq"||nt==="Bag"||nt==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return $e(this.children.map(Ye));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let it={};for(let nt of this.properties)_e(nt,it);return this.value!==void 0&&(it.value=this.value),f(it)}}function _e(rt,it){let nt=rt.serialize();nt!==void 0&&(it[rt.name]=nt)}var Ye=rt=>rt.serialize(),$e=rt=>rt.length===1?rt[0]:rt,Je=(rt,it)=>it[rt]?it[rt]:it[rt]={};function qe(rt,it){let nt,st=[];if(!rt)return st;for(;(nt=it.exec(rt))!==null;)st.push(nt);return st}function Qe(rt){if(function(st){return st==null||st==="null"||st==="undefined"||st===""||st.trim()===""}(rt))return;let it=Number(rt);if(!Number.isNaN(it))return it;let nt=rt.toLowerCase();return nt==="true"||nt!=="false"&&rt.trim()}const Ze=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],et=new RegExp(`(<|\\/)(${Ze.join("|")})`,"g");var tt=Object.freeze({__proto__:null,default:Me,Exifr:te,fileParsers:w,segmentParsers:T,fileReaders:A,tagKeys:E,tagValues:B,tagRevivers:N,createDictionary:U,extendDictionary:F,fetchUrlAsArrayBuffer:M,readBlobAsArrayBuffer:R,chunkedProps:G,otherSegments:V,segments:z,tiffBlocks:H,segmentsAndBlocks:j,tiffExtractables:W,inheritables:K,allFormatters:X,Options:q,parse:ie,gpsOnlyOptions:me,gps:Se,thumbnailOnlyOptions:Ce,thumbnail:ye,thumbnailUrl:be,orientationOnlyOptions:Ie,orientation:Pe,rotations:ke,get rotateCanvas(){return we},get rotateCss(){return Te},rotation:Ae});let at=l("fs",rt=>rt.promises);A.set("fs",class extends ve{async readWhole(){this.chunked=!1,this.fs=await at;let rt=await this.fs.readFile(this.input);this._swapBuffer(rt)}async readChunked(){this.chunked=!0,this.fs=await at,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(rt,it){this.fh===void 0&&await this.open(),rt+it>this.size&&(it=this.size-rt);var nt=this.subarray(rt,it,!0);return await this.fh.read(nt.dataView,0,it,rt),nt}async close(){if(this.fh){let rt=this.fh;this.fh=void 0,await rt.close()}}});A.set("base64",class extends ve{constructor(...rt){super(...rt),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(rt,it){let nt,st,vt=this.input;rt===void 0?(rt=0,nt=0,st=0):(nt=4*Math.floor(rt/3),st=rt-nt/4*3),it===void 0&&(it=this.size);let _t=rt+it,bt=nt+4*Math.ceil(_t/3);vt=vt.slice(nt,bt);let xt=Math.min(it,this.size-rt);if(a){let Tt=s.from(vt,"base64").slice(st,st+xt);return this.set(Tt,rt,!0)}{let Tt=this.subarray(rt,xt,!0),Et=atob(vt),wt=Tt.toUint8();for(let Ot=0;Ot<xt;Ot++)wt[Ot]=Et.charCodeAt(st+Ot);return Tt}}});class ot extends se{static canHandle(it,nt){return nt===18761||nt===19789}extendOptions(it){let{ifd0:nt,xmp:st,iptc:vt,icc:_t}=it;st.enabled&&nt.deps.add(700),vt.enabled&&nt.deps.add(33723),_t.enabled&&nt.deps.add(34675),nt.finalizeFilters()}async parse(){let{tiff:it,xmp:nt,iptc:st,icc:vt}=this.options;if(it.enabled||nt.enabled||st.enabled||vt.enabled){let _t=Math.max(S(this.options),this.options.chunkSize);await this.file.ensureChunk(0,_t),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(it){if(this.parsers.tiff[it]){let nt=this.parsers.tiff[it];this.injectSegment(it,nt)}}}c(ot,"type","tiff"),w.set("tiff",ot);let lt=l("zlib");const ht=["ihdr","iccp","text","itxt","exif"];class ut extends se{constructor(...it){super(...it),c(this,"catchError",nt=>this.errors.push(nt)),c(this,"metaChunks",[]),c(this,"unknownChunks",[])}static canHandle(it,nt){return nt===35152&&it.getUint32(0)===2303741511&&it.getUint32(4)===218765834}async parse(){let{file:it}=this;await this.findPngChunksInRange(8,it.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(it,nt){let{file:st}=this;for(;it<nt;){let vt=st.getUint32(it),_t=st.getUint32(it+4),bt=st.getString(it+4,4).toLowerCase(),xt=vt+4+4+4,Tt={type:bt,offset:it,length:xt,start:it+4+4,size:vt,marker:_t};ht.includes(bt)?this.metaChunks.push(Tt):this.unknownChunks.push(Tt),it+=xt}}parseTextChunks(){let it=this.metaChunks.filter(nt=>nt.type==="text");for(let nt of it){let[st,vt]=this.file.getString(nt.start,nt.size).split("\0");this.injectKeyValToIhdr(st,vt)}}injectKeyValToIhdr(it,nt){let st=this.parsers.ihdr;st&&st.raw.set(it,nt)}findIhdr(){let it=this.metaChunks.find(nt=>nt.type==="ihdr");it&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",it.chunk)}async findExif(){let it=this.metaChunks.find(nt=>nt.type==="exif");it&&this.injectSegment("tiff",it.chunk)}async findXmp(){let it=this.metaChunks.filter(nt=>nt.type==="itxt");for(let nt of it)nt.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",nt.chunk)}async findIcc(){let it=this.metaChunks.find(xt=>xt.type==="iccp");if(!it)return;let{chunk:nt}=it,st=nt.getUint8Array(0,81),vt=0;for(;vt<80&&st[vt]!==0;)vt++;let _t=vt+2,bt=nt.getString(0,vt);if(this.injectKeyValToIhdr("ProfileName",bt),n){let xt=await lt,Tt=nt.getUint8Array(_t);Tt=xt.inflateSync(Tt),this.injectSegment("icc",Tt)}}}c(ut,"type","png"),w.set("png",ut),U(E,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),F(E,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let ct=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];F(E,"ifd0",ct),F(E,"exif",ct),U(B,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class ft extends re{static canHandle(it,nt){return it.getUint8(nt+1)===224&&it.getUint32(nt+4)===1246120262&&it.getUint8(nt+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}c(ft,"type","jfif"),c(ft,"headerLength",9),T.set("jfif",ft),U(E,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class dt extends re{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}c(dt,"type","ihdr"),T.set("ihdr",dt),U(E,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),U(B,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class pt extends re{static canHandle(it,nt){return it.getUint8(nt+1)===226&&it.getUint32(nt+4)===1229144927}static findPosition(it,nt){let st=super.findPosition(it,nt);return st.chunkNumber=it.getUint8(nt+16),st.chunkCount=it.getUint8(nt+17),st.multiSegment=st.chunkCount>1,st}static handleMultiSegments(it){return function(nt){let st=function(vt){let _t=vt[0].constructor,bt=0;for(let Et of vt)bt+=Et.length;let xt=new _t(bt),Tt=0;for(let Et of vt)xt.set(Et,Tt),Tt+=Et.length;return xt}(nt.map(vt=>vt.chunk.toUint8()));return new I(st)}(it)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:it}=this;this.chunk.byteLength<84&&g("ICC header is too short");for(let[nt,st]of Object.entries(gt)){nt=parseInt(nt,10);let vt=st(this.chunk,nt);vt!=="\0\0\0\0"&&it.set(nt,vt)}}parseTags(){let it,nt,st,vt,_t,{raw:bt}=this,xt=this.chunk.getUint32(128),Tt=132,Et=this.chunk.byteLength;for(;xt--;){if(it=this.chunk.getString(Tt,4),nt=this.chunk.getUint32(Tt+4),st=this.chunk.getUint32(Tt+8),vt=this.chunk.getString(nt,4),nt+st>Et)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");_t=this.parseTag(vt,nt,st),_t!==void 0&&_t!=="\0\0\0\0"&&bt.set(it,_t),Tt+=12}}parseTag(it,nt,st){switch(it){case"desc":return this.parseDesc(nt);case"mluc":return this.parseMluc(nt);case"text":return this.parseText(nt,st);case"sig ":return this.parseSig(nt)}if(!(nt+st>this.chunk.byteLength))return this.chunk.getUint8Array(nt,st)}parseDesc(it){let nt=this.chunk.getUint32(it+8)-1;return m(this.chunk.getString(it+12,nt))}parseText(it,nt){return m(this.chunk.getString(it+8,nt-8))}parseSig(it){return m(this.chunk.getString(it+8,4))}parseMluc(it){let{chunk:nt}=this,st=nt.getUint32(it+8),vt=nt.getUint32(it+12),_t=it+16,bt=[];for(let xt=0;xt<st;xt++){let Tt=nt.getString(_t+0,2),Et=nt.getString(_t+2,2),wt=nt.getUint32(_t+4),Ot=nt.getUint32(_t+8)+it,It=m(nt.getUnicodeString(Ot,wt));bt.push({lang:Tt,country:Et,text:It}),_t+=vt}return st===1?bt[0].text:bt}translateValue(it,nt){return typeof it=="string"?nt[it]||nt[it.toLowerCase()]||it:nt[it]||it}}c(pt,"type","icc"),c(pt,"multiSegment",!0),c(pt,"headerLength",18);const gt={4:mt,8:function(rt,it){return[rt.getUint8(it),rt.getUint8(it+1)>>4,rt.getUint8(it+1)%16].map(nt=>nt.toString(10)).join(".")},12:mt,16:mt,20:mt,24:function(rt,it){const nt=rt.getUint16(it),st=rt.getUint16(it+2)-1,vt=rt.getUint16(it+4),_t=rt.getUint16(it+6),bt=rt.getUint16(it+8),xt=rt.getUint16(it+10);return new Date(Date.UTC(nt,st,vt,_t,bt,xt))},36:mt,40:mt,48:mt,52:mt,64:(rt,it)=>rt.getUint32(it),80:mt};function mt(rt,it){return m(rt.getString(it,4))}T.set("icc",pt),U(E,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const St={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},Ct={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};U(B,"icc",[[4,St],[12,Ct],[40,Object.assign({},St,Ct)],[48,St],[80,St],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class yt extends re{static canHandle(it,nt,st){return it.getUint8(nt+1)===237&&it.getString(nt+4,9)==="Photoshop"&&this.containsIptc8bim(it,nt,st)!==void 0}static headerLength(it,nt,st){let vt,_t=this.containsIptc8bim(it,nt,st);if(_t!==void 0)return vt=it.getUint8(nt+_t+7),vt%2!=0&&(vt+=1),vt===0&&(vt=4),_t+8+vt}static containsIptc8bim(it,nt,st){for(let vt=0;vt<st;vt++)if(this.isIptcSegmentHead(it,nt+vt))return vt}static isIptcSegmentHead(it,nt){return it.getUint8(nt)===56&&it.getUint32(nt)===943868237&&it.getUint16(nt+4)===1028}parse(){let{raw:it}=this,nt=this.chunk.byteLength-1,st=!1;for(let vt=0;vt<nt;vt++)if(this.chunk.getUint8(vt)===28&&this.chunk.getUint8(vt+1)===2){st=!0;let _t=this.chunk.getUint16(vt+3),bt=this.chunk.getUint8(vt+2),xt=this.chunk.getLatin1String(vt+5,_t);it.set(bt,this.pluralizeValue(it.get(bt),xt)),vt+=4+_t}else if(st)break;return this.translate(),this.output}pluralizeValue(it,nt){return it!==void 0?it instanceof Array?(it.push(nt),it):[it,nt]:nt}}c(yt,"type","iptc"),c(yt,"translateValues",!1),c(yt,"reviveValues",!1),T.set("iptc",yt),U(E,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),U(B,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);let nanoid=(rt=21)=>crypto.getRandomValues(new Uint8Array(rt)).reduce((it,nt)=>(nt&=63,nt<36?it+=nt.toString(36):nt<62?it+=(nt-26).toString(36).toUpperCase():nt>62?it+="-":it+="_",it),"");var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},litegraph={};(function(exports){(function(global){var LiteGraph=global.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#FFF",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",NODE_BOX_OUTLINE_COLOR:"#FFF",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,GRID_SHAPE:6,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,NODE_MODES:["Always","On Event","Never","On Trigger"],NODE_MODES_COLORS:["#666","#422","#333","#224","#626"],ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,LINK_RENDER_MODES:["Straight","Linear","Spline"],STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,VERTICAL_LAYOUT:"vertical",proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,use_deferred_actions:!0,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},auto_sort_node_types:!1,node_box_coloured_when_on:!1,node_box_coloured_by_mode:!1,dialog_close_on_mouse_leave:!0,dialog_close_on_mouse_leave_delay:500,shift_click_do_break_link_from:!1,click_do_break_link_to:!1,search_hide_on_mouse_leave:!0,search_filter_enabled:!1,search_show_all_on_open:!0,auto_load_slot_types:!1,registered_slot_in_types:{},registered_slot_out_types:{},slot_types_in:[],slot_types_out:[],slot_types_default_in:[],slot_types_default_out:[],alt_drag_do_clone_nodes:!1,do_add_triggers_slots:!1,allow_multi_output_for_events:!0,middle_click_slot_add_default_node:!1,release_link_on_empty_shows_menu:!1,pointerevents_method:"mouse",ctrl_shift_v_paste_connect_unselected_outputs:!1,use_uuids:!1,registerNodeType:function(rt,it){if(!it.prototype)throw"Cannot register a simple object, it must be a class with a prototype";it.type=rt,LiteGraph.debug&&console.log("Node registered: "+rt);const nt=it.name,st=rt.lastIndexOf("/");it.category=rt.substring(0,st),it.title||(it.title=nt);for(var vt in LGraphNode.prototype)it.prototype[vt]||(it.prototype[vt]=LGraphNode.prototype[vt]);const _t=this.registered_node_types[rt];if(_t&&console.log("replacing node type: "+rt),!Object.prototype.hasOwnProperty.call(it.prototype,"shape")&&(Object.defineProperty(it.prototype,"shape",{set:function(bt){switch(bt){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=bt}},get:function(){return this._shape},enumerable:!0,configurable:!0}),it.supported_extensions))for(let bt in it.supported_extensions){const xt=it.supported_extensions[bt];xt&&xt.constructor===String&&(this.node_types_by_file_extension[xt.toLowerCase()]=it)}this.registered_node_types[rt]=it,it.constructor.name&&(this.Nodes[nt]=it),LiteGraph.onNodeTypeRegistered&&LiteGraph.onNodeTypeRegistered(rt,it),_t&&LiteGraph.onNodeTypeReplaced&&LiteGraph.onNodeTypeReplaced(rt,it,_t),it.prototype.onPropertyChange&&console.warn("LiteGraph node class "+rt+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),this.auto_load_slot_types&&new it(it.title||"tmpnode")},unregisterNodeType:function(rt){const it=rt.constructor===String?this.registered_node_types[rt]:rt;if(!it)throw"node type not found: "+rt;delete this.registered_node_types[it.type],it.constructor.name&&delete this.Nodes[it.constructor.name]},registerNodeAndSlotType:function(rt,it,nt){nt=nt||!1;const vt=(rt.constructor===String&&this.registered_node_types[rt]!=="anonymous"?this.registered_node_types[rt]:rt).constructor.type;let _t=[];typeof it=="string"?_t=it.split(","):it==this.EVENT||it==this.ACTION?_t=["_event_"]:_t=["*"];for(let bt=0;bt<_t.length;++bt){let xt=_t[bt];xt===""&&(xt="*");const Tt=nt?"registered_slot_out_types":"registered_slot_in_types";this[Tt][xt]===void 0&&(this[Tt][xt]={nodes:[]}),this[Tt][xt].nodes.includes(vt)||this[Tt][xt].nodes.push(vt),nt?this.slot_types_out.includes(xt.toLowerCase())||(this.slot_types_out.push(xt.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(xt.toLowerCase())||(this.slot_types_in.push(xt.toLowerCase()),this.slot_types_in.sort())}},buildNodeClassFromObject:function(rt,it){var nt="";if(it.inputs)for(var st=0;st<it.inputs.length;++st){var vt=it.inputs[st][0],_t=it.inputs[st][1];_t&&_t.constructor===String&&(_t='"'+_t+'"'),nt+="this.addInput('"+vt+"',"+_t+`);
`}if(it.outputs)for(var st=0;st<it.outputs.length;++st){var vt=it.outputs[st][0],_t=it.outputs[st][1];_t&&_t.constructor===String&&(_t='"'+_t+'"'),nt+="this.addOutput('"+vt+"',"+_t+`);
`}if(it.properties)for(var st in it.properties){var bt=it.properties[st];bt&&bt.constructor===String&&(bt='"'+bt+'"'),nt+="this.addProperty('"+st+"',"+bt+`);
`}nt+="if(this.onCreate)this.onCreate()";var xt=Function(nt);for(var st in it)st!="inputs"&&st!="outputs"&&st!="properties"&&(xt.prototype[st]=it[st]);return xt.title=it.title||rt.split("/").pop(),xt.desc=it.desc||"Generated from object",this.registerNodeType(rt,xt),xt},wrapFunctionAsNode:function(rt,it,nt,st,vt){var _t=Array(it.length),bt="";if(nt!==null)for(var xt=LiteGraph.getParameterNames(it),Tt=0;Tt<xt.length;++Tt){var Et=0;nt&&(nt[Tt]!=null&&nt[Tt].constructor===String?Et="'"+nt[Tt]+"'":nt[Tt]!=null&&(Et=nt[Tt])),bt+="this.addInput('"+xt[Tt]+"',"+Et+`);
`}st!==null&&(bt+="this.addOutput('out',"+(st!=null?st.constructor===String?"'"+st+"'":st:0)+`);
`),vt&&(bt+="this.properties = "+JSON.stringify(vt)+`;
`);var wt=Function(bt);return wt.title=rt.split("/").pop(),wt.desc="Generated from "+it.name,wt.prototype.onExecute=function(){for(var It=0;It<_t.length;++It)_t[It]=this.getInputData(It);var At=it.apply(this,_t);this.setOutputData(0,At)},this.registerNodeType(rt,wt),wt},clearRegisteredTypes:function(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod:function(rt,it){LGraphNode.prototype[rt]=it;for(var nt in this.registered_node_types){var st=this.registered_node_types[nt];st.prototype[rt]&&(st.prototype["_"+rt]=st.prototype[rt]),st.prototype[rt]=it}},createNode:function(rt,it,nt){var st=this.registered_node_types[rt];if(!st)return LiteGraph.debug&&console.log('GraphNode type "'+rt+'" not registered.'),null;st.prototype,it=it||st.title||rt;var vt=null;if(LiteGraph.catch_exceptions)try{vt=new st(it)}catch(bt){return console.error(bt),null}else vt=new st(it);if(vt.type=rt,!vt.title&&it&&(vt.title=it),vt.properties||(vt.properties={}),vt.properties_info||(vt.properties_info=[]),vt.flags||(vt.flags={}),vt.size||(vt.size=vt.computeSize()),vt.pos||(vt.pos=LiteGraph.DEFAULT_POSITION.concat()),vt.mode||(vt.mode=LiteGraph.ALWAYS),nt)for(var _t in nt)vt[_t]=nt[_t];return vt.onNodeCreated&&vt.onNodeCreated(),vt},getNodeType:function(rt){return this.registered_node_types[rt]},getNodeTypesInCategory:function(rt,it){var nt=[];for(var st in this.registered_node_types){var vt=this.registered_node_types[st];vt.filter==it&&(rt==""?vt.category==null&&nt.push(vt):vt.category==rt&&nt.push(vt))}return this.auto_sort_node_types&&nt.sort(function(_t,bt){return _t.title.localeCompare(bt.title)}),nt},getNodeTypesCategories:function(rt){var it={"":1};for(var nt in this.registered_node_types){var st=this.registered_node_types[nt];if(st.category&&!st.skip_list){if(st.filter!=rt)continue;it[st.category]=1}}var vt=[];for(var nt in it)vt.push(nt);return this.auto_sort_node_types?vt.sort():vt},reloadNodes:function(rt){for(var it=document.getElementsByTagName("script"),nt=[],st=0;st<it.length;st++)nt.push(it[st]);var vt=document.getElementsByTagName("head")[0];rt=document.location.href+rt;for(var st=0;st<nt.length;st++){var _t=nt[st].src;if(!(!_t||_t.substr(0,rt.length)!=rt))try{LiteGraph.debug&&console.log("Reloading: "+_t);var bt=document.createElement("script");bt.type="text/javascript",bt.src=_t,vt.appendChild(bt),vt.removeChild(nt[st])}catch(Tt){if(LiteGraph.throw_errors)throw Tt;LiteGraph.debug&&console.log("Error while reloading "+_t)}}LiteGraph.debug&&console.log("Nodes reloaded")},cloneObject:function(rt,it){if(rt==null)return null;var nt=JSON.parse(JSON.stringify(rt));if(!it)return nt;for(var st in nt)it[st]=nt[st];return it},uuidv4:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,rt=>(rt^Math.random()*16>>rt/4).toString(16))},isValidConnection:function(rt,it){if((rt==""||rt==="*")&&(rt=0),(it==""||it==="*")&&(it=0),!rt||!it||rt==it||rt==LiteGraph.EVENT&&it==LiteGraph.ACTION)return!0;if(rt=String(rt),it=String(it),rt=rt.toLowerCase(),it=it.toLowerCase(),rt.indexOf(",")==-1&&it.indexOf(",")==-1)return rt==it;for(var nt=rt.split(","),st=it.split(","),vt=0;vt<nt.length;++vt)for(var _t=0;_t<st.length;++_t)if(this.isValidConnection(nt[vt],st[_t]))return!0;return!1},registerSearchboxExtra:function(rt,it,nt){this.searchbox_extras[it.toLowerCase()]={type:rt,desc:it,data:nt}},fetchFile:function(rt,it,nt,st){if(!rt)return null;if(it=it||"text",rt.constructor===String)return rt.substr(0,4)=="http"&&LiteGraph.proxy&&(rt=LiteGraph.proxy+rt.substr(rt.indexOf(":")+3)),fetch(rt).then(function(_t){if(!_t.ok)throw new Error("File not found");if(it=="arraybuffer")return _t.arrayBuffer();if(it=="text"||it=="string")return _t.text();if(it=="json")return _t.json();if(it=="blob")return _t.blob()}).then(function(_t){nt&&nt(_t)}).catch(function(_t){console.error("error fetching file:",rt),st&&st(_t)});if(rt.constructor===File||rt.constructor===Blob){var vt=new FileReader;if(vt.onload=function(_t){var bt=_t.target.result;it=="json"&&(bt=JSON.parse(bt)),nt&&nt(bt)},it=="arraybuffer")return vt.readAsArrayBuffer(rt);if(it=="text"||it=="json")return vt.readAsText(rt);if(it=="blob")return vt.readAsBinaryString(rt)}return null}};typeof performance<"u"?LiteGraph.getTime=performance.now.bind(performance):typeof Date<"u"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process<"u"?LiteGraph.getTime=function(){var rt=process.hrtime();return rt[0]*.001+rt[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()};function LGraph(rt){LiteGraph.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),rt&&this.configure(rt)}global.LGraph=LiteGraph.LGraph=LGraph,LGraph.supported_types=["number","string","boolean"],LGraph.prototype.getSupportedTypes=function(){return this.supported_types||LGraph.supported_types},LGraph.STATUS_STOPPED=1,LGraph.STATUS_RUNNING=2,LGraph.prototype.clear=function(){if(this.stop(),this.status=LGraph.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var rt=0;rt<this._nodes.length;++rt){var it=this._nodes[rt];it.onRemoved&&it.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},LGraph.prototype.attachCanvas=function(rt){if(rt.constructor!=LGraphCanvas)throw"attachCanvas expects a LGraphCanvas instance";rt.graph&&rt.graph!=this&&rt.graph.detachCanvas(rt),rt.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(rt)},LGraph.prototype.detachCanvas=function(rt){if(!!this.list_of_graphcanvas){var it=this.list_of_graphcanvas.indexOf(rt);it!=-1&&(rt.graph=null,this.list_of_graphcanvas.splice(it,1))}},LGraph.prototype.start=function(rt){if(this.status!=LGraph.STATUS_RUNNING){this.status=LGraph.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime,rt=rt||0;var it=this;if(rt==0&&typeof window<"u"&&window.requestAnimationFrame){let nt=function(){it.execution_timer_id==-1&&(window.requestAnimationFrame(nt),it.onBeforeStep&&it.onBeforeStep(),it.runStep(1,!it.catch_errors),it.onAfterStep&&it.onAfterStep())};this.execution_timer_id=-1,nt()}else this.execution_timer_id=setInterval(function(){it.onBeforeStep&&it.onBeforeStep(),it.runStep(1,!it.catch_errors),it.onAfterStep&&it.onAfterStep()},rt)}},LGraph.prototype.stop=function(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},LGraph.prototype.runStep=function(rt,it,nt){rt=rt||1;var st=LiteGraph.getTime();this.globaltime=.001*(st-this.starttime);var vt=this._nodes_executable?this._nodes_executable:this._nodes;if(!!vt){if(nt=nt||vt.length,it){for(var _t=0;_t<rt;_t++){for(var bt=0;bt<nt;++bt){var xt=vt[bt];LiteGraph.use_deferred_actions&&xt._waiting_actions&&xt._waiting_actions.length&&xt.executePendingActions(),xt.mode==LiteGraph.ALWAYS&&xt.onExecute&&xt.doExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(var _t=0;_t<rt;_t++){for(var bt=0;bt<nt;++bt){var xt=vt[bt];LiteGraph.use_deferred_actions&&xt._waiting_actions&&xt._waiting_actions.length&&xt.executePendingActions(),xt.mode==LiteGraph.ALWAYS&&xt.onExecute&&xt.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(wt){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw wt;LiteGraph.debug&&console.log("Error during execution: "+wt),this.stop()}var Tt=LiteGraph.getTime(),Et=Tt-st;Et==0&&(Et=1),this.execution_time=.001*Et,this.globaltime+=.001*Et,this.iteration+=1,this.elapsed_time=(Tt-this.last_update_time)*.001,this.last_update_time=Tt,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[]}},LGraph.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var rt=0;rt<this._nodes_in_order.length;++rt)this._nodes_in_order[rt].onExecute&&this._nodes_executable.push(this._nodes_in_order[rt])},LGraph.prototype.computeExecutionOrder=function(rt,it){for(var nt=[],st=[],vt={},_t={},bt={},xt=0,Mt=this._nodes.length;xt<Mt;++xt){var Tt=this._nodes[xt];if(!(rt&&!Tt.onExecute)){vt[Tt.id]=Tt;var Et=0;if(Tt.inputs)for(var wt=0,Ot=Tt.inputs.length;wt<Ot;wt++)Tt.inputs[wt]&&Tt.inputs[wt].link!=null&&(Et+=1);Et==0?(st.push(Tt),it&&(Tt._level=1)):(it&&(Tt._level=0),bt[Tt.id]=Et)}}for(;st.length!=0;){var Tt=st.shift();if(nt.push(Tt),delete vt[Tt.id],!!Tt.outputs)for(var xt=0;xt<Tt.outputs.length;xt++){var It=Tt.outputs[xt];if(!(It==null||It.links==null||It.links.length==0))for(var wt=0;wt<It.links.length;wt++){var At=It.links[wt],Dt=this.links[At];if(!!Dt&&!_t[Dt.id]){var kt=this.getNodeById(Dt.target_id);if(kt==null){_t[Dt.id]=!0;continue}it&&(!kt._level||kt._level<=Tt._level)&&(kt._level=Tt._level+1),_t[Dt.id]=!0,bt[kt.id]-=1,bt[kt.id]==0&&st.push(kt)}}}}for(var xt in vt)nt.push(vt[xt]);nt.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing");for(var Mt=nt.length,xt=0;xt<Mt;++xt)nt[xt].order=xt;nt=nt.sort(function(zt,Pt){var Lt=zt.constructor.priority||zt.priority||0,Bt=Pt.constructor.priority||Pt.priority||0;return Lt==Bt?zt.order-Pt.order:Lt-Bt});for(var xt=0;xt<Mt;++xt)nt[xt].order=xt;return nt},LGraph.prototype.getAncestors=function(rt){for(var it=[],nt=[rt],st={};nt.length;){var vt=nt.shift();if(!!vt.inputs){!st[vt.id]&&vt!=rt&&(st[vt.id]=!0,it.push(vt));for(var _t=0;_t<vt.inputs.length;++_t){var bt=vt.getInputNode(_t);bt&&it.indexOf(bt)==-1&&nt.push(bt)}}}return it.sort(function(xt,Tt){return xt.order-Tt.order}),it},LGraph.prototype.arrange=function(rt,it){rt=rt||100;const nt=this.computeExecutionOrder(!1,!0),st=[];for(let _t=0;_t<nt.length;++_t){const bt=nt[_t],xt=bt._level||1;st[xt]||(st[xt]=[]),st[xt].push(bt)}let vt=rt;for(let _t=0;_t<st.length;++_t){const bt=st[_t];if(!bt)continue;let xt=100,Tt=rt+LiteGraph.NODE_TITLE_HEIGHT;for(let Et=0;Et<bt.length;++Et){const wt=bt[Et];wt.pos[0]=it==LiteGraph.VERTICAL_LAYOUT?Tt:vt,wt.pos[1]=it==LiteGraph.VERTICAL_LAYOUT?vt:Tt;const Ot=it==LiteGraph.VERTICAL_LAYOUT?1:0;wt.size[Ot]>xt&&(xt=wt.size[Ot]);const It=it==LiteGraph.VERTICAL_LAYOUT?0:1;Tt+=wt.size[It]+rt+LiteGraph.NODE_TITLE_HEIGHT}vt+=xt+rt}this.setDirtyCanvas(!0,!0)},LGraph.prototype.getTime=function(){return this.globaltime},LGraph.prototype.getFixedTime=function(){return this.fixedtime},LGraph.prototype.getElapsedTime=function(){return this.elapsed_time},LGraph.prototype.sendEventToAllNodes=function(rt,it,nt){nt=nt||LiteGraph.ALWAYS;var st=this._nodes_in_order?this._nodes_in_order:this._nodes;if(!!st)for(var vt=0,_t=st.length;vt<_t;++vt){var bt=st[vt];if(bt.constructor===LiteGraph.Subgraph&&rt!="onExecute"){bt.mode==nt&&bt.sendEventToAllNodes(rt,it,nt);continue}!bt[rt]||bt.mode!=nt||(it===void 0?bt[rt]():it&&it.constructor===Array?bt[rt].apply(bt,it):bt[rt](it))}},LGraph.prototype.sendActionToCanvas=function(rt,it){if(!!this.list_of_graphcanvas)for(var nt=0;nt<this.list_of_graphcanvas.length;++nt){var st=this.list_of_graphcanvas[nt];st[rt]&&st[rt].apply(st,it)}},LGraph.prototype.add=function(rt,it){if(!!rt){if(rt.constructor===LGraphGroup){this._groups.push(rt),this.setDirtyCanvas(!0),this.change(),rt.graph=this,this._version++;return}if(rt.id!=-1&&this._nodes_by_id[rt.id]!=null&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?rt.id=LiteGraph.uuidv4():rt.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return LiteGraph.use_uuids?(rt.id==null||rt.id==-1)&&(rt.id=LiteGraph.uuidv4()):rt.id==null||rt.id==-1?rt.id=++this.last_node_id:this.last_node_id<rt.id&&(this.last_node_id=rt.id),rt.graph=this,this._version++,this._nodes.push(rt),this._nodes_by_id[rt.id]=rt,rt.onAdded&&rt.onAdded(this),this.config.align_to_grid&&rt.alignToGrid(),it||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(rt),this.setDirtyCanvas(!0),this.change(),rt}},LGraph.prototype.remove=function(rt){if(rt.constructor===LiteGraph.LGraphGroup){var it=this._groups.indexOf(rt);it!=-1&&this._groups.splice(it,1),rt.graph=null,this._version++,this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[rt.id]!=null&&!rt.ignore_remove){if(this.beforeChange(),rt.inputs)for(var nt=0;nt<rt.inputs.length;nt++){var st=rt.inputs[nt];st.link!=null&&rt.disconnectInput(nt)}if(rt.outputs)for(var nt=0;nt<rt.outputs.length;nt++){var st=rt.outputs[nt];st.links!=null&&st.links.length&&rt.disconnectOutput(nt)}if(rt.onRemoved&&rt.onRemoved(),rt.graph=null,this._version++,this.list_of_graphcanvas)for(var nt=0;nt<this.list_of_graphcanvas.length;++nt){var vt=this.list_of_graphcanvas[nt];vt.selected_nodes[rt.id]&&delete vt.selected_nodes[rt.id],vt.node_dragged==rt&&(vt.node_dragged=null)}var _t=this._nodes.indexOf(rt);_t!=-1&&this._nodes.splice(_t,1),delete this._nodes_by_id[rt.id],this.onNodeRemoved&&this.onNodeRemoved(rt),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.afterChange(),this.change(),this.updateExecutionOrder()}},LGraph.prototype.getNodeById=function(rt){return rt==null?null:this._nodes_by_id[rt]},LGraph.prototype.findNodesByClass=function(rt,it){it=it||[],it.length=0;for(var nt=0,st=this._nodes.length;nt<st;++nt)this._nodes[nt].constructor===rt&&it.push(this._nodes[nt]);return it},LGraph.prototype.findNodesByType=function(nt,it){var nt=nt.toLowerCase();it=it||[],it.length=0;for(var st=0,vt=this._nodes.length;st<vt;++st)this._nodes[st].type.toLowerCase()==nt&&it.push(this._nodes[st]);return it},LGraph.prototype.findNodeByTitle=function(rt){for(var it=0,nt=this._nodes.length;it<nt;++it)if(this._nodes[it].title==rt)return this._nodes[it];return null},LGraph.prototype.findNodesByTitle=function(rt){for(var it=[],nt=0,st=this._nodes.length;nt<st;++nt)this._nodes[nt].title==rt&&it.push(this._nodes[nt]);return it},LGraph.prototype.getNodeOnPos=function(rt,it,nt,st){nt=nt||this._nodes;for(var vt=null,_t=nt.length-1;_t>=0;_t--){var bt=nt[_t];if(bt.isPointInside(rt,it,st))return bt}return vt},LGraph.prototype.getGroupOnPos=function(rt,it){for(var nt=this._groups.length-1;nt>=0;nt--){var st=this._groups[nt];if(st.isPointInside(rt,it,2,!0))return st}return null},LGraph.prototype.checkNodeTypes=function(){for(var rt=0;rt<this._nodes.length;rt++){var it=this._nodes[rt],nt=LiteGraph.registered_node_types[it.type];if(it.constructor!=nt){console.log("node being replaced by newer version: "+it.type);var st=LiteGraph.createNode(it.type);this._nodes[rt]=st,st.configure(it.serialize()),st.graph=this,this._nodes_by_id[st.id]=st,it.inputs&&(st.inputs=it.inputs.concat()),it.outputs&&(st.outputs=it.outputs.concat())}}this.updateExecutionOrder()},LGraph.prototype.onAction=function(rt,it,nt){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var st=0;st<this._input_nodes.length;++st){var vt=this._input_nodes[st];if(vt.properties.name==rt){vt.actionDo(rt,it,nt);break}}},LGraph.prototype.trigger=function(rt,it){this.onTrigger&&this.onTrigger(rt,it)},LGraph.prototype.addInput=function(rt,it,nt){var st=this.inputs[rt];st||(this.beforeChange(),this.inputs[rt]={name:rt,type:it,value:nt},this._version++,this.afterChange(),this.onInputAdded&&this.onInputAdded(rt,it),this.onInputsOutputsChange&&this.onInputsOutputsChange())},LGraph.prototype.setInputData=function(rt,it){var nt=this.inputs[rt];!nt||(nt.value=it)},LGraph.prototype.getInputData=function(rt){var it=this.inputs[rt];return it?it.value:null},LGraph.prototype.renameInput=function(rt,it){if(it!=rt){if(!this.inputs[rt])return!1;if(this.inputs[it])return console.error("there is already one input with that name"),!1;this.inputs[it]=this.inputs[rt],delete this.inputs[rt],this._version++,this.onInputRenamed&&this.onInputRenamed(rt,it),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},LGraph.prototype.changeInputType=function(rt,it){if(!this.inputs[rt])return!1;this.inputs[rt].type&&String(this.inputs[rt].type).toLowerCase()==String(it).toLowerCase()||(this.inputs[rt].type=it,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(rt,it))},LGraph.prototype.removeInput=function(rt){return this.inputs[rt]?(delete this.inputs[rt],this._version++,this.onInputRemoved&&this.onInputRemoved(rt),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.addOutput=function(rt,it,nt){this.outputs[rt]={name:rt,type:it,value:nt},this._version++,this.onOutputAdded&&this.onOutputAdded(rt,it),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.setOutputData=function(rt,it){var nt=this.outputs[rt];!nt||(nt.value=it)},LGraph.prototype.getOutputData=function(rt){var it=this.outputs[rt];return it?it.value:null},LGraph.prototype.renameOutput=function(rt,it){if(!this.outputs[rt])return!1;if(this.outputs[it])return console.error("there is already one output with that name"),!1;this.outputs[it]=this.outputs[rt],delete this.outputs[rt],this._version++,this.onOutputRenamed&&this.onOutputRenamed(rt,it),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.changeOutputType=function(rt,it){if(!this.outputs[rt])return!1;this.outputs[rt].type&&String(this.outputs[rt].type).toLowerCase()==String(it).toLowerCase()||(this.outputs[rt].type=it,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(rt,it))},LGraph.prototype.removeOutput=function(rt){return this.outputs[rt]?(delete this.outputs[rt],this._version++,this.onOutputRemoved&&this.onOutputRemoved(rt),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.triggerInput=function(rt,it){for(var nt=this.findNodesByTitle(rt),st=0;st<nt.length;++st)nt[st].onTrigger(it)},LGraph.prototype.setCallback=function(rt,it){for(var nt=this.findNodesByTitle(rt),st=0;st<nt.length;++st)nt[st].setTrigger(it)},LGraph.prototype.beforeChange=function(rt){this.onBeforeChange&&this.onBeforeChange(this,rt),this.sendActionToCanvas("onBeforeChange",this)},LGraph.prototype.afterChange=function(rt){this.onAfterChange&&this.onAfterChange(this,rt),this.sendActionToCanvas("onAfterChange",this)},LGraph.prototype.connectionChange=function(rt,it){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(rt),this._version++,this.sendActionToCanvas("onConnectionChange")},LGraph.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var rt=0;rt<this.list_of_graphcanvas.length;++rt){var it=this.list_of_graphcanvas[rt];if(it.live_mode)return!0}return!1},LGraph.prototype.clearTriggeredSlots=function(){for(var rt in this.links){var it=this.links[rt];!it||it._last_time&&(it._last_time=0)}},LGraph.prototype.change=function(){LiteGraph.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},LGraph.prototype.setDirtyCanvas=function(rt,it){this.sendActionToCanvas("setDirty",[rt,it])},LGraph.prototype.removeLink=function(rt){var it=this.links[rt];if(!!it){var nt=this.getNodeById(it.target_id);nt&&nt.disconnectInput(it.target_slot)}},LGraph.prototype.serialize=function(){for(var rt=[],it=0,nt=this._nodes.length;it<nt;++it)rt.push(this._nodes[it].serialize());var st=[];for(var it in this.links){var vt=this.links[it];if(!vt.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var _t=new LLink;for(var bt in vt)_t[bt]=vt[bt];this.links[it]=_t,vt=_t}st.push(vt.serialize())}for(var xt=[],it=0;it<this._groups.length;++it)xt.push(this._groups[it].serialize());var Tt={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:rt,links:st,groups:xt,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return this.onSerialize&&this.onSerialize(Tt),Tt},LGraph.prototype.configure=function(rt,it){if(!!rt){it||this.clear();var nt=rt.nodes;if(rt.links&&rt.links.constructor===Array){for(var st=[],vt=0;vt<rt.links.length;++vt){var _t=rt.links[vt];if(!_t){console.warn("serialized graph link data contains errors, skipping.");continue}var bt=new LLink;bt.configure(_t),st[bt.id]=bt}rt.links=st}for(var vt in rt)vt=="nodes"||vt=="groups"||(this[vt]=rt[vt]);var xt=!1;if(this._nodes=[],nt){for(var vt=0,Tt=nt.length;vt<Tt;++vt){var Et=nt[vt],wt=LiteGraph.createNode(Et.type,Et.title);wt||(LiteGraph.debug&&console.log("Node not found or has errors: "+Et.type),wt=new LGraphNode,wt.last_serialization=Et,wt.has_errors=!0,xt=!0),wt.id=Et.id,this.add(wt,!0)}for(var vt=0,Tt=nt.length;vt<Tt;++vt){var Et=nt[vt],wt=this.getNodeById(Et.id);wt&&wt.configure(Et)}}if(this._groups.length=0,rt.groups)for(var vt=0;vt<rt.groups.length;++vt){var Ot=new LiteGraph.LGraphGroup;Ot.configure(rt.groups[vt]),this.add(Ot)}return this.updateExecutionOrder(),this.extra=rt.extra||{},this.onConfigure&&this.onConfigure(rt),this._version++,this.setDirtyCanvas(!0,!0),xt}},LGraph.prototype.load=function(rt,it){var nt=this;if(rt.constructor===File||rt.constructor===Blob){var st=new FileReader;st.addEventListener("load",function(_t){var bt=JSON.parse(_t.target.result);nt.configure(bt),it&&it()}),st.readAsText(rt);return}var vt=new XMLHttpRequest;vt.open("GET",rt,!0),vt.send(null),vt.onload=function(_t){if(vt.status!==200){console.error("Error loading graph:",vt.status,vt.response);return}var bt=JSON.parse(vt.response);nt.configure(bt),it&&it()},vt.onerror=function(_t){console.error("Error loading graph:",_t)}},LGraph.prototype.onNodeTrace=function(rt,it,nt){};function LLink(rt,it,nt,st,vt,_t){this.id=rt,this.type=it,this.origin_id=nt,this.origin_slot=st,this.target_id=vt,this.target_slot=_t,this._data=null,this._pos=new Float32Array(2)}LLink.prototype.configure=function(rt){rt.constructor===Array?(this.id=rt[0],this.origin_id=rt[1],this.origin_slot=rt[2],this.target_id=rt[3],this.target_slot=rt[4],this.type=rt[5]):(this.id=rt.id,this.type=rt.type,this.origin_id=rt.origin_id,this.origin_slot=rt.origin_slot,this.target_id=rt.target_id,this.target_slot=rt.target_slot)},LLink.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},LiteGraph.LLink=LLink;function LGraphNode(rt){this._ctor(rt)}global.LGraphNode=LiteGraph.LGraphNode=LGraphNode,LGraphNode.prototype._ctor=function(rt){this.title=rt||"Unnamed",this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(it){!it||it.length<2||(this._pos[0]=it[0],this._pos[1]=it[1])},get:function(){return this._pos},enumerable:!0}),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},LGraphNode.prototype.configure=function(rt){this.graph&&this.graph._version++;for(var it in rt){if(it=="properties"){for(var nt in rt.properties)this.properties[nt]=rt.properties[nt],this.onPropertyChanged&&this.onPropertyChanged(nt,rt.properties[nt]);continue}rt[it]!=null&&(typeof rt[it]=="object"?this[it]&&this[it].configure?this[it].configure(rt[it]):this[it]=LiteGraph.cloneObject(rt[it],this[it]):this[it]=rt[it])}if(rt.title||(this.title=this.constructor.title),this.inputs)for(var st=0;st<this.inputs.length;++st){var vt=this.inputs[st],_t=this.graph?this.graph.links[vt.link]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,st,!0,_t,vt),this.onInputAdded&&this.onInputAdded(vt)}if(this.outputs)for(var st=0;st<this.outputs.length;++st){var bt=this.outputs[st];if(!!bt.links){for(var it=0;it<bt.links.length;++it){var _t=this.graph?this.graph.links[bt.links[it]]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,st,!0,_t,bt)}this.onOutputAdded&&this.onOutputAdded(bt)}}if(this.widgets){for(var st=0;st<this.widgets.length;++st){var xt=this.widgets[st];!xt||xt.options&&xt.options.property&&this.properties[xt.options.property]!=null&&(xt.value=JSON.parse(JSON.stringify(this.properties[xt.options.property])))}if(rt.widgets_values)for(var st=0;st<rt.widgets_values.length;++st)this.widgets[st]&&(this.widgets[st].value=rt.widgets_values[st])}this.onConfigure&&this.onConfigure(rt)},LGraphNode.prototype.serialize=function(){var rt={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===LGraphNode&&this.last_serialization)return this.last_serialization;if(this.inputs&&(rt.inputs=this.inputs),this.outputs){for(var it=0;it<this.outputs.length;it++)delete this.outputs[it]._data;rt.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(rt.title=this.title),this.properties&&(rt.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){rt.widgets_values=[];for(var it=0;it<this.widgets.length;++it)this.widgets[it]?rt.widgets_values[it]=this.widgets[it].value:rt.widgets_values[it]=null}return rt.type||(rt.type=this.constructor.type),this.color&&(rt.color=this.color),this.bgcolor&&(rt.bgcolor=this.bgcolor),this.boxcolor&&(rt.boxcolor=this.boxcolor),this.shape&&(rt.shape=this.shape),this.onSerialize&&this.onSerialize(rt)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),rt},LGraphNode.prototype.clone=function(){var rt=LiteGraph.createNode(this.type);if(!rt)return null;var it=LiteGraph.cloneObject(this.serialize());if(it.inputs)for(var nt=0;nt<it.inputs.length;++nt)it.inputs[nt].link=null;if(it.outputs)for(var nt=0;nt<it.outputs.length;++nt)it.outputs[nt].links&&(it.outputs[nt].links.length=0);return delete it.id,LiteGraph.use_uuids&&(it.id=LiteGraph.uuidv4()),rt.configure(it),rt},LGraphNode.prototype.toString=function(){return JSON.stringify(this.serialize())},LGraphNode.prototype.getTitle=function(){return this.title||this.constructor.title},LGraphNode.prototype.setProperty=function(rt,it){if(this.properties||(this.properties={}),it!==this.properties[rt]){var nt=this.properties[rt];if(this.properties[rt]=it,this.onPropertyChanged&&this.onPropertyChanged(rt,it,nt)===!1&&(this.properties[rt]=nt),this.widgets)for(var st=0;st<this.widgets.length;++st){var vt=this.widgets[st];if(!!vt&&vt.options.property==rt){vt.value=it;break}}}},LGraphNode.prototype.setOutputData=function(rt,it){if(!!this.outputs&&!(rt==-1||rt>=this.outputs.length)){var nt=this.outputs[rt];if(!!nt&&(nt._data=it,this.outputs[rt].links))for(var st=0;st<this.outputs[rt].links.length;st++){var vt=this.outputs[rt].links[st],_t=this.graph.links[vt];_t&&(_t.data=it)}}},LGraphNode.prototype.setOutputDataType=function(rt,it){if(!!this.outputs&&!(rt==-1||rt>=this.outputs.length)){var nt=this.outputs[rt];if(!!nt&&(nt.type=it,this.outputs[rt].links))for(var st=0;st<this.outputs[rt].links.length;st++){var vt=this.outputs[rt].links[st];this.graph.links[vt].type=it}}},LGraphNode.prototype.getInputData=function(rt,it){if(!!this.inputs&&!(rt>=this.inputs.length||this.inputs[rt].link==null)){var nt=this.inputs[rt].link,st=this.graph.links[nt];if(!st)return null;if(!it)return st.data;var vt=this.graph.getNodeById(st.origin_id);return vt&&(vt.updateOutputData?vt.updateOutputData(st.origin_slot):vt.onExecute&&vt.onExecute()),st.data}},LGraphNode.prototype.getInputDataType=function(rt){if(!this.inputs||rt>=this.inputs.length||this.inputs[rt].link==null)return null;var it=this.inputs[rt].link,nt=this.graph.links[it];if(!nt)return null;var st=this.graph.getNodeById(nt.origin_id);if(!st)return nt.type;var vt=st.outputs[nt.origin_slot];return vt?vt.type:null},LGraphNode.prototype.getInputDataByName=function(rt,it){var nt=this.findInputSlot(rt);return nt==-1?null:this.getInputData(nt,it)},LGraphNode.prototype.isInputConnected=function(rt){return this.inputs?rt<this.inputs.length&&this.inputs[rt].link!=null:!1},LGraphNode.prototype.getInputInfo=function(rt){return this.inputs&&rt<this.inputs.length?this.inputs[rt]:null},LGraphNode.prototype.getInputLink=function(rt){if(!this.inputs)return null;if(rt<this.inputs.length){var it=this.inputs[rt];return this.graph.links[it.link]}return null},LGraphNode.prototype.getInputNode=function(rt){if(!this.inputs||rt>=this.inputs.length)return null;var it=this.inputs[rt];if(!it||it.link===null)return null;var nt=this.graph.links[it.link];return nt?this.graph.getNodeById(nt.origin_id):null},LGraphNode.prototype.getInputOrProperty=function(rt){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[rt]:null;for(var it=0,nt=this.inputs.length;it<nt;++it){var st=this.inputs[it];if(rt==st.name&&st.link!=null){var vt=this.graph.links[st.link];if(vt)return vt.data}}return this.properties[rt]},LGraphNode.prototype.getOutputData=function(rt){if(!this.outputs||rt>=this.outputs.length)return null;var it=this.outputs[rt];return it._data},LGraphNode.prototype.getOutputInfo=function(rt){return this.outputs&&rt<this.outputs.length?this.outputs[rt]:null},LGraphNode.prototype.isOutputConnected=function(rt){return this.outputs?rt<this.outputs.length&&this.outputs[rt].links&&this.outputs[rt].links.length:!1},LGraphNode.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var rt=0;rt<this.outputs.length;++rt)if(this.outputs[rt].links&&this.outputs[rt].links.length)return!0;return!1},LGraphNode.prototype.getOutputNodes=function(rt){if(!this.outputs||this.outputs.length==0||rt>=this.outputs.length)return null;var it=this.outputs[rt];if(!it.links||it.links.length==0)return null;for(var nt=[],st=0;st<it.links.length;st++){var vt=it.links[st],_t=this.graph.links[vt];if(_t){var bt=this.graph.getNodeById(_t.target_id);bt&&nt.push(bt)}}return nt},LGraphNode.prototype.addOnTriggerInput=function(){var rt=this.findInputSlot("onTrigger");if(rt==-1){//!trigS || 
return this.addInput("onTrigger",LiteGraph.EVENT,{optional:!0,nameLocked:!0}),this.findInputSlot("onTrigger")}return rt},LGraphNode.prototype.addOnExecutedOutput=function(){var rt=this.findOutputSlot("onExecuted");if(rt==-1){//!trigS || 
return this.addOutput("onExecuted",LiteGraph.ACTION,{optional:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")}return rt},LGraphNode.prototype.onAfterExecuteNode=function(rt,it){var nt=this.findOutputSlot("onExecuted");nt!=-1&&this.triggerSlot(nt,rt,null,it)},LGraphNode.prototype.changeMode=function(rt){switch(rt){case LiteGraph.ON_EVENT:break;case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.NEVER:break;case LiteGraph.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=rt,!0},LGraphNode.prototype.executePendingActions=function(){if(!(!this._waiting_actions||!this._waiting_actions.length)){for(var rt=0;rt<this._waiting_actions.length;++rt){var it=this._waiting_actions[rt];this.onAction(it[0],it[1],it[2],it[3],it[4])}this._waiting_actions.length=0}},LGraphNode.prototype.doExecute=function(rt,it){it=it||{},this.onExecute&&(it.action_call||(it.action_call=this.id+"_exec_"+Math.floor(Math.random()*9999)),this.graph.nodes_executing[this.id]=!0,this.onExecute(rt,it),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,it&&it.action_call&&(this.action_call=it.action_call,this.graph.nodes_executedAction[this.id]=it.action_call)),this.execute_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(rt,it)},LGraphNode.prototype.actionDo=function(rt,it,nt,st){nt=nt||{},this.onAction&&(nt.action_call||(nt.action_call=this.id+"_"+(rt||"action")+"_"+Math.floor(Math.random()*9999)),this.graph.nodes_actioning[this.id]=rt||"actioning",this.onAction(rt,it,nt,st),this.graph.nodes_actioning[this.id]=!1,nt&&nt.action_call&&(this.action_call=nt.action_call,this.graph.nodes_executedAction[this.id]=nt.action_call)),this.action_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(it,nt)},LGraphNode.prototype.trigger=function(rt,it,nt){if(!(!this.outputs||!this.outputs.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var st=0;st<this.outputs.length;++st){var vt=this.outputs[st];!vt||vt.type!==LiteGraph.EVENT||rt&&vt.name!=rt||this.triggerSlot(st,it,null,nt)}}},LGraphNode.prototype.triggerSlot=function(rt,it,nt,st){if(st=st||{},!!this.outputs){if(rt==null){console.error("slot must be a number");return}rt.constructor!==Number&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");var vt=this.outputs[rt];if(!!vt){var _t=vt.links;if(!(!_t||!_t.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var bt=0;bt<_t.length;++bt){var xt=_t[bt];if(!(nt!=null&&nt!=xt)){var Tt=this.graph.links[_t[bt]];if(!!Tt){Tt._last_time=LiteGraph.getTime();var Et=this.graph.getNodeById(Tt.target_id);if(!!Et){var wt=Et.inputs[Tt.target_slot];if(Et.mode===LiteGraph.ON_TRIGGER)st.action_call||(st.action_call=this.id+"_trigg_"+Math.floor(Math.random()*9999)),Et.onExecute&&Et.doExecute(it,st);else if(Et.onAction){st.action_call||(st.action_call=this.id+"_act_"+Math.floor(Math.random()*9999));var wt=Et.inputs[Tt.target_slot];LiteGraph.use_deferred_actions&&Et.onExecute?(Et._waiting_actions||(Et._waiting_actions=[]),Et._waiting_actions.push([wt.name,it,st,Tt.target_slot])):Et.actionDo(wt.name,it,st,Tt.target_slot)}}}}}}}}},LGraphNode.prototype.clearTriggeredSlot=function(rt,it){if(!!this.outputs){var nt=this.outputs[rt];if(!!nt){var st=nt.links;if(!(!st||!st.length))for(var vt=0;vt<st.length;++vt){var _t=st[vt];if(!(it!=null&&it!=_t)){var bt=this.graph.links[st[vt]];!bt||(bt._last_time=0)}}}}},LGraphNode.prototype.setSize=function(rt){this.size=rt,this.onResize&&this.onResize(this.size)},LGraphNode.prototype.addProperty=function(rt,it,nt,st){var vt={name:rt,type:nt,default_value:it};if(st)for(var _t in st)vt[_t]=st[_t];return this.properties_info||(this.properties_info=[]),this.properties_info.push(vt),this.properties||(this.properties={}),this.properties[rt]=it,vt},LGraphNode.prototype.addOutput=function(rt,it,nt){var st={name:rt,type:it,links:null};if(nt)for(var vt in nt)st[vt]=nt[vt];return this.outputs||(this.outputs=[]),this.outputs.push(st),this.onOutputAdded&&this.onOutputAdded(st),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,it,!0),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),st},LGraphNode.prototype.addOutputs=function(rt){for(var it=0;it<rt.length;++it){var nt=rt[it],st={name:nt[0],type:nt[1],link:null};if(rt[2])for(var vt in nt[2])st[vt]=nt[2][vt];this.outputs||(this.outputs=[]),this.outputs.push(st),this.onOutputAdded&&this.onOutputAdded(st),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,nt[1],!0)}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeOutput=function(rt){this.disconnectOutput(rt),this.outputs.splice(rt,1);for(var it=rt;it<this.outputs.length;++it)if(!(!this.outputs[it]||!this.outputs[it].links))for(var nt=this.outputs[it].links,st=0;st<nt.length;++st){var vt=this.graph.links[nt[st]];!vt||(vt.origin_slot-=1)}this.setSize(this.computeSize()),this.onOutputRemoved&&this.onOutputRemoved(rt),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addInput=function(rt,it,nt){it=it||0;var st={name:rt,type:it,link:null};if(nt)for(var vt in nt)st[vt]=nt[vt];return this.inputs||(this.inputs=[]),this.inputs.push(st),this.setSize(this.computeSize()),this.onInputAdded&&this.onInputAdded(st),LiteGraph.registerNodeAndSlotType(this,it),this.setDirtyCanvas(!0,!0),st},LGraphNode.prototype.addInputs=function(rt){for(var it=0;it<rt.length;++it){var nt=rt[it],st={name:nt[0],type:nt[1],link:null};if(rt[2])for(var vt in nt[2])st[vt]=nt[2][vt];this.inputs||(this.inputs=[]),this.inputs.push(st),this.onInputAdded&&this.onInputAdded(st),LiteGraph.registerNodeAndSlotType(this,nt[1])}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeInput=function(rt){this.disconnectInput(rt);for(var it=this.inputs.splice(rt,1),nt=rt;nt<this.inputs.length;++nt)if(!!this.inputs[nt]){var st=this.graph.links[this.inputs[nt].link];!st||(st.target_slot-=1)}this.setSize(this.computeSize()),this.onInputRemoved&&this.onInputRemoved(rt,it[0]),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addConnection=function(rt,it,nt,st){var vt={name:rt,type:it,pos:nt,direction:st,links:null};return this.connections.push(vt),vt},LGraphNode.prototype.computeSize=function(rt){if(this.constructor.size)return this.constructor.size.concat();var it=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),nt=rt||new Float32Array([0,0]);it=Math.max(it,1);var st=LiteGraph.NODE_TEXT_SIZE,vt=Dt(this.title),_t=0,bt=0;if(this.inputs)for(var xt=0,Tt=this.inputs.length;xt<Tt;++xt){var Et=this.inputs[xt],wt=Et.label||Et.name||"",Ot=Dt(wt);_t<Ot&&(_t=Ot)}if(this.outputs)for(var xt=0,Tt=this.outputs.length;xt<Tt;++xt){var It=this.outputs[xt],wt=It.label||It.name||"",Ot=Dt(wt);bt<Ot&&(bt=Ot)}nt[0]=Math.max(_t+bt+10,vt),nt[0]=Math.max(nt[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(nt[0]=Math.max(nt[0],LiteGraph.NODE_WIDTH*1.5)),nt[1]=(this.constructor.slot_start_y||0)+it*LiteGraph.NODE_SLOT_HEIGHT;var At=0;if(this.widgets&&this.widgets.length){for(var xt=0,Tt=this.widgets.length;xt<Tt;++xt)this.widgets[xt].computeSize?At+=this.widgets[xt].computeSize(nt[0])[1]+4:At+=LiteGraph.NODE_WIDGET_HEIGHT+4;At+=8}this.widgets_up?nt[1]=Math.max(nt[1],At):this.widgets_start_y!=null?nt[1]=Math.max(nt[1],At+this.widgets_start_y):nt[1]+=At;function Dt(kt){return kt?st*kt.length*.6:0}return this.constructor.min_height&&nt[1]<this.constructor.min_height&&(nt[1]=this.constructor.min_height),nt[1]+=6,nt},LGraphNode.prototype.getPropertyInfo=function(rt){var it=null;if(this.properties_info){for(var nt=0;nt<this.properties_info.length;++nt)if(this.properties_info[nt].name==rt){it=this.properties_info[nt];break}}return this.constructor["@"+rt]&&(it=this.constructor["@"+rt]),this.constructor.widgets_info&&this.constructor.widgets_info[rt]&&(it=this.constructor.widgets_info[rt]),!it&&this.onGetPropertyInfo&&(it=this.onGetPropertyInfo(rt)),it||(it={}),it.type||(it.type=typeof this.properties[rt]),it.widget=="combo"&&(it.type="enum"),it},LGraphNode.prototype.addWidget=function(rt,it,nt,st,vt){this.widgets||(this.widgets=[]),!vt&&st&&st.constructor===Object&&(vt=st,st=null),vt&&vt.constructor===String&&(vt={property:vt}),st&&st.constructor===String&&(vt||(vt={}),vt.property=st,st=null),st&&st.constructor!==Function&&(console.warn("addWidget: callback must be a function"),st=null);var _t={type:rt.toLowerCase(),name:it,value:nt,callback:st,options:vt||{}};if(_t.options.y!==void 0&&(_t.y=_t.options.y),!st&&!_t.options.callback&&!_t.options.property&&console.warn("LiteGraph addWidget(...) without a callback or property assigned"),rt=="combo"&&!_t.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(_t),this.setSize(this.computeSize()),_t},LGraphNode.prototype.addCustomWidget=function(rt){return this.widgets||(this.widgets=[]),this.widgets.push(rt),rt},LGraphNode.prototype.getBounding=function(rt,it){rt=rt||new Float32Array(4);const nt=this.pos,st=this.flags.collapsed,vt=this.size;let _t=0,bt=1,xt=0,Tt=0;return it&&(_t=4,bt=6+_t,xt=4,Tt=5+xt),rt[0]=nt[0]-_t,rt[1]=nt[1]-LiteGraph.NODE_TITLE_HEIGHT-xt,rt[2]=st?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+bt:vt[0]+bt,rt[3]=st?LiteGraph.NODE_TITLE_HEIGHT+Tt:vt[1]+LiteGraph.NODE_TITLE_HEIGHT+Tt,this.onBounding&&this.onBounding(rt),rt},LGraphNode.prototype.isPointInside=function(rt,it,nt,st){nt=nt||0;var vt=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(st&&(vt=0),this.flags&&this.flags.collapsed){if(isInsideRectangle(rt,it,this.pos[0]-nt,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-nt,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*nt,LiteGraph.NODE_TITLE_HEIGHT+2*nt))return!0}else if(this.pos[0]-4-nt<rt&&this.pos[0]+this.size[0]+4+nt>rt&&this.pos[1]-vt-nt<it&&this.pos[1]+this.size[1]+nt>it)return!0;return!1},LGraphNode.prototype.getSlotInPosition=function(rt,it){var nt=new Float32Array(2);if(this.inputs)for(var st=0,vt=this.inputs.length;st<vt;++st){var _t=this.inputs[st];if(this.getConnectionPos(!0,st,nt),isInsideRectangle(rt,it,nt[0]-10,nt[1]-5,20,10))return{input:_t,slot:st,link_pos:nt}}if(this.outputs)for(var st=0,vt=this.outputs.length;st<vt;++st){var bt=this.outputs[st];if(this.getConnectionPos(!1,st,nt),isInsideRectangle(rt,it,nt[0]-10,nt[1]-5,20,10))return{output:bt,slot:st,link_pos:nt}}return null},LGraphNode.prototype.findInputSlot=function(rt,it){if(!this.inputs)return-1;for(var nt=0,st=this.inputs.length;nt<st;++nt)if(rt==this.inputs[nt].name)return it?this.inputs[nt]:nt;return-1},LGraphNode.prototype.findOutputSlot=function(rt,it){if(it=it||!1,!this.outputs)return-1;for(var nt=0,st=this.outputs.length;nt<st;++nt)if(rt==this.outputs[nt].name)return it?this.outputs[nt]:nt;return-1},LGraphNode.prototype.findInputSlotFree=function(it){var it=it||{},nt={returnObj:!1,typesNotAccepted:[]},st=Object.assign(nt,it);if(!this.inputs)return-1;for(var vt=0,_t=this.inputs.length;vt<_t;++vt)if(!(this.inputs[vt].link&&this.inputs[vt].link!=null)&&!(st.typesNotAccepted&&st.typesNotAccepted.includes&&st.typesNotAccepted.includes(this.inputs[vt].type)))return st.returnObj?this.inputs[vt]:vt;return-1},LGraphNode.prototype.findOutputSlotFree=function(it){var it=it||{},nt={returnObj:!1,typesNotAccepted:[]},st=Object.assign(nt,it);if(!this.outputs)return-1;for(var vt=0,_t=this.outputs.length;vt<_t;++vt)if(!(this.outputs[vt].links&&this.outputs[vt].links!=null)&&!(st.typesNotAccepted&&st.typesNotAccepted.includes&&st.typesNotAccepted.includes(this.outputs[vt].type)))return st.returnObj?this.outputs[vt]:vt;return-1},LGraphNode.prototype.findInputSlotByType=function(rt,it,nt,st){return this.findSlotByType(!0,rt,it,nt,st)},LGraphNode.prototype.findOutputSlotByType=function(rt,it,nt,st){return this.findSlotByType(!1,rt,it,nt,st)},LGraphNode.prototype.findSlotByType=function(rt,it,nt,st,vt){rt=rt||!1,nt=nt||!1,st=st||!1,vt=vt||!1;var _t=rt?this.inputs:this.outputs;if(!_t)return-1;(it==""||it=="*")&&(it=0);for(var bt=0,xt=_t.length;bt<xt;++bt){var Tt=(it+"").toLowerCase().split(","),Et=_t[bt].type=="0"||_t[bt].type=="*"?"0":_t[bt].type;Et=(Et+"").toLowerCase().split(",");for(var wt=0;wt<Tt.length;wt++)for(var Ot=0;Ot<Et.length;Ot++)if(Tt[wt]=="_event_"&&(Tt[wt]=LiteGraph.EVENT),Et[wt]=="_event_"&&(Et[wt]=LiteGraph.EVENT),Tt[wt]=="*"&&(Tt[wt]=0),Et[wt]=="*"&&(Et[wt]=0),Tt[wt]==Et[Ot]){if(st&&_t[bt].links&&_t[bt].links!==null)continue;return nt?_t[bt]:bt}}if(st&&!vt)for(var bt=0,xt=_t.length;bt<xt;++bt){var Tt=(it+"").toLowerCase().split(","),Et=_t[bt].type=="0"||_t[bt].type=="*"?"0":_t[bt].type;Et=(Et+"").toLowerCase().split(",");for(var wt=0;wt<Tt.length;wt++)for(var Ot=0;Ot<Et.length;Ot++)if(Tt[wt]=="*"&&(Tt[wt]=0),Et[wt]=="*"&&(Et[wt]=0),Tt[wt]==Et[Ot])return nt?_t[bt]:bt}return-1},LGraphNode.prototype.connectByType=function(rt,it,nt,vt){var vt=vt||{},_t={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},bt=Object.assign(_t,vt);it&&it.constructor===Number&&(it=this.graph.getNodeById(it));var xt=it.findInputSlotByType(nt,!1,!0);if(xt>=0&&xt!==null)return this.connect(rt,it,xt);if(bt.createEventInCase&&nt==LiteGraph.EVENT)return this.connect(rt,it,-1);if(bt.generalTypeInCase){var xt=it.findInputSlotByType(0,!1,!0,!0);if(xt>=0)return this.connect(rt,it,xt)}if(bt.firstFreeIfOutputGeneralInCase&&(nt==0||nt=="*"||nt=="")){var xt=it.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(xt>=0)return this.connect(rt,it,xt)}return console.debug("no way to connect type: ",nt," to targetNODE ",it),null},LGraphNode.prototype.connectByTypeOutput=function(rt,it,nt,vt){var vt=vt||{},_t={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},bt=Object.assign(_t,vt);it&&it.constructor===Number&&(it=this.graph.getNodeById(it));var xt=it.findOutputSlotByType(nt,!1,!0);if(xt>=0&&xt!==null)return it.connect(xt,this,rt);if(bt.generalTypeInCase){var xt=it.findOutputSlotByType(0,!1,!0,!0);if(xt>=0)return it.connect(xt,this,rt)}if(bt.createEventInCase&&nt==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots){var xt=it.addOnExecutedOutput();return it.connect(xt,this,rt)}if(bt.firstFreeIfInputGeneralInCase&&(nt==0||nt=="*"||nt=="")){var xt=it.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(xt>=0)return it.connect(xt,this,rt)}return console.debug("no way to connect byOUT type: ",nt," to sourceNODE ",it),null},LGraphNode.prototype.connect=function(rt,it,nt){if(nt=nt||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(rt.constructor===String){if(rt=this.findOutputSlot(rt),rt==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+rt),null}else if(!this.outputs||rt>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(it&&it.constructor===Number&&(it=this.graph.getNodeById(it)),!it)throw"target node is null";if(it==this)return null;if(nt.constructor===String){if(nt=it.findInputSlot(nt),nt==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+nt),null}else if(nt===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)it.changeMode(LiteGraph.ON_TRIGGER),nt=it.findInputSlot("onTrigger");else return null;else if(!it.inputs||nt>=it.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;var st=!1,vt=it.inputs[nt],_t=null,bt=this.outputs[rt];if(!this.outputs[rt])return null;if(it.onBeforeConnectInput&&(nt=it.onBeforeConnectInput(nt)),nt===!1||nt===null||!LiteGraph.isValidConnection(bt.type,vt.type))return this.setDirtyCanvas(!1,!0),st&&this.graph.connectionChange(this,_t),null;if(it.onConnectInput&&it.onConnectInput(nt,bt.type,bt,this,rt)===!1||this.onConnectOutput&&this.onConnectOutput(rt,vt.type,vt,it,nt)===!1)return null;if(it.inputs[nt]&&it.inputs[nt].link!=null&&(this.graph.beforeChange(),it.disconnectInput(nt,{doProcessChange:!1}),st=!0),bt.links!==null&&bt.links.length)switch(bt.type){case LiteGraph.EVENT:LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(rt,!1,{doProcessChange:!1}),st=!0);break}var xt;return LiteGraph.use_uuids?xt=LiteGraph.uuidv4():xt=++this.graph.last_link_id,_t=new LLink(xt,vt.type||bt.type,this.id,rt,it.id,nt),this.graph.links[_t.id]=_t,bt.links==null&&(bt.links=[]),bt.links.push(_t.id),it.inputs[nt].link=_t.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,rt,!0,_t,bt),it.onConnectionsChange&&it.onConnectionsChange(LiteGraph.INPUT,nt,!0,_t,vt),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,it,nt,this,rt),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,rt,it,nt)),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,_t),_t},LGraphNode.prototype.disconnectOutput=function(rt,it){if(rt.constructor===String){if(rt=this.findOutputSlot(rt),rt==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+rt),!1}else if(!this.outputs||rt>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var nt=this.outputs[rt];if(!nt||!nt.links||nt.links.length==0)return!1;if(it){if(it.constructor===Number&&(it=this.graph.getNodeById(it)),!it)throw"Target Node not found";for(var st=0,vt=nt.links.length;st<vt;st++){var _t=nt.links[st],bt=this.graph.links[_t];if(bt.target_id==it.id){nt.links.splice(st,1);var xt=it.inputs[bt.target_slot];xt.link=null,delete this.graph.links[_t],this.graph&&this.graph._version++,it.onConnectionsChange&&it.onConnectionsChange(LiteGraph.INPUT,bt.target_slot,!1,bt,xt),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,rt,!1,bt,nt),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,rt),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,rt),this.graph.onNodeConnectionChange(LiteGraph.INPUT,it,bt.target_slot));break}}}else{for(var st=0,vt=nt.links.length;st<vt;st++){var _t=nt.links[st],bt=this.graph.links[_t];if(!!bt){var it=this.graph.getNodeById(bt.target_id),xt=null;this.graph&&this.graph._version++,it&&(xt=it.inputs[bt.target_slot],xt.link=null,it.onConnectionsChange&&it.onConnectionsChange(LiteGraph.INPUT,bt.target_slot,!1,bt,xt),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,it,bt.target_slot)),delete this.graph.links[_t],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,rt,!1,bt,nt),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,rt),this.graph.onNodeConnectionChange(LiteGraph.INPUT,it,bt.target_slot))}}nt.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},LGraphNode.prototype.disconnectInput=function(rt){if(rt.constructor===String){if(rt=this.findInputSlot(rt),rt==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+rt),!1}else if(!this.inputs||rt>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var it=this.inputs[rt];if(!it)return!1;var nt=this.inputs[rt].link;if(nt!=null){this.inputs[rt].link=null;var st=this.graph.links[nt];if(st){var vt=this.graph.getNodeById(st.origin_id);if(!vt)return!1;var _t=vt.outputs[st.origin_slot];if(!_t||!_t.links||_t.links.length==0)return!1;for(var bt=0,xt=_t.links.length;bt<xt;bt++)if(_t.links[bt]==nt){_t.links.splice(bt,1);break}delete this.graph.links[nt],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,rt,!1,st,it),vt.onConnectionsChange&&vt.onConnectionsChange(LiteGraph.OUTPUT,bt,!1,st,_t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,vt,bt),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,rt))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0},LGraphNode.prototype.getConnectionPos=function(rt,it,nt){nt=nt||new Float32Array(2);var st=0;rt&&this.inputs&&(st=this.inputs.length),!rt&&this.outputs&&(st=this.outputs.length);var vt=LiteGraph.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var _t=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(nt[0]=this.pos[0]+_t*.5,rt?nt[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:nt[1]=this.pos[1]):(rt?nt[0]=this.pos[0]:nt[0]=this.pos[0]+_t,nt[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT*.5),nt}return rt&&it==-1?(nt[0]=this.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*.5,nt[1]=this.pos[1]+LiteGraph.NODE_TITLE_HEIGHT*.5,nt):rt&&st>it&&this.inputs[it].pos?(nt[0]=this.pos[0]+this.inputs[it].pos[0],nt[1]=this.pos[1]+this.inputs[it].pos[1],nt):!rt&&st>it&&this.outputs[it].pos?(nt[0]=this.pos[0]+this.outputs[it].pos[0],nt[1]=this.pos[1]+this.outputs[it].pos[1],nt):this.horizontal?(nt[0]=this.pos[0]+(it+.5)*(this.size[0]/st),rt?nt[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:nt[1]=this.pos[1]+this.size[1],nt):(rt?nt[0]=this.pos[0]+vt:nt[0]=this.pos[0]+this.size[0]+1-vt,nt[1]=this.pos[1]+(it+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),nt)},LGraphNode.prototype.alignToGrid=function(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)},LGraphNode.prototype.trace=function(rt){this.console||(this.console=[]),this.console.push(rt),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,rt)},LGraphNode.prototype.setDirtyCanvas=function(rt,it){!this.graph||this.graph.sendActionToCanvas("setDirty",[rt,it])},LGraphNode.prototype.loadImage=function(rt){var it=new Image;it.src=LiteGraph.node_images_path+rt,it.ready=!1;var nt=this;return it.onload=function(){this.ready=!0,nt.setDirtyCanvas(!0)},it},LGraphNode.prototype.captureInput=function(rt){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var it=this.graph.list_of_graphcanvas,nt=0;nt<it.length;++nt){var st=it[nt];!rt&&st.node_capturing_input!=this||(st.node_capturing_input=rt?this:null)}},LGraphNode.prototype.collapse=function(rt){this.graph._version++,!(this.constructor.collapsable===!1&&!rt)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},LGraphNode.prototype.pin=function(rt){this.graph._version++,rt===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=rt},LGraphNode.prototype.localToScreen=function(rt,it,nt){return[(rt+this.pos[0])*nt.scale+nt.offset[0],(it+this.pos[1])*nt.scale+nt.offset[1]]};function LGraphGroup(rt){this._ctor(rt)}global.LGraphGroup=LiteGraph.LGraphGroup=LGraphGroup,LGraphGroup.prototype._ctor=function(rt){this.title=rt||"Group",this.font_size=24,this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(it){!it||it.length<2||(this._pos[0]=it[0],this._pos[1]=it[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(it){!it||it.length<2||(this._size[0]=Math.max(140,it[0]),this._size[1]=Math.max(80,it[1]))},get:function(){return this._size},enumerable:!0})},LGraphGroup.prototype.configure=function(rt){this.title=rt.title,this._bounding.set(rt.bounding),this.color=rt.color,this.font_size=rt.font_size},LGraphGroup.prototype.serialize=function(){var rt=this._bounding;return{title:this.title,bounding:[Math.round(rt[0]),Math.round(rt[1]),Math.round(rt[2]),Math.round(rt[3])],color:this.color,font_size:this.font_size}},LGraphGroup.prototype.move=function(rt,it,nt){if(this._pos[0]+=rt,this._pos[1]+=it,!nt)for(var st=0;st<this._nodes.length;++st){var vt=this._nodes[st];vt.pos[0]+=rt,vt.pos[1]+=it}},LGraphGroup.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var rt=this.graph._nodes,it=new Float32Array(4),nt=0;nt<rt.length;++nt){var st=rt[nt];st.getBounding(it),overlapBounding(this._bounding,it)&&this._nodes.push(st)}},LGraphGroup.prototype.isPointInside=LGraphNode.prototype.isPointInside,LGraphGroup.prototype.setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas;function DragAndScale(rt,it){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),rt&&(this.element=rt,it||this.bindEvents(rt))}LiteGraph.DragAndScale=DragAndScale,DragAndScale.prototype.bindEvents=function(rt){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),LiteGraph.pointerListenerAdd(rt,"down",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(rt,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(rt,"up",this._binded_mouse_callback),rt.addEventListener("mousewheel",this._binded_mouse_callback,!1),rt.addEventListener("wheel",this._binded_mouse_callback,!1)},DragAndScale.prototype.computeVisibleArea=function(rt){if(!this.element){this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0;return}var it=this.element.width,nt=this.element.height,st=-this.offset[0],vt=-this.offset[1];rt&&(st+=rt[0]/this.scale,vt+=rt[1]/this.scale,it=rt[2],nt=rt[3]);var _t=st+it/this.scale,bt=vt+nt/this.scale;this.visible_area[0]=st,this.visible_area[1]=vt,this.visible_area[2]=_t-st,this.visible_area[3]=bt-vt},DragAndScale.prototype.onMouse=function(rt){if(!!this.enabled){var it=this.element,nt=it.getBoundingClientRect(),st=rt.clientX-nt.left,vt=rt.clientY-nt.top;rt.canvasx=st,rt.canvasy=vt,rt.dragging=this.dragging;var _t=!this.viewport||this.viewport&&st>=this.viewport[0]&&st<this.viewport[0]+this.viewport[2]&&vt>=this.viewport[1]&&vt<this.viewport[1]+this.viewport[3],bt=!1;if(this.onmouse&&(bt=this.onmouse(rt)),rt.type==LiteGraph.pointerevents_method+"down"&&_t)this.dragging=!0,LiteGraph.pointerListenerRemove(it,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"up",this._binded_mouse_callback);else if(rt.type==LiteGraph.pointerevents_method+"move"){if(!bt){var xt=st-this.last_mouse[0],Tt=vt-this.last_mouse[1];this.dragging&&this.mouseDrag(xt,Tt)}}else rt.type==LiteGraph.pointerevents_method+"up"?(this.dragging=!1,LiteGraph.pointerListenerRemove(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerRemove(document,"up",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(it,"move",this._binded_mouse_callback)):_t&&(rt.type=="mousewheel"||rt.type=="wheel"||rt.type=="DOMMouseScroll")&&(rt.eventType="mousewheel",rt.type=="wheel"?rt.wheel=-rt.deltaY:rt.wheel=rt.wheelDeltaY!=null?rt.wheelDeltaY:rt.detail*-60,rt.delta=rt.wheelDelta?rt.wheelDelta/40:rt.deltaY?-rt.deltaY/3:0,this.changeDeltaScale(1+rt.delta*.05));if(this.last_mouse[0]=st,this.last_mouse[1]=vt,_t)return rt.preventDefault(),rt.stopPropagation(),!1}},DragAndScale.prototype.toCanvasContext=function(rt){rt.scale(this.scale,this.scale),rt.translate(this.offset[0],this.offset[1])},DragAndScale.prototype.convertOffsetToCanvas=function(rt){return[(rt[0]+this.offset[0])*this.scale,(rt[1]+this.offset[1])*this.scale]},DragAndScale.prototype.convertCanvasToOffset=function(rt,it){return it=it||[0,0],it[0]=rt[0]/this.scale-this.offset[0],it[1]=rt[1]/this.scale-this.offset[1],it},DragAndScale.prototype.mouseDrag=function(rt,it){this.offset[0]+=rt/this.scale,this.offset[1]+=it/this.scale,this.onredraw&&this.onredraw(this)},DragAndScale.prototype.changeScale=function(rt,it){if(rt<this.min_scale?rt=this.min_scale:rt>this.max_scale&&(rt=this.max_scale),rt!=this.scale&&!!this.element){var nt=this.element.getBoundingClientRect();if(!!nt){it=it||[nt.width*.5,nt.height*.5];var st=this.convertCanvasToOffset(it);this.scale=rt,Math.abs(this.scale-1)<.01&&(this.scale=1);var vt=this.convertCanvasToOffset(it),_t=[vt[0]-st[0],vt[1]-st[1]];this.offset[0]+=_t[0],this.offset[1]+=_t[1],this.onredraw&&this.onredraw(this)}}},DragAndScale.prototype.changeDeltaScale=function(rt,it){this.changeScale(this.scale*rt,it)},DragAndScale.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0};function LGraphCanvas(rt,it,nt){this.options=nt=nt||{},this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,rt&&rt.constructor===String&&(rt=document.querySelector(rt)),this.ds=new DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=""+LiteGraph.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+LiteGraph.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=nt.viewport||null,it&&it.attachCanvas(this),this.setCanvas(rt,nt.skip_events),this.clear(),nt.skip_render||this.startRendering(),this.autoresize=nt.autoresize}global.LGraphCanvas=LiteGraph.LGraphCanvas=LGraphCanvas,LGraphCanvas.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",LGraphCanvas.link_type_colors={"-1":LiteGraph.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},LGraphCanvas.gradients={},LGraphCanvas.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},LGraphCanvas.prototype.setGraph=function(rt,it){if(this.graph!=rt){if(it||this.clear(),!rt&&this.graph){this.graph.detachCanvas(this);return}rt.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}},LGraphCanvas.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph},LGraphCanvas.prototype.openSubgraph=function(rt){if(!rt)throw"graph cannot be null";if(this.graph==rt)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),rt.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)},LGraphCanvas.prototype.closeSubgraph=function(){if(!(!this._graph_stack||this._graph_stack.length==0)){var rt=this.graph._subgraph_node,it=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},it.attachCanvas(this),this.setDirty(!0,!0),rt&&(this.centerOnNode(rt),this.selectNodes([rt])),this.ds.offset=[0,0],this.ds.scale=1}},LGraphCanvas.prototype.getCurrentGraph=function(){return this.graph},LGraphCanvas.prototype.setCanvas=function(rt,it){if(rt&&rt.constructor===String&&(rt=document.getElementById(rt),!rt))throw"Error creating LiteGraph canvas: Canvas not found";if(rt!==this.canvas&&(!rt&&this.canvas&&(it||this.unbindEvents()),this.canvas=rt,this.ds.element=rt,!!rt)){if(rt.className+=" lgraphcanvas",rt.data=this,rt.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),rt.getContext==null)throw rt.localName!="canvas"?"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+rt.localName:"This browser doesn't support Canvas";var nt=this.ctx=rt.getContext("2d");nt==null&&(rt.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),it||this.bindEvents()}},LGraphCanvas.prototype._doNothing=function(it){return it.preventDefault(),!1},LGraphCanvas.prototype._doReturnTrue=function(it){return it.preventDefault(),!0},LGraphCanvas.prototype.bindEvents=function(){if(this._events_binded){console.warn("LGraphCanvas: events already binded");return}var rt=this.canvas,it=this.getCanvasWindow(),nt=it.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),LiteGraph.pointerListenerAdd(rt,"down",this._mousedown_callback,!0),rt.addEventListener("mousewheel",this._mousewheel_callback,!1),LiteGraph.pointerListenerAdd(rt,"up",this._mouseup_callback,!0),LiteGraph.pointerListenerAdd(rt,"move",this._mousemove_callback),rt.addEventListener("contextmenu",this._doNothing),rt.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),this._key_callback=this.processKey.bind(this),rt.setAttribute("tabindex",1),rt.addEventListener("keydown",this._key_callback,!0),nt.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),rt.addEventListener("dragover",this._doNothing,!1),rt.addEventListener("dragend",this._doNothing,!1),rt.addEventListener("drop",this._ondrop_callback,!1),rt.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0},LGraphCanvas.prototype.unbindEvents=function(){if(!this._events_binded){console.warn("LGraphCanvas: no events binded");return}var rt=this.getCanvasWindow(),it=rt.document;LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"up",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"down",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),it.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1},LGraphCanvas.getFileExtension=function(rt){var it=rt.indexOf("?");it!=-1&&(rt=rt.substr(0,it));var nt=rt.lastIndexOf(".");return nt==-1?"":rt.substr(nt+1).toLowerCase()},LGraphCanvas.prototype.enableWebGL=function(){if(typeof GL>"u")throw"litegl.js must be included to use a WebGL canvas";if(typeof enableWebGLCanvas>"u")throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},LGraphCanvas.prototype.setDirty=function(rt,it){rt&&(this.dirty_canvas=!0),it&&(this.dirty_bgcanvas=!0)},LGraphCanvas.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var rt=this.canvas.ownerDocument;return rt.defaultView||rt.parentWindow},LGraphCanvas.prototype.startRendering=function(){if(this.is_rendering)return;this.is_rendering=!0,rt.call(this);function rt(){this.pause_rendering||this.draw();var it=this.getCanvasWindow();this.is_rendering&&it.requestAnimationFrame(rt.bind(this))}},LGraphCanvas.prototype.stopRendering=function(){this.is_rendering=!1},LGraphCanvas.prototype.blockClick=function(){this.block_click=!0,this.last_mouseclick=0},LGraphCanvas.prototype.processMouseDown=function(rt){if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(rt);var it=this.getCanvasWindow();it.document,LGraphCanvas.active_canvas=this;var nt=this,st=rt.clientX,vt=rt.clientY;this.ds.viewport=this.viewport;var _t=!this.viewport||this.viewport&&st>=this.viewport[0]&&st<this.viewport[0]+this.viewport[2]&&vt>=this.viewport[1]&&vt<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousemove_callback),LiteGraph.pointerListenerAdd(it.document,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(it.document,"up",this._mouseup_callback,!0)),!!_t){var bt=this.graph.getNodeOnPos(rt.canvasX,rt.canvasY,this.visible_nodes,5),xt=!1,Tt=LiteGraph.getTime(),Et=rt.isPrimary===void 0||!rt.isPrimary,wt=Tt-this.last_mouseclick<300&&Et;if(this.mouse[0]=rt.clientX,this.mouse[1]=rt.clientY,this.graph_mouse[0]=rt.canvasX,this.graph_mouse[1]=rt.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&Et?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(it),!(this.onMouse&&this.onMouse(rt)==!0)){if(rt.which==1&&!this.pointer_is_double){rt.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=rt.canvasX,this.dragging_rectangle[1]=rt.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,xt=!0),LiteGraph.alt_drag_do_clone_nodes&&rt.altKey&&bt&&this.allow_interaction&&!xt&&!this.read_only&&(cloned=bt.clone())&&(cloned.pos[0]+=5,cloned.pos[1]+=5,this.graph.add(cloned,!1,{doCalcSize:!1}),bt=cloned,xt=!0,Pt||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=bt),this.selected_nodes[bt.id]||this.processNodeSelected(bt,rt)));var Ot=!1;if(bt&&(this.allow_interaction||bt.flags.allow_interaction)&&!xt&&!this.read_only){if(!this.live_mode&&!bt.flags.pinned&&this.bringToFront(bt),this.allow_interaction&&!this.connecting_node&&!bt.flags.collapsed&&!this.live_mode)if(!xt&&bt.resizable!==!1&&isInsideRectangle(rt.canvasX,rt.canvasY,bt.pos[0]+bt.size[0]-5,bt.pos[1]+bt.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=bt,this.canvas.style.cursor="se-resize",xt=!0;else{if(bt.outputs)for(var It=0,At=bt.outputs.length;It<At;++It){var Dt=bt.outputs[It],kt=bt.getConnectionPos(!1,It);if(isInsideRectangle(rt.canvasX,rt.canvasY,kt[0]-15,kt[1]-10,30,20)){this.connecting_node=bt,this.connecting_output=Dt,this.connecting_output.slot_index=It,this.connecting_pos=bt.getConnectionPos(!1,It),this.connecting_slot=It,LiteGraph.shift_click_do_break_link_from&&rt.shiftKey&&bt.disconnectOutput(It),wt?bt.onOutputDblClick&&bt.onOutputDblClick(It,rt):bt.onOutputClick&&bt.onOutputClick(It,rt),xt=!0;break}}if(bt.inputs)for(var It=0,At=bt.inputs.length;It<At;++It){var Mt=bt.inputs[It],kt=bt.getConnectionPos(!0,It);if(isInsideRectangle(rt.canvasX,rt.canvasY,kt[0]-15,kt[1]-10,30,20)){if(wt?bt.onInputDblClick&&bt.onInputDblClick(It,rt):bt.onInputClick&&bt.onInputClick(It,rt),Mt.link!==null){var zt=this.graph.links[Mt.link];LiteGraph.click_do_break_link_to&&(bt.disconnectInput(It),this.dirty_bgcanvas=!0,xt=!0),(this.allow_reconnect_links||rt.shiftKey)&&(LiteGraph.click_do_break_link_to||bt.disconnectInput(It),this.connecting_node=this.graph._nodes_by_id[zt.origin_id],this.connecting_slot=zt.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,xt=!0)}xt||(this.connecting_node=bt,this.connecting_input=Mt,this.connecting_input.slot_index=It,this.connecting_pos=bt.getConnectionPos(!0,It),this.connecting_slot=It,this.dirty_bgcanvas=!0,xt=!0)}}}if(!xt){var Pt=!1,Lt=[rt.canvasX-bt.pos[0],rt.canvasY-bt.pos[1]],Bt=this.processNodeWidgets(bt,this.graph_mouse,rt);if(Bt&&(Pt=!0,this.node_widget=[bt,Bt]),this.allow_interaction&&wt&&this.selected_nodes[bt.id]&&(bt.onDblClick&&bt.onDblClick(rt,Lt,this),this.processNodeDblClicked(bt),Pt=!0),bt.onMouseDown&&bt.onMouseDown(rt,Lt,this))Pt=!0;else{if(bt.subgraph&&!bt.skip_subgraph_button&&!bt.flags.collapsed&&Lt[0]>bt.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&Lt[1]<0){var nt=this;setTimeout(function(){nt.openSubgraph(bt.subgraph)},10)}this.live_mode&&(Ot=!0,Pt=!0)}Pt?bt.is_selected||this.processNodeSelected(bt,rt):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=bt),this.processNodeSelected(bt,rt)),this.dirty_canvas=!0}}else if(!xt){if(!this.read_only)for(var It=0;It<this.visible_links.length;++It){var Gt=this.visible_links[It],Ut=Gt._pos;if(!(!Ut||rt.canvasX<Ut[0]-4||rt.canvasX>Ut[0]+4||rt.canvasY<Ut[1]-4||rt.canvasY>Ut[1]+4)){this.showLinkMenu(Gt,rt),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(rt.canvasX,rt.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){rt.ctrlKey&&(this.dragging_rectangle=null);var Zt=distance([rt.canvasX,rt.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);Zt*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}wt&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(rt),rt.preventDefault(),rt.stopPropagation()),Ot=!0}!xt&&Ot&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(rt.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(bt&&this.allow_interaction&&!xt&&!this.read_only&&!this.connecting_node&&!bt.flags.collapsed&&!this.live_mode){var Jt=!1,ei=!1,ii=!1;if(bt.outputs)for(var It=0,At=bt.outputs.length;It<At;++It){var Dt=bt.outputs[It],kt=bt.getConnectionPos(!1,It);if(isInsideRectangle(rt.canvasX,rt.canvasY,kt[0]-15,kt[1]-10,30,20)){Jt=Dt,ei=It,ii=!0;break}}if(bt.inputs)for(var It=0,At=bt.inputs.length;It<At;++It){var Mt=bt.inputs[It],kt=bt.getConnectionPos(!0,It);if(isInsideRectangle(rt.canvasX,rt.canvasY,kt[0]-15,kt[1]-10,30,20)){Jt=Mt,ei=It,ii=!1;break}}if(Jt&&ei!==!1){var li=.5-(ei+1)/(ii?bt.outputs.length:bt.inputs.length),pi=bt.getBounding(),ci=[ii?pi[0]+pi[2]:pi[0],rt.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:ii?bt:null,slotFrom:ii?ei:null,nodeTo:ii?null:bt,slotTo:ii?null:ei,position:ci,nodeType:"AUTO",posAdd:[ii?30:-30,-li*130],posSizeFix:[ii?0:-1,0]})}}}else!xt&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(rt.which==3||this.pointer_is_double)&&this.allow_interaction&&!xt&&!this.read_only&&(bt&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[bt.id]||rt.shiftKey||rt.ctrlKey||rt.metaKey)?this.selected_nodes[bt.id]||this.selectNodes([bt],!0):this.selectNodes([bt])),this.processContextMenu(bt,rt));return this.last_mouse[0]=rt.clientX,this.last_mouse[1]=rt.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!it.document.activeElement||it.document.activeElement.nodeName.toLowerCase()!="input"&&it.document.activeElement.nodeName.toLowerCase()!="textarea")&&rt.preventDefault(),rt.stopPropagation(),this.onMouseDown&&this.onMouseDown(rt),!1}}}},LGraphCanvas.prototype.processMouseMove=function(rt){if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(rt);var it=[rt.clientX,rt.clientY];this.mouse[0]=it[0],this.mouse[1]=it[1];var nt=[it[0]-this.last_mouse[0],it[1]-this.last_mouse[1]];if(this.last_mouse=it,this.graph_mouse[0]=rt.canvasX,this.graph_mouse[1]=rt.canvasY,this.block_click)return rt.preventDefault(),!1;rt.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,rt,this.node_widget[1]),this.dirty_canvas=!0);var st=this.graph.getNodeOnPos(rt.canvasX,rt.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=rt.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=rt.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[rt.canvasX-this.selected_group.pos[0],rt.canvasY-this.selected_group.pos[1]];else{var vt=nt[0]/this.ds.scale,_t=nt[1]/this.ds.scale;this.selected_group.move(vt,_t,rt.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=nt[0]/this.ds.scale,this.ds.offset[1]+=nt[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||st&&st.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var bt=0,xt=this.graph._nodes.length;bt<xt;++bt)this.graph._nodes[bt].mouseOver&&st!=this.graph._nodes[bt]&&(this.graph._nodes[bt].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(rt),this.node_over=null,this.dirty_canvas=!0);if(st){if(st.redraw_on_mouse&&(this.dirty_canvas=!0),st.mouseOver||(st.mouseOver=!0,this.node_over=st,this.dirty_canvas=!0,st.onMouseEnter&&st.onMouseEnter(rt)),st.onMouseMove&&st.onMouseMove(rt,[rt.canvasX-st.pos[0],rt.canvasY-st.pos[1]],this),this.connecting_node){if(this.connecting_output){var Tt=this._highlight_input||[0,0];if(!this.isOverNodeBox(st,rt.canvasX,rt.canvasY)){var Et=this.isOverNodeInput(st,rt.canvasX,rt.canvasY,Tt);if(Et!=-1&&st.inputs[Et]){var wt=st.inputs[Et].type;LiteGraph.isValidConnection(this.connecting_output.type,wt)&&(this._highlight_input=Tt,this._highlight_input_slot=st.inputs[Et])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input){var Tt=this._highlight_output||[0,0];if(!this.isOverNodeBox(st,rt.canvasX,rt.canvasY)){var Et=this.isOverNodeOutput(st,rt.canvasX,rt.canvasY,Tt);if(Et!=-1&&st.outputs[Et]){var wt=st.outputs[Et].type;LiteGraph.isValidConnection(this.connecting_input.type,wt)&&(this._highlight_output=Tt)}else this._highlight_output=null}}}this.canvas&&(isInsideRectangle(rt.canvasX,rt.canvasY,st.pos[0]+st.size[0]-5,st.pos[1]+st.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{for(var Ot=null,bt=0;bt<this.visible_links.length;++bt){var It=this.visible_links[bt],At=It._pos;if(!(!At||rt.canvasX<At[0]-4||rt.canvasX>At[0]+4||rt.canvasY<At[1]-4||rt.canvasY>At[1]+4)){Ot=It;break}}Ot!=this.over_link_center&&(this.over_link_center=Ot,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=st&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(rt,[rt.canvasX-this.node_capturing_input.pos[0],rt.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(var bt in this.selected_nodes){var Dt=this.selected_nodes[bt];Dt.pos[0]+=nt[0]/this.ds.scale,Dt.pos[1]+=nt[1]/this.ds.scale,Dt.is_selected||this.processNodeSelected(Dt,rt)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var kt=[rt.canvasX-this.resizing_node.pos[0],rt.canvasY-this.resizing_node.pos[1]],Mt=this.resizing_node.computeSize();kt[0]=Math.max(Mt[0],kt[0]),kt[1]=Math.max(Mt[1],kt[1]),this.resizing_node.setSize(kt),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return rt.preventDefault(),!1}},LGraphCanvas.prototype.processMouseUp=function(rt){var it=rt.isPrimary===void 0||rt.isPrimary;if(!it)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var nt=this.getCanvasWindow(),st=nt.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(LiteGraph.pointerListenerRemove(st,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(this.canvas,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerRemove(st,"up",this._mouseup_callback,!0)),this.adjustMouseEvent(rt);var vt=LiteGraph.getTime();if(rt.click_time=vt-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),rt.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,rt),this.node_widget=null,this.selected_group){var _t=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),bt=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(_t,bt,rt.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var xt=this.graph.getNodeOnPos(rt.canvasX,rt.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var Tt=this.graph._nodes,Et=new Float32Array(4),wt=Math.abs(this.dragging_rectangle[2]),Ot=Math.abs(this.dragging_rectangle[3]),It=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-wt:this.dragging_rectangle[0],At=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-Ot:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=It,this.dragging_rectangle[1]=At,this.dragging_rectangle[2]=wt,this.dragging_rectangle[3]=Ot,!xt||wt>10&&Ot>10){for(var Dt=[],kt=0;kt<Tt.length;++kt){var Mt=Tt[kt];Mt.getBounding(Et),overlapBounding(this.dragging_rectangle,Et)&&Dt.push(Mt)}Dt.length&&this.selectNodes(Dt,rt.shiftKey)}else this.selectNodes([xt],rt.shiftKey||rt.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var zt=this.connecting_output||this.connecting_input,Pt=zt.type;if(xt){if(this.connecting_output){var Lt=this.isOverNodeInput(xt,rt.canvasX,rt.canvasY);Lt!=-1?this.connecting_node.connect(this.connecting_slot,xt,Lt):this.connecting_node.connectByType(this.connecting_slot,xt,Pt)}else if(this.connecting_input){var Lt=this.isOverNodeOutput(xt,rt.canvasX,rt.canvasY);Lt!=-1?xt.connect(Lt,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,xt,Pt)}}else LiteGraph.release_link_on_empty_shows_menu&&(rt.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(rt,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(rt,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:rt}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:rt}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){var xt=this.node_dragged;xt&&rt.click_time<300&&isInsideRectangle(rt.canvasX,rt.canvasY,xt.pos[0],xt.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&xt.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),this.onNodeMoved&&this.onNodeMoved(this.node_dragged),this.graph.afterChange(this.node_dragged),this.node_dragged=null}else{var xt=this.graph.getNodeOnPos(rt.canvasX,rt.canvasY,this.visible_nodes);!xt&&rt.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(rt,[rt.canvasX-this.node_over.pos[0],rt.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(rt,[rt.canvasX-this.node_capturing_input.pos[0],rt.canvasY-this.node_capturing_input.pos[1]])}}else rt.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):rt.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return it&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),rt.stopPropagation(),rt.preventDefault(),!1}},LGraphCanvas.prototype.processMouseWheel=function(rt){if(!(!this.graph||!this.allow_dragcanvas)){var it=rt.wheelDeltaY!=null?rt.wheelDeltaY:rt.detail*-60;this.adjustMouseEvent(rt);var nt=rt.clientX,st=rt.clientY,vt=!this.viewport||this.viewport&&nt>=this.viewport[0]&&nt<this.viewport[0]+this.viewport[2]&&st>=this.viewport[1]&&st<this.viewport[1]+this.viewport[3];if(!!vt){var _t=this.ds.scale;return it>0?_t*=1.1:it<0&&(_t*=1/1.1),this.ds.changeScale(_t,[rt.clientX,rt.clientY]),this.graph.change(),rt.preventDefault(),!1}}},LGraphCanvas.prototype.isOverNodeBox=function(rt,it,nt){var st=LiteGraph.NODE_TITLE_HEIGHT;return!!isInsideRectangle(it,nt,rt.pos[0]+2,rt.pos[1]+2-st,st-4,st-4)},LGraphCanvas.prototype.isOverNodeInput=function(rt,it,nt,st){if(rt.inputs)for(var vt=0,_t=rt.inputs.length;vt<_t;++vt){rt.inputs[vt];var bt=rt.getConnectionPos(!0,vt),xt=!1;if(rt.horizontal?xt=isInsideRectangle(it,nt,bt[0]-5,bt[1]-10,10,20):xt=isInsideRectangle(it,nt,bt[0]-10,bt[1]-5,40,10),xt)return st&&(st[0]=bt[0],st[1]=bt[1]),vt}return-1},LGraphCanvas.prototype.isOverNodeOutput=function(rt,it,nt,st){if(rt.outputs)for(var vt=0,_t=rt.outputs.length;vt<_t;++vt){rt.outputs[vt];var bt=rt.getConnectionPos(!1,vt),xt=!1;if(rt.horizontal?xt=isInsideRectangle(it,nt,bt[0]-5,bt[1]-10,10,20):xt=isInsideRectangle(it,nt,bt[0]-10,bt[1]-5,40,10),xt)return st&&(st[0]=bt[0],st[1]=bt[1]),vt}return-1},LGraphCanvas.prototype.processKey=function(rt){if(!!this.graph){var it=!1;if(rt.target.localName!="input"){if(rt.type=="keydown"){if(rt.keyCode==32&&(this.dragging_canvas=!0,it=!0),rt.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),it=!0),rt.keyCode==65&&rt.ctrlKey&&(this.selectNodes(),it=!0),rt.keyCode===67&&(rt.metaKey||rt.ctrlKey)&&!rt.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),it=!0),rt.keyCode===86&&(rt.metaKey||rt.ctrlKey)&&this.pasteFromClipboard(rt.shiftKey),(rt.keyCode==46||rt.keyCode==8)&&rt.target.localName!="input"&&rt.target.localName!="textarea"&&(this.deleteSelectedNodes(),it=!0),this.selected_nodes)for(var nt in this.selected_nodes)this.selected_nodes[nt].onKeyDown&&this.selected_nodes[nt].onKeyDown(rt)}else if(rt.type=="keyup"&&(rt.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(var nt in this.selected_nodes)this.selected_nodes[nt].onKeyUp&&this.selected_nodes[nt].onKeyUp(rt);if(this.graph.change(),it)return rt.preventDefault(),rt.stopImmediatePropagation(),!1}}},LGraphCanvas.prototype.copyToClipboard=function(){var rt={nodes:[],links:[]},it=0,nt=[];for(var st in this.selected_nodes){var vt=this.selected_nodes[st];vt.clonable!==!1&&(vt._relative_id=it,nt.push(vt),it+=1)}for(var st=0;st<nt.length;++st){var vt=nt[st];if(vt.clonable!==!1){var _t=vt.clone();if(!_t){console.warn("node type not found: "+vt.type);continue}if(rt.nodes.push(_t.serialize()),vt.inputs&&vt.inputs.length)for(var bt=0;bt<vt.inputs.length;++bt){var xt=vt.inputs[bt];if(!(!xt||xt.link==null)){var Tt=this.graph.links[xt.link];if(!!Tt){var Et=this.graph.getNodeById(Tt.origin_id);!Et||rt.links.push([Et._relative_id,Tt.origin_slot,vt._relative_id,Tt.target_slot,Et.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(rt))},LGraphCanvas.prototype.pasteFromClipboard=function(rt=!1){if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&rt)){var it=localStorage.getItem("litegrapheditor_clipboard");if(!!it){this.graph.beforeChange();for(var nt=JSON.parse(it),st=!1,vt=!1,_t=0;_t<nt.nodes.length;++_t)st?(st[0]>nt.nodes[_t].pos[0]&&(st[0]=nt.nodes[_t].pos[0],vt[0]=_t),st[1]>nt.nodes[_t].pos[1]&&(st[1]=nt.nodes[_t].pos[1],vt[1]=_t)):(st=[nt.nodes[_t].pos[0],nt.nodes[_t].pos[1]],vt=[_t,_t]);for(var bt=[],_t=0;_t<nt.nodes.length;++_t){var xt=nt.nodes[_t],Tt=LiteGraph.createNode(xt.type);Tt&&(Tt.configure(xt),Tt.pos[0]+=this.graph_mouse[0]-st[0],Tt.pos[1]+=this.graph_mouse[1]-st[1],this.graph.add(Tt,{doProcessChange:!1}),bt.push(Tt))}for(var _t=0;_t<nt.links.length;++_t){var Et=nt.links[_t],wt,Ot=Et[0];if(Ot!=null)wt=bt[Ot];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&rt){var It=Et[4];It&&(wt=this.graph.getNodeById(It))}var At=bt[Et[2]];wt&&At?wt.connect(Et[1],At,Et[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(bt),this.graph.afterChange()}}},LGraphCanvas.prototype.processDrop=function(rt){rt.preventDefault(),this.adjustMouseEvent(rt);var it=rt.clientX,nt=rt.clientY,st=!this.viewport||this.viewport&&it>=this.viewport[0]&&it<this.viewport[0]+this.viewport[2]&&nt>=this.viewport[1]&&nt<this.viewport[1]+this.viewport[3];if(!!st){var vt=[rt.canvasX,rt.canvasY],_t=this.graph?this.graph.getNodeOnPos(vt[0],vt[1]):null;if(!_t){var bt=null;this.onDropItem&&(bt=this.onDropItem(event)),bt||this.checkDropItem(rt);return}if(_t.onDropFile||_t.onDropData){var xt=rt.dataTransfer.files;if(xt&&xt.length)for(var Tt=0;Tt<xt.length;Tt++){var Et=rt.dataTransfer.files[0],wt=Et.name;if(LGraphCanvas.getFileExtension(wt),_t.onDropFile&&_t.onDropFile(Et),_t.onDropData){var Ot=new FileReader;Ot.onload=function(At){var Dt=At.target.result;_t.onDropData(Dt,wt,Et)};var It=Et.type.split("/")[0];It=="text"||It==""?Ot.readAsText(Et):It=="image"?Ot.readAsDataURL(Et):Ot.readAsArrayBuffer(Et)}}}return _t.onDropItem&&_t.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}},LGraphCanvas.prototype.checkDropItem=function(rt){if(rt.dataTransfer.files.length){var it=rt.dataTransfer.files[0],nt=LGraphCanvas.getFileExtension(it.name).toLowerCase(),st=LiteGraph.node_types_by_file_extension[nt];if(st){this.graph.beforeChange();var vt=LiteGraph.createNode(st.type);vt.pos=[rt.canvasX,rt.canvasY],this.graph.add(vt),vt.onDropFile&&vt.onDropFile(it),this.graph.afterChange()}}},LGraphCanvas.prototype.processNodeDblClicked=function(rt){this.onShowNodePanel?this.onShowNodePanel(rt):this.showShowNodePanel(rt),this.onNodeDblClicked&&this.onNodeDblClicked(rt),this.setDirty(!0)},LGraphCanvas.prototype.processNodeSelected=function(rt,it){this.selectNode(rt,it&&(it.shiftKey||it.ctrlKey||this.multi_select)),this.onNodeSelected&&this.onNodeSelected(rt)},LGraphCanvas.prototype.selectNode=function(rt,it){rt==null?this.deselectAllNodes():this.selectNodes([rt],it)},LGraphCanvas.prototype.selectNodes=function(rt,it){it||this.deselectAllNodes(),rt=rt||this.graph._nodes,typeof rt=="string"&&(rt=[rt]);for(var nt in rt){var st=rt[nt];if(st.is_selected){this.deselectNode(st);continue}if(!st.is_selected&&st.onSelected&&st.onSelected(),st.is_selected=!0,this.selected_nodes[st.id]=st,st.inputs)for(var vt=0;vt<st.inputs.length;++vt)this.highlighted_links[st.inputs[vt].link]=!0;if(st.outputs)for(var vt=0;vt<st.outputs.length;++vt){var _t=st.outputs[vt];if(_t.links)for(var bt=0;bt<_t.links.length;++bt)this.highlighted_links[_t.links[bt]]=!0}}this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)},LGraphCanvas.prototype.deselectNode=function(rt){if(!!rt.is_selected){if(rt.onDeselected&&rt.onDeselected(),rt.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(rt),rt.inputs)for(var it=0;it<rt.inputs.length;++it)delete this.highlighted_links[rt.inputs[it].link];if(rt.outputs)for(var it=0;it<rt.outputs.length;++it){var nt=rt.outputs[it];if(nt.links)for(var st=0;st<nt.links.length;++st)delete this.highlighted_links[nt.links[st]]}}},LGraphCanvas.prototype.deselectAllNodes=function(){if(!!this.graph){for(var rt=this.graph._nodes,it=0,nt=rt.length;it<nt;++it){var st=rt[it];!st.is_selected||(st.onDeselected&&st.onDeselected(),st.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(st))}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)}},LGraphCanvas.prototype.deleteSelectedNodes=function(){this.graph.beforeChange();for(var rt in this.selected_nodes){var it=this.selected_nodes[rt];if(!it.block_delete){if(it.inputs&&it.inputs.length&&it.outputs&&it.outputs.length&&LiteGraph.isValidConnection(it.inputs[0].type,it.outputs[0].type)&&it.inputs[0].link&&it.outputs[0].links&&it.outputs[0].links.length){var nt=it.graph.links[it.inputs[0].link],st=it.graph.links[it.outputs[0].links[0]],vt=it.getInputNode(0),_t=it.getOutputNodes(0)[0];vt&&_t&&vt.connect(nt.origin_slot,_t,st.target_slot)}this.graph.remove(it),this.onNodeDeselected&&this.onNodeDeselected(it)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()},LGraphCanvas.prototype.centerOnNode=function(rt){this.ds.offset[0]=-rt.pos[0]-rt.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-rt.pos[1]-rt.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)},LGraphCanvas.prototype.adjustMouseEvent=function(rt){var it=0,nt=0;if(this.canvas){var st=this.canvas.getBoundingClientRect();it=rt.clientX-st.left,nt=rt.clientY-st.top}else it=rt.clientX,nt=rt.clientY;this.last_mouse_position[0]=it,this.last_mouse_position[1]=nt,rt.canvasX=it/this.ds.scale-this.ds.offset[0],rt.canvasY=nt/this.ds.scale-this.ds.offset[1]},LGraphCanvas.prototype.setZoom=function(rt,it){this.ds.changeScale(rt,it),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},LGraphCanvas.prototype.convertOffsetToCanvas=function(rt,it){return this.ds.convertOffsetToCanvas(rt,it)},LGraphCanvas.prototype.convertCanvasToOffset=function(rt,it){return this.ds.convertCanvasToOffset(rt,it)},LGraphCanvas.prototype.convertEventToCanvasOffset=function(rt){var it=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([rt.clientX-it.left,rt.clientY-it.top])},LGraphCanvas.prototype.bringToFront=function(rt){var it=this.graph._nodes.indexOf(rt);it!=-1&&(this.graph._nodes.splice(it,1),this.graph._nodes.push(rt))},LGraphCanvas.prototype.sendToBack=function(rt){var it=this.graph._nodes.indexOf(rt);it!=-1&&(this.graph._nodes.splice(it,1),this.graph._nodes.unshift(rt))};var temp=new Float32Array(4);LGraphCanvas.prototype.computeVisibleNodes=function(rt,it){var nt=it||[];nt.length=0,rt=rt||this.graph._nodes;for(var st=0,vt=rt.length;st<vt;++st){var _t=rt[st];this.live_mode&&!_t.onDrawBackground&&!_t.onDrawForeground||!overlapBounding(this.visible_area,_t.getBounding(temp,!0))||nt.push(_t)}return nt},LGraphCanvas.prototype.draw=function(rt,it){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var nt=LiteGraph.getTime();this.render_time=(nt-this.last_draw_time)*.001,this.last_draw_time=nt,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||it||this.always_render_background||this.graph&&this.graph._last_trigger_time&&nt-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||rt)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},LGraphCanvas.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var rt=this.ctx;if(!!rt){var it=this.canvas;rt.start2D&&!this.viewport&&(rt.start2D(),rt.restore(),rt.setTransform(1,0,0,1,0,0));var nt=this.viewport||this.dirty_area;if(nt&&(rt.save(),rt.beginPath(),rt.rect(nt[0],nt[1],nt[2],nt[3]),rt.clip()),this.clear_background&&(nt?rt.clearRect(nt[0],nt[1],nt[2],nt[3]):rt.clearRect(0,0,it.width,it.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():rt.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(it,rt),this.show_info&&this.renderInfo(rt,nt?nt[0]:0,nt?nt[1]:0),this.graph){rt.save(),this.ds.toCanvasContext(rt);for(var st=this.computeVisibleNodes(null,this.visible_nodes),vt=0;vt<st.length;++vt){var _t=st[vt];rt.save(),rt.translate(_t.pos[0],_t.pos[1]),this.drawNode(_t,rt),rt.restore()}if(this.render_execution_order&&this.drawExecutionOrder(rt),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(rt)),this.connecting_pos!=null){rt.lineWidth=this.connections_width;var bt=null,xt=this.connecting_output||this.connecting_input,Tt=xt.type,Et=xt.dir;Et==null&&(this.connecting_output?Et=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:Et=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var wt=xt.shape;switch(Tt){case LiteGraph.EVENT:bt=LiteGraph.EVENT_LINK_COLOR;break;default:bt=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(rt,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,bt,Et,LiteGraph.CENTER),rt.beginPath(),Tt===LiteGraph.EVENT||wt===LiteGraph.BOX_SHAPE?(rt.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),rt.fill(),rt.beginPath(),rt.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):wt===LiteGraph.ARROW_SHAPE?(rt.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),rt.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),rt.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),rt.closePath()):(rt.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),rt.fill(),rt.beginPath(),rt.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),rt.fill(),rt.fillStyle="#ffcc00",this._highlight_input){rt.beginPath();var Ot=this._highlight_input_slot.shape;Ot===LiteGraph.ARROW_SHAPE?(rt.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),rt.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),rt.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),rt.closePath()):rt.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),rt.fill()}this._highlight_output&&(rt.beginPath(),Ot===LiteGraph.ARROW_SHAPE?(rt.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),rt.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),rt.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),rt.closePath()):rt.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),rt.fill())}this.dragging_rectangle&&(rt.strokeStyle="#FFF",rt.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(rt,this.over_link_center):this.onDrawLinkTooltip&&this.onDrawLinkTooltip(rt,null),this.onDrawForeground&&this.onDrawForeground(rt,this.visible_rect),rt.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(rt),this.onDrawOverlay&&this.onDrawOverlay(rt),nt&&rt.restore(),rt.finish2D&&rt.finish2D()}},LGraphCanvas.prototype.drawSubgraphPanel=function(rt){var it=this.graph,nt=it._subgraph_node;if(!nt){console.warn("subgraph without subnode");return}this.drawSubgraphPanelLeft(it,nt,rt),this.drawSubgraphPanelRight(it,nt,rt)},LGraphCanvas.prototype.drawSubgraphPanelLeft=function(rt,it,nt){var st=it.inputs?it.inputs.length:0,vt=200,_t=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(nt.fillStyle="#111",nt.globalAlpha=.8,nt.beginPath(),nt.roundRect(10,10,vt,(st+1)*_t+50,[8]),nt.fill(),nt.globalAlpha=1,nt.fillStyle="#888",nt.font="14px Arial",nt.textAlign="left",nt.fillText("Graph Inputs",20,34),this.drawButton(vt-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var bt=50;if(nt.font="14px Arial",it.inputs)for(var xt=0;xt<it.inputs.length;++xt){var Tt=it.inputs[xt];if(!Tt.not_subgraph_input){if(this.drawButton(20,bt+2,vt-20,_t-2)){var Et=it.constructor.input_node_type||"graph/input";this.graph.beforeChange();var wt=LiteGraph.createNode(Et);wt?(rt.add(wt),this.block_click=!1,this.last_click_position=null,this.selectNodes([wt]),this.node_dragged=wt,this.dragging_canvas=!1,wt.setProperty("name",Tt.name),wt.setProperty("type",Tt.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",Et)}nt.fillStyle="#9C9",nt.beginPath(),nt.arc(vt-16,bt+_t*.5,5,0,2*Math.PI),nt.fill(),nt.fillStyle="#AAA",nt.fillText(Tt.name,30,bt+_t*.75),nt.fillStyle="#777",nt.fillText(Tt.type,130,bt+_t*.75),bt+=_t}}this.drawButton(20,bt+2,vt-20,_t-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(it)},LGraphCanvas.prototype.drawSubgraphPanelRight=function(rt,it,nt){var st=it.outputs?it.outputs.length:0,vt=this.bgcanvas.width,_t=200,bt=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);nt.fillStyle="#111",nt.globalAlpha=.8,nt.beginPath(),nt.roundRect(vt-_t-10,10,_t,(st+1)*bt+50,[8]),nt.fill(),nt.globalAlpha=1,nt.fillStyle="#888",nt.font="14px Arial",nt.textAlign="left";var xt="Graph Outputs",Tt=nt.measureText(xt).width;if(nt.fillText(xt,vt-Tt-20,34),this.drawButton(vt-_t,20,20,20,"X","#151515")){this.closeSubgraph();return}var Et=50;if(nt.font="14px Arial",it.outputs)for(var wt=0;wt<it.outputs.length;++wt){var Ot=it.outputs[wt];if(!Ot.not_subgraph_input){if(this.drawButton(vt-_t,Et+2,_t-20,bt-2)){var It=it.constructor.output_node_type||"graph/output";this.graph.beforeChange();var At=LiteGraph.createNode(It);At?(rt.add(At),this.block_click=!1,this.last_click_position=null,this.selectNodes([At]),this.node_dragged=At,this.dragging_canvas=!1,At.setProperty("name",Ot.name),At.setProperty("type",Ot.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",It)}nt.fillStyle="#9C9",nt.beginPath(),nt.arc(vt-_t+16,Et+bt*.5,5,0,2*Math.PI),nt.fill(),nt.fillStyle="#AAA",nt.fillText(Ot.name,vt-_t+30,Et+bt*.75),nt.fillStyle="#777",nt.fillText(Ot.type,vt-_t+130,Et+bt*.75),Et+=bt}}this.drawButton(vt-_t,Et+2,_t-20,bt-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(it)},LGraphCanvas.prototype.drawButton=function(rt,it,nt,st,vt,_t,bt,xt){var Tt=this.ctx;_t=_t||LiteGraph.NODE_DEFAULT_COLOR,bt=bt||"#555",xt=xt||LiteGraph.NODE_TEXT_COLOR;var Et=this.ds.convertOffsetToCanvas(this.graph_mouse),wt=LiteGraph.isInsideRectangle(Et[0],Et[1],rt,it,nt,st);if(Et=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,Et){var Ot=this.canvas.getBoundingClientRect();Et[0]-=Ot.left,Et[1]-=Ot.top}var It=Et&&LiteGraph.isInsideRectangle(Et[0],Et[1],rt,it,nt,st);Tt.fillStyle=wt?bt:_t,It&&(Tt.fillStyle="#AAA"),Tt.beginPath(),Tt.roundRect(rt,it,nt,st,[4]),Tt.fill(),vt!=null&&vt.constructor==String&&(Tt.fillStyle=xt,Tt.textAlign="center",Tt.font=(st*.65|0)+"px Arial",Tt.fillText(vt,rt+nt*.5,it+st*.75),Tt.textAlign="left");var At=It&&!this.block_click;return It&&this.blockClick(),At},LGraphCanvas.prototype.isAreaClicked=function(rt,it,nt,st,vt){var _t=this.mouse;LiteGraph.isInsideRectangle(_t[0],_t[1],rt,it,nt,st),_t=this.last_click_position;var bt=_t&&LiteGraph.isInsideRectangle(_t[0],_t[1],rt,it,nt,st),xt=bt&&!this.block_click;return bt&&vt&&this.blockClick(),xt},LGraphCanvas.prototype.renderInfo=function(rt,it,nt){it=it||10,nt=nt||this.canvas.height-80,rt.save(),rt.translate(it,nt),rt.font="10px Arial",rt.fillStyle="#888",rt.textAlign="left",this.graph?(rt.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13*1),rt.fillText("I: "+this.graph.iteration,5,13*2),rt.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,13*3),rt.fillText("V: "+this.graph._version,5,13*4),rt.fillText("FPS:"+this.fps.toFixed(2),5,13*5)):rt.fillText("No graph selected",5,13*1),rt.restore()},LGraphCanvas.prototype.drawBackCanvas=function(){var rt=this.bgcanvas;(rt.width!=this.canvas.width||rt.height!=this.canvas.height)&&(rt.width=this.canvas.width,rt.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var it=this.bgctx;it.start&&it.start();var nt=this.viewport||[0,0,it.canvas.width,it.canvas.height];if(this.clear_background&&it.clearRect(nt[0],nt[1],nt[2],nt[3]),this._graph_stack&&this._graph_stack.length){it.save(),this._graph_stack[this._graph_stack.length-1];var st=this.graph._subgraph_node;it.strokeStyle=st.bgcolor,it.lineWidth=10,it.strokeRect(1,1,rt.width-2,rt.height-2),it.lineWidth=1,it.font="40px Arial",it.textAlign="center",it.fillStyle=st.bgcolor||"#AAA";for(var vt="",_t=1;_t<this._graph_stack.length;++_t)vt+=this._graph_stack[_t]._subgraph_node.getTitle()+" >> ";it.fillText(vt+st.getTitle(),rt.width*.5,40),it.restore()}var bt=!1;if(this.onRenderBackground&&(bt=this.onRenderBackground(rt,it)),this.viewport||(it.restore(),it.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(it.save(),this.ds.toCanvasContext(it),this.ds.scale<1.5&&!bt&&this.clear_background_color&&(it.fillStyle=this.clear_background_color,it.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!bt){if(this.zoom_modify_alpha?it.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:it.globalAlpha=this.editor_alpha,it.imageSmoothingEnabled=it.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var xt=this;this._bg_img.onload=function(){xt.draw(!0,!0)}}var Tt=null;this._pattern==null&&this._bg_img.width>0?(Tt=it.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=Tt):Tt=this._pattern,Tt&&(it.fillStyle=Tt,it.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),it.fillStyle="transparent"),it.globalAlpha=1,it.imageSmoothingEnabled=it.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(rt,it),this.onDrawBackground&&this.onDrawBackground(it,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(it.strokeStyle="#235",it.strokeRect(0,0,rt.width,rt.height)),this.render_connections_shadows?(it.shadowColor="#000",it.shadowOffsetX=0,it.shadowOffsetY=0,it.shadowBlur=6):it.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(it),it.shadowColor="rgba(0,0,0,0)",it.restore()}it.finish&&it.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var temp_vec2=new Float32Array(2);LGraphCanvas.prototype.drawNode=function(rt,it){this.current_node=rt;var nt=rt.color||rt.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,st=rt.bgcolor||rt.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR;rt.mouseOver;var vt=this.ds.scale<.6;if(this.live_mode){rt.flags.collapsed||(it.shadowColor="transparent",rt.onDrawForeground&&rt.onDrawForeground(it,this,this.canvas));return}var _t=this.editor_alpha;if(it.globalAlpha=_t,this.render_shadows&&!vt?(it.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,it.shadowOffsetX=2*this.ds.scale,it.shadowOffsetY=2*this.ds.scale,it.shadowBlur=3*this.ds.scale):it.shadowColor="transparent",!(rt.flags.collapsed&&rt.onDrawCollapsed&&rt.onDrawCollapsed(it,this)==!0)){var bt=rt._shape||LiteGraph.BOX_SHAPE,xt=temp_vec2;temp_vec2.set(rt.size);var Tt=rt.horizontal;if(rt.flags.collapsed){it.font=this.inner_text_font;var Et=rt.getTitle?rt.getTitle():rt.title;Et!=null&&(rt._collapsed_width=Math.min(rt.size[0],it.measureText(Et).width+LiteGraph.NODE_TITLE_HEIGHT*2),xt[0]=rt._collapsed_width,xt[1]=0)}rt.clip_area&&(it.save(),it.beginPath(),bt==LiteGraph.BOX_SHAPE?it.rect(0,0,xt[0],xt[1]):bt==LiteGraph.ROUND_SHAPE?it.roundRect(0,0,xt[0],xt[1],[10]):bt==LiteGraph.CIRCLE_SHAPE&&it.arc(xt[0]*.5,xt[1]*.5,xt[0]*.5,0,Math.PI*2),it.clip()),rt.has_errors&&(st="red"),this.drawNodeShape(rt,it,xt,nt,st,rt.is_selected,rt.mouseOver),it.shadowColor="transparent",rt.onDrawForeground&&rt.onDrawForeground(it,this,this.canvas),it.textAlign=Tt?"center":"left",it.font=this.inner_text_font;var wt=!vt,Ot=this.connecting_output,It=this.connecting_input;it.lineWidth=1;var At=0,Dt=new Float32Array(2);if(rt.flags.collapsed){if(this.render_collapsed_slots){var Zt=null,Jt=null;if(rt.inputs)for(var kt=0;kt<rt.inputs.length;kt++){var Mt=rt.inputs[kt];if(Mt.link!=null){Zt=Mt;break}}if(rt.outputs)for(var kt=0;kt<rt.outputs.length;kt++){var Mt=rt.outputs[kt];!Mt.links||!Mt.links.length||(Jt=Mt)}if(Zt){var ei=0,ii=LiteGraph.NODE_TITLE_HEIGHT*-.5;Tt&&(ei=rt._collapsed_width*.5,ii=-LiteGraph.NODE_TITLE_HEIGHT),it.fillStyle="#686",it.beginPath(),Mt.type===LiteGraph.EVENT||Mt.shape===LiteGraph.BOX_SHAPE?it.rect(ei-7+.5,ii-4,14,8):Mt.shape===LiteGraph.ARROW_SHAPE?(it.moveTo(ei+8,ii),it.lineTo(ei+-4,ii-4),it.lineTo(ei+-4,ii+4),it.closePath()):it.arc(ei,ii,4,0,Math.PI*2),it.fill()}if(Jt){var ei=rt._collapsed_width,ii=LiteGraph.NODE_TITLE_HEIGHT*-.5;Tt&&(ei=rt._collapsed_width*.5,ii=0),it.fillStyle="#686",it.strokeStyle="black",it.beginPath(),Mt.type===LiteGraph.EVENT||Mt.shape===LiteGraph.BOX_SHAPE?it.rect(ei-7+.5,ii-4,14,8):Mt.shape===LiteGraph.ARROW_SHAPE?(it.moveTo(ei+6,ii),it.lineTo(ei-6,ii-4),it.lineTo(ei-6,ii+4),it.closePath()):it.arc(ei,ii,4,0,Math.PI*2),it.fill()}}}else{if(rt.inputs)for(var kt=0;kt<rt.inputs.length;kt++){var Mt=rt.inputs[kt],zt=Mt.type,Pt=Mt.shape;it.globalAlpha=_t,this.connecting_output&&!LiteGraph.isValidConnection(Mt.type,Ot.type)&&(it.globalAlpha=.4*_t),it.fillStyle=Mt.link!=null?Mt.color_on||this.default_connection_color_byType[zt]||this.default_connection_color.input_on:Mt.color_off||this.default_connection_color_byTypeOff[zt]||this.default_connection_color_byType[zt]||this.default_connection_color.input_off;var Lt=rt.getConnectionPos(!0,kt,Dt);Lt[0]-=rt.pos[0],Lt[1]-=rt.pos[1],At<Lt[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(At=Lt[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),it.beginPath(),zt=="array"&&(Pt=LiteGraph.GRID_SHAPE);var Bt=!0;if(Mt.type===LiteGraph.EVENT||Mt.shape===LiteGraph.BOX_SHAPE?Tt?it.rect(Lt[0]-5+.5,Lt[1]-8+.5,10,14):it.rect(Lt[0]-6+.5,Lt[1]-5+.5,14,10):Pt===LiteGraph.ARROW_SHAPE?(it.moveTo(Lt[0]+8,Lt[1]+.5),it.lineTo(Lt[0]-4,Lt[1]+6+.5),it.lineTo(Lt[0]-4,Lt[1]-6+.5),it.closePath()):Pt===LiteGraph.GRID_SHAPE?(it.rect(Lt[0]-4,Lt[1]-4,2,2),it.rect(Lt[0]-1,Lt[1]-4,2,2),it.rect(Lt[0]+2,Lt[1]-4,2,2),it.rect(Lt[0]-4,Lt[1]-1,2,2),it.rect(Lt[0]-1,Lt[1]-1,2,2),it.rect(Lt[0]+2,Lt[1]-1,2,2),it.rect(Lt[0]-4,Lt[1]+2,2,2),it.rect(Lt[0]-1,Lt[1]+2,2,2),it.rect(Lt[0]+2,Lt[1]+2,2,2),Bt=!1):vt?it.rect(Lt[0]-4,Lt[1]-4,8,8):it.arc(Lt[0],Lt[1],4,0,Math.PI*2),it.fill(),wt){var Gt=Mt.label!=null?Mt.label:Mt.name;Gt&&(it.fillStyle=LiteGraph.NODE_TEXT_COLOR,Tt||Mt.dir==LiteGraph.UP?it.fillText(Gt,Lt[0],Lt[1]-10):it.fillText(Gt,Lt[0]+10,Lt[1]+5))}}if(it.textAlign=Tt?"center":"right",it.strokeStyle="black",rt.outputs)for(var kt=0;kt<rt.outputs.length;kt++){var Mt=rt.outputs[kt],zt=Mt.type,Pt=Mt.shape;this.connecting_input&&!LiteGraph.isValidConnection(zt,It.type)&&(it.globalAlpha=.4*_t);var Lt=rt.getConnectionPos(!1,kt,Dt);Lt[0]-=rt.pos[0],Lt[1]-=rt.pos[1],At<Lt[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(At=Lt[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),it.fillStyle=Mt.links&&Mt.links.length?Mt.color_on||this.default_connection_color_byType[zt]||this.default_connection_color.output_on:Mt.color_off||this.default_connection_color_byTypeOff[zt]||this.default_connection_color_byType[zt]||this.default_connection_color.output_off,it.beginPath(),zt=="array"&&(Pt=LiteGraph.GRID_SHAPE);var Bt=!0;if(zt===LiteGraph.EVENT||Pt===LiteGraph.BOX_SHAPE?Tt?it.rect(Lt[0]-5+.5,Lt[1]-8+.5,10,14):it.rect(Lt[0]-6+.5,Lt[1]-5+.5,14,10):Pt===LiteGraph.ARROW_SHAPE?(it.moveTo(Lt[0]+8,Lt[1]+.5),it.lineTo(Lt[0]-4,Lt[1]+6+.5),it.lineTo(Lt[0]-4,Lt[1]-6+.5),it.closePath()):Pt===LiteGraph.GRID_SHAPE?(it.rect(Lt[0]-4,Lt[1]-4,2,2),it.rect(Lt[0]-1,Lt[1]-4,2,2),it.rect(Lt[0]+2,Lt[1]-4,2,2),it.rect(Lt[0]-4,Lt[1]-1,2,2),it.rect(Lt[0]-1,Lt[1]-1,2,2),it.rect(Lt[0]+2,Lt[1]-1,2,2),it.rect(Lt[0]-4,Lt[1]+2,2,2),it.rect(Lt[0]-1,Lt[1]+2,2,2),it.rect(Lt[0]+2,Lt[1]+2,2,2),Bt=!1):vt?it.rect(Lt[0]-4,Lt[1]-4,8,8):it.arc(Lt[0],Lt[1],4,0,Math.PI*2),it.fill(),!vt&&Bt&&it.stroke(),wt){var Gt=Mt.label!=null?Mt.label:Mt.name;Gt&&(it.fillStyle=LiteGraph.NODE_TEXT_COLOR,Tt||Mt.dir==LiteGraph.DOWN?it.fillText(Gt,Lt[0],Lt[1]-8):it.fillText(Gt,Lt[0]-10,Lt[1]+5))}}if(it.textAlign="left",it.globalAlpha=1,rt.widgets){var Ut=At;(Tt||rt.widgets_up)&&(Ut=2),rt.widgets_start_y!=null&&(Ut=rt.widgets_start_y),this.drawNodeWidgets(rt,Ut,it,this.node_widget&&this.node_widget[0]==rt?this.node_widget[1]:null)}}rt.clip_area&&it.restore(),it.globalAlpha=1}},LGraphCanvas.prototype.drawLinkTooltip=function(rt,it){var nt=it._pos;if(rt.fillStyle="black",rt.beginPath(),rt.arc(nt[0],nt[1],3,0,Math.PI*2),rt.fill(),it.data!=null&&!(this.onDrawLinkTooltip&&this.onDrawLinkTooltip(rt,it,this)==!0)){var st=it.data,vt=null;if(st.constructor===Number?vt=st.toFixed(2):st.constructor===String?vt='"'+st+'"':st.constructor===Boolean?vt=String(st):st.toToolTip?vt=st.toToolTip():vt="["+st.constructor.name+"]",vt!=null){vt=vt.substr(0,30),rt.font="14px Courier New";var _t=rt.measureText(vt),bt=_t.width+20,xt=24;rt.shadowColor="black",rt.shadowOffsetX=2,rt.shadowOffsetY=2,rt.shadowBlur=3,rt.fillStyle="#454",rt.beginPath(),rt.roundRect(nt[0]-bt*.5,nt[1]-15-xt,bt,xt,[3]),rt.moveTo(nt[0]-10,nt[1]-15),rt.lineTo(nt[0]+10,nt[1]-15),rt.lineTo(nt[0],nt[1]-5),rt.fill(),rt.shadowColor="transparent",rt.textAlign="center",rt.fillStyle="#CEC",rt.fillText(vt,nt[0],nt[1]-15-xt*.3)}}};var tmp_area=new Float32Array(4);LGraphCanvas.prototype.drawNodeShape=function(rt,it,nt,st,vt,_t,bt){it.strokeStyle=st,it.fillStyle=vt;var xt=LiteGraph.NODE_TITLE_HEIGHT,Tt=this.ds.scale<.5,Et=rt._shape||rt.constructor.shape||LiteGraph.ROUND_SHAPE,wt=rt.constructor.title_mode,Ot=!0;wt==LiteGraph.TRANSPARENT_TITLE||wt==LiteGraph.NO_TITLE?Ot=!1:wt==LiteGraph.AUTOHIDE_TITLE&&bt&&(Ot=!0);var It=tmp_area;It[0]=0,It[1]=Ot?-xt:0,It[2]=nt[0]+1,It[3]=Ot?nt[1]+xt:nt[1];var At=it.globalAlpha;if(it.beginPath(),Et==LiteGraph.BOX_SHAPE||Tt?it.fillRect(It[0],It[1],It[2],It[3]):Et==LiteGraph.ROUND_SHAPE||Et==LiteGraph.CARD_SHAPE?it.roundRect(It[0],It[1],It[2],It[3],Et==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):Et==LiteGraph.CIRCLE_SHAPE&&it.arc(nt[0]*.5,nt[1]*.5,nt[0]*.5,0,Math.PI*2),it.fill(),!rt.flags.collapsed&&Ot&&(it.shadowColor="transparent",it.fillStyle="rgba(0,0,0,0.2)",it.fillRect(0,-1,It[2],2)),it.shadowColor="transparent",rt.onDrawBackground&&rt.onDrawBackground(it,this,this.canvas,this.graph_mouse),Ot||wt==LiteGraph.TRANSPARENT_TITLE){if(rt.onDrawTitleBar)rt.onDrawTitleBar(it,xt,nt,this.ds.scale,st);else if(wt!=LiteGraph.TRANSPARENT_TITLE&&(rt.constructor.title_color||this.render_title_colored)){var Dt=rt.constructor.title_color||st;if(rt.flags.collapsed&&(it.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var kt=LGraphCanvas.gradients[Dt];kt||(kt=LGraphCanvas.gradients[Dt]=it.createLinearGradient(0,0,400,0),kt.addColorStop(0,Dt),kt.addColorStop(1,"#000")),it.fillStyle=kt}else it.fillStyle=Dt;it.beginPath(),Et==LiteGraph.BOX_SHAPE||Tt?it.rect(0,-xt,nt[0]+1,xt):(Et==LiteGraph.ROUND_SHAPE||Et==LiteGraph.CARD_SHAPE)&&it.roundRect(0,-xt,nt[0]+1,xt,rt.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),it.fill(),it.shadowColor="transparent"}var Mt=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[rt.mode]&&(Mt=LiteGraph.NODE_MODES_COLORS[rt.mode]),LiteGraph.node_box_coloured_when_on&&(Mt=rt.action_triggered?"#FFF":rt.execute_triggered?"#AAA":Mt);var zt=10;if(rt.onDrawTitleBox?rt.onDrawTitleBox(it,xt,nt,this.ds.scale):Et==LiteGraph.ROUND_SHAPE||Et==LiteGraph.CIRCLE_SHAPE||Et==LiteGraph.CARD_SHAPE?(Tt&&(it.fillStyle="black",it.beginPath(),it.arc(xt*.5,xt*-.5,zt*.5+1,0,Math.PI*2),it.fill()),it.fillStyle=rt.boxcolor||Mt||LiteGraph.NODE_DEFAULT_BOXCOLOR,Tt?it.fillRect(xt*.5-zt*.5,xt*-.5-zt*.5,zt,zt):(it.beginPath(),it.arc(xt*.5,xt*-.5,zt*.5,0,Math.PI*2),it.fill())):(Tt&&(it.fillStyle="black",it.fillRect((xt-zt)*.5-1,(xt+zt)*-.5-1,zt+2,zt+2)),it.fillStyle=rt.boxcolor||Mt||LiteGraph.NODE_DEFAULT_BOXCOLOR,it.fillRect((xt-zt)*.5,(xt+zt)*-.5,zt,zt)),it.globalAlpha=At,rt.onDrawTitleText&&rt.onDrawTitleText(it,xt,nt,this.ds.scale,this.title_text_font,_t),!Tt){it.font=this.title_text_font;var Pt=String(rt.getTitle());Pt&&(_t?it.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:it.fillStyle=rt.constructor.title_text_color||this.node_title_color,rt.flags.collapsed?(it.textAlign="left",it.measureText(Pt),it.fillText(Pt.substr(0,20),xt,LiteGraph.NODE_TITLE_TEXT_Y-xt),it.textAlign="left"):(it.textAlign="left",it.fillText(Pt,xt,LiteGraph.NODE_TITLE_TEXT_Y-xt)))}if(!rt.flags.collapsed&&rt.subgraph&&!rt.skip_subgraph_button){var Lt=LiteGraph.NODE_TITLE_HEIGHT,Bt=rt.size[0]-Lt,Gt=LiteGraph.isInsideRectangle(this.graph_mouse[0]-rt.pos[0],this.graph_mouse[1]-rt.pos[1],Bt+2,-Lt+2,Lt-4,Lt-4);it.fillStyle=Gt?"#888":"#555",Et==LiteGraph.BOX_SHAPE||Tt?it.fillRect(Bt+2,-Lt+2,Lt-4,Lt-4):(it.beginPath(),it.roundRect(Bt+2,-Lt+2,Lt-4,Lt-4,[4]),it.fill()),it.fillStyle="#333",it.beginPath(),it.moveTo(Bt+Lt*.2,-Lt*.6),it.lineTo(Bt+Lt*.8,-Lt*.6),it.lineTo(Bt+Lt*.5,-Lt*.3),it.fill()}rt.onDrawTitle&&rt.onDrawTitle(it)}_t&&(rt.onBounding&&rt.onBounding(It),wt==LiteGraph.TRANSPARENT_TITLE&&(It[1]-=xt,It[3]+=xt),it.lineWidth=1,it.globalAlpha=.8,it.beginPath(),Et==LiteGraph.BOX_SHAPE?it.rect(-6+It[0],-6+It[1],12+It[2],12+It[3]):Et==LiteGraph.ROUND_SHAPE||Et==LiteGraph.CARD_SHAPE&&rt.flags.collapsed?it.roundRect(-6+It[0],-6+It[1],12+It[2],12+It[3],[this.round_radius*2]):Et==LiteGraph.CARD_SHAPE?it.roundRect(-6+It[0],-6+It[1],12+It[2],12+It[3],[this.round_radius*2,2,this.round_radius*2,2]):Et==LiteGraph.CIRCLE_SHAPE&&it.arc(nt[0]*.5,nt[1]*.5,nt[0]*.5+6,0,Math.PI*2),it.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,it.stroke(),it.strokeStyle=st,it.globalAlpha=1),rt.execute_triggered>0&&rt.execute_triggered--,rt.action_triggered>0&&rt.action_triggered--};var margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);LGraphCanvas.prototype.drawConnections=function(rt){var it=LiteGraph.getTime(),nt=this.visible_area;margin_area[0]=nt[0]-20,margin_area[1]=nt[1]-20,margin_area[2]=nt[2]+40,margin_area[3]=nt[3]+40,rt.lineWidth=this.connections_width,rt.fillStyle="#AAA",rt.strokeStyle="#AAA",rt.globalAlpha=this.editor_alpha;for(var st=this.graph._nodes,vt=0,_t=st.length;vt<_t;++vt){var bt=st[vt];if(!(!bt.inputs||!bt.inputs.length))for(var xt=0;xt<bt.inputs.length;++xt){var Tt=bt.inputs[xt];if(!(!Tt||Tt.link==null)){var Et=Tt.link,wt=this.graph.links[Et];if(!!wt){var Ot=this.graph.getNodeById(wt.origin_id);if(Ot!=null){var It=wt.origin_slot,At=null;It==-1?At=[Ot.pos[0]+10,Ot.pos[1]+10]:At=Ot.getConnectionPos(!1,It,tempA);var Dt=bt.getConnectionPos(!0,xt,tempB);if(link_bounding[0]=At[0],link_bounding[1]=At[1],link_bounding[2]=Dt[0]-At[0],link_bounding[3]=Dt[1]-At[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!overlapBounding(link_bounding,margin_area)){var kt=Ot.outputs[It],Mt=bt.inputs[xt];if(!(!kt||!Mt)){var zt=kt.dir||(Ot.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),Pt=Mt.dir||(bt.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(rt,At,Dt,wt,!1,0,null,zt,Pt),wt&&wt._last_time&&it-wt._last_time<1e3){var Lt=2-(it-wt._last_time)*.002,Bt=rt.globalAlpha;rt.globalAlpha=Bt*Lt,this.renderLink(rt,At,Dt,wt,!0,Lt,"white",zt,Pt),rt.globalAlpha=Bt}}}}}}}}rt.globalAlpha=1},LGraphCanvas.prototype.renderLink=function(rt,it,nt,st,vt,_t,bt,xt,Tt,Et){st&&this.visible_links.push(st),!bt&&st&&(bt=st.color||LGraphCanvas.link_type_colors[st.type]),bt||(bt=this.default_link_color),st!=null&&this.highlighted_links[st.id]&&(bt="#FFF"),xt=xt||LiteGraph.RIGHT,Tt=Tt||LiteGraph.LEFT;var wt=distance(it,nt);this.render_connections_border&&this.ds.scale>.6&&(rt.lineWidth=this.connections_width+4),rt.lineJoin="round",Et=Et||1,Et>1&&(rt.lineWidth=.5),rt.beginPath();for(var Ot=0;Ot<Et;Ot+=1){var It=(Ot-(Et-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){rt.moveTo(it[0],it[1]+It);var At=0,Dt=0,kt=0,Mt=0;switch(xt){case LiteGraph.LEFT:At=wt*-.25;break;case LiteGraph.RIGHT:At=wt*.25;break;case LiteGraph.UP:Dt=wt*-.25;break;case LiteGraph.DOWN:Dt=wt*.25;break}switch(Tt){case LiteGraph.LEFT:kt=wt*-.25;break;case LiteGraph.RIGHT:kt=wt*.25;break;case LiteGraph.UP:Mt=wt*-.25;break;case LiteGraph.DOWN:Mt=wt*.25;break}rt.bezierCurveTo(it[0]+At,it[1]+Dt+It,nt[0]+kt,nt[1]+Mt+It,nt[0],nt[1]+It)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){rt.moveTo(it[0],it[1]+It);var At=0,Dt=0,kt=0,Mt=0;switch(xt){case LiteGraph.LEFT:At=-1;break;case LiteGraph.RIGHT:At=1;break;case LiteGraph.UP:Dt=-1;break;case LiteGraph.DOWN:Dt=1;break}switch(Tt){case LiteGraph.LEFT:kt=-1;break;case LiteGraph.RIGHT:kt=1;break;case LiteGraph.UP:Mt=-1;break;case LiteGraph.DOWN:Mt=1;break}var zt=15;rt.lineTo(it[0]+At*zt,it[1]+Dt*zt+It),rt.lineTo(nt[0]+kt*zt,nt[1]+Mt*zt+It),rt.lineTo(nt[0],nt[1]+It)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){rt.moveTo(it[0],it[1]);var Pt=it[0],Lt=it[1],Bt=nt[0],Gt=nt[1];xt==LiteGraph.RIGHT?Pt+=10:Lt+=10,Tt==LiteGraph.LEFT?Bt-=10:Gt-=10,rt.lineTo(Pt,Lt),rt.lineTo((Pt+Bt)*.5,Lt),rt.lineTo((Pt+Bt)*.5,Gt),rt.lineTo(Bt,Gt),rt.lineTo(nt[0],nt[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!vt&&(rt.strokeStyle="rgba(0,0,0,0.5)",rt.stroke()),rt.lineWidth=this.connections_width,rt.fillStyle=rt.strokeStyle=bt,rt.stroke();var Ut=this.computeConnectionPoint(it,nt,.5,xt,Tt);if(st&&st._pos&&(st._pos[0]=Ut[0],st._pos[1]=Ut[1]),this.ds.scale>=.6&&this.highquality_render&&Tt!=LiteGraph.CENTER){if(this.render_connection_arrows){var Zt=this.computeConnectionPoint(it,nt,.25,xt,Tt),Jt=this.computeConnectionPoint(it,nt,.26,xt,Tt),ei=this.computeConnectionPoint(it,nt,.75,xt,Tt),ii=this.computeConnectionPoint(it,nt,.76,xt,Tt),li=0,pi=0;this.render_curved_connections?(li=-Math.atan2(Jt[0]-Zt[0],Jt[1]-Zt[1]),pi=-Math.atan2(ii[0]-ei[0],ii[1]-ei[1])):pi=li=nt[1]>it[1]?0:Math.PI,rt.save(),rt.translate(Zt[0],Zt[1]),rt.rotate(li),rt.beginPath(),rt.moveTo(-5,-3),rt.lineTo(0,7),rt.lineTo(5,-3),rt.fill(),rt.restore(),rt.save(),rt.translate(ei[0],ei[1]),rt.rotate(pi),rt.beginPath(),rt.moveTo(-5,-3),rt.lineTo(0,7),rt.lineTo(5,-3),rt.fill(),rt.restore()}rt.beginPath(),rt.arc(Ut[0],Ut[1],5,0,Math.PI*2),rt.fill()}if(_t){rt.fillStyle=bt;for(var Ot=0;Ot<5;++Ot){var ci=(LiteGraph.getTime()*.001+Ot*.2)%1,Ut=this.computeConnectionPoint(it,nt,ci,xt,Tt);rt.beginPath(),rt.arc(Ut[0],Ut[1],5,0,2*Math.PI),rt.fill()}}},LGraphCanvas.prototype.computeConnectionPoint=function(rt,it,nt,st,vt){st=st||LiteGraph.RIGHT,vt=vt||LiteGraph.LEFT;var _t=distance(rt,it),bt=rt,xt=[rt[0],rt[1]],Tt=[it[0],it[1]],Et=it;switch(st){case LiteGraph.LEFT:xt[0]+=_t*-.25;break;case LiteGraph.RIGHT:xt[0]+=_t*.25;break;case LiteGraph.UP:xt[1]+=_t*-.25;break;case LiteGraph.DOWN:xt[1]+=_t*.25;break}switch(vt){case LiteGraph.LEFT:Tt[0]+=_t*-.25;break;case LiteGraph.RIGHT:Tt[0]+=_t*.25;break;case LiteGraph.UP:Tt[1]+=_t*-.25;break;case LiteGraph.DOWN:Tt[1]+=_t*.25;break}var wt=(1-nt)*(1-nt)*(1-nt),Ot=3*((1-nt)*(1-nt))*nt,It=3*(1-nt)*(nt*nt),At=nt*nt*nt,Dt=wt*bt[0]+Ot*xt[0]+It*Tt[0]+At*Et[0],kt=wt*bt[1]+Ot*xt[1]+It*Tt[1]+At*Et[1];return[Dt,kt]},LGraphCanvas.prototype.drawExecutionOrder=function(rt){rt.shadowColor="transparent",rt.globalAlpha=.25,rt.textAlign="center",rt.strokeStyle="white",rt.globalAlpha=.75;for(var it=this.visible_nodes,nt=0;nt<it.length;++nt){var st=it[nt];rt.fillStyle="black",rt.fillRect(st.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,st.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),st.order==0&&rt.strokeRect(st.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,st.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),rt.fillStyle="#FFF",rt.fillText(st.order,st.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,st.pos[1]-6)}rt.globalAlpha=1},LGraphCanvas.prototype.drawNodeWidgets=function(rt,it,nt,st){if(!rt.widgets||!rt.widgets.length)return 0;var vt=rt.size[0],_t=rt.widgets;it+=2;var bt=LiteGraph.NODE_WIDGET_HEIGHT,xt=this.ds.scale>.5;nt.save(),nt.globalAlpha=this.editor_alpha;for(var Tt=LiteGraph.WIDGET_OUTLINE_COLOR,Et=LiteGraph.WIDGET_BGCOLOR,wt=LiteGraph.WIDGET_TEXT_COLOR,Ot=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,It=15,At=0;At<_t.length;++At){var Dt=_t[At],kt=it;Dt.y&&(kt=Dt.y),Dt.last_y=kt,nt.strokeStyle=Tt,nt.fillStyle="#222",nt.textAlign="left",Dt.disabled&&(nt.globalAlpha*=.5);var Mt=Dt.width||vt;switch(Dt.type){case"button":Dt.clicked&&(nt.fillStyle="#AAA",Dt.clicked=!1,this.dirty_canvas=!0),nt.fillRect(It,kt,Mt-It*2,bt),xt&&!Dt.disabled&&nt.strokeRect(It,kt,Mt-It*2,bt),xt&&(nt.textAlign="center",nt.fillStyle=wt,nt.fillText(Dt.label||Dt.name,Mt*.5,kt+bt*.7));break;case"toggle":if(nt.textAlign="left",nt.strokeStyle=Tt,nt.fillStyle=Et,nt.beginPath(),xt?nt.roundRect(It,kt,Mt-It*2,bt,[bt*.5]):nt.rect(It,kt,Mt-It*2,bt),nt.fill(),xt&&!Dt.disabled&&nt.stroke(),nt.fillStyle=Dt.value?"#89A":"#333",nt.beginPath(),nt.arc(Mt-It*2,kt+bt*.5,bt*.36,0,Math.PI*2),nt.fill(),xt){nt.fillStyle=Ot;const Ut=Dt.label||Dt.name;Ut!=null&&nt.fillText(Ut,It*2,kt+bt*.7),nt.fillStyle=Dt.value?wt:Ot,nt.textAlign="right",nt.fillText(Dt.value?Dt.options.on||"true":Dt.options.off||"false",Mt-40,kt+bt*.7)}break;case"slider":nt.fillStyle=Et,nt.fillRect(It,kt,Mt-It*2,bt);var zt=Dt.options.max-Dt.options.min,Pt=(Dt.value-Dt.options.min)/zt;if(Pt<0&&(Pt=0),Pt>1&&(Pt=1),nt.fillStyle=Dt.options.hasOwnProperty("slider_color")?Dt.options.slider_color:st==Dt?"#89A":"#678",nt.fillRect(It,kt,Pt*(Mt-It*2),bt),xt&&!Dt.disabled&&nt.strokeRect(It,kt,Mt-It*2,bt),Dt.marker){var Lt=(Dt.marker-Dt.options.min)/zt;Lt<0&&(Lt=0),Lt>1&&(Lt=1),nt.fillStyle=Dt.options.hasOwnProperty("marker_color")?Dt.options.marker_color:"#AA9",nt.fillRect(It+Lt*(Mt-It*2),kt,2,bt)}xt&&(nt.textAlign="center",nt.fillStyle=wt,nt.fillText(Dt.label||Dt.name+"  "+Number(Dt.value).toFixed(Dt.options.precision!=null?Dt.options.precision:3),Mt*.5,kt+bt*.7));break;case"number":case"combo":if(nt.textAlign="left",nt.strokeStyle=Tt,nt.fillStyle=Et,nt.beginPath(),xt?nt.roundRect(It,kt,Mt-It*2,bt,[bt*.5]):nt.rect(It,kt,Mt-It*2,bt),nt.fill(),xt)if(Dt.disabled||nt.stroke(),nt.fillStyle=wt,Dt.disabled||(nt.beginPath(),nt.moveTo(It+16,kt+5),nt.lineTo(It+6,kt+bt*.5),nt.lineTo(It+16,kt+bt-5),nt.fill(),nt.beginPath(),nt.moveTo(Mt-It-16,kt+5),nt.lineTo(Mt-It-6,kt+bt*.5),nt.lineTo(Mt-It-16,kt+bt-5),nt.fill()),nt.fillStyle=Ot,nt.fillText(Dt.label||Dt.name,It*2+5,kt+bt*.7),nt.fillStyle=wt,nt.textAlign="right",Dt.type=="number")nt.fillText(Number(Dt.value).toFixed(Dt.options.precision!==void 0?Dt.options.precision:3),Mt-It*2-20,kt+bt*.7);else{var Bt=Dt.value;if(Dt.options.values){var Gt=Dt.options.values;Gt.constructor===Function&&(Gt=Gt()),Gt&&Gt.constructor!==Array&&(Bt=Gt[Dt.value])}nt.fillText(Bt,Mt-It*2-20,kt+bt*.7)}break;case"string":case"text":if(nt.textAlign="left",nt.strokeStyle=Tt,nt.fillStyle=Et,nt.beginPath(),xt?nt.roundRect(It,kt,Mt-It*2,bt,[bt*.5]):nt.rect(It,kt,Mt-It*2,bt),nt.fill(),xt){Dt.disabled||nt.stroke(),nt.save(),nt.beginPath(),nt.rect(It,kt,Mt-It*2,bt),nt.clip(),nt.fillStyle=Ot;const Ut=Dt.label||Dt.name;Ut!=null&&nt.fillText(Ut,It*2,kt+bt*.7),nt.fillStyle=wt,nt.textAlign="right",nt.fillText(String(Dt.value).substr(0,30),Mt-It*2,kt+bt*.7),nt.restore()}break;default:Dt.draw&&Dt.draw(nt,rt,Mt,kt,bt);break}it+=(Dt.computeSize?Dt.computeSize(Mt)[1]:bt)+4,nt.globalAlpha=this.editor_alpha}nt.restore(),nt.textAlign="left"},LGraphCanvas.prototype.processNodeWidgets=function(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;for(var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow(),i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type===LiteGraph.pointerevents_method+"down"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var old_value=w.value,nvalue=clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value)},20),this.dirty_canvas=!0;break;case"number":case"combo":var old_value=w.value;if(event.type==LiteGraph.pointerevents_method+"move"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type==LiteGraph.pointerevents_method+"down"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));var delta=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=delta*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(delta){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+delta:index=values_list.indexOf(w.value)+delta,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let rt=function(it,nt,st){return values!=values_list&&(it=text_values.indexOf(it)),this.value=it,inner_value_change(this,it),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:rt.bind(w)},ref_window)}}else if(event.type==LiteGraph.pointerevents_method+"up"&&w.type=="number"){var delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,function(v){if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(rt){}this.value=Number(v),inner_value_change(this,this.value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type==LiteGraph.pointerevents_method+"down"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type==LiteGraph.pointerevents_method+"down"&&this.prompt("Value",w.value,function(rt){inner_value_change(this,rt)}.bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return old_value!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,old_value,w),node.graph._version++),w}}}function inner_value_change(rt,it){rt.type=="number"&&(it=Number(it)),rt.value=it,rt.options&&rt.options.property&&node.properties[rt.options.property]!==void 0&&node.setProperty(rt.options.property,it),rt.callback&&rt.callback(rt.value,that,node,pos,event)}return null},LGraphCanvas.prototype.drawGroups=function(rt,it){if(!!this.graph){var nt=this.graph._groups;it.save(),it.globalAlpha=.5*this.editor_alpha;for(var st=0;st<nt.length;++st){var vt=nt[st];if(!!overlapBounding(this.visible_area,vt._bounding)){it.fillStyle=vt.color||"#335",it.strokeStyle=vt.color||"#335";var _t=vt._pos,bt=vt._size;it.globalAlpha=.25*this.editor_alpha,it.beginPath(),it.rect(_t[0]+.5,_t[1]+.5,bt[0],bt[1]),it.fill(),it.globalAlpha=this.editor_alpha,it.stroke(),it.beginPath(),it.moveTo(_t[0]+bt[0],_t[1]+bt[1]),it.lineTo(_t[0]+bt[0]-10,_t[1]+bt[1]),it.lineTo(_t[0]+bt[0],_t[1]+bt[1]-10),it.fill();var xt=vt.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;it.font=xt+"px Arial",it.textAlign="left",it.fillText(vt.title,_t[0]+4,_t[1]+xt)}}it.restore()}},LGraphCanvas.prototype.adjustNodesSize=function(){for(var rt=this.graph._nodes,it=0;it<rt.length;++it)rt[it].size=rt[it].computeSize();this.setDirty(!0,!0)},LGraphCanvas.prototype.resize=function(rt,it){if(!rt&&!it){var nt=this.canvas.parentNode;rt=nt.offsetWidth,it=nt.offsetHeight}this.canvas.width==rt&&this.canvas.height==it||(this.canvas.width=rt,this.canvas.height=it,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},LGraphCanvas.prototype.switchLiveMode=function(rt){if(!rt){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var it=this,nt=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var st=setInterval(function(){it.editor_alpha*=nt,it.dirty_canvas=!0,it.dirty_bgcanvas=!0,nt<1&&it.editor_alpha<.01&&(clearInterval(st),nt<1&&(it.live_mode=!0)),nt>1&&it.editor_alpha>.99&&(clearInterval(st),it.editor_alpha=1)},1)},LGraphCanvas.prototype.onNodeSelectionChange=function(rt){},LGraphCanvas.onGroupAdd=function(rt,it,nt){var st=LGraphCanvas.active_canvas;st.getCanvasWindow();var vt=new LiteGraph.LGraphGroup;vt.pos=st.convertEventToCanvasOffset(nt),st.graph.add(vt)},LGraphCanvas.getBoundaryNodes=function(rt){let it=null,nt=null,st=null,vt=null;for(const _t in rt){const bt=rt[_t],[xt,Tt]=bt.pos,[Et,wt]=bt.size;(it===null||Tt<it.pos[1])&&(it=bt),(nt===null||xt+Et>nt.pos[0]+nt.size[0])&&(nt=bt),(st===null||Tt+wt>st.pos[1]+st.size[1])&&(st=bt),(vt===null||xt<vt.pos[0])&&(vt=bt)}return{top:it,right:nt,bottom:st,left:vt}},LGraphCanvas.prototype.boundaryNodesForSelection=function(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))},LGraphCanvas.alignNodes=function(rt,it,nt){if(!rt)return;const st=LGraphCanvas.active_canvas;let vt=[];nt===void 0?vt=LGraphCanvas.getBoundaryNodes(rt):vt={top:nt,right:nt,bottom:nt,left:nt};for(const[_t,bt]of Object.entries(st.selected_nodes))switch(it){case"right":bt.pos[0]=vt.right.pos[0]+vt.right.size[0]-bt.size[0];break;case"left":bt.pos[0]=vt.left.pos[0];break;case"top":bt.pos[1]=vt.top.pos[1];break;case"bottom":bt.pos[1]=vt.bottom.pos[1]+vt.bottom.size[1]-bt.size[1];break}st.dirty_canvas=!0,st.dirty_bgcanvas=!0},LGraphCanvas.onNodeAlign=function(rt,it,nt,st,vt){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:nt,callback:_t,parentMenu:st});function _t(bt){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,bt.toLowerCase(),vt)}},LGraphCanvas.onGroupAlign=function(rt,it,nt,st){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:nt,callback:vt,parentMenu:st});function vt(_t){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,_t.toLowerCase())}},LGraphCanvas.onMenuAdd=function(rt,it,nt,st,vt){var _t=LGraphCanvas.active_canvas,bt=_t.getCanvasWindow(),xt=_t.graph;if(!xt)return;function Tt(Et,wt){var Ot=LiteGraph.getNodeTypesCategories(_t.filter||xt.filter).filter(function(Dt){return Dt.startsWith(Et)}),It=[];Ot.map(function(Dt){if(!!Dt){var kt=new RegExp("^("+Et+")"),Mt=Dt.replace(kt,"").split("/")[0],zt=Et===""?Mt+"/":Et+Mt+"/",Pt=Mt;Pt.indexOf("::")!=-1&&(Pt=Pt.split("::")[1]);var Lt=It.findIndex(function(Bt){return Bt.value===zt});Lt===-1&&It.push({value:zt,content:Pt,has_submenu:!0,callback:function(Bt,Gt,Ut,Zt){Tt(Bt.value,Zt)}})}});var At=LiteGraph.getNodeTypesInCategory(Et.slice(0,-1),_t.filter||xt.filter);At.map(function(Dt){if(!Dt.skip_list){var kt={value:Dt.type,content:Dt.title,has_submenu:!1,callback:function(Mt,zt,Pt,Lt){var Bt=Lt.getFirstEvent();_t.graph.beforeChange();var Gt=LiteGraph.createNode(Mt.value);Gt&&(Gt.pos=_t.convertEventToCanvasOffset(Bt),_t.graph.add(Gt)),vt&&vt(Gt),_t.graph.afterChange()}};It.push(kt)}}),new LiteGraph.ContextMenu(It,{event:nt,parentMenu:wt},bt)}return Tt("",st),!1},LGraphCanvas.onMenuCollapseAll=function(){},LGraphCanvas.onMenuNodeEdit=function(){},LGraphCanvas.showMenuNodeOptionalInputs=function(rt,Tt,nt,st,vt){if(!vt)return;var _t=this,bt=LGraphCanvas.active_canvas,xt=bt.getCanvasWindow(),Tt=vt.optional_inputs;vt.onGetInputs&&(Tt=vt.onGetInputs());var Et=[];if(Tt)for(var wt=0;wt<Tt.length;wt++){var Ot=Tt[wt];if(!Ot){Et.push(null);continue}var It=Ot[0];Ot[2]||(Ot[2]={}),Ot[2].label&&(It=Ot[2].label),Ot[2].removable=!0;var At={content:It,value:Ot};Ot[1]==LiteGraph.ACTION&&(At.className="event"),Et.push(At)}if(vt.onMenuNodeInputs){var Dt=vt.onMenuNodeInputs(Et);Dt&&(Et=Dt)}if(!Et.length){console.log("no input entries");return}new LiteGraph.ContextMenu(Et,{event:nt,callback:kt,parentMenu:st,node:vt},xt);function kt(Mt,zt,Pt){!vt||(Mt.callback&&Mt.callback.call(_t,vt,Mt,zt,Pt),Mt.value&&(vt.graph.beforeChange(),vt.addInput(Mt.value[0],Mt.value[1],Mt.value[2]),vt.onNodeInputAdd&&vt.onNodeInputAdd(Mt.value),vt.setDirtyCanvas(!0,!0),vt.graph.afterChange()))}return!1},LGraphCanvas.showMenuNodeOptionalOutputs=function(rt,Tt,nt,st,vt){if(!vt)return;var _t=this,bt=LGraphCanvas.active_canvas,xt=bt.getCanvasWindow(),Tt=vt.optional_outputs;vt.onGetOutputs&&(Tt=vt.onGetOutputs());var Et=[];if(Tt)for(var wt=0;wt<Tt.length;wt++){var Ot=Tt[wt];if(!Ot){Et.push(null);continue}if(!(vt.flags&&vt.flags.skip_repeated_outputs&&vt.findOutputSlot(Ot[0])!=-1)){var It=Ot[0];Ot[2]||(Ot[2]={}),Ot[2].label&&(It=Ot[2].label),Ot[2].removable=!0;var At={content:It,value:Ot};Ot[1]==LiteGraph.EVENT&&(At.className="event"),Et.push(At)}}if(this.onMenuNodeOutputs&&(Et=this.onMenuNodeOutputs(Et)),LiteGraph.do_add_triggers_slots&&vt.findOutputSlot("onExecuted")==-1&&Et.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"}),vt.onMenuNodeOutputs){var Dt=vt.onMenuNodeOutputs(Et);Dt&&(Et=Dt)}if(!Et.length)return;new LiteGraph.ContextMenu(Et,{event:nt,callback:kt,parentMenu:st,node:vt},xt);function kt(Mt,zt,Pt){if(!!vt&&(Mt.callback&&Mt.callback.call(_t,vt,Mt,zt,Pt),!!Mt.value)){var Lt=Mt.value[1];if(Lt&&(Lt.constructor===Object||Lt.constructor===Array)){var Bt=[];for(var Gt in Lt)Bt.push({content:Gt,value:Lt[Gt]});return new LiteGraph.ContextMenu(Bt,{event:zt,callback:kt,parentMenu:st,node:vt}),!1}else vt.graph.beforeChange(),vt.addOutput(Mt.value[0],Mt.value[1],Mt.value[2]),vt.onNodeOutputAdd&&vt.onNodeOutputAdd(Mt.value),vt.setDirtyCanvas(!0,!0),vt.graph.afterChange()}}return!1},LGraphCanvas.onShowMenuNodeProperties=function(rt,it,nt,st,vt){if(!vt||!vt.properties)return;var _t=LGraphCanvas.active_canvas,bt=_t.getCanvasWindow(),xt=[];for(var Tt in vt.properties){var rt=vt.properties[Tt]!==void 0?vt.properties[Tt]:" ";typeof rt=="object"&&(rt=JSON.stringify(rt));var Et=vt.getPropertyInfo(Tt);(Et.type=="enum"||Et.type=="combo")&&(rt=LGraphCanvas.getPropertyPrintableValue(rt,Et.values)),rt=LGraphCanvas.decodeHTML(rt),xt.push({content:"<span class='property_name'>"+(Et.label?Et.label:Tt)+"</span><span class='property_value'>"+rt+"</span>",value:Tt})}if(!xt.length)return;new LiteGraph.ContextMenu(xt,{event:nt,callback:wt,parentMenu:st,allow_html:!0,node:vt},bt);function wt(Ot,It,At,Dt){if(!!vt){var kt=this.getBoundingClientRect();_t.showEditPropertyValue(vt,Ot.value,{position:[kt.left,kt.top]})}}return!1},LGraphCanvas.decodeHTML=function(rt){var it=document.createElement("div");return it.innerText=rt,it.innerHTML},LGraphCanvas.onMenuResizeNode=function(rt,it,nt,st,vt){if(!!vt){var _t=function(Tt){Tt.size=Tt.computeSize(),Tt.onResize&&Tt.onResize(Tt.size)},bt=LGraphCanvas.active_canvas;if(!bt.selected_nodes||Object.keys(bt.selected_nodes).length<=1)_t(vt);else for(var xt in bt.selected_nodes)_t(bt.selected_nodes[xt]);vt.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.showLinkMenu=function(rt,it){var nt=this,st=nt.graph.getNodeById(rt.origin_id),vt=nt.graph.getNodeById(rt.target_id),_t=!1;st&&st.outputs&&st.outputs[rt.origin_slot]&&(_t=st.outputs[rt.origin_slot].type);var bt=!1;vt&&vt.outputs&&vt.outputs[rt.target_slot]&&(bt=vt.inputs[rt.target_slot].type);var xt=["Add Node",null,"Delete",null],Tt=new LiteGraph.ContextMenu(xt,{event:it,title:rt.data!=null?rt.data.constructor.name:null,callback:Et});function Et(wt,Ot,It){switch(wt){case"Add Node":LGraphCanvas.onMenuAdd(null,null,It,Tt,function(At){!At.inputs||!At.inputs.length||!At.outputs||!At.outputs.length||st.connectByType(rt.origin_slot,At,_t)&&(At.connectByType(rt.target_slot,vt,bt),At.pos[0]-=At.size[0]*.5)});break;case"Delete":nt.graph.removeLink(rt.id);break}}return!1},LGraphCanvas.prototype.createDefaultNodeForSlot=function(it){var it=it||{},nt=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},it),st=this,vt=nt.nodeFrom&&nt.slotFrom!==null,_t=!vt&&nt.nodeTo&&nt.slotTo!==null;if(!vt&&!_t)return console.warn("No data passed to createDefaultNodeForSlot "+nt.nodeFrom+" "+nt.slotFrom+" "+nt.nodeTo+" "+nt.slotTo),!1;if(!nt.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;var bt=vt?nt.nodeFrom:nt.nodeTo,xt=vt?nt.slotFrom:nt.slotTo,Tt=!1;switch(typeof xt){case"string":Tt=vt?bt.findOutputSlot(xt,!1):bt.findInputSlot(xt,!1),xt=vt?bt.outputs[xt]:bt.inputs[xt];break;case"object":Tt=vt?bt.findOutputSlot(xt.name):bt.findInputSlot(xt.name);break;case"number":Tt=xt,xt=vt?bt.outputs[xt]:bt.inputs[xt];break;case"undefined":default:return console.warn("Cant get slot information "+xt),!1}(xt===!1||Tt===!1)&&console.warn("createDefaultNodeForSlot bad slotX "+xt+" "+Tt);var Et=xt.type==LiteGraph.EVENT?"_event_":xt.type,wt=vt?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(wt&&wt[Et]){if(xt.link,nodeNewType=!1,typeof wt[Et]=="object"||typeof wt[Et]=="array"){for(var Ot in wt[Et])if(nt.nodeType==wt[Et][Ot]||nt.nodeType=="AUTO"){nodeNewType=wt[Et][Ot];break}}else(nt.nodeType==wt[Et]||nt.nodeType=="AUTO")&&(nodeNewType=wt[Et]);if(nodeNewType){var It=!1;typeof nodeNewType=="object"&&nodeNewType.node&&(It=nodeNewType,nodeNewType=nodeNewType.node);var At=LiteGraph.createNode(nodeNewType);if(At){if(It){if(It.properties)for(var Dt in It.properties)At.addProperty(Dt,It.properties[Dt]);if(It.inputs){At.inputs=[];for(var Dt in It.inputs)At.addOutput(It.inputs[Dt][0],It.inputs[Dt][1])}if(It.outputs){At.outputs=[];for(var Dt in It.outputs)At.addOutput(It.outputs[Dt][0],It.outputs[Dt][1])}It.title&&(At.title=It.title),It.json&&At.configure(It.json)}return st.graph.add(At),At.pos=[nt.position[0]+nt.posAdd[0]+(nt.posSizeFix[0]?nt.posSizeFix[0]*At.size[0]:0),nt.position[1]+nt.posAdd[1]+(nt.posSizeFix[1]?nt.posSizeFix[1]*At.size[1]:0)],vt?nt.nodeFrom.connectByType(Tt,At,Et):nt.nodeTo.connectByTypeOutput(Tt,At,Et),!0}else console.log("failed creating "+nodeNewType)}}return!1},LGraphCanvas.prototype.showConnectionMenu=function(it){var it=it||{},nt=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},it),st=this,vt=nt.nodeFrom&&nt.slotFrom,_t=!vt&&nt.nodeTo&&nt.slotTo;if(!vt&&!_t)return console.warn("No data passed to showConnectionMenu"),!1;var bt=vt?nt.nodeFrom:nt.nodeTo,xt=vt?nt.slotFrom:nt.slotTo,Tt=!1;switch(typeof xt){case"string":Tt=vt?bt.findOutputSlot(xt,!1):bt.findInputSlot(xt,!1),xt=vt?bt.outputs[xt]:bt.inputs[xt];break;case"object":Tt=vt?bt.findOutputSlot(xt.name):bt.findInputSlot(xt.name);break;case"number":Tt=xt,xt=vt?bt.outputs[xt]:bt.inputs[xt];break;default:return console.warn("Cant get slot information "+xt),!1}var Et=["Add Node",null];st.allow_searchbox&&(Et.push("Search"),Et.push(null));var wt=xt.type==LiteGraph.EVENT?"_event_":xt.type,Ot=vt?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(Ot&&Ot[wt])if(typeof Ot[wt]=="object"||typeof Ot[wt]=="array")for(var It in Ot[wt])Et.push(Ot[wt][It]);else Et.push(Ot[wt]);var At=new LiteGraph.ContextMenu(Et,{event:nt.e,title:(xt&&xt.name!=""?xt.name+(wt?" | ":""):"")+(xt&&wt?wt:""),callback:Dt});function Dt(kt,Mt,zt){switch(kt){case"Add Node":LGraphCanvas.onMenuAdd(null,null,zt,At,function(Pt){vt?nt.nodeFrom.connectByType(Tt,Pt,wt):nt.nodeTo.connectByTypeOutput(Tt,Pt,wt)});break;case"Search":vt?st.showSearchBox(zt,{node_from:nt.nodeFrom,slot_from:xt,type_filter_in:wt}):st.showSearchBox(zt,{node_to:nt.nodeTo,slot_from:xt,type_filter_out:wt});break;default:st.createDefaultNodeForSlot(Object.assign(nt,{position:[nt.e.canvasX,nt.e.canvasY],nodeType:kt}));break}}return!1},LGraphCanvas.onShowPropertyEditor=function(rt,it,nt,st,vt){var _t=rt.property||"title",bt=vt[_t],xt=document.createElement("div");xt.is_modified=!1,xt.className="graphdialog",xt.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",xt.close=function(){xt.parentNode&&xt.parentNode.removeChild(xt)};var Tt=xt.querySelector(".name");Tt.innerText=_t;var Et=xt.querySelector(".value");Et&&(Et.value=bt,Et.addEventListener("blur",function(Lt){this.focus()}),Et.addEventListener("keydown",function(Lt){if(xt.is_modified=!0,Lt.keyCode==27)xt.close();else if(Lt.keyCode==13)zt();else if(Lt.keyCode!=13&&Lt.target.localName!="textarea")return;Lt.preventDefault(),Lt.stopPropagation()}));var wt=LGraphCanvas.active_canvas,Ot=wt.canvas,It=Ot.getBoundingClientRect(),At=-20,Dt=-20;It&&(At-=It.left,Dt-=It.top),event?(xt.style.left=event.clientX+At+"px",xt.style.top=event.clientY+Dt+"px"):(xt.style.left=Ot.width*.5+At+"px",xt.style.top=Ot.height*.5+Dt+"px");var kt=xt.querySelector("button");kt.addEventListener("click",zt),Ot.parentNode.appendChild(xt),Et&&Et.focus();var Mt=null;xt.addEventListener("mouseleave",function(Lt){LiteGraph.dialog_close_on_mouse_leave&&!xt.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(Mt=setTimeout(xt.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),xt.addEventListener("mouseenter",function(Lt){LiteGraph.dialog_close_on_mouse_leave&&Mt&&clearTimeout(Mt)});function zt(){Et&&Pt(Et.value)}function Pt(Lt){rt.type=="Number"?Lt=Number(Lt):rt.type=="Boolean"&&(Lt=Boolean(Lt)),vt[_t]=Lt,xt.parentNode&&xt.parentNode.removeChild(xt),vt.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.prompt=function(rt,it,nt,st,vt){var _t=this;rt=rt||"";var bt=document.createElement("div");bt.is_modified=!1,bt.className="graphdialog rounded",vt?bt.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":bt.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",bt.close=function(){_t.prompt_box=null,bt.parentNode&&bt.parentNode.removeChild(bt)};var xt=LGraphCanvas.active_canvas,Tt=xt.canvas;Tt.parentNode.appendChild(bt),this.ds.scale>1&&(bt.style.transform="scale("+this.ds.scale+")");var Et=null,wt=!1;LiteGraph.pointerListenerAdd(bt,"leave",function(Lt){wt||LiteGraph.dialog_close_on_mouse_leave&&!bt.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(Et=setTimeout(bt.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),LiteGraph.pointerListenerAdd(bt,"enter",function(Lt){LiteGraph.dialog_close_on_mouse_leave&&Et&&clearTimeout(Et)});var Ot=bt.querySelectorAll("select");Ot&&Ot.forEach(function(Lt){Lt.addEventListener("click",function(Bt){wt++}),Lt.addEventListener("blur",function(Bt){wt=0}),Lt.addEventListener("change",function(Bt){wt=-1})}),_t.prompt_box&&_t.prompt_box.close(),_t.prompt_box=bt;var It=bt.querySelector(".name");It.innerText=rt;var At=bt.querySelector(".value");At.value=it;var Dt=At;Dt.addEventListener("keydown",function(Lt){if(bt.is_modified=!0,Lt.keyCode==27)bt.close();else if(Lt.keyCode==13&&Lt.target.localName!="textarea")nt&&nt(this.value),bt.close();else return;Lt.preventDefault(),Lt.stopPropagation()});var kt=bt.querySelector("button");kt.addEventListener("click",function(Lt){nt&&nt(Dt.value),_t.setDirty(!0),bt.close()});var Mt=Tt.getBoundingClientRect(),zt=-20,Pt=-20;return Mt&&(zt-=Mt.left,Pt-=Mt.top),st?(bt.style.left=st.clientX+zt+"px",bt.style.top=st.clientY+Pt+"px"):(bt.style.left=Tt.width*.5+zt+"px",bt.style.top=Tt.height*.5+Pt+"px"),setTimeout(function(){Dt.focus()},10),bt},LGraphCanvas.search_limit=-1,LGraphCanvas.prototype.showSearchBox=function(rt,it){var nt={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};it=Object.assign(nt,it||{});var st=this,vt=LGraphCanvas.active_canvas,_t=vt.canvas,bt=_t.ownerDocument||document,xt=document.createElement("div");if(xt.className="litegraph litesearchbox graphdialog rounded",xt.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",it.do_type_filter&&(xt.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",xt.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),xt.innerHTML+="<div class='helper'></div>",bt.fullscreenElement?bt.fullscreenElement.appendChild(xt):(bt.body.appendChild(xt),bt.body.style.overflow="hidden"),it.do_type_filter)var Tt=xt.querySelector(".slot_in_type_filter"),Et=xt.querySelector(".slot_out_type_filter");if(xt.close=function(){st.search_box=null,this.blur(),_t.focus(),bt.body.style.overflow="",setTimeout(function(){st.canvas.focus()},20),xt.parentNode&&xt.parentNode.removeChild(xt)},this.ds.scale>1&&(xt.style.transform="scale("+this.ds.scale+")"),it.hide_on_mouse_leave){var wt=!1,Ot=null;LiteGraph.pointerListenerAdd(xt,"enter",function(li){Ot&&(clearTimeout(Ot),Ot=null)}),LiteGraph.pointerListenerAdd(xt,"leave",function(li){wt||(Ot=setTimeout(function(){xt.close()},500))}),it.do_type_filter&&(Tt.addEventListener("click",function(li){wt++}),Tt.addEventListener("blur",function(li){wt=0}),Tt.addEventListener("change",function(li){wt=-1}),Et.addEventListener("click",function(li){wt++}),Et.addEventListener("blur",function(li){wt=0}),Et.addEventListener("change",function(li){wt=-1}))}st.search_box&&st.search_box.close(),st.search_box=xt;var It=xt.querySelector(".helper"),At=null,Dt=null,kt=null,Mt=xt.querySelector("input");if(Mt&&(Mt.addEventListener("blur",function(li){st.search_box&&this.focus()}),Mt.addEventListener("keydown",function(li){if(li.keyCode==38)ei(!1);else if(li.keyCode==40)ei(!0);else if(li.keyCode==27)xt.close();else if(li.keyCode==13)ii(),kt?Jt(kt.innerHTML):At?Jt(At):xt.close();else{Dt&&clearInterval(Dt),Dt=setTimeout(ii,250);return}return li.preventDefault(),li.stopPropagation(),li.stopImmediatePropagation(),!0})),it.do_type_filter){if(Tt){var zt=LiteGraph.slot_types_in,Pt=zt.length;(it.type_filter_in==LiteGraph.EVENT||it.type_filter_in==LiteGraph.ACTION)&&(it.type_filter_in="_event_");for(var Lt=0;Lt<Pt;Lt++){var Bt=document.createElement("option");Bt.value=zt[Lt],Bt.innerHTML=zt[Lt],Tt.appendChild(Bt),it.type_filter_in!==!1&&(it.type_filter_in+"").toLowerCase()==(zt[Lt]+"").toLowerCase()&&(Bt.selected=!0)}Tt.addEventListener("change",function(){ii()})}if(Et){var zt=LiteGraph.slot_types_out,Pt=zt.length;(it.type_filter_out==LiteGraph.EVENT||it.type_filter_out==LiteGraph.ACTION)&&(it.type_filter_out="_event_");for(var Lt=0;Lt<Pt;Lt++){var Bt=document.createElement("option");Bt.value=zt[Lt],Bt.innerHTML=zt[Lt],Et.appendChild(Bt),it.type_filter_out!==!1&&(it.type_filter_out+"").toLowerCase()==(zt[Lt]+"").toLowerCase()&&(Bt.selected=!0)}Et.addEventListener("change",function(){ii()})}}var Gt=_t.getBoundingClientRect(),Ut=(rt?rt.clientX:Gt.left+Gt.width*.5)-80,Zt=(rt?rt.clientY:Gt.top+Gt.height*.5)-20;xt.style.left=Ut+"px",xt.style.top=Zt+"px",rt.layerY>Gt.height-200&&(It.style.maxHeight=Gt.height-rt.layerY-20+"px"),Mt.focus(),it.show_all_on_open&&ii();function Jt(li){if(li)if(st.onSearchBoxSelection)st.onSearchBoxSelection(li,rt,vt);else{var pi=LiteGraph.searchbox_extras[li.toLowerCase()];pi&&(li=pi.type),vt.graph.beforeChange();var ci=LiteGraph.createNode(li);if(ci&&(ci.pos=vt.convertEventToCanvasOffset(rt),vt.graph.add(ci,!1)),pi&&pi.data){if(pi.data.properties)for(var Wt in pi.data.properties)ci.addProperty(Wt,pi.data.properties[Wt]);if(pi.data.inputs){ci.inputs=[];for(var Wt in pi.data.inputs)ci.addOutput(pi.data.inputs[Wt][0],pi.data.inputs[Wt][1])}if(pi.data.outputs){ci.outputs=[];for(var Wt in pi.data.outputs)ci.addOutput(pi.data.outputs[Wt][0],pi.data.outputs[Wt][1])}pi.data.title&&(ci.title=pi.data.title),pi.data.json&&ci.configure(pi.data.json)}if(it.node_from){var $t=!1;switch(typeof it.slot_from){case"string":$t=it.node_from.findOutputSlot(it.slot_from);break;case"object":it.slot_from.name?$t=it.node_from.findOutputSlot(it.slot_from.name):$t=-1,$t==-1&&typeof it.slot_from.slot_index<"u"&&($t=it.slot_from.slot_index);break;case"number":$t=it.slot_from;break;default:$t=0}typeof it.node_from.outputs[$t]<"u"&&$t!==!1&&$t>-1&&it.node_from.connectByType($t,ci,it.node_from.outputs[$t].type)}if(it.node_to){var $t=!1;switch(typeof it.slot_from){case"string":$t=it.node_to.findInputSlot(it.slot_from);break;case"object":it.slot_from.name?$t=it.node_to.findInputSlot(it.slot_from.name):$t=-1,$t==-1&&typeof it.slot_from.slot_index<"u"&&($t=it.slot_from.slot_index);break;case"number":$t=it.slot_from;break;default:$t=0}typeof it.node_to.inputs[$t]<"u"&&$t!==!1&&$t>-1&&it.node_to.connectByTypeOutput($t,ci,it.node_to.inputs[$t].type)}vt.graph.afterChange()}xt.close()}function ei(li){var pi=kt;kt&&kt.classList.remove("selected"),kt?(kt=li?kt.nextSibling:kt.previousSibling,kt||(kt=pi)):kt=li?It.childNodes[0]:It.childNodes[It.childNodes.length],kt&&(kt.classList.add("selected"),kt.scrollIntoView({block:"end",behavior:"smooth"}))}function ii(){Dt=null;var li=Mt.value;if(At=null,It.innerHTML="",!li&&!it.show_all_if_empty)return;if(st.onSearchBox){var pi=st.onSearchBox(It,li,vt);if(pi)for(var ci=0;ci<pi.length;++ci)oi(pi[ci])}else{let fi=function(bi,di){var di=di||{},Nt={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},Ft=Object.assign(Nt,di),Xt=LiteGraph.registered_node_types[bi];if($t&&Xt.filter!=$t||(!it.show_all_if_empty||li)&&bi.toLowerCase().indexOf(li)===-1)return!1;if(it.do_type_filter&&!Ft.skipFilter){var Qt=bi,si=Rt.value;if(Ft.inTypeOverride!==!1&&(si=Ft.inTypeOverride),Rt&&si&&LiteGraph.registered_slot_in_types[si]&&LiteGraph.registered_slot_in_types[si].nodes){var ti=LiteGraph.registered_slot_in_types[si].nodes.includes(Qt);if(ti===!1)return!1}var si=Yt.value;if(Ft.outTypeOverride!==!1&&(si=Ft.outTypeOverride),Yt&&si&&LiteGraph.registered_slot_out_types[si]&&LiteGraph.registered_slot_out_types[si].nodes){var ti=LiteGraph.registered_slot_out_types[si].nodes.includes(Qt);if(ti===!1)return!1}}return!0};var Wt=0;li=li.toLowerCase();var $t=vt.filter||vt.graph.filter;if(it.do_type_filter&&st.search_box)var Rt=st.search_box.querySelector(".slot_in_type_filter"),Yt=st.search_box.querySelector(".slot_out_type_filter");else var Rt=!1,Yt=!1;for(var ci in LiteGraph.searchbox_extras){var Ht=LiteGraph.searchbox_extras[ci];if(!((!it.show_all_if_empty||li)&&Ht.desc.toLowerCase().indexOf(li)===-1)){var jt=LiteGraph.registered_node_types[Ht.type];if(!(jt&&jt.filter!=$t)&&!!fi(Ht.type)&&(oi(Ht.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&Wt++>LGraphCanvas.search_limit))break}}var qt=null;if(Array.prototype.filter)var ri=Object.keys(LiteGraph.registered_node_types),qt=ri.filter(fi);else{qt=[];for(var ci in LiteGraph.registered_node_types)fi(ci)&&qt.push(ci)}for(var ci=0;ci<qt.length&&(oi(qt[ci]),!(LGraphCanvas.search_limit!==-1&&Wt++>LGraphCanvas.search_limit));ci++);if(it.show_general_after_typefiltered&&(Rt.value||Yt.value)){filtered_extra=[];for(var ci in LiteGraph.registered_node_types)fi(ci,{inTypeOverride:Rt&&Rt.value?"*":!1,outTypeOverride:Yt&&Yt.value?"*":!1})&&filtered_extra.push(ci);for(var ci=0;ci<filtered_extra.length&&(oi(filtered_extra[ci],"generic_type"),!(LGraphCanvas.search_limit!==-1&&Wt++>LGraphCanvas.search_limit));ci++);}if((Rt.value||Yt.value)&&It.childNodes.length==0&&it.show_general_if_none_on_typefilter){filtered_extra=[];for(var ci in LiteGraph.registered_node_types)fi(ci,{skipFilter:!0})&&filtered_extra.push(ci);for(var ci=0;ci<filtered_extra.length&&(oi(filtered_extra[ci],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&Wt++>LGraphCanvas.search_limit));ci++);}}function oi(fi,bi){var ai=document.createElement("div");At||(At=fi),ai.innerText=fi,ai.dataset.type=escape(fi),ai.className="litegraph lite-search-item",bi&&(ai.className+=" "+bi),ai.addEventListener("click",function(di){Jt(unescape(this.dataset.type))}),It.appendChild(ai)}}return xt},LGraphCanvas.prototype.showEditPropertyValue=function(rt,it,nt){if(!rt||rt.properties[it]===void 0)return;nt=nt||{};var st=rt.getPropertyInfo(it),vt=st.type,_t="";if(vt=="string"||vt=="number"||vt=="array"||vt=="object")_t="<input autofocus type='text' class='value'/>";else if((vt=="enum"||vt=="combo")&&st.values){_t="<select autofocus type='text' class='value'>";for(var bt in st.values){var xt=bt;st.values.constructor===Array&&(xt=st.values[bt]),_t+="<option value='"+xt+"' "+(xt==rt.properties[it]?"selected":"")+">"+st.values[bt]+"</option>"}_t+="</select>"}else if(vt=="boolean"||vt=="toggle")_t="<input autofocus type='checkbox' class='value' "+(rt.properties[it]?"checked":"")+"/>";else{console.warn("unknown type: "+vt);return}var Tt=this.createDialog("<span class='name'>"+(st.label?st.label:it)+"</span>"+_t+"<button>OK</button>",nt),Et=!1;if((vt=="enum"||vt=="combo")&&st.values)Et=Tt.querySelector("select"),Et.addEventListener("change",function(At){Tt.modified(),It(At.target.value)});else if(vt=="boolean"||vt=="toggle")Et=Tt.querySelector("input"),Et&&Et.addEventListener("click",function(At){Tt.modified(),It(!!Et.checked)});else if(Et=Tt.querySelector("input"),Et){Et.addEventListener("blur",function(Dt){this.focus()});var xt=rt.properties[it]!==void 0?rt.properties[it]:"";vt!=="string"&&(xt=JSON.stringify(xt)),Et.value=xt,Et.addEventListener("keydown",function(Dt){if(Dt.keyCode==27)Tt.close();else if(Dt.keyCode==13)Ot();else if(Dt.keyCode!=13){Tt.modified();return}Dt.preventDefault(),Dt.stopPropagation()})}Et&&Et.focus();var wt=Tt.querySelector("button");wt.addEventListener("click",Ot);function Ot(){It(Et.value)}function It(At){st&&st.values&&st.values.constructor===Object&&st.values[At]!=null&&(At=st.values[At]),typeof rt.properties[it]=="number"&&(At=Number(At)),(vt=="array"||vt=="object")&&(At=JSON.parse(At)),rt.properties[it]=At,rt.graph&&rt.graph._version++,rt.onPropertyChanged&&rt.onPropertyChanged(it,At),nt.onclose&&nt.onclose(),Tt.close(),rt.setDirtyCanvas(!0,!0)}return Tt},LGraphCanvas.prototype.createDialog=function(rt,it){var nt={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};it=Object.assign(nt,it||{});var st=document.createElement("div");st.className="graphdialog",st.innerHTML=rt,st.is_modified=!1;var vt=this.canvas.getBoundingClientRect(),_t=-20,bt=-20;if(vt&&(_t-=vt.left,bt-=vt.top),it.position?(_t+=it.position[0],bt+=it.position[1]):it.event?(_t+=it.event.clientX,bt+=it.event.clientY):(_t+=this.canvas.width*.5,bt+=this.canvas.height*.5),st.style.left=_t+"px",st.style.top=bt+"px",this.canvas.parentNode.appendChild(st),it.checkForInput){var xt=[],Tt=!1;(xt=st.querySelectorAll("input"))&&xt.forEach(function(It){It.addEventListener("keydown",function(At){if(st.modified(),At.keyCode==27)st.close();else if(At.keyCode!=13)return;At.preventDefault(),At.stopPropagation()}),Tt||It.focus()})}st.modified=function(){st.is_modified=!0},st.close=function(){st.parentNode&&st.parentNode.removeChild(st)};var Et=null,wt=!1;st.addEventListener("mouseleave",function(It){wt||(it.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!st.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(Et=setTimeout(st.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),st.addEventListener("mouseenter",function(It){(it.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&Et&&clearTimeout(Et)});var Ot=st.querySelectorAll("select");return Ot&&Ot.forEach(function(It){It.addEventListener("click",function(At){wt++}),It.addEventListener("blur",function(At){wt=0}),It.addEventListener("change",function(At){wt=-1})}),st},LGraphCanvas.prototype.createPanel=function(rt,it){it=it||{};var nt=it.window||window,st=document.createElement("div");if(st.className="litegraph dialog",st.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",st.header=st.querySelector(".dialog-header"),it.width&&(st.style.width=it.width+(it.width.constructor===Number?"px":"")),it.height&&(st.style.height=it.height+(it.height.constructor===Number?"px":"")),it.closable){var vt=document.createElement("span");vt.innerHTML="&#10005;",vt.classList.add("close"),vt.addEventListener("click",function(){st.close()}),st.header.appendChild(vt)}return st.title_element=st.querySelector(".dialog-title"),st.title_element.innerText=rt,st.content=st.querySelector(".dialog-content"),st.alt_content=st.querySelector(".dialog-alt-content"),st.footer=st.querySelector(".dialog-footer"),st.close=function(){st.onClose&&typeof st.onClose=="function"&&st.onClose(),st.parentNode&&st.parentNode.removeChild(st),this.parentNode&&this.parentNode.removeChild(this)},st.toggleAltContent=function(_t){if(typeof _t<"u")var bt=_t?"block":"none",xt=_t?"none":"block";else var bt=st.alt_content.style.display!="block"?"block":"none",xt=st.alt_content.style.display!="block"?"none":"block";st.alt_content.style.display=bt,st.content.style.display=xt},st.toggleFooterVisibility=function(_t){if(typeof _t<"u")var bt=_t?"block":"none";else var bt=st.footer.style.display!="block"?"block":"none";st.footer.style.display=bt},st.clear=function(){this.content.innerHTML=""},st.addHTML=function(_t,bt,xt){var Tt=document.createElement("div");return bt&&(Tt.className=bt),Tt.innerHTML=_t,xt?st.footer.appendChild(Tt):st.content.appendChild(Tt),Tt},st.addButton=function(_t,bt,xt){var Tt=document.createElement("button");return Tt.innerText=_t,Tt.options=xt,Tt.classList.add("btn"),Tt.addEventListener("click",bt),st.footer.appendChild(Tt),Tt},st.addSeparator=function(){var _t=document.createElement("div");_t.className="separator",st.content.appendChild(_t)},st.addWidget=function(_t,bt,xt,Tt,Et){Tt=Tt||{};var wt=String(xt);_t=_t.toLowerCase(),_t=="number"&&(wt=xt.toFixed(3));var Ot=document.createElement("div");Ot.className="property",Ot.innerHTML="<span class='property_name'></span><span class='property_value'></span>",Ot.querySelector(".property_name").innerText=Tt.label||bt;var It=Ot.querySelector(".property_value");if(It.innerText=wt,Ot.dataset.property=bt,Ot.dataset.type=Tt.type||_t,Ot.options=Tt,Ot.value=xt,_t=="code")Ot.addEventListener("click",function(Dt){st.inner_showCodePad(this.dataset.property)});else if(_t=="boolean")Ot.classList.add("boolean"),xt&&Ot.classList.add("bool-on"),Ot.addEventListener("click",function(){var Dt=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",At(Dt,this.value)});else if(_t=="string"||_t=="number")It.setAttribute("contenteditable",!0),It.addEventListener("keydown",function(Dt){Dt.code=="Enter"&&(_t!="string"||!Dt.shiftKey)&&(Dt.preventDefault(),this.blur())}),It.addEventListener("blur",function(){var Dt=this.innerText,kt=this.parentNode.dataset.property,Mt=this.parentNode.dataset.type;Mt=="number"&&(Dt=Number(Dt)),At(kt,Dt)});else if(_t=="enum"||_t=="combo"){var wt=LGraphCanvas.getPropertyPrintableValue(xt,Tt.values);It.innerText=wt,It.addEventListener("click",function(kt){var Mt=Tt.values||[],zt=this.parentNode.dataset.property,Pt=this;new LiteGraph.ContextMenu(Mt,{event:kt,className:"dark",callback:Lt},nt);function Lt(Bt,Gt,Ut){return Pt.innerText=Bt,At(zt,Bt),!1}})}st.content.appendChild(Ot);function At(Dt,kt){Tt.callback&&Tt.callback(Dt,kt,Tt),Et&&Et(Dt,kt,Tt)}return Ot},st.onOpen&&typeof st.onOpen=="function"&&st.onOpen(),st},LGraphCanvas.getPropertyPrintableValue=function(rt,it){if(!it||it.constructor===Array)return String(rt);if(it.constructor===Object){var nt="";for(var st in it)if(it[st]==rt){nt=st;break}return String(rt)+" ("+nt+")"}},LGraphCanvas.prototype.closePanels=function(){var rt=document.querySelector("#node-panel");rt&&rt.close();var rt=document.querySelector("#option-panel");rt&&rt.close()},LGraphCanvas.prototype.showShowGraphOptionsPanel=function(rt,it,nt,st){if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!it||!it.event||!it.event.target||!it.event.target.lgraphcanvas){console.warn("Canvas not found");return}var vt=it.event.target.lgraphcanvas}else var vt=this;vt.closePanels();var _t=vt.getCanvasWindow();panel=vt.createPanel("Options",{closable:!0,window:_t,onOpen:function(){vt.OPTIONPANEL_IS_OPEN=!0},onClose:function(){vt.OPTIONPANEL_IS_OPEN=!1,vt.options_panel=null}}),vt.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function bt(){panel.content.innerHTML="";var xt=function(Ot,It,At){switch(Ot){default:At&&At.key&&(Ot=At.key),At.values&&(It=Object.values(At.values).indexOf(It)),vt[Ot]=It;break}},Tt=LiteGraph.availableCanvasOptions;Tt.sort();for(var Et in Tt){var wt=Tt[Et];panel.addWidget("boolean",wt,vt[wt],{key:wt,on:"True",off:"False"},xt)}vt.links_render_mode,panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[vt.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},xt),panel.addSeparator(),panel.footer.innerHTML=""}bt(),vt.canvas.parentNode.appendChild(panel)},LGraphCanvas.prototype.showShowNodePanel=function(rt){this.SELECTED_NODE=rt,this.closePanels();var it=this.getCanvasWindow(),nt=this,st=this.createPanel(rt.title||"",{closable:!0,window:it,onOpen:function(){nt.NODEPANEL_IS_OPEN=!0},onClose:function(){nt.NODEPANEL_IS_OPEN=!1,nt.node_panel=null}});nt.node_panel=st,st.id="node-panel",st.node=rt,st.classList.add("settings");function vt(){st.content.innerHTML="",st.addHTML("<span class='node_type'>"+rt.type+"</span><span class='node_desc'>"+(rt.constructor.desc||"")+"</span><span class='separator'></span>"),st.addHTML("<h3>Properties</h3>");var _t=function(wt,Ot){switch(nt.graph.beforeChange(rt),wt){case"Title":rt.title=Ot;break;case"Mode":var It=Object.values(LiteGraph.NODE_MODES).indexOf(Ot);It>=0&&LiteGraph.NODE_MODES[It]?rt.changeMode(It):console.warn("unexpected mode: "+Ot);break;case"Color":LGraphCanvas.node_colors[Ot]?(rt.color=LGraphCanvas.node_colors[Ot].color,rt.bgcolor=LGraphCanvas.node_colors[Ot].bgcolor):console.warn("unexpected color: "+Ot);break;default:rt.setProperty(wt,Ot);break}nt.graph.afterChange(),nt.dirty_canvas=!0};st.addWidget("string","Title",rt.title,{},_t),st.addWidget("combo","Mode",LiteGraph.NODE_MODES[rt.mode],{values:LiteGraph.NODE_MODES},_t);var bt="";rt.color!==void 0&&(bt=Object.keys(LGraphCanvas.node_colors).filter(function(wt){return LGraphCanvas.node_colors[wt].color==rt.color})),st.addWidget("combo","Color",bt,{values:Object.keys(LGraphCanvas.node_colors)},_t);for(var xt in rt.properties){var Tt=rt.properties[xt],Et=rt.getPropertyInfo(xt);Et.type,!(rt.onAddPropertyToPanel&&rt.onAddPropertyToPanel(xt,st))&&st.addWidget(Et.widget||Et.type,xt,Tt,Et,_t)}st.addSeparator(),rt.onShowCustomPanelInfo&&rt.onShowCustomPanelInfo(st),st.footer.innerHTML="",st.addButton("Delete",function(){rt.block_delete||(rt.graph.remove(rt),st.close())}).classList.add("delete")}st.inner_showCodePad=function(_t){st.classList.remove("settings"),st.classList.add("centered"),st.alt_content.innerHTML="<textarea class='code'></textarea>";var bt=st.alt_content.querySelector("textarea"),xt=function(){st.toggleAltContent(!1),st.toggleFooterVisibility(!0),bt.parentNode.removeChild(bt),st.classList.add("settings"),st.classList.remove("centered"),vt()};bt.value=rt.properties[_t],bt.addEventListener("keydown",function(wt){wt.code=="Enter"&&wt.ctrlKey&&(rt.setProperty(_t,bt.value),xt())}),st.toggleAltContent(!0),st.toggleFooterVisibility(!1),bt.style.height="calc(100% - 40px)";var Tt=st.addButton("Assign",function(){rt.setProperty(_t,bt.value),xt()});st.alt_content.appendChild(Tt);var Et=st.addButton("Close",xt);Et.style.float="right",st.alt_content.appendChild(Et)},vt(),this.canvas.parentNode.appendChild(st)},LGraphCanvas.prototype.showSubgraphPropertiesDialog=function(rt){console.log("showing subgraph properties dialog");var it=this.canvas.parentNode.querySelector(".subgraph_dialog");it&&it.close();var nt=this.createPanel("Subgraph Inputs",{closable:!0,width:500});nt.node=rt,nt.classList.add("subgraph_dialog");function st(){if(nt.clear(),rt.inputs)for(var bt=0;bt<rt.inputs.length;++bt){var xt=rt.inputs[bt];if(!xt.not_subgraph_input){var Tt="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",Et=nt.addHTML(Tt,"subgraph_property");Et.dataset.name=xt.name,Et.dataset.slot=bt,Et.querySelector(".name").innerText=xt.name,Et.querySelector(".type").innerText=xt.type,Et.querySelector("button").addEventListener("click",function(wt){rt.removeInput(Number(this.parentNode.dataset.slot)),st()})}}}var vt=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",_t=nt.addHTML(vt,"subgraph_property extra",!0);return _t.querySelector("button").addEventListener("click",function(bt){var xt=this.parentNode,Tt=xt.querySelector(".name").value,Et=xt.querySelector(".type").value;!Tt||rt.findInputSlot(Tt)!=-1||(rt.addInput(Tt,Et),xt.querySelector(".name").value="",xt.querySelector(".type").value="",st())}),st(),this.canvas.parentNode.appendChild(nt),nt},LGraphCanvas.prototype.showSubgraphPropertiesDialogRight=function(rt){var it=this.canvas.parentNode.querySelector(".subgraph_dialog");it&&it.close();var nt=this.createPanel("Subgraph Outputs",{closable:!0,width:500});nt.node=rt,nt.classList.add("subgraph_dialog");function st(){if(nt.clear(),rt.outputs)for(var xt=0;xt<rt.outputs.length;++xt){var Tt=rt.outputs[xt];if(!Tt.not_subgraph_output){var Et="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",wt=nt.addHTML(Et,"subgraph_property");wt.dataset.name=Tt.name,wt.dataset.slot=xt,wt.querySelector(".name").innerText=Tt.name,wt.querySelector(".type").innerText=Tt.type,wt.querySelector("button").addEventListener("click",function(Ot){rt.removeOutput(Number(this.parentNode.dataset.slot)),st()})}}}var vt=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",_t=nt.addHTML(vt,"subgraph_property extra",!0);_t.querySelector(".name").addEventListener("keydown",function(xt){xt.keyCode==13&&bt.apply(this)}),_t.querySelector("button").addEventListener("click",function(xt){bt.apply(this)});function bt(){var xt=this.parentNode,Tt=xt.querySelector(".name").value,Et=xt.querySelector(".type").value;!Tt||rt.findOutputSlot(Tt)!=-1||(rt.addOutput(Tt,Et),xt.querySelector(".name").value="",xt.querySelector(".type").value="",st())}return st(),this.canvas.parentNode.appendChild(nt),nt},LGraphCanvas.prototype.checkPanels=function(){if(!!this.canvas)for(var rt=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),it=0;it<rt.length;++it){var nt=rt[it];!nt.node||(!nt.node.graph||nt.graph!=this.graph)&&nt.close()}},LGraphCanvas.onMenuNodeCollapse=function(rt,it,nt,st,vt){vt.graph.beforeChange();var _t=function(Tt){Tt.collapse()},bt=LGraphCanvas.active_canvas;if(!bt.selected_nodes||Object.keys(bt.selected_nodes).length<=1)_t(vt);else for(var xt in bt.selected_nodes)_t(bt.selected_nodes[xt]);vt.graph.afterChange()},LGraphCanvas.onMenuNodePin=function(rt,it,nt,st,vt){vt.pin()},LGraphCanvas.onMenuNodeMode=function(rt,it,nt,st,vt){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:nt,callback:_t,parentMenu:st,node:vt});function _t(bt){if(!!vt){var xt=Object.values(LiteGraph.NODE_MODES).indexOf(bt),Tt=function(Ot){xt>=0&&LiteGraph.NODE_MODES[xt]?Ot.changeMode(xt):(console.warn("unexpected mode: "+bt),Ot.changeMode(LiteGraph.ALWAYS))},Et=LGraphCanvas.active_canvas;if(!Et.selected_nodes||Object.keys(Et.selected_nodes).length<=1)Tt(vt);else for(var wt in Et.selected_nodes)Tt(Et.selected_nodes[wt])}}return!1},LGraphCanvas.onMenuNodeColors=function(rt,it,nt,st,vt){if(!vt)throw"no node for color";var _t=[];_t.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(var bt in LGraphCanvas.node_colors){var xt=LGraphCanvas.node_colors[bt],rt={value:bt,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+xt.color+"; background-color:"+xt.bgcolor+"'>"+bt+"</span>"};_t.push(rt)}new LiteGraph.ContextMenu(_t,{event:nt,callback:Tt,parentMenu:st,node:vt});function Tt(Et){if(!!vt){var wt=Et.value?LGraphCanvas.node_colors[Et.value]:null,Ot=function(Dt){wt?Dt.constructor===LiteGraph.LGraphGroup?Dt.color=wt.groupcolor:(Dt.color=wt.color,Dt.bgcolor=wt.bgcolor):(delete Dt.color,delete Dt.bgcolor)},It=LGraphCanvas.active_canvas;if(!It.selected_nodes||Object.keys(It.selected_nodes).length<=1)Ot(vt);else for(var At in It.selected_nodes)Ot(It.selected_nodes[At]);vt.setDirtyCanvas(!0,!0)}}return!1},LGraphCanvas.onMenuNodeShapes=function(rt,it,nt,st,vt){if(!vt)throw"no node passed";new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:nt,callback:_t,parentMenu:st,node:vt});function _t(bt){if(!!vt){vt.graph.beforeChange();var xt=function(wt){wt.shape=bt},Tt=LGraphCanvas.active_canvas;if(!Tt.selected_nodes||Object.keys(Tt.selected_nodes).length<=1)xt(vt);else for(var Et in Tt.selected_nodes)xt(Tt.selected_nodes[Et]);vt.graph.afterChange(),vt.setDirtyCanvas(!0)}}return!1},LGraphCanvas.onMenuNodeRemove=function(rt,it,nt,st,vt){if(!vt)throw"no node passed";var _t=vt.graph;_t.beforeChange();var bt=function(Et){Et.removable!==!1&&_t.remove(Et)},xt=LGraphCanvas.active_canvas;if(!xt.selected_nodes||Object.keys(xt.selected_nodes).length<=1)bt(vt);else for(var Tt in xt.selected_nodes)bt(xt.selected_nodes[Tt]);_t.afterChange(),vt.setDirtyCanvas(!0,!0)},LGraphCanvas.onMenuNodeToSubgraph=function(rt,it,nt,st,vt){var _t=vt.graph,bt=LGraphCanvas.active_canvas;if(!!bt){var xt=Object.values(bt.selected_nodes||{});xt.length||(xt=[vt]);var Tt=LiteGraph.createNode("graph/subgraph");Tt.pos=vt.pos.concat(),_t.add(Tt),Tt.buildFromNodes(xt),bt.deselectAllNodes(),vt.setDirtyCanvas(!0,!0)}},LGraphCanvas.onMenuNodeClone=function(rt,it,nt,st,vt){vt.graph.beforeChange();var _t={},bt=function(Et){if(Et.clonable!==!1){var wt=Et.clone();!wt||(wt.pos=[Et.pos[0]+5,Et.pos[1]+5],Et.graph.add(wt),_t[wt.id]=wt)}},xt=LGraphCanvas.active_canvas;if(!xt.selected_nodes||Object.keys(xt.selected_nodes).length<=1)bt(vt);else for(var Tt in xt.selected_nodes)bt(xt.selected_nodes[Tt]);Object.keys(_t).length&&xt.selectNodes(_t),vt.graph.afterChange(),vt.setDirtyCanvas(!0,!0)},LGraphCanvas.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},LGraphCanvas.prototype.getCanvasMenuOptions=function(){var rt=null;if(this.getMenuOptions?rt=this.getMenuOptions():(rt=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],Object.keys(this.selected_nodes).length>1&&rt.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&rt.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var it=this.getExtraMenuOptions(this,rt);it&&(rt=rt.concat(it))}return rt},LGraphCanvas.prototype.getNodeMenuOptions=function(rt){var it=null;if(rt.getMenuOptions?it=rt.getMenuOptions(this):(it=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],rt.resizable!==!1&&it.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),it.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),rt.onGetInputs){var nt=rt.onGetInputs();nt&&nt.length&&(it[0].disabled=!1)}if(rt.onGetOutputs){var st=rt.onGetOutputs();st&&st.length&&(it[1].disabled=!1)}if(rt.getExtraMenuOptions){var vt=rt.getExtraMenuOptions(this,it);vt&&(vt.push(null),it=vt.concat(it))}return rt.clonable!==!1&&it.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&it.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),it.push(null,{content:"Remove",disabled:!(rt.removable!==!1&&!rt.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),rt.graph&&rt.graph.onGetNodeMenuOptions&&rt.graph.onGetNodeMenuOptions(it,rt),it},LGraphCanvas.prototype.getGroupMenuOptions=function(rt){var it=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return it},LGraphCanvas.prototype.processContextMenu=function(rt,it){var nt=this,st=LGraphCanvas.active_canvas,vt=st.getCanvasWindow(),_t=null,bt={event:it,callback:wt,extra:rt};rt&&(bt.title=rt.type);var xt=null;if(rt&&(xt=rt.getSlotInPosition(it.canvasX,it.canvasY),LGraphCanvas.active_node=rt),xt){if(_t=[],rt.getSlotMenuOptions)_t=rt.getSlotMenuOptions(xt);else{xt&&xt.output&&xt.output.links&&xt.output.links.length&&_t.push({content:"Disconnect Links",slot:xt});var Tt=xt.input||xt.output;Tt.removable&&_t.push(Tt.locked?"Cannot remove":{content:"Remove Slot",slot:xt}),Tt.nameLocked||_t.push({content:"Rename Slot",slot:xt})}bt.title=(xt.input?xt.input.type:xt.output.type)||"*",xt.input&&xt.input.type==LiteGraph.ACTION&&(bt.title="Action"),xt.output&&xt.output.type==LiteGraph.EVENT&&(bt.title="Event")}else if(rt)_t=this.getNodeMenuOptions(rt);else{_t=this.getCanvasMenuOptions();var Et=this.graph.getGroupOnPos(it.canvasX,it.canvasY);Et&&_t.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:Et,options:this.getGroupMenuOptions(Et)}})}if(!_t)return;new LiteGraph.ContextMenu(_t,bt,vt);function wt(Ot,It,At){if(!!Ot){if(Ot.content=="Remove Slot"){var Dt=Ot.slot;rt.graph.beforeChange(),Dt.input?rt.removeInput(Dt.slot):Dt.output&&rt.removeOutput(Dt.slot),rt.graph.afterChange();return}else if(Ot.content=="Disconnect Links"){var Dt=Ot.slot;rt.graph.beforeChange(),Dt.output?rt.disconnectOutput(Dt.slot):Dt.input&&rt.disconnectInput(Dt.slot),rt.graph.afterChange();return}else if(Ot.content=="Rename Slot"){var Dt=Ot.slot,kt=Dt.input?rt.getInputInfo(Dt.slot):rt.getOutputInfo(Dt.slot),Mt=nt.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",It),zt=Mt.querySelector("input");zt&&kt&&(zt.value=kt.label||"");var Pt=function(){rt.graph.beforeChange(),zt.value&&(kt&&(kt.label=zt.value),nt.setDirty(!0)),Mt.close(),rt.graph.afterChange()};Mt.querySelector("button").addEventListener("click",Pt),zt.addEventListener("keydown",function(Bt){if(Mt.is_modified=!0,Bt.keyCode==27)Mt.close();else if(Bt.keyCode==13)Pt();else if(Bt.keyCode!=13&&Bt.target.localName!="textarea")return;Bt.preventDefault(),Bt.stopPropagation()}),zt.focus()}}}};function compareObjects(rt,it){for(var nt in rt)if(rt[nt]!=it[nt])return!1;return!0}LiteGraph.compareObjects=compareObjects;function distance(rt,it){return Math.sqrt((it[0]-rt[0])*(it[0]-rt[0])+(it[1]-rt[1])*(it[1]-rt[1]))}LiteGraph.distance=distance;function colorToString(rt){return"rgba("+Math.round(rt[0]*255).toFixed()+","+Math.round(rt[1]*255).toFixed()+","+Math.round(rt[2]*255).toFixed()+","+(rt.length==4?rt[3].toFixed(2):"1.0")+")"}LiteGraph.colorToString=colorToString;function isInsideRectangle(rt,it,nt,st,vt,_t){return nt<rt&&nt+vt>rt&&st<it&&st+_t>it}LiteGraph.isInsideRectangle=isInsideRectangle;function growBounding(rt,it,nt){it<rt[0]?rt[0]=it:it>rt[2]&&(rt[2]=it),nt<rt[1]?rt[1]=nt:nt>rt[3]&&(rt[3]=nt)}LiteGraph.growBounding=growBounding;function isInsideBounding(rt,it){return!(rt[0]<it[0][0]||rt[1]<it[0][1]||rt[0]>it[1][0]||rt[1]>it[1][1])}LiteGraph.isInsideBounding=isInsideBounding;function overlapBounding(rt,it){var nt=rt[0]+rt[2],st=rt[1]+rt[3],vt=it[0]+it[2],_t=it[1]+it[3];return!(rt[0]>vt||rt[1]>_t||nt<it[0]||st<it[1])}LiteGraph.overlapBounding=overlapBounding;function hex2num(rt){rt.charAt(0)=="#"&&(rt=rt.slice(1)),rt=rt.toUpperCase();for(var it="0123456789ABCDEF",nt=new Array(3),st=0,vt,_t,bt=0;bt<6;bt+=2)vt=it.indexOf(rt.charAt(bt)),_t=it.indexOf(rt.charAt(bt+1)),nt[st]=vt*16+_t,st++;return nt}LiteGraph.hex2num=hex2num;function num2hex(rt){for(var it="0123456789ABCDEF",nt="#",st,vt,_t=0;_t<3;_t++)st=rt[_t]/16,vt=rt[_t]%16,nt+=it.charAt(st)+it.charAt(vt);return nt}LiteGraph.num2hex=num2hex;function ContextMenu(rt,it){it=it||{},this.options=it;var nt=this;it.parentMenu&&(it.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),it.parentMenu=null):(this.parentMenu=it.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var st=null;it.event&&(st=it.event.constructor.name),st!=="MouseEvent"&&st!=="CustomEvent"&&st!=="PointerEvent"&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. ("+st+")"),it.event=null);var vt=document.createElement("div");vt.className="litegraph litecontextmenu litemenubar-panel",it.className&&(vt.className+=" "+it.className),vt.style.minWidth=100,vt.style.minHeight=100,vt.style.pointerEvents="none",setTimeout(function(){vt.style.pointerEvents="auto"},100),LiteGraph.pointerListenerAdd(vt,"up",function(Mt){return Mt.preventDefault(),!0},!0),vt.addEventListener("contextmenu",function(Mt){return Mt.button!=2||Mt.preventDefault(),!1},!0),LiteGraph.pointerListenerAdd(vt,"down",function(Mt){if(Mt.button==2)return nt.close(),Mt.preventDefault(),!0},!0);function _t(Mt){var zt=parseInt(vt.style.top);return vt.style.top=(zt+Mt.deltaY*it.scroll_speed).toFixed()+"px",Mt.preventDefault(),!0}if(it.scroll_speed||(it.scroll_speed=.1),vt.addEventListener("wheel",_t,!0),vt.addEventListener("mousewheel",_t,!0),this.root=vt,it.title){var bt=document.createElement("div");bt.className="litemenu-title",bt.innerHTML=it.title,vt.appendChild(bt)}for(var xt=0;xt<rt.length;xt++){var Tt=rt.constructor==Array?rt[xt]:xt;Tt!=null&&Tt.constructor!==String&&(Tt=Tt.content===void 0?String(Tt):Tt.content);var Et=rt[xt];this.addItem(Tt,Et,it)}LiteGraph.pointerListenerAdd(vt,"enter",function(Mt){vt.closing_timer&&clearTimeout(vt.closing_timer)});var wt=document;it.event&&(wt=it.event.target.ownerDocument),wt||(wt=document),wt.fullscreenElement?wt.fullscreenElement.appendChild(vt):wt.body.appendChild(vt);var Ot=it.left||0,It=it.top||0;if(it.event){if(Ot=it.event.clientX-10,It=it.event.clientY-10,it.title&&(It-=20),it.parentMenu){var At=it.parentMenu.root.getBoundingClientRect();Ot=At.left+At.width}var Dt=document.body.getBoundingClientRect(),kt=vt.getBoundingClientRect();Dt.height==0&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),Dt.width&&Ot>Dt.width-kt.width-10&&(Ot=Dt.width-kt.width-10),Dt.height&&It>Dt.height-kt.height-10&&(It=Dt.height-kt.height-10)}vt.style.left=Ot+"px",vt.style.top=It+"px",it.scale&&(vt.style.transform="scale("+it.scale+")")}ContextMenu.prototype.addItem=function(rt,it,nt){var st=this;nt=nt||{};var vt=document.createElement("div");vt.className="litemenu-entry submenu";var _t=!1;it===null?vt.classList.add("separator"):(vt.innerHTML=it&&it.title?it.title:rt,vt.value=it,it&&(it.disabled&&(_t=!0,vt.classList.add("disabled")),(it.submenu||it.has_submenu)&&vt.classList.add("has_submenu")),typeof it=="function"?(vt.dataset.value=rt,vt.onclick_callback=it):vt.dataset.value=it,it.className&&(vt.className+=" "+it.className)),this.root.appendChild(vt),_t||vt.addEventListener("click",xt),!_t&&nt.autoopen&&LiteGraph.pointerListenerAdd(vt,"enter",bt);function bt(Tt){var Et=this.value;!Et||!Et.has_submenu||xt.call(this,Tt)}function xt(Tt){var Et=this.value,wt=!0;if(st.current_submenu&&st.current_submenu.close(Tt),nt.callback){var Ot=nt.callback.call(this,Et,nt,Tt,st,nt.node);Ot===!0&&(wt=!1)}if(Et){if(Et.callback&&!nt.ignore_item_callbacks&&Et.disabled!==!0){var Ot=Et.callback.call(this,Et,nt,Tt,st,nt.extra);Ot===!0&&(wt=!1)}if(Et.submenu){if(!Et.submenu.options)throw"ContextMenu submenu needs options";new st.constructor(Et.submenu.options,{callback:Et.submenu.callback,event:Tt,parentMenu:st,ignore_item_callbacks:Et.submenu.ignore_item_callbacks,title:Et.submenu.title,extra:Et.submenu.extra,autoopen:nt.autoopen}),wt=!1}}wt&&!st.lock&&st.close()}return vt},ContextMenu.prototype.close=function(rt,it){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!it&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,rt===void 0?this.parentMenu.close():rt&&!ContextMenu.isCursorOverElement(rt,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,LiteGraph.pointerevents_method+"leave",rt)),this.current_submenu&&this.current_submenu.close(rt,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},ContextMenu.trigger=function(rt,it,nt,st){var vt=document.createEvent("CustomEvent");return vt.initCustomEvent(it,!0,!0,nt),vt.srcElement=st,rt.dispatchEvent?rt.dispatchEvent(vt):rt.__events&&rt.__events.dispatchEvent(vt),vt},ContextMenu.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},ContextMenu.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},ContextMenu.isCursorOverElement=function(rt,it){var nt=rt.clientX,st=rt.clientY,vt=it.getBoundingClientRect();return vt?st>vt.top&&st<vt.top+vt.height&&nt>vt.left&&nt<vt.left+vt.width:!1},LiteGraph.ContextMenu=ContextMenu,LiteGraph.closeAllContextMenus=function(rt){rt=rt||window;var it=rt.document.querySelectorAll(".litecontextmenu");if(!!it.length){for(var nt=[],st=0;st<it.length;st++)nt.push(it[st]);for(var st=0;st<nt.length;st++)nt[st].close?nt[st].close():nt[st].parentNode&&nt[st].parentNode.removeChild(nt[st])}},LiteGraph.extendClass=function(rt,it){for(var nt in it)rt.hasOwnProperty(nt)||(rt[nt]=it[nt]);if(it.prototype)for(var nt in it.prototype)!it.prototype.hasOwnProperty(nt)||rt.prototype.hasOwnProperty(nt)||(it.prototype.__lookupGetter__(nt)?rt.prototype.__defineGetter__(nt,it.prototype.__lookupGetter__(nt)):rt.prototype[nt]=it.prototype[nt],it.prototype.__lookupSetter__(nt)&&rt.prototype.__defineSetter__(nt,it.prototype.__lookupSetter__(nt)))};function CurveEditor(rt){this.points=rt,this.selected=-1,this.nearest=-1,this.size=null,this.must_update=!0,this.margin=5}CurveEditor.sampleCurve=function(rt,it){if(!!it){for(var nt=0;nt<it.length-1;++nt){var st=it[nt],vt=it[nt+1];if(!(vt[0]<rt)){var _t=vt[0]-st[0];if(Math.abs(_t)<1e-5)return st[1];var bt=(rt-st[0])/_t;return st[1]*(1-bt)+vt[1]*bt}}return 0}},CurveEditor.prototype.draw=function(rt,it,nt,st,vt,_t){var bt=this.points;if(!!bt){this.size=it;var xt=it[0]-this.margin*2,Tt=it[1]-this.margin*2;vt=vt||"#666",rt.save(),rt.translate(this.margin,this.margin),st&&(rt.fillStyle="#111",rt.fillRect(0,0,xt,Tt),rt.fillStyle="#222",rt.fillRect(xt*.5,0,1,Tt),rt.strokeStyle="#333",rt.strokeRect(0,0,xt,Tt)),rt.strokeStyle=vt,_t&&(rt.globalAlpha=.5),rt.beginPath();for(var Et=0;Et<bt.length;++Et){var wt=bt[Et];rt.lineTo(wt[0]*xt,(1-wt[1])*Tt)}if(rt.stroke(),rt.globalAlpha=1,!_t)for(var Et=0;Et<bt.length;++Et){var wt=bt[Et];rt.fillStyle=this.selected==Et?"#FFF":this.nearest==Et?"#DDD":"#AAA",rt.beginPath(),rt.arc(wt[0]*xt,(1-wt[1])*Tt,2,0,Math.PI*2),rt.fill()}rt.restore()}},CurveEditor.prototype.onMouseDown=function(rt,it){var nt=this.points;if(!!nt&&!(rt[1]<0)){var st=this.size[0]-this.margin*2,vt=this.size[1]-this.margin*2,_t=rt[0]-this.margin,bt=rt[1]-this.margin,xt=[_t,bt],Tt=30/it.ds.scale;if(this.selected=this.getCloserPoint(xt,Tt),this.selected==-1){var Et=[_t/st,1-bt/vt];nt.push(Et),nt.sort(function(wt,Ot){return wt[0]-Ot[0]}),this.selected=nt.indexOf(Et),this.must_update=!0}if(this.selected!=-1)return!0}},CurveEditor.prototype.onMouseMove=function(rt,it){var nt=this.points;if(!!nt){var st=this.selected;if(!(st<0)){var vt=(rt[0]-this.margin)/(this.size[0]-this.margin*2),_t=(rt[1]-this.margin)/(this.size[1]-this.margin*2),bt=[rt[0]-this.margin,rt[1]-this.margin],xt=30/it.ds.scale;this._nearest=this.getCloserPoint(bt,xt);var Tt=nt[st];if(Tt){var Et=st==0||st==nt.length-1;if(!Et&&(rt[0]<-10||rt[0]>this.size[0]+10||rt[1]<-10||rt[1]>this.size[1]+10)){nt.splice(st,1),this.selected=-1;return}Et?Tt[0]=st==0?0:1:Tt[0]=clamp(vt,0,1),Tt[1]=1-clamp(_t,0,1),nt.sort(function(wt,Ot){return wt[0]-Ot[0]}),this.selected=nt.indexOf(Tt),this.must_update=!0}}}},CurveEditor.prototype.onMouseUp=function(rt,it){return this.selected=-1,!1},CurveEditor.prototype.getCloserPoint=function(rt,it){var nt=this.points;if(!nt)return-1;it=it||30;for(var st=this.size[0]-this.margin*2,vt=this.size[1]-this.margin*2,_t=nt.length,bt=[0,0],xt=1e6,Tt=-1,Et=0;Et<_t;++Et){var wt=nt[Et];bt[0]=wt[0]*st,bt[1]=(1-wt[1])*vt,bt[0]<rt[0];var Ot=vec2.distance(rt,bt);Ot>xt||Ot>it||(Tt=Et,xt=Ot)}return Tt},LiteGraph.CurveEditor=CurveEditor,LiteGraph.getParameterNames=function(rt){return(rt+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},LiteGraph.pointerListenerAdd=function(rt,it,nt,st=!1){if(!(!rt||!rt.addEventListener||!it||typeof nt!="function")){var vt=LiteGraph.pointerevents_method,_t=it;if(vt=="pointer"&&!window.PointerEvent)switch(console.warn("sMethod=='pointer' && !window.PointerEvent"),console.log("Converting pointer["+_t+"] : down move up cancel enter TO touchstart touchmove touchend, etc .."),_t){case"down":{vt="touch",_t="start";break}case"move":{vt="touch";break}case"up":{vt="touch",_t="end";break}case"cancel":{vt="touch";break}case"enter":{console.log("debug: Should I send a move event?");break}default:console.warn("PointerEvent not available in this browser ? The event "+_t+" would not be called")}switch(_t){case"down":case"up":case"move":case"over":case"out":case"enter":rt.addEventListener(vt+_t,nt,st);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(vt!="mouse")return rt.addEventListener(vt+_t,nt,st);default:return rt.addEventListener(_t,nt,st)}}},LiteGraph.pointerListenerRemove=function(rt,it,nt,st=!1){if(!(!rt||!rt.removeEventListener||!it||typeof nt!="function"))switch(it){case"down":case"up":case"move":case"over":case"out":case"enter":(LiteGraph.pointerevents_method=="pointer"||LiteGraph.pointerevents_method=="mouse")&&rt.removeEventListener(LiteGraph.pointerevents_method+it,nt,st);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(LiteGraph.pointerevents_method=="pointer")return rt.removeEventListener(LiteGraph.pointerevents_method+it,nt,st);default:return rt.removeEventListener(it,nt,st)}};function clamp(rt,it,nt){return it>rt?it:nt<rt?nt:rt}global.clamp=clamp,typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(rt){window.setTimeout(rt,1e3/60)})})(commonjsGlobal),exports.LiteGraph=commonjsGlobal.LiteGraph,exports.LGraph=commonjsGlobal.LGraph,exports.LLink=commonjsGlobal.LLink,exports.LGraphNode=commonjsGlobal.LGraphNode,exports.LGraphGroup=commonjsGlobal.LGraphGroup,exports.DragAndScale=commonjsGlobal.DragAndScale,exports.LGraphCanvas=commonjsGlobal.LGraphCanvas,exports.ContextMenu=commonjsGlobal.ContextMenu,function(rt){var it=rt.LiteGraph;function nt(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}nt.title="Time",nt.desc="Time",nt.prototype.onExecute=function(){this.setOutputData(0,this.graph.globaltime*1e3),this.setOutputData(1,this.graph.globaltime)},it.registerNodeType("basic/time",nt);function st(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new it.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}st.title="Subgraph",st.desc="Graph inside a node",st.title_color="#334",st.prototype.onGetInputs=function(){return[["enabled","boolean"]]},st.prototype.onDblClick=function(Wt,$t,Rt){var Yt=this;setTimeout(function(){Rt.openSubgraph(Yt.subgraph)},10)},st.prototype.onAction=function(Wt,$t){this.subgraph.onAction(Wt,$t)},st.prototype.onExecute=function(){if(this.enabled=this.getInputOrProperty("enabled"),!!this.enabled){if(this.inputs)for(var Wt=0;Wt<this.inputs.length;Wt++){var $t=this.inputs[Wt],Rt=this.getInputData(Wt);this.subgraph.setInputData($t.name,Rt)}if(this.subgraph.runStep(),this.outputs)for(var Wt=0;Wt<this.outputs.length;Wt++){var Yt=this.outputs[Wt],Rt=this.subgraph.getOutputData(Yt.name);this.setOutputData(Wt,Rt)}}},st.prototype.sendEventToAllNodes=function(Wt,$t,Rt){this.enabled&&this.subgraph.sendEventToAllNodes(Wt,$t,Rt)},st.prototype.onDrawBackground=function(Wt,$t,Rt,Yt){if(this.flags.collapsed)return;var Ht=this.size[1]-it.NODE_TITLE_HEIGHT+.5,jt=it.isInsideRectangle(Yt[0],Yt[1],this.pos[0],this.pos[1]+Ht,this.size[0],it.NODE_TITLE_HEIGHT);let qt=it.isInsideRectangle(Yt[0],Yt[1],this.pos[0],this.pos[1]+Ht,this.size[0]/2,it.NODE_TITLE_HEIGHT);Wt.fillStyle=jt?"#555":"#222",Wt.beginPath(),this._shape==it.BOX_SHAPE?qt?Wt.rect(0,Ht,this.size[0]/2+1,it.NODE_TITLE_HEIGHT):Wt.rect(this.size[0]/2,Ht,this.size[0]/2+1,it.NODE_TITLE_HEIGHT):qt?Wt.roundRect(0,Ht,this.size[0]/2+1,it.NODE_TITLE_HEIGHT,[0,0,8,8]):Wt.roundRect(this.size[0]/2,Ht,this.size[0]/2+1,it.NODE_TITLE_HEIGHT,[0,0,8,8]),jt?Wt.fill():Wt.fillRect(0,Ht,this.size[0]+1,it.NODE_TITLE_HEIGHT),Wt.textAlign="center",Wt.font="24px Arial",Wt.fillStyle=jt?"#DDD":"#999",Wt.fillText("+",this.size[0]*.25,Ht+24),Wt.fillText("+",this.size[0]*.75,Ht+24)},st.prototype.onMouseDown=function(Wt,$t,Rt){var Yt=this.size[1]-it.NODE_TITLE_HEIGHT+.5;console.log(0),$t[1]>Yt&&($t[0]<this.size[0]/2?(console.log(1),Rt.showSubgraphPropertiesDialog(this)):(console.log(2),Rt.showSubgraphPropertiesDialogRight(this)))},st.prototype.computeSize=function(){var Wt=this.inputs?this.inputs.length:0,$t=this.outputs?this.outputs.length:0;return[200,Math.max(Wt,$t)*it.NODE_SLOT_HEIGHT+it.NODE_TITLE_HEIGHT]},st.prototype.onSubgraphTrigger=function(Wt,$t){var Rt=this.findOutputSlot(Wt);Rt!=-1&&this.triggerSlot(Rt)},st.prototype.onSubgraphNewInput=function(Wt,$t){var Rt=this.findInputSlot(Wt);Rt==-1&&this.addInput(Wt,$t)},st.prototype.onSubgraphRenamedInput=function(Wt,$t){var Rt=this.findInputSlot(Wt);if(Rt!=-1){var Yt=this.getInputInfo(Rt);Yt.name=$t}},st.prototype.onSubgraphTypeChangeInput=function(Wt,$t){var Rt=this.findInputSlot(Wt);if(Rt!=-1){var Yt=this.getInputInfo(Rt);Yt.type=$t}},st.prototype.onSubgraphRemovedInput=function(Wt){var $t=this.findInputSlot(Wt);$t!=-1&&this.removeInput($t)},st.prototype.onSubgraphNewOutput=function(Wt,$t){var Rt=this.findOutputSlot(Wt);Rt==-1&&this.addOutput(Wt,$t)},st.prototype.onSubgraphRenamedOutput=function(Wt,$t){var Rt=this.findOutputSlot(Wt);if(Rt!=-1){var Yt=this.getOutputInfo(Rt);Yt.name=$t}},st.prototype.onSubgraphTypeChangeOutput=function(Wt,$t){var Rt=this.findOutputSlot(Wt);if(Rt!=-1){var Yt=this.getOutputInfo(Rt);Yt.type=$t}},st.prototype.onSubgraphRemovedOutput=function(Wt){var $t=this.findOutputSlot(Wt);$t!=-1&&this.removeOutput($t)},st.prototype.getExtraMenuOptions=function(Wt){var $t=this;return[{content:"Open",callback:function(){Wt.openSubgraph($t.subgraph)}}]},st.prototype.onResize=function(Wt){Wt[1]+=20},st.prototype.serialize=function(){var Wt=it.LGraphNode.prototype.serialize.call(this);return Wt.subgraph=this.subgraph.serialize(),Wt},st.prototype.reassignSubgraphUUIDs=function(Wt){const $t={nodeIDs:{},linkIDs:{}};for(const Rt of Wt.nodes){const Yt=Rt.id,Ht=it.uuidv4();if(Rt.id=Ht,$t.nodeIDs[Yt]||$t.nodeIDs[Ht])throw new Error(`New/old node UUID wasn't unique in changed map! ${Yt} ${Ht}`);$t.nodeIDs[Yt]=Ht,$t.nodeIDs[Ht]=Yt}for(const Rt of Wt.links){const Yt=Rt[0],Ht=it.uuidv4();if(Rt[0]=Ht,$t.linkIDs[Yt]||$t.linkIDs[Ht])throw new Error(`New/old link UUID wasn't unique in changed map! ${Yt} ${Ht}`);$t.linkIDs[Yt]=Ht,$t.linkIDs[Ht]=Yt;const jt=Rt[1],qt=Rt[3];if(!$t.nodeIDs[jt])throw new Error(`Old node UUID not found in mapping! ${jt}`);if(Rt[1]=$t.nodeIDs[jt],!$t.nodeIDs[qt])throw new Error(`Old node UUID not found in mapping! ${qt}`);Rt[3]=$t.nodeIDs[qt]}for(const Rt of Wt.nodes){if(Rt.inputs)for(const Yt of Rt.inputs)Yt.link&&(Yt.link=$t.linkIDs[Yt.link]);if(Rt.outputs)for(const Yt of Rt.outputs)Yt.links&&(Yt.links=Yt.links.map(Ht=>$t.linkIDs[Ht]))}for(const Rt of Wt.nodes)if(Rt.type==="graph/subgraph"){const Yt=reassignGraphUUIDs(Rt.subgraph);$t.nodeIDs.assign(Yt.nodeIDs),$t.linkIDs.assign(Yt.linkIDs)}},st.prototype.clone=function(){var Wt=it.createNode(this.type),$t=this.serialize();if(it.use_uuids){const Rt=it.cloneObject($t.subgraph);this.reassignSubgraphUUIDs(Rt),$t.subgraph=Rt}return delete $t.id,delete $t.inputs,delete $t.outputs,Wt.configure($t),Wt},st.prototype.buildFromNodes=function(Wt){for(var $t={},Rt=0,Yt=0;Yt<Wt.length;++Yt){var Ht=Wt[Yt];$t[Ht.id]=Ht,Rt=Math.min(Ht.pos[0],Rt),Math.max(Ht.pos[0],Rt)}for(var Yt=0;Yt<Wt.length;++Yt){var Ht=Wt[Yt];if(Ht.inputs)for(var jt=0;jt<Ht.inputs.length;++jt){var qt=Ht.inputs[jt];if(!(!qt||!qt.link)){var ri=Ht.graph.links[qt.link];!ri||$t[ri.origin_id]||this.subgraph.addInput(qt.name,ri.type)}}if(Ht.outputs)for(var jt=0;jt<Ht.outputs.length;++jt){var oi=Ht.outputs[jt];if(!(!oi||!oi.links||!oi.links.length))for(var fi=!1,bi=0;bi<oi.links.length;++bi){var ri=Ht.graph.links[oi.links[bi]];if(!!ri&&!$t[ri.target_id]){fi=!0;break}}}}},it.Subgraph=st,it.registerNodeType("graph/subgraph",st);function vt(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var Wt=this;this.name_widget=this.addWidget("text","Name",this.properties.name,function($t){!$t||Wt.setProperty("name",$t)}),this.type_widget=this.addWidget("text","Type",this.properties.type,function($t){Wt.setProperty("type",$t)}),this.value_widget=this.addWidget("number","Value",this.properties.value,function($t){Wt.setProperty("value",$t)}),this.widgets_up=!0,this.size=[180,90]}vt.title="Input",vt.desc="Input of the graph",vt.prototype.onConfigure=function(){this.updateType()},vt.prototype.updateType=function(){var Wt=this.properties.type;this.type_widget.value=Wt,this.outputs[0].type!=Wt&&(it.isValidConnection(this.outputs[0].type,Wt)||this.disconnectOutput(0),this.outputs[0].type=Wt),Wt=="number"?(this.value_widget.type="number",this.value_widget.value=0):Wt=="boolean"?(this.value_widget.type="toggle",this.value_widget.value=!0):Wt=="string"?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,Wt)},vt.prototype.onPropertyChanged=function(Wt,$t){if(Wt=="name"){if($t==""||$t==this.name_in_graph||$t=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,$t):this.graph.addInput($t,this.properties.type)),this.name_widget.value=$t,this.name_in_graph=$t}else Wt=="type"&&this.updateType()},vt.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},vt.prototype.onAction=function(Wt,$t){this.properties.type==it.EVENT&&this.triggerSlot(0,$t)},vt.prototype.onExecute=function(){var Wt=this.properties.name,$t=this.graph.inputs[Wt];if(!$t){this.setOutputData(0,this.properties.value);return}this.setOutputData(0,$t.value!==void 0?$t.value:this.properties.value)},vt.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},it.GraphInput=vt,it.registerNodeType("graph/input",vt);function _t(){this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}_t.title="Output",_t.desc="Output of the graph",_t.prototype.onPropertyChanged=function(Wt,$t){if(Wt=="name"){if($t==""||$t==this.name_in_graph||$t=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,$t):this.graph.addOutput($t,this.properties.type)),this.name_widget.value=$t,this.name_in_graph=$t}else Wt=="type"&&this.updateType()},_t.prototype.updateType=function(){var Wt=this.properties.type;this.type_widget&&(this.type_widget.value=Wt),this.inputs[0].type!=Wt&&((Wt=="action"||Wt=="event")&&(Wt=it.EVENT),it.isValidConnection(this.inputs[0].type,Wt)||this.disconnectInput(0),this.inputs[0].type=Wt),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,Wt)},_t.prototype.onExecute=function(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)},_t.prototype.onAction=function(Wt,$t){this.properties.type==it.ACTION&&this.graph.trigger(this.properties.name,$t)},_t.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},_t.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},it.GraphOutput=_t,it.registerNodeType("graph/output",_t);function bt(){this.addOutput("value","number"),this.addProperty("value",1),this.widget=this.addWidget("number","value",1,"value"),this.widgets_up=!0,this.size=[180,30]}bt.title="Const Number",bt.desc="Constant number",bt.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties.value))},bt.prototype.getTitle=function(){return this.flags.collapsed?this.properties.value:this.title},bt.prototype.setValue=function(Wt){this.setProperty("value",Wt)},bt.prototype.onDrawBackground=function(Wt){this.outputs[0].label=this.properties.value.toFixed(3)},it.registerNodeType("basic/const",bt);function xt(){this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value"),this.serialize_widgets=!0,this.widgets_up=!0,this.size=[140,30]}xt.title="Const Boolean",xt.desc="Constant boolean",xt.prototype.getTitle=bt.prototype.getTitle,xt.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},xt.prototype.setValue=bt.prototype.setValue,xt.prototype.onGetInputs=function(){return[["toggle",it.ACTION]]},xt.prototype.onAction=function(Wt){this.setValue(!this.properties.value)},it.registerNodeType("basic/boolean",xt);function Tt(){this.addOutput("string","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0,this.size=[180,30]}Tt.title="Const String",Tt.desc="Constant string",Tt.prototype.getTitle=bt.prototype.getTitle,Tt.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},Tt.prototype.setValue=bt.prototype.setValue,Tt.prototype.onDropFile=function(Wt){var $t=this,Rt=new FileReader;Rt.onload=function(Yt){$t.setProperty("value",Yt.target.result)},Rt.readAsText(Wt)},it.registerNodeType("basic/string",Tt);function Et(){this.addOutput("obj","object"),this.size=[120,30],this._object={}}Et.title="Const Object",Et.desc="Constant Object",Et.prototype.onExecute=function(){this.setOutputData(0,this._object)},it.registerNodeType("basic/object",Et);function wt(){this.addInput("url","string"),this.addOutput("file","string"),this.addProperty("url",""),this.addProperty("type","text"),this.widget=this.addWidget("text","url","","url"),this._data=null}wt.title="Const File",wt.desc="Fetches a file from an url",wt["@type"]={type:"enum",values:["text","arraybuffer","blob","json"]},wt.prototype.onPropertyChanged=function(Wt,$t){Wt=="url"&&($t==null||$t==""?this._data=null:this.fetchFile($t))},wt.prototype.onExecute=function(){var Wt=this.getInputData(0)||this.properties.url;Wt&&(Wt!=this._url||this._type!=this.properties.type)&&this.fetchFile(Wt),this.setOutputData(0,this._data)},wt.prototype.setValue=bt.prototype.setValue,wt.prototype.fetchFile=function(Wt){var $t=this;if(!Wt||Wt.constructor!==String){$t._data=null,$t.boxcolor=null;return}this._url=Wt,this._type=this.properties.type,Wt.substr(0,4)=="http"&&it.proxy&&(Wt=it.proxy+Wt.substr(Wt.indexOf(":")+3)),fetch(Wt).then(function(Rt){if(!Rt.ok)throw new Error("File not found");if($t.properties.type=="arraybuffer")return Rt.arrayBuffer();if($t.properties.type=="text")return Rt.text();if($t.properties.type=="json")return Rt.json();if($t.properties.type=="blob")return Rt.blob()}).then(function(Rt){$t._data=Rt,$t.boxcolor="#AEA"}).catch(function(Rt){$t._data=null,$t.boxcolor="red",console.error("error fetching file:",Wt)})},wt.prototype.onDropFile=function(Wt){var $t=this;this._url=Wt.name,this._type=this.properties.type,this.properties.url=Wt.name;var Rt=new FileReader;if(Rt.onload=function(Yt){$t.boxcolor="#AEA";var Ht=Yt.target.result;$t.properties.type=="json"&&(Ht=JSON.parse(Ht)),$t._data=Ht},$t.properties.type=="arraybuffer")Rt.readAsArrayBuffer(Wt);else if($t.properties.type=="text"||$t.properties.type=="json")Rt.readAsText(Wt);else if($t.properties.type=="blob")return Rt.readAsBinaryString(Wt)},it.registerNodeType("basic/file",wt);function Ot(){this.addInput("parse",it.ACTION),this.addInput("json","string"),this.addOutput("done",it.EVENT),this.addOutput("object","object"),this.widget=this.addWidget("button","parse","",this.parse.bind(this)),this._str=null,this._obj=null}Ot.title="JSON Parse",Ot.desc="Parses JSON String into object",Ot.prototype.parse=function(){if(!!this._str)try{this._str=this.getInputData(1),this._obj=JSON.parse(this._str),this.boxcolor="#AEA",this.triggerSlot(0)}catch{this.boxcolor="red"}},Ot.prototype.onExecute=function(){this._str=this.getInputData(1),this.setOutputData(1,this._obj)},Ot.prototype.onAction=function(Wt){Wt=="parse"&&this.parse()},it.registerNodeType("basic/jsonparse",Ot);function It(){this.addOutput("data","object"),this.addProperty("value",""),this.widget=this.addWidget("text","json","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}It.title="Const Data",It.desc="Constant Data",It.prototype.onPropertyChanged=function(Wt,$t){if(this.widget.value=$t,!($t==null||$t==""))try{this._value=JSON.parse($t),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},It.prototype.onExecute=function(){this.setOutputData(0,this._value)},It.prototype.setValue=bt.prototype.setValue,it.registerNodeType("basic/data",It);function At(){this._value=[],this.addInput("json",""),this.addOutput("arrayOut","array"),this.addOutput("length","number"),this.addProperty("value","[]"),this.widget=this.addWidget("text","array",this.properties.value,"value"),this.widgets_up=!0,this.size=[140,50]}At.title="Const Array",At.desc="Constant Array",At.prototype.onPropertyChanged=function(Wt,$t){if(this.widget.value=$t,!($t==null||$t==""))try{$t[0]!="["?this._value=JSON.parse("["+$t+"]"):this._value=JSON.parse($t),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},At.prototype.onExecute=function(){var Wt=this.getInputData(0);if(Wt&&Wt.length){this._value||(this._value=new Array),this._value.length=Wt.length;for(var $t=0;$t<Wt.length;++$t)this._value[$t]=Wt[$t]}this.setOutputData(0,this._value),this.setOutputData(1,this._value&&this._value.length||0)},At.prototype.setValue=bt.prototype.setValue,it.registerNodeType("basic/array",At);function Dt(){this.addInput("arr","array"),this.addInput("value",""),this.addOutput("arr","array"),this.properties={index:0},this.widget=this.addWidget("number","i",this.properties.index,"index",{precision:0,step:10,min:0})}Dt.title="Set Array",Dt.desc="Sets index of array",Dt.prototype.onExecute=function(){var Wt=this.getInputData(0);if(!!Wt){var $t=this.getInputData(1);$t!==void 0&&(this.properties.index&&(Wt[Math.floor(this.properties.index)]=$t),this.setOutputData(0,Wt))}},it.registerNodeType("basic/set_array",Dt);function kt(){this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0)}kt.title="Array[i]",kt.desc="Returns an element from an array",kt.prototype.onExecute=function(){var Wt=this.getInputData(0),$t=this.getInputData(1);$t==null&&($t=this.properties.index),!(Wt==null||$t==null)&&this.setOutputData(0,Wt[Math.floor(Number($t))])},it.registerNodeType("basic/array[]",kt);function Mt(){this.addInput("table","table"),this.addInput("row","number"),this.addInput("col","number"),this.addOutput("value",""),this.addProperty("row",0),this.addProperty("column",0)}Mt.title="Table[row][col]",Mt.desc="Returns an element from a table",Mt.prototype.onExecute=function(){var Wt=this.getInputData(0),Rt=this.getInputData(1),$t=this.getInputData(2);if(Rt==null&&(Rt=this.properties.row),$t==null&&($t=this.properties.column),!(Wt==null||Rt==null||$t==null)){var Rt=Wt[Math.floor(Number(Rt))];Rt?this.setOutputData(0,Rt[Math.floor(Number($t))]):this.setOutputData(0,null)}},it.registerNodeType("basic/table[][]",Mt);function zt(){this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.widget=this.addWidget("text","prop.","",this.setValue.bind(this)),this.widgets_up=!0,this.size=[140,30],this._value=null}zt.title="Object property",zt.desc="Outputs the property of an object",zt.prototype.setValue=function(Wt){this.properties.value=Wt,this.widget.value=Wt},zt.prototype.getTitle=function(){return this.flags.collapsed?"in."+this.properties.value:this.title},zt.prototype.onPropertyChanged=function(Wt,$t){this.widget.value=$t},zt.prototype.onExecute=function(){var Wt=this.getInputData(0);Wt!=null&&this.setOutputData(0,Wt[this.properties.value])},it.registerNodeType("basic/object_property",zt);function Pt(){this.addInput("obj",""),this.addOutput("keys","array"),this.size=[140,30]}Pt.title="Object keys",Pt.desc="Outputs an array with the keys of an object",Pt.prototype.onExecute=function(){var Wt=this.getInputData(0);Wt!=null&&this.setOutputData(0,Object.keys(Wt))},it.registerNodeType("basic/object_keys",Pt);function Lt(){this.addInput("obj",""),this.addInput("value",""),this.addOutput("obj",""),this.properties={property:""},this.name_widget=this.addWidget("text","prop.",this.properties.property,"property")}Lt.title="Set Object",Lt.desc="Adds propertiesrty to object",Lt.prototype.onExecute=function(){var Wt=this.getInputData(0);if(!!Wt){var $t=this.getInputData(1);$t!==void 0&&(this.properties.property&&(Wt[this.properties.property]=$t),this.setOutputData(0,Wt))}},it.registerNodeType("basic/set_object",Lt);function Bt(){this.addInput("A","object"),this.addInput("B","object"),this.addOutput("out","object"),this._result={};var Wt=this;this.addWidget("button","clear","",function(){Wt._result={}}),this.size=this.computeSize()}Bt.title="Merge Objects",Bt.desc="Creates an object copying properties from others",Bt.prototype.onExecute=function(){var Wt=this.getInputData(0),$t=this.getInputData(1),Rt=this._result;if(Wt)for(var Yt in Wt)Rt[Yt]=Wt[Yt];if($t)for(var Yt in $t)Rt[Yt]=$t[Yt];this.setOutputData(0,Rt)},it.registerNodeType("basic/merge_objects",Bt);function Gt(){this.size=[60,30],this.addInput("in"),this.addOutput("out"),this.properties={varname:"myname",container:Gt.LITEGRAPH},this.value=null}Gt.title="Variable",Gt.desc="store/read variable value",Gt.LITEGRAPH=0,Gt.GRAPH=1,Gt.GLOBALSCOPE=2,Gt["@container"]={type:"enum",values:{litegraph:Gt.LITEGRAPH,graph:Gt.GRAPH,global:Gt.GLOBALSCOPE}},Gt.prototype.onExecute=function(){var Wt=this.getContainer();if(this.isInputConnected(0)){this.value=this.getInputData(0),Wt[this.properties.varname]=this.value,this.setOutputData(0,this.value);return}this.setOutputData(0,Wt[this.properties.varname])},Gt.prototype.getContainer=function(){switch(this.properties.container){case Gt.GRAPH:return this.graph?this.graph.vars:{};case Gt.GLOBALSCOPE:return rt;case Gt.LITEGRAPH:default:return it.Globals}},Gt.prototype.getTitle=function(){return this.properties.varname},it.registerNodeType("basic/variable",Gt),it.wrapFunctionAsNode("basic/length",Ut,[""],"number");function Ut(Wt){return Wt&&Wt.length!=null?Number(Wt.length):0}it.wrapFunctionAsNode("basic/not",function(Wt){return!Wt},[""],"boolean");function Zt(){this.size=[60,30],this.addInput("data",0),this.addInput("download",it.ACTION),this.properties={filename:"data.json"},this.value=null;var Wt=this;this.addWidget("button","Download","",function($t){!Wt.value||Wt.downloadAsFile()})}Zt.title="Download",Zt.desc="Download some data",Zt.prototype.downloadAsFile=function(){if(this.value!=null){var Wt=null;this.value.constructor===String?Wt=this.value:Wt=JSON.stringify(this.value);var $t=new Blob([Wt]),Rt=URL.createObjectURL($t),Yt=document.createElement("a");Yt.setAttribute("href",Rt),Yt.setAttribute("download",this.properties.filename),Yt.style.display="none",document.body.appendChild(Yt),Yt.click(),document.body.removeChild(Yt),setTimeout(function(){URL.revokeObjectURL(Rt)},1e3*60)}},Zt.prototype.onAction=function(Wt,$t){var Rt=this;setTimeout(function(){Rt.downloadAsFile()},100)},Zt.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},Zt.prototype.getTitle=function(){return this.flags.collapsed?this.properties.filename:this.title},it.registerNodeType("basic/download",Zt);function Jt(){this.size=[60,30],this.addInput("value",0,{label:""}),this.value=0}Jt.title="Watch",Jt.desc="Show value of input",Jt.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},Jt.prototype.getTitle=function(){return this.flags.collapsed?this.inputs[0].label:this.title},Jt.toString=function(Wt){if(Wt==null)return"null";if(Wt.constructor===Number)return Wt.toFixed(3);if(Wt.constructor===Array){for(var $t="[",Rt=0;Rt<Wt.length;++Rt)$t+=Jt.toString(Wt[Rt])+(Rt+1!=Wt.length?",":"");return $t+="]",$t}else return String(Wt)},Jt.prototype.onDrawBackground=function(Wt){this.inputs[0].label=Jt.toString(this.value)},it.registerNodeType("basic/watch",Jt);function ei(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,30]}ei.title="Cast",ei.desc="Allows to connect different types",ei.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},it.registerNodeType("basic/cast",ei);function ii(){this.mode=it.ON_EVENT,this.size=[80,30],this.addProperty("msg",""),this.addInput("log",it.EVENT),this.addInput("msg",0)}ii.title="Console",ii.desc="Show value inside the console",ii.prototype.onAction=function(Wt,$t){var Rt=this.getInputData(1);Rt||(Rt=this.properties.msg),Rt||(Rt="Event: "+$t),Wt=="log"?console.log(Rt):Wt=="warn"?console.warn(Rt):Wt=="error"&&console.error(Rt)},ii.prototype.onExecute=function(){var Wt=this.getInputData(1);Wt||(Wt=this.properties.msg),Wt!=null&&typeof Wt<"u"&&(this.properties.msg=Wt,console.log(Wt))},ii.prototype.onGetInputs=function(){return[["log",it.ACTION],["warn",it.ACTION],["error",it.ACTION]]},it.registerNodeType("basic/console",ii);function li(){this.mode=it.ON_EVENT,this.addProperty("msg",""),this.addInput("",it.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}li.title="Alert",li.desc="Show an alert window",li.color="#510",li.prototype.onConfigure=function(Wt){this.widget.value=Wt.properties.msg},li.prototype.onAction=function(Wt,$t){var Rt=this.properties.msg;setTimeout(function(){alert(Rt)},10)},it.registerNodeType("basic/alert",li);function pi(){this.size=[60,30],this.addProperty("onExecute","return A;"),this.addInput("A",0),this.addInput("B",0),this.addOutput("out",0),this._func=null,this.data={}}pi.prototype.onConfigure=function(Wt){Wt.properties.onExecute&&it.allow_scripts?this.compileCode(Wt.properties.onExecute):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},pi.title="Script",pi.desc="executes a code (max 256 characters)",pi.widgets_info={onExecute:{type:"code"}},pi.prototype.onPropertyChanged=function(Wt,$t){Wt=="onExecute"&&it.allow_scripts?this.compileCode($t):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},pi.prototype.compileCode=function(Wt){if(this._func=null,Wt.length>256)console.warn("Script too long, max 256 chars");else{for(var $t=Wt.toLowerCase(),Rt=["script","body","document","eval","nodescript","function"],Yt=0;Yt<Rt.length;++Yt)if($t.indexOf(Rt[Yt])!=-1){console.warn("invalid script");return}try{this._func=new Function("A","B","C","DATA","node",Wt)}catch(Ht){console.error("Error parsing script"),console.error(Ht)}}},pi.prototype.onExecute=function(){if(!!this._func)try{var Wt=this.getInputData(0),$t=this.getInputData(1),Rt=this.getInputData(2);this.setOutputData(0,this._func(Wt,$t,Rt,this.data,this))}catch(Yt){console.error("Error in script"),console.error(Yt)}},pi.prototype.onGetOutputs=function(){return[["C",""]]},it.registerNodeType("basic/script",pi);function ci(){this.addInput("A",0),this.addInput("B",0),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","==","enum",{values:ci.values}),this.addWidget("combo","Op.",this.properties.OP,{property:"OP",values:ci.values}),this.size=[80,60]}ci.values=["==","!="],ci["@OP"]={type:"enum",title:"operation",values:ci.values},ci.title="Compare *",ci.desc="evaluates condition between A and B",ci.prototype.getTitle=function(){return"*A "+this.properties.OP+" *B"},ci.prototype.onExecute=function(){var Wt=this.getInputData(0);Wt===void 0?Wt=this.properties.A:this.properties.A=Wt;var $t=this.getInputData(1);$t===void 0?$t=this.properties.B:this.properties.B=$t;var Rt=!1;if(typeof Wt==typeof $t)switch(this.properties.OP){case"==":case"!=":switch(Rt=!0,typeof Wt){case"object":var Yt=Object.getOwnPropertyNames(Wt),Ht=Object.getOwnPropertyNames($t);if(Yt.length!=Ht.length){Rt=!1;break}for(var jt=0;jt<Yt.length;jt++){var qt=Yt[jt];if(Wt[qt]!==$t[qt]){Rt=!1;break}}break;default:Rt=Wt==$t}this.properties.OP=="!="&&(Rt=!Rt);break}this.setOutputData(0,Rt),this.setOutputData(1,!Rt)},it.registerNodeType("basic/CompareValues",ci)}(commonjsGlobal),function(rt){var it=rt.LiteGraph;function nt(){this.size=[60,30],this.addInput("event",it.ACTION)}nt.title="Log Event",nt.desc="Log event in console",nt.prototype.onAction=function(kt,Mt,zt){console.log(kt,Mt)},it.registerNodeType("events/log",nt);function st(){this.size=[60,30],this.addInput("if",""),this.addOutput("true",it.EVENT),this.addOutput("change",it.EVENT),this.addOutput("false",it.EVENT),this.properties={only_on_change:!0},this.prev=0}st.title="TriggerEvent",st.desc="Triggers event if input evaluates to true",st.prototype.onExecute=function(kt,Mt){var zt=this.getInputData(0),Pt=zt!=this.prev;this.prev===0&&(Pt=!1);var Lt=Pt&&this.properties.only_on_change||!Pt&&!this.properties.only_on_change;zt&&Lt&&this.triggerSlot(0,kt,null,Mt),!zt&&Lt&&this.triggerSlot(2,kt,null,Mt),Pt&&this.triggerSlot(1,kt,null,Mt),this.prev=zt},it.registerNodeType("events/trigger",st);function vt(){var kt=this;this.addInput("",it.ACTION),this.addInput("",it.ACTION),this.addInput("",it.ACTION),this.addOutput("",it.EVENT),this.addOutput("",it.EVENT),this.addOutput("",it.EVENT),this.addWidget("button","+",null,function(){kt.addInput("",it.ACTION),kt.addOutput("",it.EVENT)}),this.size=[90,70],this.flags={horizontal:!0,render_box:!1}}vt.title="Sequence",vt.desc="Triggers a sequence of events when an event arrives",vt.prototype.getTitle=function(){return""},vt.prototype.onAction=function(kt,Mt,zt){if(this.outputs){zt=zt||{};for(var Pt=0;Pt<this.outputs.length;++Pt)this.outputs[Pt],zt.action_call?zt.action_call=zt.action_call+"_seq_"+Pt:zt.action_call=this.id+"_"+(kt||"action")+"_seq_"+Pt+"_"+Math.floor(Math.random()*9999),this.triggerSlot(Pt,Mt,null,zt)}},it.registerNodeType("events/sequence",vt);function _t(){var kt=this;this.addInput("",it.ACTION),this.addInput("",it.ACTION),this.addOutput("",it.EVENT),this.addWidget("button","+",null,function(){kt.addInput("",it.ACTION),kt.size[0]=90}),this.size=[90,70],this.ready=[]}_t.title="WaitAll",_t.desc="Wait until all input events arrive then triggers output",_t.prototype.getTitle=function(){return""},_t.prototype.onDrawBackground=function(kt){if(!this.flags.collapsed)for(var Mt=0;Mt<this.inputs.length;++Mt){var zt=Mt*it.NODE_SLOT_HEIGHT+10;kt.fillStyle=this.ready[Mt]?"#AFB":"#000",kt.fillRect(20,zt,10,10)}},_t.prototype.onAction=function(kt,Mt,zt,Pt){if(Pt!=null){this.ready.length=this.outputs.length,this.ready[Pt]=!0;for(var Lt=0;Lt<this.ready.length;++Lt)if(!this.ready[Lt])return;this.reset(),this.triggerSlot(0)}},_t.prototype.reset=function(){this.ready.length=0},it.registerNodeType("events/waitAll",_t);function bt(){var kt=this;this.properties={index:0},this.addInput("index","number"),this.addInput("step",it.ACTION),this.addInput("reset",it.ACTION),this.addOutput("index","number"),this.addOutput("",it.EVENT),this.addOutput("",it.EVENT),this.addOutput("",it.EVENT,{removable:!0}),this.addWidget("button","+",null,function(){kt.addOutput("",it.EVENT,{removable:!0})}),this.size=[120,120],this.flags={render_box:!1}}bt.title="Stepper",bt.desc="Trigger events sequentially when an tick arrives",bt.prototype.onDrawBackground=function(kt){if(!this.flags.collapsed){var Mt=this.properties.index||0;kt.fillStyle="#AFB";var zt=this.size[0],Pt=(Mt+1)*it.NODE_SLOT_HEIGHT+4;kt.beginPath(),kt.moveTo(zt-30,Pt),kt.lineTo(zt-30,Pt+it.NODE_SLOT_HEIGHT),kt.lineTo(zt-15,Pt+it.NODE_SLOT_HEIGHT*.5),kt.fill()}},bt.prototype.onExecute=function(){var kt=this.getInputData(0);kt!=null&&(kt=Math.floor(kt),kt=clamp(kt,0,this.outputs?this.outputs.length-2:0),kt!=this.properties.index&&(this.properties.index=kt,this.triggerSlot(kt+1))),this.setOutputData(0,this.properties.index)},bt.prototype.onAction=function(kt,Mt){if(kt=="reset")this.properties.index=0;else if(kt=="step"){this.triggerSlot(this.properties.index+1,Mt);var zt=this.outputs?this.outputs.length-1:0;this.properties.index=(this.properties.index+1)%zt}},it.registerNodeType("events/stepper",bt);function xt(){this.size=[60,30],this.addInput("event",it.ACTION),this.addOutput("event",it.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}xt.title="Filter Event",xt.desc="Blocks events that do not match the filter",xt.prototype.onAction=function(kt,Mt,zt){if(Mt!=null&&!(this.properties.equal_to&&this.properties.equal_to!=Mt)){if(this.properties.has_property){var Pt=Mt[this.properties.has_property];if(Pt==null||this.properties.property_equal_to&&this.properties.property_equal_to!=Pt)return}this.triggerSlot(0,Mt,null,zt)}},it.registerNodeType("events/filter",xt);function Tt(){this.addInput("in",it.ACTION),this.addInput("cond","boolean"),this.addOutput("true",it.EVENT),this.addOutput("false",it.EVENT),this.size=[120,60],this._value=!1}Tt.title="Branch",Tt.desc="If condition is true, outputs triggers true, otherwise false",Tt.prototype.onExecute=function(){this._value=this.getInputData(1)},Tt.prototype.onAction=function(kt,Mt,zt){this._value=this.getInputData(1),this.triggerSlot(this._value?0:1,Mt,null,zt)},it.registerNodeType("events/branch",Tt);function Et(){this.addInput("inc",it.ACTION),this.addInput("dec",it.ACTION),this.addInput("reset",it.ACTION),this.addOutput("change",it.EVENT),this.addOutput("num","number"),this.addProperty("doCountExecution",!1,"boolean",{name:"Count Executions"}),this.addWidget("toggle","Count Exec.",this.properties.doCountExecution,"doCountExecution"),this.num=0}Et.title="Counter",Et.desc="Counts events",Et.prototype.getTitle=function(){return this.flags.collapsed?String(this.num):this.title},Et.prototype.onAction=function(kt,Mt,zt){var Pt=this.num;kt=="inc"?this.num+=1:kt=="dec"?this.num-=1:kt=="reset"&&(this.num=0),this.num!=Pt&&this.trigger("change",this.num)},Et.prototype.onDrawBackground=function(kt){this.flags.collapsed||(kt.fillStyle="#AAA",kt.font="20px Arial",kt.textAlign="center",kt.fillText(this.num,this.size[0]*.5,this.size[1]*.5))},Et.prototype.onExecute=function(){this.properties.doCountExecution&&(this.num+=1),this.setOutputData(1,this.num)},it.registerNodeType("events/counter",Et);function wt(){this.size=[60,30],this.addProperty("time_in_ms",1e3),this.addInput("event",it.ACTION),this.addOutput("on_time",it.EVENT),this._pending=[]}wt.title="Delay",wt.desc="Delays one event",wt.prototype.onAction=function(kt,Mt,zt){var Pt=this.properties.time_in_ms;Pt<=0?this.trigger(null,Mt,zt):this._pending.push([Pt,Mt])},wt.prototype.onExecute=function(kt,Mt){var zt=this.graph.elapsed_time*1e3;this.isInputConnected(1)&&(this.properties.time_in_ms=this.getInputData(1));for(var Pt=0;Pt<this._pending.length;++Pt){var Lt=this._pending[Pt];Lt[0]-=zt,!(Lt[0]>0)&&(this._pending.splice(Pt,1),--Pt,this.trigger(null,Lt[1],Mt))}},wt.prototype.onGetInputs=function(){return[["event",it.ACTION],["time_in_ms","number"]]},it.registerNodeType("events/delay",wt);function Ot(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",it.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}Ot.title="Timer",Ot.desc="Sends an event every N milliseconds",Ot.prototype.onStart=function(){this.time=0},Ot.prototype.getTitle=function(){return"Timer: "+this.last_interval.toString()+"ms"},Ot.on_color="#AAA",Ot.off_color="#222",Ot.prototype.onDrawBackground=function(){this.boxcolor=this.triggered?Ot.on_color:Ot.off_color,this.triggered=!1},Ot.prototype.onExecute=function(){var kt=this.graph.elapsed_time*1e3,Mt=this.time==0;if(this.time+=kt,this.last_interval=Math.max(1,this.getInputOrProperty("interval")|0),!Mt&&(this.time<this.last_interval||isNaN(this.last_interval))){this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1);return}this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)},Ot.prototype.onGetInputs=function(){return[["interval","number"]]},Ot.prototype.onGetOutputs=function(){return[["tick","boolean"]]},it.registerNodeType("events/timer",Ot);function It(){this.addInput("go",it.ACTION),this.addInput("green",it.ACTION),this.addInput("red",it.ACTION),this.addOutput("continue",it.EVENT),this.addOutput("blocked",it.EVENT),this.addOutput("is_green","boolean"),this._ready=!1,this.properties={};var kt=this;this.addWidget("button","reset","",function(){kt._ready=!1})}It.title="Semaphore Event",It.desc="Until both events are not triggered, it doesnt continue.",It.prototype.onExecute=function(){this.setOutputData(1,this._ready),this.boxcolor=this._ready?"#9F9":"#FA5"},It.prototype.onAction=function(kt,Mt){kt=="go"?this.triggerSlot(this._ready?0:1):kt=="green"?this._ready=!0:kt=="red"&&(this._ready=!1)},it.registerNodeType("events/semaphore",It);function At(){this.addInput("in",it.ACTION),this.addInput("reset",it.ACTION),this.addOutput("out",it.EVENT),this._once=!1,this.properties={};var kt=this;this.addWidget("button","reset","",function(){kt._once=!1})}At.title="Once",At.desc="Only passes an event once, then gets locked",At.prototype.onAction=function(kt,Mt){kt=="in"&&!this._once?(this._once=!0,this.triggerSlot(0,Mt)):kt=="reset"&&(this._once=!1)},it.registerNodeType("events/once",At);function Dt(){this.addInput("data",0),this.addInput("assign",it.ACTION),this.addOutput("data",0),this._last_value=null,this.properties={data:null,serialize:!0};var kt=this;this.addWidget("button","store","",function(){kt.properties.data=kt._last_value})}Dt.title="Data Store",Dt.desc="Stores data and only changes when event is received",Dt.prototype.onExecute=function(){this._last_value=this.getInputData(0),this.setOutputData(0,this.properties.data)},Dt.prototype.onAction=function(kt,Mt,zt){this.properties.data=this._last_value},Dt.prototype.onSerialize=function(kt){kt.data!=null&&(this.properties.serialize==!1||kt.data.constructor!==String&&kt.data.constructor!==Number&&kt.data.constructor!==Boolean&&kt.data.constructor!==Array&&kt.data.constructor!==Object)&&(kt.data=null)},it.registerNodeType("basic/data_store",Dt)}(commonjsGlobal),function(rt){var it=rt.LiteGraph;function nt(){this.addOutput("",it.EVENT),this.addOutput("","boolean"),this.addProperty("text","click me"),this.addProperty("font_size",30),this.addProperty("message",""),this.size=[164,84],this.clicked=!1}nt.title="Button",nt.desc="Triggers an event",nt.font="Arial",nt.prototype.onDrawForeground=function(It){if(!this.flags.collapsed){var At=10;if(It.fillStyle="black",It.fillRect(At+1,At+1,this.size[0]-At*2,this.size[1]-At*2),It.fillStyle="#AAF",It.fillRect(At-1,At-1,this.size[0]-At*2,this.size[1]-At*2),It.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",It.fillRect(At,At,this.size[0]-At*2,this.size[1]-At*2),this.properties.text||this.properties.text===0){var Dt=this.properties.font_size||30;It.textAlign="center",It.fillStyle=this.clicked?"black":"white",It.font=Dt+"px "+nt.font,It.fillText(this.properties.text,this.size[0]*.5,this.size[1]*.5+Dt*.3),It.textAlign="left"}}},nt.prototype.onMouseDown=function(It,At){if(At[0]>1&&At[1]>1&&At[0]<this.size[0]-2&&At[1]<this.size[1]-2)return this.clicked=!0,this.setOutputData(1,this.clicked),this.triggerSlot(0,this.properties.message),!0},nt.prototype.onExecute=function(){this.setOutputData(1,this.clicked)},nt.prototype.onMouseUp=function(It){this.clicked=!1},it.registerNodeType("widget/button",nt);function st(){this.addInput("","boolean"),this.addInput("e",it.ACTION),this.addOutput("v","boolean"),this.addOutput("e",it.EVENT),this.properties={font:"",value:!1},this.size=[160,44]}st.title="Toggle",st.desc="Toggles between true or false",st.prototype.onDrawForeground=function(It){if(!this.flags.collapsed){var At=this.size[1]*.5,Dt=.25,kt=this.size[1]*.8;It.font=this.properties.font||(At*.8).toFixed(0)+"px Arial";var Mt=It.measureText(this.title).width,zt=(this.size[0]-(Mt+At))*.5;It.fillStyle="#AAA",It.fillRect(zt,kt-At,At,At),It.fillStyle=this.properties.value?"#AEF":"#000",It.fillRect(zt+At*Dt,kt-At+At*Dt,At*(1-Dt*2),At*(1-Dt*2)),It.textAlign="left",It.fillStyle="#AAA",It.fillText(this.title,At*1.2+zt,kt*.85),It.textAlign="left"}},st.prototype.onAction=function(It){this.properties.value=!this.properties.value,this.trigger("e",this.properties.value)},st.prototype.onExecute=function(){var It=this.getInputData(0);It!=null&&(this.properties.value=It),this.setOutputData(0,this.properties.value)},st.prototype.onMouseDown=function(It,At){if(At[0]>1&&At[1]>1&&At[0]<this.size[0]-2&&At[1]<this.size[1]-2)return this.properties.value=!this.properties.value,this.graph._version++,this.trigger("e",this.properties.value),!0},it.registerNodeType("widget/toggle",st);function vt(){this.addOutput("","number"),this.size=[80,60],this.properties={min:-1e3,max:1e3,value:1,step:1},this.old_y=-1,this._remainder=0,this._precision=0,this.mouse_captured=!1}vt.title="Number",vt.desc="Widget to select number value",vt.pixels_threshold=10,vt.markers_color="#666",vt.prototype.onDrawForeground=function(It){var At=this.size[0]*.5,Dt=this.size[1];Dt>30?(It.fillStyle=vt.markers_color,It.beginPath(),It.moveTo(At,Dt*.1),It.lineTo(At+Dt*.1,Dt*.2),It.lineTo(At+Dt*-.1,Dt*.2),It.fill(),It.beginPath(),It.moveTo(At,Dt*.9),It.lineTo(At+Dt*.1,Dt*.8),It.lineTo(At+Dt*-.1,Dt*.8),It.fill(),It.font=(Dt*.7).toFixed(1)+"px Arial"):It.font=(Dt*.8).toFixed(1)+"px Arial",It.textAlign="center",It.font=(Dt*.7).toFixed(1)+"px Arial",It.fillStyle="#EEE",It.fillText(this.properties.value.toFixed(this._precision),At,Dt*.75)},vt.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},vt.prototype.onPropertyChanged=function(It,At){var Dt=(this.properties.step+"").split(".");this._precision=Dt.length>1?Dt[1].length:0},vt.prototype.onMouseDown=function(It,At){if(!(At[1]<0))return this.old_y=It.canvasY,this.captureInput(!0),this.mouse_captured=!0,!0},vt.prototype.onMouseMove=function(It){if(!!this.mouse_captured){var At=this.old_y-It.canvasY;It.shiftKey&&(At*=10),(It.metaKey||It.altKey)&&(At*=.1),this.old_y=It.canvasY;var Dt=this._remainder+At/vt.pixels_threshold;this._remainder=Dt%1,Dt=Dt|0;var kt=clamp(this.properties.value+Dt*this.properties.step,this.properties.min,this.properties.max);this.properties.value=kt,this.graph._version++,this.setDirtyCanvas(!0)}},vt.prototype.onMouseUp=function(It,At){if(It.click_time<200){var Dt=At[1]>this.size[1]*.5?-1:1;this.properties.value=clamp(this.properties.value+Dt*this.properties.step,this.properties.min,this.properties.max),this.graph._version++,this.setDirtyCanvas(!0)}this.mouse_captured&&(this.mouse_captured=!1,this.captureInput(!1))},it.registerNodeType("widget/number",vt);function _t(){this.addOutput("","string"),this.addOutput("change",it.EVENT),this.size=[80,60],this.properties={value:"A",values:"A;B;C"},this.old_y=-1,this.mouse_captured=!1,this._values=this.properties.values.split(";");var It=this;this.widgets_up=!0,this.widget=this.addWidget("combo","",this.properties.value,function(At){It.properties.value=At,It.triggerSlot(1,At)},{property:"value",values:this._values})}_t.title="Combo",_t.desc="Widget to select from a list",_t.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},_t.prototype.onPropertyChanged=function(It,At){It=="values"?(this._values=At.split(";"),this.widget.options.values=this._values):It=="value"&&(this.widget.value=At)},it.registerNodeType("widget/combo",_t);function bt(){this.addOutput("","number"),this.size=[64,84],this.properties={min:0,max:1,value:.5,color:"#7AF",precision:2},this.value=-1}bt.title="Knob",bt.desc="Circular controller",bt.size=[80,100],bt.prototype.onDrawForeground=function(It){if(!this.flags.collapsed){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min));var At=this.size[0]*.5,Dt=this.size[1]*.5,kt=Math.min(this.size[0],this.size[1])*.5-5;It.globalAlpha=1,It.save(),It.translate(At,Dt),It.rotate(Math.PI*.75),It.fillStyle="rgba(0,0,0,0.5)",It.beginPath(),It.moveTo(0,0),It.arc(0,0,kt,0,Math.PI*1.5),It.fill(),It.strokeStyle="black",It.fillStyle=this.properties.color,It.lineWidth=2,It.beginPath(),It.moveTo(0,0),It.arc(0,0,kt-4,0,Math.PI*1.5*Math.max(.01,this.value)),It.closePath(),It.fill(),It.lineWidth=1,It.globalAlpha=1,It.restore(),It.fillStyle="black",It.beginPath(),It.arc(At,Dt,kt*.75,0,Math.PI*2,!0),It.fill(),It.fillStyle=this.mouseOver?"white":this.properties.color,It.beginPath();var Mt=this.value*Math.PI*1.5+Math.PI*.75;It.arc(At+Math.cos(Mt)*kt*.65,Dt+Math.sin(Mt)*kt*.65,kt*.05,0,Math.PI*2,!0),It.fill(),It.fillStyle=this.mouseOver?"white":"#AAA",It.font=Math.floor(kt*.5)+"px Arial",It.textAlign="center",It.fillText(this.properties.value.toFixed(this.properties.precision),At,Dt+kt*.15)}},bt.prototype.onExecute=function(){this.setOutputData(0,this.properties.value),this.boxcolor=it.colorToString([this.value,this.value,this.value])},bt.prototype.onMouseDown=function(It){return this.center=[this.size[0]*.5,this.size[1]*.5+20],this.radius=this.size[0]*.5,It.canvasY-this.pos[1]<20||it.distance([It.canvasX,It.canvasY],[this.pos[0]+this.center[0],this.pos[1]+this.center[1]])>this.radius?!1:(this.oldmouse=[It.canvasX-this.pos[0],It.canvasY-this.pos[1]],this.captureInput(!0),!0)},bt.prototype.onMouseMove=function(It){if(!!this.oldmouse){var At=[It.canvasX-this.pos[0],It.canvasY-this.pos[1]],Dt=this.value;Dt-=(At[1]-this.oldmouse[1])*.01,Dt>1?Dt=1:Dt<0&&(Dt=0),this.value=Dt,this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.oldmouse=At,this.setDirtyCanvas(!0)}},bt.prototype.onMouseUp=function(It){this.oldmouse&&(this.oldmouse=null,this.captureInput(!1))},bt.prototype.onPropertyChanged=function(It,At){if(It=="min"||It=="max"||It=="value")return this.properties[It]=parseFloat(At),!0},it.registerNodeType("widget/knob",bt);function xt(){this.addOutput("","number"),this.properties={value:.5,min:0,max:1,text:"V"};var It=this;this.size=[140,40],this.slider=this.addWidget("slider","V",this.properties.value,function(At){It.properties.value=At},this.properties),this.widgets_up=!0}xt.title="Inner Slider",xt.prototype.onPropertyChanged=function(It,At){It=="value"&&(this.slider.value=At)},xt.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},it.registerNodeType("widget/internal_slider",xt);function Tt(){this.size=[160,26],this.addOutput("","number"),this.properties={color:"#7AF",min:0,max:1,value:.5},this.value=-1}Tt.title="H.Slider",Tt.desc="Linear slider controller",Tt.prototype.onDrawForeground=function(It){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min)),It.globalAlpha=1,It.lineWidth=1,It.fillStyle="#000",It.fillRect(2,2,this.size[0]-4,this.size[1]-4),It.fillStyle=this.properties.color,It.beginPath(),It.rect(4,4,(this.size[0]-8)*this.value,this.size[1]-8),It.fill()},Tt.prototype.onExecute=function(){this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.setOutputData(0,this.properties.value),this.boxcolor=it.colorToString([this.value,this.value,this.value])},Tt.prototype.onMouseDown=function(It){return It.canvasY-this.pos[1]<0?!1:(this.oldmouse=[It.canvasX-this.pos[0],It.canvasY-this.pos[1]],this.captureInput(!0),!0)},Tt.prototype.onMouseMove=function(It){if(!!this.oldmouse){var At=[It.canvasX-this.pos[0],It.canvasY-this.pos[1]],Dt=this.value,kt=At[0]-this.oldmouse[0];Dt+=kt/this.size[0],Dt>1?Dt=1:Dt<0&&(Dt=0),this.value=Dt,this.oldmouse=At,this.setDirtyCanvas(!0)}},Tt.prototype.onMouseUp=function(It){this.oldmouse=null,this.captureInput(!1)},Tt.prototype.onMouseLeave=function(It){},it.registerNodeType("widget/hslider",Tt);function Et(){this.size=[160,26],this.addInput("","number"),this.properties={min:0,max:1,value:0,color:"#AAF"}}Et.title="Progress",Et.desc="Shows data in linear progress",Et.prototype.onExecute=function(){var It=this.getInputData(0);It!=null&&(this.properties.value=It)},Et.prototype.onDrawForeground=function(It){It.lineWidth=1,It.fillStyle=this.properties.color;var At=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min);At=Math.min(1,At),At=Math.max(0,At),It.fillRect(2,2,(this.size[0]-4)*At,this.size[1]-4)},it.registerNodeType("widget/progress",Et);function wt(){this.addInputs("",0),this.properties={value:"...",font:"Arial",fontsize:18,color:"#AAA",align:"left",glowSize:0,decimals:1}}wt.title="Text",wt.desc="Shows the input value",wt.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"led_text",text:"LED",type:"minibutton"},{name:"normal_text",text:"Normal",type:"minibutton"}],wt.prototype.onDrawForeground=function(It){It.fillStyle=this.properties.color;var At=this.properties.value;this.properties.glowSize?(It.shadowColor=this.properties.color,It.shadowOffsetX=0,It.shadowOffsetY=0,It.shadowBlur=this.properties.glowSize):It.shadowColor="transparent";var Dt=this.properties.fontsize;if(It.textAlign=this.properties.align,It.font=Dt.toString()+"px "+this.properties.font,this.str=typeof At=="number"?At.toFixed(this.properties.decimals):At,typeof this.str=="string")for(var kt=this.str.replace(/[\r\n]/g,"\\n").split("\\n"),Mt=0;Mt<kt.length;Mt++)It.fillText(kt[Mt],this.properties.align=="left"?15:this.size[0]-15,Dt*-.15+Dt*(parseInt(Mt)+1));It.shadowColor="transparent",this.last_ctx=It,It.textAlign="left"},wt.prototype.onExecute=function(){var It=this.getInputData(0);It!=null&&(this.properties.value=It)},wt.prototype.resize=function(){if(!!this.last_ctx){var It=this.str.split("\\n");this.last_ctx.font=this.properties.fontsize+"px "+this.properties.font;for(var At=0,Dt=0;Dt<It.length;Dt++){var kt=this.last_ctx.measureText(It[Dt]).width;At<kt&&(At=kt)}this.size[0]=At+20,this.size[1]=4+It.length*this.properties.fontsize,this.setDirtyCanvas(!0)}},wt.prototype.onPropertyChanged=function(It,At){return this.properties[It]=At,this.str=typeof At=="number"?At.toFixed(3):At,!0},it.registerNodeType("widget/text",wt);function Ot(){this.size=[200,100],this.properties={borderColor:"#ffffff",bgcolorTop:"#f0f0f0",bgcolorBottom:"#e0e0e0",shadowSize:2,borderRadius:3}}Ot.title="Panel",Ot.desc="Non interactive panel",Ot.widgets=[{name:"update",text:"Update",type:"button"}],Ot.prototype.createGradient=function(It){if(this.properties.bgcolorTop==""||this.properties.bgcolorBottom==""){this.lineargradient=0;return}this.lineargradient=It.createLinearGradient(0,0,0,this.size[1]),this.lineargradient.addColorStop(0,this.properties.bgcolorTop),this.lineargradient.addColorStop(1,this.properties.bgcolorBottom)},Ot.prototype.onDrawForeground=function(It){this.flags.collapsed||(this.lineargradient==null&&this.createGradient(It),this.lineargradient&&(It.lineWidth=1,It.strokeStyle=this.properties.borderColor,It.fillStyle=this.lineargradient,this.properties.shadowSize?(It.shadowColor="#000",It.shadowOffsetX=0,It.shadowOffsetY=0,It.shadowBlur=this.properties.shadowSize):It.shadowColor="transparent",It.roundRect(0,0,this.size[0]-1,this.size[1]-1,this.properties.shadowSize),It.fill(),It.shadowColor="transparent",It.stroke()))},it.registerNodeType("widget/panel",Ot)}(commonjsGlobal),function(rt){var it=rt.LiteGraph;function nt(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",it.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}nt.title="Gamepad",nt.desc="gets the input of the gamepad",nt.CENTER=0,nt.LEFT=1,nt.RIGHT=2,nt.UP=4,nt.DOWN=8,nt.zero=new Float32Array(2),nt.buttons=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"],nt.prototype.onExecute=function(){var st=this.getGamepad(),vt=this.properties.threshold||0;if(st&&(this._left_axis[0]=Math.abs(st.xbox.axes.lx)>vt?st.xbox.axes.lx:0,this._left_axis[1]=Math.abs(st.xbox.axes.ly)>vt?st.xbox.axes.ly:0,this._right_axis[0]=Math.abs(st.xbox.axes.rx)>vt?st.xbox.axes.rx:0,this._right_axis[1]=Math.abs(st.xbox.axes.ry)>vt?st.xbox.axes.ry:0,this._triggers[0]=Math.abs(st.xbox.axes.ltrigger)>vt?st.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(st.xbox.axes.rtrigger)>vt?st.xbox.axes.rtrigger:0),this.outputs)for(var _t=0;_t<this.outputs.length;_t++){var bt=this.outputs[_t];if(!(!bt.links||!bt.links.length)){var xt=null;if(st)switch(bt.name){case"left_axis":xt=this._left_axis;break;case"right_axis":xt=this._right_axis;break;case"left_x_axis":xt=this._left_axis[0];break;case"left_y_axis":xt=this._left_axis[1];break;case"right_x_axis":xt=this._right_axis[0];break;case"right_y_axis":xt=this._right_axis[1];break;case"trigger_left":xt=this._triggers[0];break;case"trigger_right":xt=this._triggers[1];break;case"a_button":xt=st.xbox.buttons.a?1:0;break;case"b_button":xt=st.xbox.buttons.b?1:0;break;case"x_button":xt=st.xbox.buttons.x?1:0;break;case"y_button":xt=st.xbox.buttons.y?1:0;break;case"lb_button":xt=st.xbox.buttons.lb?1:0;break;case"rb_button":xt=st.xbox.buttons.rb?1:0;break;case"ls_button":xt=st.xbox.buttons.ls?1:0;break;case"rs_button":xt=st.xbox.buttons.rs?1:0;break;case"hat_left":xt=st.xbox.hatmap&nt.LEFT;break;case"hat_right":xt=st.xbox.hatmap&nt.RIGHT;break;case"hat_up":xt=st.xbox.hatmap&nt.UP;break;case"hat_down":xt=st.xbox.hatmap&nt.DOWN;break;case"hat":xt=st.xbox.hatmap;break;case"start_button":xt=st.xbox.buttons.start?1:0;break;case"back_button":xt=st.xbox.buttons.back?1:0;break;case"button_pressed":for(var Tt=0;Tt<this._current_buttons.length;++Tt)this._current_buttons[Tt]&&!this._previous_buttons[Tt]&&this.triggerSlot(_t,nt.buttons[Tt]);break}else switch(bt.name){case"button_pressed":break;case"left_axis":case"right_axis":xt=nt.zero;break;default:xt=0}this.setOutputData(_t,xt)}}},nt.mapping={a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11},nt.mapping_array=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs"],nt.prototype.getGamepad=function(){var st=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!st)return null;var vt=st.call(navigator),_t=null;this._previous_buttons.set(this._current_buttons);for(var bt=this.properties.gamepad_index;bt<4;bt++)if(!!vt[bt]){_t=vt[bt];var xt=this.xbox_mapping;xt||(xt=this.xbox_mapping={axes:[],buttons:{},hat:"",hatmap:nt.CENTER}),xt.axes.lx=_t.axes[0],xt.axes.ly=_t.axes[1],xt.axes.rx=_t.axes[2],xt.axes.ry=_t.axes[3],xt.axes.ltrigger=_t.buttons[6].value,xt.axes.rtrigger=_t.buttons[7].value,xt.hat="",xt.hatmap=nt.CENTER;for(var Tt=0;Tt<_t.buttons.length;Tt++)if(this._current_buttons[Tt]=_t.buttons[Tt].pressed,Tt<12)xt.buttons[nt.mapping_array[Tt]]=_t.buttons[Tt].pressed,_t.buttons[Tt].was_pressed&&this.trigger(nt.mapping_array[Tt]+"_button_event");else switch(Tt){case 12:_t.buttons[Tt].pressed&&(xt.hat+="up",xt.hatmap|=nt.UP);break;case 13:_t.buttons[Tt].pressed&&(xt.hat+="down",xt.hatmap|=nt.DOWN);break;case 14:_t.buttons[Tt].pressed&&(xt.hat+="left",xt.hatmap|=nt.LEFT);break;case 15:_t.buttons[Tt].pressed&&(xt.hat+="right",xt.hatmap|=nt.RIGHT);break;case 16:xt.buttons.home=_t.buttons[Tt].pressed;break}return _t.xbox=xt,_t}},nt.prototype.onDrawBackground=function(st){if(!this.flags.collapsed){var vt=this._left_axis,_t=this._right_axis;st.strokeStyle="#88A",st.strokeRect((vt[0]+1)*.5*this.size[0]-4,(vt[1]+1)*.5*this.size[1]-4,8,8),st.strokeStyle="#8A8",st.strokeRect((_t[0]+1)*.5*this.size[0]-4,(_t[1]+1)*.5*this.size[1]-4,8,8);var bt=this.size[1]/this._current_buttons.length;st.fillStyle="#AEB";for(var xt=0;xt<this._current_buttons.length;++xt)this._current_buttons[xt]&&st.fillRect(0,bt*xt,6,bt)}},nt.prototype.onGetOutputs=function(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start_button","number"],["back_button","number"],["a_button_event",it.EVENT],["b_button_event",it.EVENT],["x_button_event",it.EVENT],["y_button_event",it.EVENT],["lb_button_event",it.EVENT],["rb_button_event",it.EVENT],["ls_button_event",it.EVENT],["rs_button_event",it.EVENT],["start_button_event",it.EVENT],["back_button_event",it.EVENT],["hat_left","number"],["hat_right","number"],["hat_up","number"],["hat_down","number"],["hat","number"],["button_pressed",it.EVENT]]},it.registerNodeType("input/gamepad",nt)}(commonjsGlobal),function(rt){var it=rt.LiteGraph;function nt(){this.addInput("in",0),this.addOutput("out",0),this.size=[80,30]}nt.title="Converter",nt.desc="type A to type B",nt.prototype.onExecute=function(){var Rt=this.getInputData(0);if(Rt!=null&&this.outputs)for(var Yt=0;Yt<this.outputs.length;Yt++){var Ht=this.outputs[Yt];if(!(!Ht.links||!Ht.links.length)){var jt=null;switch(Ht.name){case"number":jt=Rt.length?Rt[0]:parseFloat(Rt);break;case"vec2":case"vec3":case"vec4":var jt=null,qt=1;switch(Ht.name){case"vec2":qt=2;break;case"vec3":qt=3;break;case"vec4":qt=4;break}var jt=new Float32Array(qt);if(Rt.length)for(var ri=0;ri<Rt.length&&ri<jt.length;ri++)jt[ri]=Rt[ri];else jt[0]=parseFloat(Rt);break}this.setOutputData(Yt,jt)}}},nt.prototype.onGetOutputs=function(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]},it.registerNodeType("math/converter",nt);function st(){this.addInput("in"),this.addOutput("out"),this.size=[80,30]}st.title="Bypass",st.desc="removes the type",st.prototype.onExecute=function(){var Rt=this.getInputData(0);this.setOutputData(0,Rt)},it.registerNodeType("math/bypass",st);function vt(){this.addInput("in"),this.addOutput("out")}vt.title="to Number",vt.desc="Cast to number",vt.prototype.onExecute=function(){var Rt=this.getInputData(0);this.setOutputData(0,Number(Rt))},it.registerNodeType("math/to_number",vt);function _t(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addOutput("clamped","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[120,50]}_t.title="Range",_t.desc="Convert a number from one range to another",_t.prototype.getTitle=function(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title},_t.prototype.onExecute=function(){if(this.inputs)for(var Rt=0;Rt<this.inputs.length;Rt++){var Yt=this.inputs[Rt],Ht=this.getInputData(Rt);Ht!==void 0&&(this.properties[Yt.name]=Ht)}var Ht=this.properties.in;(Ht==null||Ht.constructor!==Number)&&(Ht=0);var jt=this.properties.in_min,qt=this.properties.in_max,ri=this.properties.out_min,oi=this.properties.out_max;this._last_v=(Ht-jt)/(qt-jt)*(oi-ri)+ri,this.setOutputData(0,this._last_v),this.setOutputData(1,clamp(this._last_v,ri,oi))},_t.prototype.onDrawBackground=function(Rt){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"},_t.prototype.onGetInputs=function(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]},it.registerNodeType("math/range",_t);function bt(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[80,30]}bt.title="Rand",bt.desc="Random number",bt.prototype.onExecute=function(){if(this.inputs)for(var Rt=0;Rt<this.inputs.length;Rt++){var Yt=this.inputs[Rt],Ht=this.getInputData(Rt);Ht!==void 0&&(this.properties[Yt.name]=Ht)}var jt=this.properties.min,qt=this.properties.max;this._last_v=Math.random()*(qt-jt)+jt,this.setOutputData(0,this._last_v)},bt.prototype.onDrawBackground=function(Rt){this.outputs[0].label=(this._last_v||0).toFixed(3)},bt.prototype.onGetInputs=function(){return[["min","number"],["max","number"]]},it.registerNodeType("math/rand",bt);function xt(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("min",0),this.addProperty("max",1),this.addProperty("smooth",!0),this.addProperty("seed",0),this.addProperty("octaves",1),this.addProperty("persistence",.8),this.addProperty("speed",1),this.size=[90,30]}xt.title="Noise",xt.desc="Random number with temporal continuity",xt.data=null,xt.getValue=function(qt,Yt){if(!xt.data){xt.data=new Float32Array(1024);for(var Ht=0;Ht<xt.data.length;++Ht)xt.data[Ht]=Math.random()}qt=qt%1024,qt<0&&(qt+=1024);var jt=Math.floor(qt),qt=qt-jt,ri=xt.data[jt],oi=xt.data[jt==1023?0:jt+1];return Yt&&(qt=qt*qt*qt*(qt*(qt*6-15)+10)),ri*(1-qt)+oi*qt},xt.prototype.onExecute=function(){var Rt=this.getInputData(0)||0,Yt=this.properties.octaves||1,Ht=0,jt=1,qt=this.properties.seed||0;Rt+=qt;for(var ri=this.properties.speed||1,oi=0,fi=0;fi<Yt&&(Ht+=xt.getValue(Rt*(1+fi)*ri,this.properties.smooth)*jt,oi+=jt,jt*=this.properties.persistence,!(jt<.001));++fi);Ht/=oi;var bi=this.properties.min,ai=this.properties.max;this._last_v=Ht*(ai-bi)+bi,this.setOutputData(0,this._last_v)},xt.prototype.onDrawBackground=function(Rt){this.outputs[0].label=(this._last_v||0).toFixed(3)},it.registerNodeType("math/noise",xt);function Tt(){this.addOutput("out","number"),this.addProperty("min_time",1),this.addProperty("max_time",2),this.addProperty("duration",.2),this.size=[90,30],this._remaining_time=0,this._blink_time=0}Tt.title="Spikes",Tt.desc="spike every random time",Tt.prototype.onExecute=function(){var Rt=this.graph.elapsed_time;this._remaining_time-=Rt,this._blink_time-=Rt;var Yt=0;if(this._blink_time>0){var Ht=this._blink_time/this.properties.duration;Yt=1/(Math.pow(Ht*8-4,4)+1)}this._remaining_time<0?(this._remaining_time=Math.random()*(this.properties.max_time-this.properties.min_time)+this.properties.min_time,this._blink_time=this.properties.duration,this.boxcolor="#FFF"):this.boxcolor="#000",this.setOutputData(0,Yt)},it.registerNodeType("math/spikes",Tt);function Et(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("min",0),this.addProperty("max",1)}Et.title="Clamp",Et.desc="Clamp number between min and max",Et.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt!=null&&(Rt=Math.max(this.properties.min,Rt),Rt=Math.min(this.properties.max,Rt),this.setOutputData(0,Rt))},Et.prototype.getCode=function(Rt){var Yt="";return this.isInputConnected(0)&&(Yt+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),Yt},it.registerNodeType("math/clamp",Et);function wt(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}wt.title="Lerp",wt.desc="Linear Interpolation",wt.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt==null&&(Rt=0);var Yt=this.getInputData(1);Yt==null&&(Yt=0);var Ht=this.properties.f,jt=this.getInputData(2);jt!==void 0&&(Ht=jt),this.setOutputData(0,Rt*(1-Ht)+Yt*Ht)},wt.prototype.onGetInputs=function(){return[["f","number"]]},it.registerNodeType("math/lerp",wt);function Ot(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}Ot.title="Abs",Ot.desc="Absolute",Ot.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt!=null&&this.setOutputData(0,Math.abs(Rt))},it.registerNodeType("math/abs",Ot);function It(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}It.title="Floor",It.desc="Floor number to remove fractional part",It.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt!=null&&this.setOutputData(0,Math.floor(Rt))},it.registerNodeType("math/floor",It);function At(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}At.title="Frac",At.desc="Returns fractional part",At.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt!=null&&this.setOutputData(0,Rt%1)},it.registerNodeType("math/frac",At);function Dt(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.properties={A:0,B:1}}Dt.title="Smoothstep",Dt.desc="Smoothstep",Dt.prototype.onExecute=function(){var Rt=this.getInputData(0);if(Rt!==void 0){var Yt=this.properties.A,Ht=this.properties.B;Rt=clamp((Rt-Yt)/(Ht-Yt),0,1),Rt=Rt*Rt*(3-2*Rt),this.setOutputData(0,Rt)}},it.registerNodeType("math/smoothstep",Dt);function kt(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[80,30],this.addProperty("factor",1)}kt.title="Scale",kt.desc="v * factor",kt.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt!=null&&this.setOutputData(0,Rt*this.properties.factor)},it.registerNodeType("math/scale",kt);function Mt(){this.addInput("v","boolean"),this.addInput("A"),this.addInput("B"),this.addOutput("out")}Mt.title="Gate",Mt.desc="if v is true, then outputs A, otherwise B",Mt.prototype.onExecute=function(){var Rt=this.getInputData(0);this.setOutputData(0,this.getInputData(Rt?1:2))},it.registerNodeType("math/gate",Mt);function zt(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}zt.title="Average",zt.desc="Average Filter",zt.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt==null&&(Rt=0);var Yt=this._values.length;this._values[this._current%Yt]=Rt,this._current+=1,this._current>Yt&&(this._current=0);for(var Ht=0,jt=0;jt<Yt;++jt)Ht+=this._values[jt];this.setOutputData(0,Ht/Yt)},zt.prototype.onPropertyChanged=function(Rt,Yt){Yt<1&&(Yt=1),this.properties.samples=Math.round(Yt);var Ht=this._values;this._values=new Float32Array(this.properties.samples),Ht.length<=this._values.length?this._values.set(Ht):this._values.set(Ht.subarray(0,this._values.length))},it.registerNodeType("math/average",zt);function Pt(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[80,30],this._value=null}Pt.title="TendTo",Pt.desc="moves the output value always closer to the input",Pt.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt==null&&(Rt=0);var Yt=this.properties.factor;this._value==null?this._value=Rt:this._value=this._value*(1-Yt)+Rt*Yt,this.setOutputData(0,this._value)},it.registerNodeType("math/tendTo",Pt);function Lt(){this.addInput("A","number,array,object"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:Lt.values}),this._func=Lt.funcs[this.properties.OP],this._result=[]}Lt.values=["+","-","*","/","%","^","max","min"],Lt.funcs={"+":function(Rt,Yt){return Rt+Yt},"-":function(Rt,Yt){return Rt-Yt},x:function(Rt,Yt){return Rt*Yt},X:function(Rt,Yt){return Rt*Yt},"*":function(Rt,Yt){return Rt*Yt},"/":function(Rt,Yt){return Rt/Yt},"%":function(Rt,Yt){return Rt%Yt},"^":function(Rt,Yt){return Math.pow(Rt,Yt)},max:function(Rt,Yt){return Math.max(Rt,Yt)},min:function(Rt,Yt){return Math.min(Rt,Yt)}},Lt.title="Operation",Lt.desc="Easy math operators",Lt["@OP"]={type:"enum",title:"operation",values:Lt.values},Lt.size=[100,60],Lt.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},Lt.prototype.setValue=function(Rt){typeof Rt=="string"&&(Rt=parseFloat(Rt)),this.properties.value=Rt},Lt.prototype.onPropertyChanged=function(Rt,Yt){Rt=="OP"&&(this._func=Lt.funcs[this.properties.OP],this._func||(console.warn("Unknown operation: "+this.properties.OP),this._func=function(Ht){return Ht}))},Lt.prototype.onExecute=function(){var Rt=this.getInputData(0),Yt=this.getInputData(1);Rt!=null?Rt.constructor===Number&&(this.properties.A=Rt):Rt=this.properties.A,Yt!=null?this.properties.B=Yt:Yt=this.properties.B;var Ht=Lt.funcs[this.properties.OP],jt;if(Rt.constructor===Number)jt=0,jt=Ht(Rt,Yt);else if(Rt.constructor===Array){jt=this._result,jt.length=Rt.length;for(var qt=0;qt<Rt.length;++qt)jt[qt]=Ht(Rt[qt],Yt)}else{jt={};for(var qt in Rt)jt[qt]=Ht(Rt[qt],Yt)}this.setOutputData(0,jt)},Lt.prototype.onDrawBackground=function(Rt){this.flags.collapsed||(Rt.font="40px Arial",Rt.fillStyle="#666",Rt.textAlign="center",Rt.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+it.NODE_TITLE_HEIGHT)*.5),Rt.textAlign="left")},it.registerNodeType("math/operation",Lt),it.registerSearchboxExtra("math/operation","MAX",{properties:{OP:"max"},title:"MAX()"}),it.registerSearchboxExtra("math/operation","MIN",{properties:{OP:"min"},title:"MIN()"});function Bt(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}Bt.title="Compare",Bt.desc="compares between two values",Bt.prototype.onExecute=function(){var Rt=this.getInputData(0),Yt=this.getInputData(1);Rt!==void 0?this.properties.A=Rt:Rt=this.properties.A,Yt!==void 0?this.properties.B=Yt:Yt=this.properties.B;for(var Ht=0,jt=this.outputs.length;Ht<jt;++Ht){var qt=this.outputs[Ht];if(!(!qt.links||!qt.links.length)){var ri;switch(qt.name){case"A==B":ri=Rt==Yt;break;case"A!=B":ri=Rt!=Yt;break;case"A>B":ri=Rt>Yt;break;case"A<B":ri=Rt<Yt;break;case"A<=B":ri=Rt<=Yt;break;case"A>=B":ri=Rt>=Yt;break}this.setOutputData(Ht,ri)}}},Bt.prototype.onGetOutputs=function(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]},it.registerNodeType("math/compare",Bt),it.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),it.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),it.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),it.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),it.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),it.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"});function Gt(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","enum",{values:Gt.values}),this.addWidget("combo","Cond.",this.properties.OP,{property:"OP",values:Gt.values}),this.size=[80,60]}Gt.values=[">","<","==","!=","<=",">=","||","&&"],Gt["@OP"]={type:"enum",title:"operation",values:Gt.values},Gt.title="Condition",Gt.desc="evaluates condition between A and B",Gt.prototype.getTitle=function(){return"A "+this.properties.OP+" B"},Gt.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt===void 0?Rt=this.properties.A:this.properties.A=Rt;var Yt=this.getInputData(1);Yt===void 0?Yt=this.properties.B:this.properties.B=Yt;var Ht=!0;switch(this.properties.OP){case">":Ht=Rt>Yt;break;case"<":Ht=Rt<Yt;break;case"==":Ht=Rt==Yt;break;case"!=":Ht=Rt!=Yt;break;case"<=":Ht=Rt<=Yt;break;case">=":Ht=Rt>=Yt;break;case"||":Ht=Rt||Yt;break;case"&&":Ht=Rt&&Yt;break}this.setOutputData(0,Ht),this.setOutputData(1,!Ht)},it.registerNodeType("math/condition",Gt);function Ut(){this.addInput("in",0),this.addInput("cond","boolean"),this.addOutput("true",0),this.addOutput("false",0),this.size=[80,60]}Ut.title="Branch",Ut.desc="If condition is true, outputs IN in true, otherwise in false",Ut.prototype.onExecute=function(){var Rt=this.getInputData(0),Yt=this.getInputData(1);Yt?(this.setOutputData(0,Rt),this.setOutputData(1,null)):(this.setOutputData(0,null),this.setOutputData(1,Rt))},it.registerNodeType("math/branch",Ut);function Zt(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}Zt.title="Accumulate",Zt.desc="Increments a value every time",Zt.prototype.onExecute=function(){this.properties.value===null&&(this.properties.value=0);var Rt=this.getInputData(0);Rt!==null?this.properties.value+=Rt:this.properties.value+=this.properties.increment,this.setOutputData(0,this.properties.value)},it.registerNodeType("math/accumulate",Zt);function Jt(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}Jt.title="Trigonometry",Jt.desc="Sin Cos Tan",Jt.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt==null&&(Rt=0);var Yt=this.properties.amplitude,Ht=this.findInputSlot("amplitude");Ht!=-1&&(Yt=this.getInputData(Ht));var jt=this.properties.offset;Ht=this.findInputSlot("offset"),Ht!=-1&&(jt=this.getInputData(Ht));for(var qt=0,ri=this.outputs.length;qt<ri;++qt){var oi=this.outputs[qt],fi;switch(oi.name){case"sin":fi=Math.sin(Rt);break;case"cos":fi=Math.cos(Rt);break;case"tan":fi=Math.tan(Rt);break;case"asin":fi=Math.asin(Rt);break;case"acos":fi=Math.acos(Rt);break;case"atan":fi=Math.atan(Rt);break}this.setOutputData(qt,Yt*fi+jt)}},Jt.prototype.onGetInputs=function(){return[["v","number"],["amplitude","number"],["offset","number"]]},Jt.prototype.onGetOutputs=function(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]},it.registerNodeType("math/trigonometry",Jt),it.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),it.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),it.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"});function ei(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.code_widget=this.addWidget("text","F(x,y)",this.properties.formula,function(Rt,Yt,Ht){Ht.properties.formula=Rt}),this.addWidget("toggle","allow",it.allow_scripts,function(Rt){it.allow_scripts=Rt}),this._func=null}ei.title="Formula",ei.desc="Compute formula",ei.size=[160,100],zt.prototype.onPropertyChanged=function(Rt,Yt){Rt=="formula"&&(this.code_widget.value=Yt)},ei.prototype.onExecute=function(){if(!!it.allow_scripts){var Rt=this.getInputData(0),Yt=this.getInputData(1);Rt!=null?this.properties.x=Rt:Rt=this.properties.x,Yt!=null?this.properties.y=Yt:Yt=this.properties.y,this.properties.formula;var Ht;try{(!this._func||this._func_code!=this.properties.formula)&&(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula),Ht=this._func(Rt,Yt,this.graph.globaltime),this.boxcolor=null}catch{this.boxcolor="red"}this.setOutputData(0,Ht)}},ei.prototype.getTitle=function(){return this._func_code||"Formula"},ei.prototype.onDrawBackground=function(){var Rt=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=Rt)},it.registerNodeType("math/formula",ei);function ii(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}ii.title="Vec2->XY",ii.desc="vector 2 to components",ii.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt!=null&&(this.setOutputData(0,Rt[0]),this.setOutputData(1,Rt[1]))},it.registerNodeType("math3d/vec2-to-xy",ii);function li(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}li.title="XY->Vec2",li.desc="components to vector2",li.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt==null&&(Rt=this.properties.x);var Yt=this.getInputData(1);Yt==null&&(Yt=this.properties.y);var Ht=this._data;Ht[0]=Rt,Ht[1]=Yt,this.setOutputData(0,Ht)},it.registerNodeType("math3d/xy-to-vec2",li);function pi(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}pi.title="Vec3->XYZ",pi.desc="vector 3 to components",pi.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt!=null&&(this.setOutputData(0,Rt[0]),this.setOutputData(1,Rt[1]),this.setOutputData(2,Rt[2]))},it.registerNodeType("math3d/vec3-to-xyz",pi);function ci(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}ci.title="XYZ->Vec3",ci.desc="components to vector3",ci.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt==null&&(Rt=this.properties.x);var Yt=this.getInputData(1);Yt==null&&(Yt=this.properties.y);var Ht=this.getInputData(2);Ht==null&&(Ht=this.properties.z);var jt=this._data;jt[0]=Rt,jt[1]=Yt,jt[2]=Ht,this.setOutputData(0,jt)},it.registerNodeType("math3d/xyz-to-vec3",ci);function Wt(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}Wt.title="Vec4->XYZW",Wt.desc="vector 4 to components",Wt.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt!=null&&(this.setOutputData(0,Rt[0]),this.setOutputData(1,Rt[1]),this.setOutputData(2,Rt[2]),this.setOutputData(3,Rt[3]))},it.registerNodeType("math3d/vec4-to-xyzw",Wt);function $t(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}$t.title="XYZW->Vec4",$t.desc="components to vector4",$t.prototype.onExecute=function(){var Rt=this.getInputData(0);Rt==null&&(Rt=this.properties.x);var Yt=this.getInputData(1);Yt==null&&(Yt=this.properties.y);var Ht=this.getInputData(2);Ht==null&&(Ht=this.properties.z);var jt=this.getInputData(3);jt==null&&(jt=this.properties.w);var qt=this._data;qt[0]=Rt,qt[1]=Yt,qt[2]=Ht,qt[3]=jt,this.setOutputData(0,qt)},it.registerNodeType("math3d/xyzw-to-vec4",$t)}(commonjsGlobal),function(rt){var it=rt.LiteGraph;function nt(){this.addInput("T","vec3"),this.addInput("R","vec3"),this.addInput("S","vec3"),this.addOutput("mat4","mat4"),this.properties={T:[0,0,0],R:[0,0,0],S:[1,1,1],R_in_degrees:!0},this._result=mat4.create(),this._must_update=!0}nt.title="mat4",nt.temp_quat=new Float32Array([0,0,0,1]),nt.temp_mat4=new Float32Array(16),nt.temp_vec3=new Float32Array(3),nt.prototype.onPropertyChanged=function(Et,wt){this._must_update=!0},nt.prototype.onExecute=function(){var Et=this._result,wt=nt.temp_quat,Ot=nt.temp_mat4,It=nt.temp_vec3,At=this.getInputData(0),Dt=this.getInputData(1),kt=this.getInputData(2);(this._must_update||At||Dt||kt)&&(At=At||this.properties.T,Dt=Dt||this.properties.R,kt=kt||this.properties.S,mat4.identity(Et),mat4.translate(Et,Et,At),this.properties.R_in_degrees?(It.set(Dt),vec3.scale(It,It,DEG2RAD),quat.fromEuler(wt,It)):quat.fromEuler(wt,Dt),mat4.fromQuat(Ot,wt),mat4.multiply(Et,Et,Ot),mat4.scale(Et,Et,kt)),this.setOutputData(0,Et)},it.registerNodeType("math3d/mat4",nt);function st(){this.addInput("A","number,vec3"),this.addInput("B","number,vec3"),this.addOutput("=","number,vec3"),this.addProperty("OP","+","enum",{values:st.values}),this._result=vec3.create()}st.values=["+","-","*","/","%","^","max","min","dot","cross"],it.registerSearchboxExtra("math3d/operation","CROSS()",{properties:{OP:"cross"},title:"CROSS()"}),it.registerSearchboxExtra("math3d/operation","DOT()",{properties:{OP:"dot"},title:"DOT()"}),st.title="Operation",st.desc="Easy math 3D operators",st["@OP"]={type:"enum",title:"operation",values:st.values},st.size=[100,60],st.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},st.prototype.onExecute=function(){var Et=this.getInputData(0),wt=this.getInputData(1);if(!(Et==null||wt==null)){Et.constructor===Number&&(Et=[Et,Et,Et]),wt.constructor===Number&&(wt=[wt,wt,wt]);var Ot=this._result;switch(this.properties.OP){case"+":Ot=vec3.add(Ot,Et,wt);break;case"-":Ot=vec3.sub(Ot,Et,wt);break;case"x":case"X":case"*":Ot=vec3.mul(Ot,Et,wt);break;case"/":Ot=vec3.div(Ot,Et,wt);break;case"%":Ot[0]=Et[0]%wt[0],Ot[1]=Et[1]%wt[1],Ot[2]=Et[2]%wt[2];break;case"^":Ot[0]=Math.pow(Et[0],wt[0]),Ot[1]=Math.pow(Et[1],wt[1]),Ot[2]=Math.pow(Et[2],wt[2]);break;case"max":Ot[0]=Math.max(Et[0],wt[0]),Ot[1]=Math.max(Et[1],wt[1]),Ot[2]=Math.max(Et[2],wt[2]);break;case"min":Ot[0]=Math.min(Et[0],wt[0]),Ot[1]=Math.min(Et[1],wt[1]),Ot[2]=Math.min(Et[2],wt[2]);case"dot":Ot=vec3.dot(Et,wt);break;case"cross":vec3.cross(Ot,Et,wt);break;default:console.warn("Unknown operation: "+this.properties.OP)}this.setOutputData(0,Ot)}},st.prototype.onDrawBackground=function(Et){this.flags.collapsed||(Et.font="40px Arial",Et.fillStyle="#666",Et.textAlign="center",Et.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+it.NODE_TITLE_HEIGHT)*.5),Et.textAlign="left")},it.registerNodeType("math3d/operation",st);function vt(){this.addInput("in","vec3"),this.addInput("f","number"),this.addOutput("out","vec3"),this.properties={f:1},this._data=new Float32Array(3)}vt.title="vec3_scale",vt.desc="scales the components of a vec3",vt.prototype.onExecute=function(){var Et=this.getInputData(0);if(Et!=null){var wt=this.getInputData(1);wt==null&&(wt=this.properties.f);var Ot=this._data;Ot[0]=Et[0]*wt,Ot[1]=Et[1]*wt,Ot[2]=Et[2]*wt,this.setOutputData(0,Ot)}},it.registerNodeType("math3d/vec3-scale",vt);function _t(){this.addInput("in","vec3"),this.addOutput("out","number")}_t.title="vec3_length",_t.desc="returns the module of a vector",_t.prototype.onExecute=function(){var Et=this.getInputData(0);if(Et!=null){var wt=Math.sqrt(Et[0]*Et[0]+Et[1]*Et[1]+Et[2]*Et[2]);this.setOutputData(0,wt)}},it.registerNodeType("math3d/vec3-length",_t);function bt(){this.addInput("in","vec3"),this.addOutput("out","vec3"),this._data=new Float32Array(3)}bt.title="vec3_normalize",bt.desc="returns the vector normalized",bt.prototype.onExecute=function(){var Et=this.getInputData(0);if(Et!=null){var wt=Math.sqrt(Et[0]*Et[0]+Et[1]*Et[1]+Et[2]*Et[2]),Ot=this._data;Ot[0]=Et[0]/wt,Ot[1]=Et[1]/wt,Ot[2]=Et[2]/wt,this.setOutputData(0,Ot)}},it.registerNodeType("math3d/vec3-normalize",bt);function xt(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addInput("f","vec3"),this.addOutput("out","vec3"),this.properties={f:.5},this._data=new Float32Array(3)}xt.title="vec3_lerp",xt.desc="returns the interpolated vector",xt.prototype.onExecute=function(){var Et=this.getInputData(0);if(Et!=null){var wt=this.getInputData(1);if(wt!=null){var Ot=this.getInputOrProperty("f"),It=this._data;It[0]=Et[0]*(1-Ot)+wt[0]*Ot,It[1]=Et[1]*(1-Ot)+wt[1]*Ot,It[2]=Et[2]*(1-Ot)+wt[2]*Ot,this.setOutputData(0,It)}}},it.registerNodeType("math3d/vec3-lerp",xt);function Tt(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addOutput("out","number")}if(Tt.title="vec3_dot",Tt.desc="returns the dot product",Tt.prototype.onExecute=function(){var Et=this.getInputData(0);if(Et!=null){var wt=this.getInputData(1);if(wt!=null){var Ot=Et[0]*wt[0]+Et[1]*wt[1]+Et[2]*wt[2];this.setOutputData(0,Ot)}}},it.registerNodeType("math3d/vec3-dot",Tt),rt.glMatrix){let Et=function(){this.addOutput("quat","quat"),this.properties={x:0,y:0,z:0,w:1,normalize:!1},this._value=quat.create()},wt=function(){this.addInputs([["degrees","number"],["axis","vec3"]]),this.addOutput("quat","quat"),this.properties={angle:90,axis:vec3.fromValues(0,1,0)},this._value=quat.create()},Ot=function(){this.addInput("euler","vec3"),this.addOutput("quat","quat"),this.properties={euler:[0,0,0],use_yaw_pitch_roll:!1},this._degs=vec3.create(),this._value=quat.create()},It=function(){this.addInput(["quat","quat"]),this.addOutput("euler","vec3"),this._value=vec3.create()},At=function(){this.addInputs([["vec3","vec3"],["quat","quat"]]),this.addOutput("result","vec3"),this.properties={vec:[0,0,1]}},Dt=function(){this.addInputs([["A","quat"],["B","quat"]]),this.addOutput("A*B","quat"),this._value=quat.create()},kt=function(){this.addInputs([["A","quat"],["B","quat"],["factor","number"]]),this.addOutput("slerp","quat"),this.addProperty("factor",.5),this._value=quat.create()},Mt=function(){this.addInput("vec3","vec3"),this.addOutput("remap","vec3"),this.addOutput("clamped","vec3"),this.properties={clamp:!0,range_min:[-1,-1,0],range_max:[1,1,0],target_min:[-1,-1,0],target_max:[1,1,0]},this._value=vec3.create(),this._clamped=vec3.create()};Et.title="Quaternion",Et.desc="quaternion",Et.prototype.onExecute=function(){this._value[0]=this.getInputOrProperty("x"),this._value[1]=this.getInputOrProperty("y"),this._value[2]=this.getInputOrProperty("z"),this._value[3]=this.getInputOrProperty("w"),this.properties.normalize&&quat.normalize(this._value,this._value),this.setOutputData(0,this._value)},Et.prototype.onGetInputs=function(){return[["x","number"],["y","number"],["z","number"],["w","number"]]},it.registerNodeType("math3d/quaternion",Et),wt.title="Rotation",wt.desc="quaternion rotation",wt.prototype.onExecute=function(){var zt=this.getInputData(0);zt==null&&(zt=this.properties.angle);var Pt=this.getInputData(1);Pt==null&&(Pt=this.properties.axis);var Lt=quat.setAxisAngle(this._value,Pt,zt*.0174532925);this.setOutputData(0,Lt)},it.registerNodeType("math3d/rotation",wt),Ot.title="Euler->Quat",Ot.desc="Converts euler angles (in degrees) to quaternion",Ot.prototype.onExecute=function(){var zt=this.getInputData(0);zt==null&&(zt=this.properties.euler),vec3.scale(this._degs,zt,DEG2RAD),this.properties.use_yaw_pitch_roll&&(this._degs=[this._degs[2],this._degs[0],this._degs[1]]);var Pt=quat.fromEuler(this._value,this._degs);this.setOutputData(0,Pt)},it.registerNodeType("math3d/euler_to_quat",Ot),It.title="Euler->Quat",It.desc="Converts rotX,rotY,rotZ in degrees to quat",It.prototype.onExecute=function(){var zt=this.getInputData(0);!zt||(quat.toEuler(this._value,zt),vec3.scale(this._value,this._value,DEG2RAD),this.setOutputData(0,this._value))},it.registerNodeType("math3d/quat_to_euler",It),At.title="Rot. Vec3",At.desc="rotate a point",At.prototype.onExecute=function(){var zt=this.getInputData(0);zt==null&&(zt=this.properties.vec);var Pt=this.getInputData(1);Pt==null?this.setOutputData(zt):this.setOutputData(0,vec3.transformQuat(vec3.create(),zt,Pt))},it.registerNodeType("math3d/rotate_vec3",At),Dt.title="Mult. Quat",Dt.desc="rotate quaternion",Dt.prototype.onExecute=function(){var zt=this.getInputData(0);if(zt!=null){var Pt=this.getInputData(1);if(Pt!=null){var Lt=quat.multiply(this._value,zt,Pt);this.setOutputData(0,Lt)}}},it.registerNodeType("math3d/mult-quat",Dt),kt.title="Quat Slerp",kt.desc="quaternion spherical interpolation",kt.prototype.onExecute=function(){var zt=this.getInputData(0);if(zt!=null){var Pt=this.getInputData(1);if(Pt!=null){var Lt=this.properties.factor;this.getInputData(2)!=null&&(Lt=this.getInputData(2));var Bt=quat.slerp(this._value,zt,Pt,Lt);this.setOutputData(0,Bt)}}},it.registerNodeType("math3d/quat-slerp",kt),Mt.title="Remap Range",Mt.desc="remap a 3D range",Mt.prototype.onExecute=function(){var zt=this.getInputData(0);zt&&this._value.set(zt);for(var Pt=this.properties.range_min,Lt=this.properties.range_max,Bt=this.properties.target_min,Gt=this.properties.target_max,Ut=0;Ut<3;++Ut){var Zt=Lt[Ut]-Pt[Ut];if(this._clamped[Ut]=clamp(this._value[Ut],Pt[Ut],Lt[Ut]),Zt==0){this._value[Ut]=(Bt[Ut]+Gt[Ut])*.5;continue}var Jt=(this._value[Ut]-Pt[Ut])/Zt;this.properties.clamp&&(Jt=clamp(Jt,0,1));var ei=Gt[Ut]-Bt[Ut];this._value[Ut]=Bt[Ut]+Jt*ei}this.setOutputData(0,this._value),this.setOutputData(1,this._clamped)},it.registerNodeType("math3d/remap_range",Mt)}else it.debug&&console.warn("No glmatrix found, some Math3D nodes may not work")}(commonjsGlobal),function(rt){var it=rt.LiteGraph;function nt(wt){if(wt&&wt.constructor===Object)try{return JSON.stringify(wt)}catch{return String(wt)}return String(wt)}it.wrapFunctionAsNode("string/toString",nt,[""],"string");function st(wt,Ot){return wt==Ot}it.wrapFunctionAsNode("string/compare",st,["string","string"],"boolean");function vt(wt,Ot){return wt===void 0?Ot:Ot===void 0?wt:wt+Ot}it.wrapFunctionAsNode("string/concatenate",vt,["string","string"],"string");function _t(wt,Ot){return wt===void 0||Ot===void 0?!1:wt.indexOf(Ot)!=-1}it.wrapFunctionAsNode("string/contains",_t,["string","string"],"boolean");function bt(wt){return wt!=null&&wt.constructor===String?wt.toUpperCase():wt}it.wrapFunctionAsNode("string/toUpperCase",bt,["string"],"string");function xt(wt,Ot){if(Ot==null&&(Ot=this.properties.separator),wt==null)return[];if(wt.constructor===String)return wt.split(Ot||" ");if(wt.constructor===Array){for(var It=[],At=0;At<wt.length;++At)typeof wt[At]=="string"&&(It[At]=wt[At].split(Ot||" "));return It}return null}it.wrapFunctionAsNode("string/split",xt,["string,array","string"],"array",{separator:","});function Tt(wt){return wt!=null&&wt.constructor===Number?wt.toFixed(this.properties.precision):wt}it.wrapFunctionAsNode("string/toFixed",Tt,["number"],"string",{precision:0});function Et(){this.addInput("","string"),this.addOutput("table","table"),this.addOutput("rows","number"),this.addProperty("value",""),this.addProperty("separator",","),this._table=null}Et.title="toTable",Et.desc="Splits a string to table",Et.prototype.onExecute=function(){var wt=this.getInputData(0);if(!!wt){var Ot=this.properties.separator||",";(wt!=this._str||Ot!=this._last_separator)&&(this._last_separator=Ot,this._str=wt,this._table=wt.split(`
`).map(function(It){return It.trim().split(Ot)})),this.setOutputData(0,this._table),this.setOutputData(1,this._table?this._table.length:0)}},it.registerNodeType("string/toTable",Et)}(commonjsGlobal),function(rt){var it=rt.LiteGraph;function nt(){this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0}nt.title="Selector",nt.desc="selects an output",nt.prototype.onDrawBackground=function(Et){if(!this.flags.collapsed){Et.fillStyle="#AFB";var wt=(this.selected+1)*it.NODE_SLOT_HEIGHT+6;Et.beginPath(),Et.moveTo(50,wt),Et.lineTo(50,wt+it.NODE_SLOT_HEIGHT),Et.lineTo(34,wt+it.NODE_SLOT_HEIGHT*.5),Et.fill()}},nt.prototype.onExecute=function(){var Et=this.getInputData(0);(Et==null||Et.constructor!==Number)&&(Et=0),this.selected=Et=Math.round(Et)%(this.inputs.length-1);var wt=this.getInputData(Et+1);wt!==void 0&&this.setOutputData(0,wt)},nt.prototype.onGetInputs=function(){return[["E",0],["F",0],["G",0],["H",0]]},it.registerNodeType("logic/selector",nt);function st(){this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(",")}st.title="Sequence",st.desc="select one element from a sequence from a string",st.prototype.onPropertyChanged=function(Et,wt){Et=="sequence"&&(this.values=wt.split(","))},st.prototype.onExecute=function(){var Et=this.getInputData(1);Et&&Et!=this.current_sequence&&(this.values=Et.split(","),this.current_sequence=Et);var wt=this.getInputData(0);wt==null&&(wt=0),this.index=wt=Math.round(wt)%this.values.length,this.setOutputData(0,this.values[wt])},it.registerNodeType("logic/sequence",st);function vt(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}vt.title="AND",vt.desc="Return true if all inputs are true",vt.prototype.onExecute=function(){var Et=!0;for(var wt in this.inputs)if(!this.getInputData(wt)){var Et=!1;break}this.setOutputData(0,Et)},vt.prototype.onGetInputs=function(){return[["and","boolean"]]},it.registerNodeType("logic/AND",vt);function _t(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}_t.title="OR",_t.desc="Return true if at least one input is true",_t.prototype.onExecute=function(){var Et=!1;for(var wt in this.inputs)if(this.getInputData(wt)){Et=!0;break}this.setOutputData(0,Et)},_t.prototype.onGetInputs=function(){return[["or","boolean"]]},it.registerNodeType("logic/OR",_t);function bt(){this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean")}bt.title="NOT",bt.desc="Return the logical negation",bt.prototype.onExecute=function(){var Et=!this.getInputData(0);this.setOutputData(0,Et)},it.registerNodeType("logic/NOT",bt);function xt(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}xt.title="bool == bool",xt.desc="Compare for logical equality",xt.prototype.onExecute=function(){var Et=null,wt=!0;for(var Ot in this.inputs)if(Et===null)Et=this.getInputData(Ot);else if(Et!=this.getInputData(Ot)){wt=!1;break}this.setOutputData(0,wt)},xt.prototype.onGetInputs=function(){return[["bool","boolean"]]},it.registerNodeType("logic/CompareBool",xt);function Tt(){this.properties={},this.addInput("onTrigger",it.ACTION),this.addInput("condition","boolean"),this.addOutput("true",it.EVENT),this.addOutput("false",it.EVENT),this.mode=it.ON_TRIGGER}Tt.title="Branch",Tt.desc="Branch execution on condition",Tt.prototype.onExecute=function(Et,wt){var Ot=this.getInputData(1);Ot?this.triggerSlot(0):this.triggerSlot(1)},it.registerNodeType("logic/IF",Tt)}(commonjsGlobal),function(rt){var it=rt.LiteGraph;function nt(){this.addInput("A","Number"),this.addInput("B","Number"),this.addInput("C","Number"),this.addInput("D","Number"),this.values=[[],[],[],[]],this.properties={scale:2}}nt.title="Plot",nt.desc="Plots data over time",nt.colors=["#FFF","#F99","#9F9","#99F"],nt.prototype.onExecute=function(At){if(!this.flags.collapsed)for(var Dt=this.size,kt=0;kt<4;++kt){var Mt=this.getInputData(kt);if(Mt!=null){var zt=this.values[kt];zt.push(Mt),zt.length>Dt[0]&&zt.shift()}}},nt.prototype.onDrawBackground=function(At){if(!this.flags.collapsed){var Dt=this.size,kt=.5*Dt[1]/this.properties.scale,Mt=nt.colors,zt=Dt[1]*.5;if(At.fillStyle="#000",At.fillRect(0,0,Dt[0],Dt[1]),At.strokeStyle="#555",At.beginPath(),At.moveTo(0,zt),At.lineTo(Dt[0],zt),At.stroke(),this.inputs)for(var Pt=0;Pt<4;++Pt){var Lt=this.values[Pt];if(!(!this.inputs[Pt]||!this.inputs[Pt].link)){At.strokeStyle=Mt[Pt],At.beginPath();var Bt=Lt[0]*kt*-1+zt;At.moveTo(0,clamp(Bt,0,Dt[1]));for(var Gt=1;Gt<Lt.length&&Gt<Dt[0];++Gt){var Bt=Lt[Gt]*kt*-1+zt;At.lineTo(Gt,clamp(Bt,0,Dt[1]))}At.stroke()}}}},it.registerNodeType("graphics/plot",nt);function st(){this.addOutput("frame","image"),this.properties={url:""}}st.title="Image",st.desc="Image loader",st.widgets=[{name:"load",text:"Load",type:"button"}],st.supported_extensions=["jpg","jpeg","png","gif"],st.prototype.onAdded=function(){this.properties.url!=""&&this.img==null&&this.loadImage(this.properties.url)},st.prototype.onDrawBackground=function(At){this.flags.collapsed||this.img&&this.size[0]>5&&this.size[1]>5&&this.img.width&&At.drawImage(this.img,0,0,this.size[0],this.size[1])},st.prototype.onExecute=function(){this.img||(this.boxcolor="#000"),this.img&&this.img.width?this.setOutputData(0,this.img):this.setOutputData(0,null),this.img&&this.img.dirty&&(this.img.dirty=!1)},st.prototype.onPropertyChanged=function(At,Dt){return this.properties[At]=Dt,At=="url"&&Dt!=""&&this.loadImage(Dt),!0},st.prototype.loadImage=function(At,Dt){if(At==""){this.img=null;return}this.img=document.createElement("img"),At.substr(0,4)=="http"&&it.proxy&&(At=it.proxy+At.substr(At.indexOf(":")+3)),this.img.src=At,this.boxcolor="#F95";var kt=this;this.img.onload=function(){Dt&&Dt(this),console.log("Image loaded, size: "+kt.img.width+"x"+kt.img.height),this.dirty=!0,kt.boxcolor="#9F9",kt.setDirtyCanvas(!0)},this.img.onerror=function(){console.log("error loading the image:"+At)}},st.prototype.onWidget=function(At,Dt){Dt.name=="load"&&this.loadImage(this.properties.url)},st.prototype.onDropFile=function(At){var Dt=this;this._url&&URL.revokeObjectURL(this._url),this._url=URL.createObjectURL(At),this.properties.url=this._url,this.loadImage(this._url,function(kt){Dt.size[1]=kt.height/kt.width*Dt.size[0]})},it.registerNodeType("graphics/image",st);function vt(){this.addInput("f","number"),this.addOutput("Color","color"),this.properties={colorA:"#444444",colorB:"#44AAFF",colorC:"#44FFAA",colorD:"#FFFFFF"}}vt.title="Palette",vt.desc="Generates a color",vt.prototype.onExecute=function(){var At=[];this.properties.colorA!=null&&At.push(hex2num(this.properties.colorA)),this.properties.colorB!=null&&At.push(hex2num(this.properties.colorB)),this.properties.colorC!=null&&At.push(hex2num(this.properties.colorC)),this.properties.colorD!=null&&At.push(hex2num(this.properties.colorD));var Dt=this.getInputData(0);if(Dt==null&&(Dt=.5),Dt>1?Dt=1:Dt<0&&(Dt=0),At.length!=0){var kt=[0,0,0];if(Dt==0)kt=At[0];else if(Dt==1)kt=At[At.length-1];else{var Mt=(At.length-1)*Dt,zt=At[Math.floor(Mt)],Pt=At[Math.floor(Mt)+1],Lt=Mt-Math.floor(Mt);kt[0]=zt[0]*(1-Lt)+Pt[0]*Lt,kt[1]=zt[1]*(1-Lt)+Pt[1]*Lt,kt[2]=zt[2]*(1-Lt)+Pt[2]*Lt}for(var Bt=0;Bt<kt.length;Bt++)kt[Bt]/=255;this.boxcolor=colorToString(kt),this.setOutputData(0,kt)}},it.registerNodeType("color/palette",vt);function _t(){this.addInput("","image,canvas"),this.size=[200,200]}_t.title="Frame",_t.desc="Frame viewerew",_t.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"view",text:"View Image",type:"button"}],_t.prototype.onDrawBackground=function(At){this.frame&&!this.flags.collapsed&&At.drawImage(this.frame,0,0,this.size[0],this.size[1])},_t.prototype.onExecute=function(){this.frame=this.getInputData(0),this.setDirtyCanvas(!0)},_t.prototype.onWidget=function(At,Dt){if(Dt.name=="resize"&&this.frame){var kt=this.frame.width,Mt=this.frame.height;!kt&&this.frame.videoWidth!=null&&(kt=this.frame.videoWidth,Mt=this.frame.videoHeight),kt&&Mt&&(this.size=[kt,Mt]),this.setDirtyCanvas(!0,!0)}else Dt.name=="view"&&this.show()},_t.prototype.show=function(){showElement&&this.frame&&showElement(this.frame)},it.registerNodeType("graphics/frame",_t);function bt(){this.addInputs([["img1","image"],["img2","image"],["fade","number"]]),this.addOutput("","image"),this.properties={fade:.5,width:512,height:512}}bt.title="Image fade",bt.desc="Fades between images",bt.widgets=[{name:"resizeA",text:"Resize to A",type:"button"},{name:"resizeB",text:"Resize to B",type:"button"}],bt.prototype.onAdded=function(){this.createCanvas();var At=this.canvas.getContext("2d");At.fillStyle="#000",At.fillRect(0,0,this.properties.width,this.properties.height)},bt.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},bt.prototype.onExecute=function(){var At=this.canvas.getContext("2d");this.canvas.width=this.canvas.width;var Dt=this.getInputData(0);Dt!=null&&At.drawImage(Dt,0,0,this.canvas.width,this.canvas.height);var kt=this.getInputData(2);kt==null?kt=this.properties.fade:this.properties.fade=kt,At.globalAlpha=kt;var Mt=this.getInputData(1);Mt!=null&&At.drawImage(Mt,0,0,this.canvas.width,this.canvas.height),At.globalAlpha=1,this.setOutputData(0,this.canvas),this.setDirtyCanvas(!0)},it.registerNodeType("graphics/imagefade",bt);function xt(){this.addInput("","image"),this.addOutput("","image"),this.properties={width:256,height:256,x:0,y:0,scale:1},this.size=[50,20]}xt.title="Crop",xt.desc="Crop Image",xt.prototype.onAdded=function(){this.createCanvas()},xt.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},xt.prototype.onExecute=function(){var At=this.getInputData(0);if(!!At)if(At.width){var Dt=this.canvas.getContext("2d");Dt.drawImage(At,-this.properties.x,-this.properties.y,At.width*this.properties.scale,At.height*this.properties.scale),this.setOutputData(0,this.canvas)}else this.setOutputData(0,null)},xt.prototype.onDrawBackground=function(At){this.flags.collapsed||this.canvas&&At.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.size[0],this.size[1])},xt.prototype.onPropertyChanged=function(At,Dt){return this.properties[At]=Dt,At=="scale"?(this.properties[At]=parseFloat(Dt),this.properties[At]==0&&(console.error("Error in scale"),this.properties[At]=1)):this.properties[At]=parseInt(Dt),this.createCanvas(),!0},it.registerNodeType("graphics/cropImage",xt);function Tt(){this.addInput("clear",it.ACTION),this.addOutput("","canvas"),this.properties={width:512,height:512,autoclear:!0},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}Tt.title="Canvas",Tt.desc="Canvas to render stuff",Tt.prototype.onExecute=function(){var At=this.canvas,Dt=this.properties.width|0,kt=this.properties.height|0;At.width!=Dt&&(At.width=Dt),At.height!=kt&&(At.height=kt),this.properties.autoclear&&this.ctx.clearRect(0,0,At.width,At.height),this.setOutputData(0,At)},Tt.prototype.onAction=function(At,Dt){At=="clear"&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},it.registerNodeType("graphics/canvas",Tt);function Et(){this.addInput("canvas","canvas"),this.addInput("img","image,canvas"),this.addInput("x","number"),this.addInput("y","number"),this.properties={x:0,y:0,opacity:1}}Et.title="DrawImage",Et.desc="Draws image into a canvas",Et.prototype.onExecute=function(){var At=this.getInputData(0);if(!!At){var Dt=this.getInputOrProperty("img");if(!!Dt){var kt=this.getInputOrProperty("x"),Mt=this.getInputOrProperty("y"),zt=At.getContext("2d");zt.drawImage(Dt,kt,Mt)}}},it.registerNodeType("graphics/drawImage",Et);function wt(){this.addInput("canvas","canvas"),this.addInput("x","number"),this.addInput("y","number"),this.addInput("w","number"),this.addInput("h","number"),this.properties={x:0,y:0,w:10,h:10,color:"white",opacity:1}}wt.title="DrawRectangle",wt.desc="Draws rectangle in canvas",wt.prototype.onExecute=function(){var At=this.getInputData(0);if(!!At){var Dt=this.getInputOrProperty("x"),kt=this.getInputOrProperty("y"),Mt=this.getInputOrProperty("w"),zt=this.getInputOrProperty("h"),Pt=At.getContext("2d");Pt.fillRect(Dt,kt,Mt,zt)}},it.registerNodeType("graphics/drawRectangle",wt);function Ot(){this.addInput("t","number"),this.addOutputs([["frame","image"],["t","number"],["d","number"]]),this.properties={url:"",use_proxy:!0}}Ot.title="Video",Ot.desc="Video playback",Ot.widgets=[{name:"play",text:"PLAY",type:"minibutton"},{name:"stop",text:"STOP",type:"minibutton"},{name:"demo",text:"Demo video",type:"button"},{name:"mute",text:"Mute video",type:"button"}],Ot.prototype.onExecute=function(){if(!!this.properties.url&&(this.properties.url!=this._video_url&&this.loadVideo(this.properties.url),!(!this._video||this._video.width==0))){var At=this.getInputData(0);At&&At>=0&&At<=1&&(this._video.currentTime=At*this._video.duration,this._video.pause()),this._video.dirty=!0,this.setOutputData(0,this._video),this.setOutputData(1,this._video.currentTime),this.setOutputData(2,this._video.duration),this.setDirtyCanvas(!0)}},Ot.prototype.onStart=function(){this.play()},Ot.prototype.onStop=function(){this.stop()},Ot.prototype.loadVideo=function(At){this._video_url=At;var Dt=At.substr(0,10).indexOf(":"),kt="";Dt!=-1&&(kt=At.substr(0,Dt));var Mt="";kt&&(Mt=At.substr(0,At.indexOf("/",kt.length+3)),Mt=Mt.substr(kt.length+3)),this.properties.use_proxy&&kt&&it.proxy&&Mt!=location.host&&(At=it.proxy+At.substr(At.indexOf(":")+3)),this._video=document.createElement("video"),this._video.src=At,this._video.type="type=video/mp4",this._video.muted=!0,this._video.autoplay=!0;var zt=this;this._video.addEventListener("loadedmetadata",function(Pt){console.log("Duration: "+this.duration+" seconds"),console.log("Size: "+this.videoWidth+","+this.videoHeight),zt.setDirtyCanvas(!0),this.width=this.videoWidth,this.height=this.videoHeight}),this._video.addEventListener("progress",function(Pt){console.log("video loading...")}),this._video.addEventListener("error",function(Pt){if(console.error("Error loading video: "+this.src),this.error)switch(this.error.code){case this.error.MEDIA_ERR_ABORTED:console.error("You stopped the video.");break;case this.error.MEDIA_ERR_NETWORK:console.error("Network error - please try again later.");break;case this.error.MEDIA_ERR_DECODE:console.error("Video is broken..");break;case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("Sorry, your browser can't play this video.");break}}),this._video.addEventListener("ended",function(Pt){console.log("Video Ended."),this.play()})},Ot.prototype.onPropertyChanged=function(At,Dt){return this.properties[At]=Dt,At=="url"&&Dt!=""&&this.loadVideo(Dt),!0},Ot.prototype.play=function(){this._video&&this._video.videoWidth&&this._video.play()},Ot.prototype.playPause=function(){!this._video||(this._video.paused?this.play():this.pause())},Ot.prototype.stop=function(){!this._video||(this._video.pause(),this._video.currentTime=0)},Ot.prototype.pause=function(){!this._video||(console.log("Video paused"),this._video.pause())},Ot.prototype.onWidget=function(At,Dt){},it.registerNodeType("graphics/video",Ot);function It(){this.addOutput("Webcam","image"),this.properties={filterFacingMode:!1,facingMode:"user"},this.boxcolor="black",this.frame=0}It.title="Webcam",It.desc="Webcam image",It.is_webcam_open=!1,It.prototype.openStream=function(){if(!navigator.mediaDevices.getUserMedia){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0;var At={audio:!1,video:this.properties.filterFacingMode?{facingMode:this.properties.facingMode}:!0};navigator.mediaDevices.getUserMedia(At).then(this.streamReady.bind(this)).catch(kt);var Dt=this;function kt(Mt){console.log("Webcam rejected",Mt),Dt._webcam_stream=!1,It.is_webcam_open=!1,Dt.boxcolor="red",Dt.trigger("stream_error")}},It.prototype.closeStream=function(){if(this._webcam_stream){var At=this._webcam_stream.getTracks();if(At.length)for(var Dt=0;Dt<At.length;++Dt)At[Dt].stop();It.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},It.prototype.onPropertyChanged=function(At,Dt){At=="facingMode"&&(this.properties.facingMode=Dt,this.closeStream(),this.openStream())},It.prototype.onRemoved=function(){this.closeStream()},It.prototype.streamReady=function(At){this._webcam_stream=At,this.boxcolor="green";var Dt=this._video;Dt||(Dt=document.createElement("video"),Dt.autoplay=!0,Dt.srcObject=At,this._video=Dt,Dt.onloadedmetadata=function(kt){console.log(kt),It.is_webcam_open=!0}),this.trigger("stream_ready",Dt)},It.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){this._video.frame=++this.frame,this._video.width=this._video.videoWidth,this._video.height=this._video.videoHeight,this.setOutputData(0,this._video);for(var At=1;At<this.outputs.length;++At)if(!!this.outputs[At])switch(this.outputs[At].name){case"width":this.setOutputData(At,this._video.videoWidth);break;case"height":this.setOutputData(At,this._video.videoHeight);break}}},It.prototype.getExtraMenuOptions=function(At){var Dt=this,kt=Dt.properties.show?"Hide Frame":"Show Frame";return[{content:kt,callback:function(){Dt.properties.show=!Dt.properties.show}}]},It.prototype.onDrawBackground=function(At){this.flags.collapsed||this.size[1]<=20||!this.properties.show||!this._video||(At.save(),At.drawImage(this._video,0,0,this.size[0],this.size[1]),At.restore())},It.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",it.EVENT],["stream_closed",it.EVENT],["stream_error",it.EVENT]]},it.registerNodeType("graphics/webcam",It)}(commonjsGlobal),function(rt){var it=rt.LiteGraph,nt=rt.LGraphCanvas;if(rt.LGraphTexture=null,typeof GL>"u")return;nt.link_type_colors.Texture="#987";function st(){this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",filter:!0},this.size=[st.image_preview_size,st.image_preview_size]}rt.LGraphTexture=st,st.title="Texture",st.desc="Texture",st.widgets_info={name:{widget:"texture"},filter:{widget:"checkbox"}},st.loadTextureCallback=null,st.image_preview_size=256,st.UNDEFINED=0,st.PASS_THROUGH=1,st.COPY=2,st.LOW=3,st.HIGH=4,st.REUSE=5,st.DEFAULT=2,st.MODE_VALUES={undefined:st.UNDEFINED,"pass through":st.PASS_THROUGH,copy:st.COPY,low:st.LOW,high:st.HIGH,reuse:st.REUSE,default:st.DEFAULT},st.getTexturesContainer=function(){return gl.textures},st.loadTexture=function(Nt,Ft){Ft=Ft||{};var Xt=Nt;Xt.substr(0,7)=="http://"&&it.proxy&&(Xt=it.proxy+Xt.substr(7));var Qt=st.getTexturesContainer(),ti=Qt[Nt]=GL.Texture.fromURL(Xt,Ft);return ti},st.getTexture=function(Nt){var Ft=this.getTexturesContainer();if(!Ft)throw"Cannot load texture, container of textures not found";var Xt=Ft[Nt];return!Xt&&Nt&&Nt[0]!=":"?this.loadTexture(Nt):Xt},st.getTargetTexture=function(Nt,Ft,Xt){if(!Nt)throw"LGraphTexture.getTargetTexture expects a reference texture";var Qt=null;switch(Xt){case st.LOW:Qt=gl.UNSIGNED_BYTE;break;case st.HIGH:Qt=gl.HIGH_PRECISION_FORMAT;break;case st.REUSE:return Nt;case st.COPY:default:Qt=Nt?Nt.type:gl.UNSIGNED_BYTE;break}return(!Ft||Ft.width!=Nt.width||Ft.height!=Nt.height||Ft.type!=Qt||Ft.format!=Nt.format)&&(Ft=new GL.Texture(Nt.width,Nt.height,{type:Qt,format:Nt.format,filter:gl.LINEAR})),Ft},st.getTextureType=function(Nt,Ft){var Xt=Ft?Ft.type:gl.UNSIGNED_BYTE;switch(Nt){case st.HIGH:Xt=gl.HIGH_PRECISION_FORMAT;break;case st.LOW:Xt=gl.UNSIGNED_BYTE;break}return Xt},st.getWhiteTexture=function(){if(this._white_texture)return this._white_texture;var Nt=this._white_texture=GL.Texture.fromMemory(1,1,[255,255,255,255],{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return Nt},st.getNoiseTexture=function(){if(this._noise_texture)return this._noise_texture;for(var Nt=new Uint8Array(512*512*4),Ft=0;Ft<512*512*4;++Ft)Nt[Ft]=Math.random()*255;var Xt=GL.Texture.fromMemory(512,512,Nt,{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return this._noise_texture=Xt,Xt},st.prototype.onDropFile=function(Nt,Ft,Xt){if(!Nt)this._drop_texture=null,this.properties.name="";else{var Qt=null;if(typeof Nt=="string")Qt=GL.Texture.fromURL(Nt);else if(Ft.toLowerCase().indexOf(".dds")!=-1)Qt=GL.Texture.fromDDSInMemory(Nt);else{var ti=new Blob([Xt]),si=URL.createObjectURL(ti);Qt=GL.Texture.fromURL(si)}this._drop_texture=Qt,this.properties.name=Ft}},st.prototype.getExtraMenuOptions=function(Nt){var Ft=this;if(!!this._drop_texture)return[{content:"Clear",callback:function(){Ft._drop_texture=null,Ft.properties.name=""}}]},st.prototype.onExecute=function(){var Nt=null;if(this.isOutputConnected(1)&&(Nt=this.getInputData(0)),!Nt&&this._drop_texture&&(Nt=this._drop_texture),!Nt&&this.properties.name&&(Nt=st.getTexture(this.properties.name)),!Nt){this.setOutputData(0,null),this.setOutputData(1,"");return}this._last_tex=Nt,this.properties.filter===!1?Nt.setParameter(gl.TEXTURE_MAG_FILTER,gl.NEAREST):Nt.setParameter(gl.TEXTURE_MAG_FILTER,gl.LINEAR),this.setOutputData(0,Nt),this.setOutputData(1,Nt.fullpath||Nt.filename);for(var Ft=2;Ft<this.outputs.length;Ft++){var Xt=this.outputs[Ft];if(!!Xt){var Qt=null;Xt.name=="width"?Qt=Nt.width:Xt.name=="height"?Qt=Nt.height:Xt.name=="aspect"&&(Qt=Nt.width/Nt.height),this.setOutputData(Ft,Qt)}}},st.prototype.onResourceRenamed=function(Nt,Ft){this.properties.name==Nt&&(this.properties.name=Ft)},st.prototype.onDrawBackground=function(Nt){if(!(this.flags.collapsed||this.size[1]<=20)){if(this._drop_texture&&Nt.webgl){Nt.drawImage(this._drop_texture,0,0,this.size[0],this.size[1]);return}if(this._last_preview_tex!=this._last_tex)if(Nt.webgl)this._canvas=this._last_tex;else{var Ft=st.generateLowResTexturePreview(this._last_tex);if(!Ft)return;this._last_preview_tex=this._last_tex,this._canvas=cloneCanvas(Ft)}!this._canvas||(Nt.save(),Nt.webgl||(Nt.translate(0,this.size[1]),Nt.scale(1,-1)),Nt.drawImage(this._canvas,0,0,this.size[0],this.size[1]),Nt.restore())}},st.generateLowResTexturePreview=function(Nt){if(!Nt)return null;var Ft=st.image_preview_size,Xt=Nt;if(Nt.format==gl.DEPTH_COMPONENT)return null;(Nt.width>Ft||Nt.height>Ft)&&(Xt=this._preview_temp_tex,this._preview_temp_tex||(Xt=new GL.Texture(Ft,Ft,{minFilter:gl.NEAREST}),this._preview_temp_tex=Xt),Nt.copyTo(Xt),Nt=Xt);var Qt=this._preview_canvas;return Qt||(Qt=createCanvas(Ft,Ft),this._preview_canvas=Qt),Xt&&Xt.toCanvas(Qt),Qt},st.prototype.getResources=function(Nt){return this.properties.name&&(Nt[this.properties.name]=GL.Texture),Nt},st.prototype.onGetInputs=function(){return[["in","Texture"]]},st.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["aspect","number"]]},st.replaceCode=function(Nt,Ft){return Nt.replace(/\{\{[a-zA-Z0-9_]*\}\}/g,function(Xt){return Xt=Xt.replace(/[\{\}]/g,""),Ft[Xt]||""})},it.registerNodeType("texture/texture",st);function vt(){this.addInput("Texture","Texture"),this.properties={flipY:!1},this.size=[st.image_preview_size,st.image_preview_size]}vt.title="Preview",vt.desc="Show a texture in the graph canvas",vt.allow_preview=!1,vt.prototype.onDrawBackground=function(Nt){if(!this.flags.collapsed&&!(!Nt.webgl&&!vt.allow_preview)){var Ft=this.getInputData(0);if(!!Ft){var Xt=null;!Ft.handle&&Nt.webgl?Xt=Ft:Xt=st.generateLowResTexturePreview(Ft),Nt.save(),this.properties.flipY&&(Nt.translate(0,this.size[1]),Nt.scale(1,-1)),Nt.drawImage(Xt,0,0,this.size[0],this.size[1]),Nt.restore()}}},it.registerNodeType("texture/preview",vt);function _t(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",generate_mipmaps:!1}}_t.title="Save",_t.desc="Save a texture in the repository",_t.prototype.getPreviewTexture=function(){return this._texture},_t.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt){if(this.properties.generate_mipmaps&&(Nt.bind(0),Nt.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.generateMipmap(Nt.texture_type),Nt.unbind(0)),this.properties.name)if(st.storeTexture)st.storeTexture(this.properties.name,Nt);else{var Ft=st.getTexturesContainer();Ft[this.properties.name]=Nt}this._texture=Nt,this.setOutputData(0,Nt),this.setOutputData(1,this.properties.name)}},it.registerNodeType("texture/save",_t);function bt(){this.addInput("Texture","Texture"),this.addInput("TextureB","Texture"),this.addInput("value","number"),this.addOutput("Texture","Texture"),this.help="<p>pixelcode must be vec3, uvcode must be vec2, is optional</p>			<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture <strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time <strong>value:</strong> input value</p><p>For multiline you must type: result = ...</p>",this.properties={value:1,pixelcode:"color + colorB * value",uvcode:"",precision:st.DEFAULT},this.has_error=!1}bt.widgets_info={uvcode:{widget:"code"},pixelcode:{widget:"code"},precision:{widget:"combo",values:st.MODE_VALUES}},bt.title="Operation",bt.desc="Texture shader operation",bt.presets={},bt.prototype.getExtraMenuOptions=function(Nt){var Ft=this,Xt=Ft.properties.show?"Hide Texture":"Show Texture";return[{content:Xt,callback:function(){Ft.properties.show=!Ft.properties.show}}]},bt.prototype.onPropertyChanged=function(){this.has_error=!1},bt.prototype.onDrawBackground=function(Nt){this.flags.collapsed||this.size[1]<=20||!this.properties.show||!this._tex||this._tex.gl==Nt&&(Nt.save(),Nt.drawImage(this._tex,0,0,this.size[0],this.size[1]),Nt.restore())},bt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!this.isOutputConnected(0)){if(this.properties.precision===st.PASS_THROUGH){this.setOutputData(0,Nt);return}var Ft=this.getInputData(1);if(!(!this.properties.uvcode&&!this.properties.pixelcode)){var Xt=512,Qt=512;Nt?(Xt=Nt.width,Qt=Nt.height):Ft&&(Xt=Ft.width,Qt=Ft.height),Ft||(Ft=GL.Texture.getWhiteTexture());var ti=st.getTextureType(this.properties.precision,Nt);!Nt&&!this._tex?this._tex=new GL.Texture(Xt,Qt,{type:ti,format:gl.RGBA,filter:gl.LINEAR}):this._tex=st.getTargetTexture(Nt||this._tex,this._tex,this.properties.precision);var si="";this.properties.uvcode&&(si="uv = "+this.properties.uvcode,this.properties.uvcode.indexOf(";")!=-1&&(si=this.properties.uvcode));var Vt="";this.properties.pixelcode&&(Vt="result = "+this.properties.pixelcode,this.properties.pixelcode.indexOf(";")!=-1&&(Vt=this.properties.pixelcode));var Kt=this._shader;if(!this.has_error&&(!Kt||this._shader_code!=si+"|"+Vt)){var ni=st.replaceCode(bt.pixel_shader,{UV_CODE:si,PIXEL_CODE:Vt});try{Kt=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,ni),this.boxcolor="#00FF00"}catch(gi){GL.Shader.dumpErrorToConsole(gi,Shader.SCREEN_VERTEX_SHADER,ni),this.boxcolor="#FF0000",this.has_error=!0;return}this._shader=Kt,this._shader_code=si+"|"+Vt}if(!!this._shader){var hi=this.getInputData(2);hi!=null?this.properties.value=hi:hi=parseFloat(this.properties.value);var ui=this.graph.getTime();this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),Nt&&Nt.bind(0),Ft&&Ft.bind(1);var gi=Mesh.getScreenQuad();Kt.uniforms({u_texture:0,u_textureB:1,value:hi,texSize:[Xt,Qt,1/Xt,1/Qt],time:ui}).draw(gi)}),this.setOutputData(0,this._tex)}}}},bt.pixel_shader=`precision highp float;
			
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			varying vec2 v_coord;
			uniform vec4 texSize;
			uniform float time;
			uniform float value;
			
			void main() {
				vec2 uv = v_coord;
				{{UV_CODE}};
				vec4 color4 = texture2D(u_texture, uv);
				vec3 color = color4.rgb;
				vec4 color4B = texture2D(u_textureB, uv);
				vec3 colorB = color4B.rgb;
				vec3 result = color;
				float alpha = 1.0;
				{{PIXEL_CODE}};
				gl_FragColor = vec4(result, alpha);
			}
			`,bt.registerPreset=function(Nt,Ft){bt.presets[Nt]=Ft},bt.registerPreset("",""),bt.registerPreset("bypass","color"),bt.registerPreset("add","color + colorB * value"),bt.registerPreset("substract","(color - colorB) * value"),bt.registerPreset("mate","mix( color, colorB, color4B.a * value)"),bt.registerPreset("invert","vec3(1.0) - color"),bt.registerPreset("multiply","color * colorB * value"),bt.registerPreset("divide","(color / colorB) / value"),bt.registerPreset("difference","abs(color - colorB) * value"),bt.registerPreset("max","max(color, colorB) * value"),bt.registerPreset("min","min(color, colorB) * value"),bt.registerPreset("displace","texture2D(u_texture, uv + (colorB.xy - vec2(0.5)) * value).xyz"),bt.registerPreset("grayscale","vec3(color.x + color.y + color.z) * value / 3.0"),bt.registerPreset("saturation","mix( vec3(color.x + color.y + color.z) / 3.0, color, value )"),bt.registerPreset("normalmap",`
			float z0 = texture2D(u_texture, uv + vec2(-texSize.z, -texSize.w) ).x;
			float z1 = texture2D(u_texture, uv + vec2(0.0, -texSize.w) ).x;
			float z2 = texture2D(u_texture, uv + vec2(texSize.z, -texSize.w) ).x;
			float z3 = texture2D(u_texture, uv + vec2(-texSize.z, 0.0) ).x;
			float z4 = color.x;
			float z5 = texture2D(u_texture, uv + vec2(texSize.z, 0.0) ).x;
			float z6 = texture2D(u_texture, uv + vec2(-texSize.z, texSize.w) ).x;
			float z7 = texture2D(u_texture, uv + vec2(0.0, texSize.w) ).x;
			float z8 = texture2D(u_texture, uv + vec2(texSize.z, texSize.w) ).x;
			vec3 normal = vec3( z2 + 2.0*z4 + z7 - z0 - 2.0*z3 - z5, z5 + 2.0*z6 + z7 -z0 - 2.0*z1 - z2, 1.0 );
			normal.xy *= value;
			result.xyz = normalize(normal) * 0.5 + vec3(0.5);
		`),bt.registerPreset("threshold","vec3(color.x > colorB.x * value ? 1.0 : 0.0,color.y > colorB.y * value ? 1.0 : 0.0,color.z > colorB.z * value ? 1.0 : 0.0)"),bt.prototype.onInspect=function(Nt){var Ft=this;Nt.addCombo("Presets","",{values:Object.keys(bt.presets),callback:function(Xt){var Qt=bt.presets[Xt];!Qt||(Ft.setProperty("pixelcode",Qt),Ft.title=Xt,Nt.refresh())}})},it.registerNodeType("texture/operation",bt);function xt(){this.addOutput("out","Texture"),this.properties={code:"",u_value:1,u_color:[1,1,1,1],width:512,height:512,precision:st.DEFAULT},this.properties.code=xt.pixel_shader,this._uniforms={u_value:1,u_color:vec4.create(),in_texture:0,texSize:vec4.create(),time:0}}xt.title="Shader",xt.desc="Texture shader",xt.widgets_info={code:{type:"code",lang:"glsl"},precision:{widget:"combo",values:st.MODE_VALUES}},xt.prototype.onPropertyChanged=function(Nt,Ft){if(Nt=="code"){var Xt=this.getShader();if(!!Xt){var Qt=Xt.uniformInfo;if(this.inputs)for(var ti={},si=0;si<this.inputs.length;++si){var Vt=this.getInputInfo(si);if(!!Vt){if(Qt[Vt.name]&&!ti[Vt.name]){ti[Vt.name]=!0;continue}this.removeInput(si),si--}}for(var si in Qt){var Vt=Xt.uniformInfo[si];if(Vt.loc!==null&&si!="time"){var Kt="number";if(this._shader.samplers[si])Kt="texture";else switch(Vt.size){case 1:Kt="number";break;case 2:Kt="vec2";break;case 3:Kt="vec3";break;case 4:Kt="vec4";break;case 9:Kt="mat3";break;case 16:Kt="mat4";break;default:continue}var ni=this.findInputSlot(si);if(ni==-1){this.addInput(si,Kt);continue}var hi=this.getInputInfo(ni);if(!hi)this.addInput(si,Kt);else{if(hi.type==Kt)continue;this.removeInput(ni,Kt),this.addInput(si,Kt)}}}}}},xt.prototype.getShader=function(){if(this._shader&&this._shader_code==this.properties.code)return this._shader;if(this._shader_code=this.properties.code,this._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,this.properties.code),this._shader)this.boxcolor="green";else return this.boxcolor="red",null;return this._shader},xt.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getShader();if(!!Nt){var Ft=0,Xt=null;if(this.inputs)for(var Qt=0;Qt<this.inputs.length;++Qt){var ti=this.getInputInfo(Qt),si=this.getInputData(Qt);si!=null&&(si.constructor===GL.Texture&&(si.bind(Ft),Xt||(Xt=si),si=Ft,Ft++),Nt.setUniform(ti.name,si))}var Vt=this._uniforms,Kt=st.getTextureType(this.properties.precision,Xt),ni=this.properties.width|0,hi=this.properties.height|0;ni==0&&(ni=Xt?Xt.width:gl.canvas.width),hi==0&&(hi=Xt?Xt.height:gl.canvas.height),Vt.texSize[0]=ni,Vt.texSize[1]=hi,Vt.texSize[2]=1/ni,Vt.texSize[3]=1/hi,Vt.time=this.graph.getTime(),Vt.u_value=this.properties.u_value,Vt.u_color.set(this.properties.u_color),(!this._tex||this._tex.type!=Kt||this._tex.width!=ni||this._tex.height!=hi)&&(this._tex=new GL.Texture(ni,hi,{type:Kt,format:gl.RGBA,filter:gl.LINEAR}));var ui=this._tex;ui.drawTo(function(){Nt.uniforms(Vt).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._tex)}}},xt.pixel_shader=`precision highp float;
	
	varying vec2 v_coord;
	uniform float time; //time in seconds
	uniform vec4 texSize; //tex resolution
	uniform float u_value;
	uniform vec4 u_color;

	void main() {
		vec2 uv = v_coord;
		vec3 color = vec3(0.0);
		//your code here
		color.xy=uv;

		gl_FragColor = vec4(color, 1.0);
	}
	`,it.registerNodeType("texture/shader",xt);function Tt(){this.addInput("in","Texture"),this.addInput("scale","vec2"),this.addInput("offset","vec2"),this.addOutput("out","Texture"),this.properties={offset:vec2.fromValues(0,0),scale:vec2.fromValues(1,1),precision:st.DEFAULT}}Tt.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},Tt.title="Scale/Offset",Tt.desc="Applies an scaling and offseting",Tt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!(!this.isOutputConnected(0)||!Nt)){if(this.properties.precision===st.PASS_THROUGH){this.setOutputData(0,Nt);return}var Ft=Nt.width,Xt=Nt.height,Qt=this.precision===st.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT;this.precision===st.DEFAULT&&(Qt=Nt.type),(!this._tex||this._tex.width!=Ft||this._tex.height!=Xt||this._tex.type!=Qt)&&(this._tex=new GL.Texture(Ft,Xt,{type:Qt,format:gl.RGBA,filter:gl.LINEAR}));var ti=this._shader;ti||(ti=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Tt.pixel_shader));var si=this.getInputData(1);si?(this.properties.scale[0]=si[0],this.properties.scale[1]=si[1]):si=this.properties.scale;var Vt=this.getInputData(2);Vt?(this.properties.offset[0]=Vt[0],this.properties.offset[1]=Vt[1]):Vt=this.properties.offset,this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),Nt.bind(0);var Kt=Mesh.getScreenQuad();ti.uniforms({u_texture:0,u_scale:si,u_offset:Vt}).draw(Kt)}),this.setOutputData(0,this._tex)}},Tt.pixel_shader=`precision highp float;
			
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			varying vec2 v_coord;
			uniform vec2 u_scale;
			uniform vec2 u_offset;
			
			void main() {
				vec2 uv = v_coord;
				uv = uv / u_scale - u_offset;
				gl_FragColor = texture2D(u_texture, uv);
			}
			`,it.registerNodeType("texture/scaleOffset",Tt);function Et(){this.addInput("in","Texture"),this.addInput("warp","Texture"),this.addInput("factor","number"),this.addOutput("out","Texture"),this.properties={factor:.01,scale:[1,1],offset:[0,0],precision:st.DEFAULT},this._uniforms={u_texture:0,u_textureB:1,u_factor:1,u_scale:vec2.create(),u_offset:vec2.create()}}Et.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},Et.title="Warp",Et.desc="Texture warp operation",Et.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!this.isOutputConnected(0)){if(this.properties.precision===st.PASS_THROUGH){this.setOutputData(0,Nt);return}var Ft=this.getInputData(1),Xt=512,Qt=512;gl.UNSIGNED_BYTE,Nt?(Xt=Nt.width,Qt=Nt.height,Nt.type):Ft&&(Xt=Ft.width,Qt=Ft.height,Ft.type),!Nt&&!this._tex?this._tex=new GL.Texture(Xt,Qt,{type:this.precision===st.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT,format:gl.RGBA,filter:gl.LINEAR}):this._tex=st.getTargetTexture(Nt||this._tex,this._tex,this.properties.precision);var ti=this._shader;ti||(ti=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Et.pixel_shader));var si=this.getInputData(2);si!=null?this.properties.factor=si:si=parseFloat(this.properties.factor);var Vt=this._uniforms;Vt.u_factor=si,Vt.u_scale.set(this.properties.scale),Vt.u_offset.set(this.properties.offset),this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),Nt&&Nt.bind(0),Ft&&Ft.bind(1);var Kt=Mesh.getScreenQuad();ti.uniforms(Vt).draw(Kt)}),this.setOutputData(0,this._tex)}},Et.pixel_shader=`precision highp float;
			
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			varying vec2 v_coord;
			uniform float u_factor;
			uniform vec2 u_scale;
			uniform vec2 u_offset;
			
			void main() {
				vec2 uv = v_coord;
				uv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor * u_scale + u_offset;
				gl_FragColor = texture2D(u_texture, uv);
			}
			`,it.registerNodeType("texture/warp",Et);function wt(){this.addInput("Texture","Texture"),this.properties={additive:!1,antialiasing:!1,filter:!0,disable_alpha:!1,gamma:1,viewport:[0,0,1,1]},this.size[0]=130}wt.title="to Viewport",wt.desc="Texture to viewport",wt._prev_viewport=new Float32Array(4),wt.prototype.onDrawBackground=function(Nt){if(!(this.flags.collapsed||this.size[1]<=40)){var Ft=this.getInputData(0);!Ft||Nt.drawImage(Nt==gl?Ft:gl.canvas,10,30,this.size[0]-20,this.size[1]-40)}},wt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt){this.properties.disable_alpha?gl.disable(gl.BLEND):(gl.enable(gl.BLEND),this.properties.additive?gl.blendFunc(gl.SRC_ALPHA,gl.ONE):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),gl.disable(gl.DEPTH_TEST);var Ft=this.properties.gamma||1;this.isInputConnected(1)&&(Ft=this.getInputData(1)),Nt.setParameter(gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST);var Xt=wt._prev_viewport;Xt.set(gl.viewport_data);var Qt=this.properties.viewport;if(gl.viewport(Xt[0]+Xt[2]*Qt[0],Xt[1]+Xt[3]*Qt[1],Xt[2]*Qt[2],Xt[3]*Qt[3]),gl.getViewport(),this.properties.antialiasing){wt._shader||(wt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,wt.aa_pixel_shader));var ti=Mesh.getScreenQuad();Nt.bind(0),wt._shader.uniforms({u_texture:0,uViewportSize:[Nt.width,Nt.height],u_igamma:1/Ft,inverseVP:[1/Nt.width,1/Nt.height]}).draw(ti)}else Ft!=1?(wt._gamma_shader||(wt._gamma_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,wt.gamma_pixel_shader)),Nt.toViewport(wt._gamma_shader,{u_texture:0,u_igamma:1/Ft})):Nt.toViewport();gl.viewport(Xt[0],Xt[1],Xt[2],Xt[3])}},wt.prototype.onGetInputs=function(){return[["gamma","number"]]},wt.aa_pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 uViewportSize;
			uniform vec2 inverseVP;
			uniform float u_igamma;
			#define FXAA_REDUCE_MIN   (1.0/ 128.0)
			#define FXAA_REDUCE_MUL   (1.0 / 8.0)
			#define FXAA_SPAN_MAX     8.0
			
			/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */
			vec4 applyFXAA(sampler2D tex, vec2 fragCoord)
			{
				vec4 color = vec4(0.0);
				/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/
				vec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;
				vec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;
				vec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;
				vec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;
				vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;
				vec3 luma = vec3(0.299, 0.587, 0.114);
				float lumaNW = dot(rgbNW, luma);
				float lumaNE = dot(rgbNE, luma);
				float lumaSW = dot(rgbSW, luma);
				float lumaSE = dot(rgbSE, luma);
				float lumaM  = dot(rgbM,  luma);
				float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
				float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
				
				vec2 dir;
				dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
				dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
				
				float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);
				
				float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
				dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;
				
				vec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + 
					texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
				vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + 
					texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);
				
				//return vec4(rgbA,1.0);
				float lumaB = dot(rgbB, luma);
				if ((lumaB < lumaMin) || (lumaB > lumaMax))
					color = vec4(rgbA, 1.0);
				else
					color = vec4(rgbB, 1.0);
				if(u_igamma != 1.0)
					color.xyz = pow( color.xyz, vec3(u_igamma) );
				return color;
			}
			
			void main() {
			   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;
			}
			`,wt.gamma_pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_igamma;
			void main() {
				vec4 color = texture2D( u_texture, v_coord);
				color.xyz = pow(color.xyz, vec3(u_igamma) );
			   gl_FragColor = color;
			}
			`,it.registerNodeType("texture/toviewport",wt);function Ot(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:0,generate_mipmaps:!1,precision:st.DEFAULT}}Ot.title="Copy",Ot.desc="Copy Texture",Ot.widgets_info={size:{widget:"combo",values:[0,32,64,128,256,512,1024,2048]},precision:{widget:"combo",values:st.MODE_VALUES}},Ot.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!(!Nt&&!this._temp_texture)&&!!this.isOutputConnected(0)){if(Nt){var Ft=Nt.width,Xt=Nt.height;this.properties.size!=0&&(Ft=this.properties.size,Xt=this.properties.size);var Qt=this._temp_texture,ti=Nt.type;if(this.properties.precision===st.LOW?ti=gl.UNSIGNED_BYTE:this.properties.precision===st.HIGH&&(ti=gl.HIGH_PRECISION_FORMAT),!Qt||Qt.width!=Ft||Qt.height!=Xt||Qt.type!=ti){var si=gl.LINEAR;this.properties.generate_mipmaps&&isPowerOfTwo(Ft)&&isPowerOfTwo(Xt)&&(si=gl.LINEAR_MIPMAP_LINEAR),this._temp_texture=new GL.Texture(Ft,Xt,{type:ti,format:gl.RGBA,minFilter:si,magFilter:gl.LINEAR})}Nt.copyTo(this._temp_texture),this.properties.generate_mipmaps&&(this._temp_texture.bind(0),gl.generateMipmap(this._temp_texture.texture_type),this._temp_texture.unbind(0))}this.setOutputData(0,this._temp_texture)}},it.registerNodeType("texture/copy",Ot);function It(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={iterations:1,generate_mipmaps:!1,precision:st.DEFAULT}}It.title="Downsample",It.desc="Downsample Texture",It.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:st.MODE_VALUES}},It.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!(!Nt&&!this._temp_texture)&&!!this.isOutputConnected(0)&&!(!Nt||Nt.texture_type!==GL.TEXTURE_2D)){if(this.properties.iterations<1){this.setOutputData(0,Nt);return}var Ft=It._shader;Ft||(It._shader=Ft=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,It.pixel_shader));var Xt=Nt.width|0,Qt=Nt.height|0,ti=Nt.type;this.properties.precision===st.LOW?ti=gl.UNSIGNED_BYTE:this.properties.precision===st.HIGH&&(ti=gl.HIGH_PRECISION_FORMAT);var si=this.properties.iterations||1,Vt=Nt,Kt=null,ni=[],hi={type:ti,format:Nt.format},ui=vec2.create(),gi={u_offset:ui};this._texture&&GL.Texture.releaseTemporary(this._texture);for(var mi=0;mi<si&&(ui[0]=1/Xt,ui[1]=1/Qt,Xt=Xt>>1||0,Qt=Qt>>1||0,Kt=GL.Texture.getTemporary(Xt,Qt,hi),ni.push(Kt),Vt.setParameter(GL.TEXTURE_MAG_FILTER,GL.NEAREST),Vt.copyTo(Kt,Ft,gi),!(Xt==1&&Qt==1));++mi)Vt=Kt;this._texture=ni.pop();for(var mi=0;mi<ni.length;++mi)GL.Texture.releaseTemporary(ni[mi]);this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},It.pixel_shader=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform vec2 u_offset;
			varying vec2 v_coord;
			
			void main() {
				vec4 color = texture2D(u_texture, v_coord );
				color += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );
				color += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );
				color += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );
			   gl_FragColor = color * 0.25;
			}
			`,it.registerNodeType("texture/downsample",It);function At(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:[512,512],generate_mipmaps:!1,precision:st.DEFAULT}}At.title="Resize",At.desc="Resize Texture",At.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:st.MODE_VALUES}},At.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!(!Nt&&!this._temp_texture)&&!!this.isOutputConnected(0)&&!(!Nt||Nt.texture_type!==GL.TEXTURE_2D)){var Ft=this.properties.size[0]|0,Xt=this.properties.size[1]|0;Ft==0&&(Ft=Nt.width),Xt==0&&(Xt=Nt.height);var Qt=Nt.type;this.properties.precision===st.LOW?Qt=gl.UNSIGNED_BYTE:this.properties.precision===st.HIGH&&(Qt=gl.HIGH_PRECISION_FORMAT),(!this._texture||this._texture.width!=Ft||this._texture.height!=Xt||this._texture.type!=Qt)&&(this._texture=new GL.Texture(Ft,Xt,{type:Qt})),Nt.copyTo(this._texture),this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},it.registerNodeType("texture/resize",At);function Dt(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("avg","vec4"),this.addOutput("lum","number"),this.properties={use_previous_frame:!0,high_quality:!1},this._uniforms={u_texture:0,u_mipmap_offset:0},this._luminance=new Float32Array(4)}Dt.title="Average",Dt.desc=`Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture.
 If high_quality is true, then it generates the mipmaps first and reads from the lower one.`,Dt.prototype.onExecute=function(){this.properties.use_previous_frame||this.updateAverage();var Nt=this._luminance;this.setOutputData(0,this._temp_texture),this.setOutputData(1,Nt),this.setOutputData(2,(Nt[0]+Nt[1]+Nt[2])/3)},Dt.prototype.onPreRenderExecute=function(){this.updateAverage()},Dt.prototype.updateAverage=function(){var Nt=this.getInputData(0);if(!!Nt&&!(!this.isOutputConnected(0)&&!this.isOutputConnected(1)&&!this.isOutputConnected(2))){if(!Dt._shader){Dt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Dt.pixel_shader);for(var Ft=new Float32Array(16),Xt=0;Xt<Ft.length;++Xt)Ft[Xt]=Math.random();Dt._shader.uniforms({u_samples_a:Ft.subarray(0,16),u_samples_b:Ft.subarray(16,32)})}var Qt=this._temp_texture,ti=gl.UNSIGNED_BYTE;Nt.type!=ti&&(ti=gl.FLOAT),(!Qt||Qt.type!=ti)&&(this._temp_texture=new GL.Texture(1,1,{type:ti,format:gl.RGBA,filter:gl.NEAREST})),this._uniforms.u_mipmap_offset=0,this.properties.high_quality&&((!this._temp_pot2_texture||this._temp_pot2_texture.type!=ti)&&(this._temp_pot2_texture=new GL.Texture(512,512,{type:ti,format:gl.RGBA,minFilter:gl.LINEAR_MIPMAP_LINEAR,magFilter:gl.LINEAR})),Nt.copyTo(this._temp_pot2_texture),Nt=this._temp_pot2_texture,Nt.bind(0),gl.generateMipmap(GL.TEXTURE_2D),this._uniforms.u_mipmap_offset=9);var si=Dt._shader,Vt=this._uniforms;if(Vt.u_mipmap_offset=this.properties.mipmap_offset,gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){Nt.toViewport(si,Vt)}),this.isOutputConnected(1)||this.isOutputConnected(2)){var Kt=this._temp_texture.getPixels();if(Kt){var ni=this._luminance,ti=this._temp_texture.type;ni.set(Kt),ti==gl.UNSIGNED_BYTE?vec4.scale(ni,ni,1/255):ti==GL.HALF_FLOAT||ti==GL.HALF_FLOAT_OES}}}},Dt.pixel_shader=`precision highp float;
			precision highp float;
			uniform mat4 u_samples_a;
			uniform mat4 u_samples_b;
			uniform sampler2D u_texture;
			uniform float u_mipmap_offset;
			varying vec2 v_coord;
			
			void main() {
				vec4 color = vec4(0.0);
				//random average
				for(int i = 0; i < 4; ++i)
					for(int j = 0; j < 4; ++j)
					{
						color += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );
						color += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );
					}
			   gl_FragColor = color * 0.03125;
			}
			`,it.registerNodeType("texture/average",Dt);function kt(){this.addInput("in","Texture"),this.addInput("factor","Number"),this.addOutput("out","Texture"),this.properties={factor:.5},this._uniforms={u_texture:0,u_textureB:1,u_factor:this.properties.factor}}kt.title="Smooth",kt.desc="Smooth texture over time",kt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!(!Nt||!this.isOutputConnected(0))){kt._shader||(kt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,kt.pixel_shader));var Ft=this._temp_texture;if(!Ft||Ft.type!=Nt.type||Ft.width!=Nt.width||Ft.height!=Nt.height){var Xt={type:Nt.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(Nt.width,Nt.height,Xt),this._temp_texture2=new GL.Texture(Nt.width,Nt.height,Xt),Nt.copyTo(this._temp_texture2)}var Qt=this._temp_texture,ti=this._temp_texture2,si=kt._shader,Vt=this._uniforms;Vt.u_factor=1-this.getInputOrProperty("factor"),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),Qt.drawTo(function(){ti.bind(1),Nt.toViewport(si,Vt)}),this.setOutputData(0,Qt),this._temp_texture=ti,this._temp_texture2=Qt}},kt.pixel_shader=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_factor;
			varying vec2 v_coord;
			
			void main() {
				gl_FragColor = mix( texture2D( u_texture, v_coord ), texture2D( u_textureB, v_coord ), u_factor );
			}
			`,it.registerNodeType("texture/temporal_smooth",kt);function Mt(){this.addInput("in","Texture"),this.addOutput("avg","Texture"),this.addOutput("array","Texture"),this.properties={samples:64,frames_interval:1},this._uniforms={u_texture:0,u_textureB:1,u_samples:this.properties.samples,u_isamples:1/this.properties.samples},this.frame=0}Mt.title="Lineal Avg Smooth",Mt.desc="Smooth texture linearly over time",Mt["@samples"]={type:"number",min:1,max:64,step:1,precision:1},Mt.prototype.getPreviewTexture=function(){return this._temp_texture2},Mt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!(!Nt||!this.isOutputConnected(0))){Mt._shader||(Mt._shader_copy=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Mt.pixel_shader_copy),Mt._shader_avg=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Mt.pixel_shader_avg));var Ft=clamp(this.properties.samples,0,64),Xt=this.frame,Qt=this.properties.frames_interval;if(Qt==0||Xt%Qt==0){var ti=this._temp_texture;if(!ti||ti.type!=Nt.type||ti.width!=Ft){var si={type:Nt.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(Ft,1,si),this._temp_texture2=new GL.Texture(Ft,1,si),this._temp_texture_out=new GL.Texture(1,1,si)}var Vt=this._temp_texture,Kt=this._temp_texture2,ni=Mt._shader_copy,hi=Mt._shader_avg,ui=this._uniforms;ui.u_samples=Ft,ui.u_isamples=1/Ft,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),Vt.drawTo(function(){Kt.bind(1),Nt.toViewport(ni,ui)}),this._temp_texture_out.drawTo(function(){Vt.toViewport(hi,ui)}),this.setOutputData(0,this._temp_texture_out),this._temp_texture=Kt,this._temp_texture2=Vt}else this.setOutputData(0,this._temp_texture_out);this.setOutputData(1,this._temp_texture2),this.frame++}},Mt.pixel_shader_copy=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_isamples;
			varying vec2 v_coord;
			
			void main() {
				if( v_coord.x <= u_isamples )
					gl_FragColor = texture2D( u_texture, vec2(0.5) );
				else
					gl_FragColor = texture2D( u_textureB, v_coord - vec2(u_isamples,0.0) );
			}
			`,Mt.pixel_shader_avg=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform int u_samples;
			uniform float u_isamples;
			varying vec2 v_coord;
			
			void main() {
				vec4 color = vec4(0.0);
				for(int i = 0; i < 64; ++i)
				{
					color += texture2D( u_texture, vec2( float(i)*u_isamples,0.0) );
					if(i == (u_samples - 1))
						break;
				}
				gl_FragColor = color * u_isamples;
			}
			`,it.registerNodeType("texture/linear_avg_smooth",Mt);function zt(){this.addInput("Image","image"),this.addOutput("","Texture"),this.properties={}}zt.title="Image to Texture",zt.desc="Uploads an image to the GPU",zt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt){var Ft=Nt.videoWidth||Nt.width,Xt=Nt.videoHeight||Nt.height;if(Nt.gltexture){this.setOutputData(0,Nt.gltexture);return}var Qt=this._temp_texture;(!Qt||Qt.width!=Ft||Qt.height!=Xt)&&(this._temp_texture=new GL.Texture(Ft,Xt,{format:gl.RGBA,filter:gl.LINEAR}));try{this._temp_texture.uploadImage(Nt)}catch(ti){console.error("image comes from an unsafe location, cannot be uploaded to webgl: "+ti);return}this.setOutputData(0,this._temp_texture)}},it.registerNodeType("texture/imageToTexture",zt);function Pt(){this.addInput("Texture","Texture"),this.addInput("LUT","Texture"),this.addInput("Intensity","number"),this.addOutput("","Texture"),this.properties={enabled:!0,intensity:1,precision:st.DEFAULT,texture:null},Pt._shader||(Pt._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Pt.pixel_shader))}Pt.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:st.MODE_VALUES}},Pt.title="LUT",Pt.desc="Apply LUT to Texture",Pt.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getInputData(0);if(this.properties.precision===st.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,Nt);return}if(!!Nt){var Ft=this.getInputData(1);if(Ft||(Ft=st.getTexture(this.properties.texture)),!Ft){this.setOutputData(0,Nt);return}Ft.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var Xt=this.properties.intensity;this.isInputConnected(2)&&(this.properties.intensity=Xt=this.getInputData(2)),this._tex=st.getTargetTexture(Nt,this._tex,this.properties.precision),this._tex.drawTo(function(){Ft.bind(1),Nt.toViewport(Pt._shader,{u_texture:0,u_textureB:1,u_amount:Xt})}),this.setOutputData(0,this._tex)}}},Pt.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_amount;
			
			void main() {
				 lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );
				 mediump float blueColor = textureColor.b * 63.0;
				 mediump vec2 quad1;
				 quad1.y = floor(floor(blueColor) / 8.0);
				 quad1.x = floor(blueColor) - (quad1.y * 8.0);
				 mediump vec2 quad2;
				 quad2.y = floor(ceil(blueColor) / 8.0);
				 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
				 highp vec2 texPos1;
				 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
				 texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
				 highp vec2 texPos2;
				 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
				 texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
				 lowp vec4 newColor1 = texture2D(u_textureB, texPos1);
				 lowp vec4 newColor2 = texture2D(u_textureB, texPos2);
				 lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
				 gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);
			}
			`,it.registerNodeType("texture/LUT",Pt);function Lt(){this.addInput("Texture","Texture"),this.addInput("Atlas","Texture"),this.addOutput("","Texture"),this.properties={enabled:!0,num_row_symbols:4,symbol_size:16,brightness:1,colorize:!1,filter:!1,invert:!1,precision:st.DEFAULT,generate_mipmaps:!1,texture:null},Lt._shader||(Lt._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Lt.pixel_shader)),this._uniforms={u_texture:0,u_textureB:1,u_row_simbols:4,u_simbol_size:16,u_res:vec2.create()}}Lt.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:st.MODE_VALUES}},Lt.title="Encode",Lt.desc="Apply a texture atlas to encode a texture",Lt.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getInputData(0);if(this.properties.precision===st.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,Nt);return}if(!!Nt){var Ft=this.getInputData(1);if(Ft||(Ft=st.getTexture(this.properties.texture)),!Ft){this.setOutputData(0,Nt);return}Ft.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var Xt=this._uniforms;Xt.u_row_simbols=Math.floor(this.properties.num_row_symbols),Xt.u_symbol_size=this.properties.symbol_size,Xt.u_brightness=this.properties.brightness,Xt.u_invert=this.properties.invert?1:0,Xt.u_colorize=this.properties.colorize?1:0,this._tex=st.getTargetTexture(Nt,this._tex,this.properties.precision),Xt.u_res[0]=this._tex.width,Xt.u_res[1]=this._tex.height,this._tex.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),this._tex.drawTo(function(){Ft.bind(1),Nt.toViewport(Lt._shader,Xt)}),this.properties.generate_mipmaps&&(this._tex.bind(0),gl.generateMipmap(this._tex.texture_type),this._tex.unbind(0)),this.setOutputData(0,this._tex)}}},Lt.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_row_simbols;
			uniform float u_symbol_size;
			uniform float u_brightness;
			uniform float u_invert;
			uniform float u_colorize;
			uniform vec2 u_res;
			
			void main() {
				vec2 total_symbols = u_res / u_symbol_size;
				vec2 uv = floor(v_coord * total_symbols) / total_symbols; //pixelate 
				vec2 local_uv = mod(v_coord * u_res, u_symbol_size) / u_symbol_size;
				lowp vec4 textureColor = texture2D(u_texture, uv );
				float lum = clamp(u_brightness * (textureColor.x + textureColor.y + textureColor.z)/3.0,0.0,1.0);
				if( u_invert == 1.0 ) lum = 1.0 - lum;
				float index = floor( lum * (u_row_simbols * u_row_simbols - 1.0));
				float col = mod( index, u_row_simbols );
				float row = u_row_simbols - floor( index / u_row_simbols ) - 1.0;
				vec2 simbol_uv = ( vec2( col, row ) + local_uv ) / u_row_simbols;
				vec4 color = texture2D( u_textureB, simbol_uv );
				if(u_colorize == 1.0)
					color *= textureColor;
				gl_FragColor = color;
			}
			`,it.registerNodeType("texture/encode",Lt);function Bt(){this.addInput("Texture","Texture"),this.addOutput("R","Texture"),this.addOutput("G","Texture"),this.addOutput("B","Texture"),this.addOutput("A","Texture"),Bt._shader||(Bt._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Bt.pixel_shader))}Bt.title="Texture to Channels",Bt.desc="Split texture channels",Bt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt){this._channels||(this._channels=Array(4));for(var Ft=gl.RGB,Xt=0,Qt=0;Qt<4;Qt++)this.isOutputConnected(Qt)?((!this._channels[Qt]||this._channels[Qt].width!=Nt.width||this._channels[Qt].height!=Nt.height||this._channels[Qt].type!=Nt.type||this._channels[Qt].format!=Ft)&&(this._channels[Qt]=new GL.Texture(Nt.width,Nt.height,{type:Nt.type,format:Ft,filter:gl.LINEAR})),Xt++):this._channels[Qt]=null;if(!!Xt){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);for(var ti=Mesh.getScreenQuad(),si=Bt._shader,Vt=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],Qt=0;Qt<4;Qt++)!this._channels[Qt]||(this._channels[Qt].drawTo(function(){Nt.bind(0),si.uniforms({u_texture:0,u_mask:Vt[Qt]}).draw(ti)}),this.setOutputData(Qt,this._channels[Qt]))}}},Bt.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec4 u_mask;
			
			void main() {
			   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );
			}
			`,it.registerNodeType("texture/textureChannels",Bt);function Gt(){this.addInput("R","Texture"),this.addInput("G","Texture"),this.addInput("B","Texture"),this.addInput("A","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:st.DEFAULT,R:1,G:1,B:1,A:1},this._color=vec4.create(),this._uniforms={u_textureR:0,u_textureG:1,u_textureB:2,u_textureA:3,u_color:this._color}}Gt.title="Channels to Texture",Gt.desc="Split texture channels",Gt.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},Gt.prototype.onExecute=function(){var Nt=st.getWhiteTexture(),Ft=this.getInputData(0)||Nt,Xt=this.getInputData(1)||Nt,Qt=this.getInputData(2)||Nt,ti=this.getInputData(3)||Nt;gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var si=Mesh.getScreenQuad();Gt._shader||(Gt._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Gt.pixel_shader));var Vt=Gt._shader,Kt=Math.max(Ft.width,Xt.width,Qt.width,ti.width),ni=Math.max(Ft.height,Xt.height,Qt.height,ti.height),hi=this.properties.precision==st.HIGH?st.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._texture||this._texture.width!=Kt||this._texture.height!=ni||this._texture.type!=hi)&&(this._texture=new GL.Texture(Kt,ni,{type:hi,format:gl.RGBA,filter:gl.LINEAR}));var ui=this._color;ui[0]=this.properties.R,ui[1]=this.properties.G,ui[2]=this.properties.B,ui[3]=this.properties.A;var gi=this._uniforms;this._texture.drawTo(function(){Ft.bind(0),Xt.bind(1),Qt.bind(2),ti.bind(3),Vt.uniforms(gi).draw(si)}),this.setOutputData(0,this._texture)},Gt.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_textureR;
			uniform sampler2D u_textureG;
			uniform sampler2D u_textureB;
			uniform sampler2D u_textureA;
			uniform vec4 u_color;
			
			void main() {
			   gl_FragColor = u_color * vec4( 						texture2D(u_textureR, v_coord).r,						texture2D(u_textureG, v_coord).r,						texture2D(u_textureB, v_coord).r,						texture2D(u_textureA, v_coord).r);
			}
			`,it.registerNodeType("texture/channelsTexture",Gt);function Ut(){this.addOutput("Texture","Texture"),this._tex_color=vec4.create(),this.properties={color:vec4.create(),precision:st.DEFAULT}}Ut.title="Color",Ut.desc="Generates a 1x1 texture with a constant color",Ut.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},Ut.prototype.onDrawBackground=function(Nt){var Ft=this.properties.color;Nt.fillStyle="rgb("+Math.floor(clamp(Ft[0],0,1)*255)+","+Math.floor(clamp(Ft[1],0,1)*255)+","+Math.floor(clamp(Ft[2],0,1)*255)+")",this.flags.collapsed?this.boxcolor=Nt.fillStyle:Nt.fillRect(0,0,this.size[0],this.size[1])},Ut.prototype.onExecute=function(){var Nt=this.properties.precision==st.HIGH?st.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._tex||this._tex.type!=Nt)&&(this._tex=new GL.Texture(1,1,{format:gl.RGBA,type:Nt,minFilter:gl.NEAREST}));var Ft=this.properties.color;if(this.inputs)for(var Xt=0;Xt<this.inputs.length;Xt++){var Qt=this.inputs[Xt],ti=this.getInputData(Xt);if(ti!==void 0)switch(Qt.name){case"RGB":case"RGBA":Ft.set(ti);break;case"R":Ft[0]=ti;break;case"G":Ft[1]=ti;break;case"B":Ft[2]=ti;break;case"A":Ft[3]=ti;break}}vec4.sqrDist(this._tex_color,Ft)>.001&&(this._tex_color.set(Ft),this._tex.fill(Ft)),this.setOutputData(0,this._tex)},Ut.prototype.onGetInputs=function(){return[["RGB","vec3"],["RGBA","vec4"],["R","number"],["G","number"],["B","number"],["A","number"]]},it.registerNodeType("texture/color",Ut);function Zt(){this.addInput("A","color"),this.addInput("B","color"),this.addOutput("Texture","Texture"),this.properties={angle:0,scale:1,A:[0,0,0],B:[1,1,1],texture_size:32},Zt._shader||(Zt._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Zt.pixel_shader)),this._uniforms={u_angle:0,u_colorA:vec3.create(),u_colorB:vec3.create()}}Zt.title="Gradient",Zt.desc="Generates a gradient",Zt["@A"]={type:"color"},Zt["@B"]={type:"color"},Zt["@texture_size"]={type:"enum",values:[32,64,128,256,512]},Zt.prototype.onExecute=function(){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Nt=GL.Mesh.getScreenQuad(),Ft=Zt._shader,Xt=this.getInputData(0);Xt||(Xt=this.properties.A);var Qt=this.getInputData(1);Qt||(Qt=this.properties.B);for(var ti=2;ti<this.inputs.length;ti++){var si=this.inputs[ti],Vt=this.getInputData(ti);Vt!==void 0&&(this.properties[si.name]=Vt)}var Kt=this._uniforms;this._uniforms.u_angle=this.properties.angle*DEG2RAD,this._uniforms.u_scale=this.properties.scale,vec3.copy(Kt.u_colorA,Xt),vec3.copy(Kt.u_colorB,Qt);var ni=parseInt(this.properties.texture_size);(!this._tex||this._tex.width!=ni)&&(this._tex=new GL.Texture(ni,ni,{format:gl.RGB,filter:gl.LINEAR})),this._tex.drawTo(function(){Ft.uniforms(Kt).draw(Nt)}),this.setOutputData(0,this._tex)},Zt.prototype.onGetInputs=function(){return[["angle","number"],["scale","number"]]},Zt.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform float u_angle;
			uniform float u_scale;
			uniform vec3 u_colorA;
			uniform vec3 u_colorB;
			
			vec2 rotate(vec2 v, float angle)
			{
				vec2 result;
				float _cos = cos(angle);
				float _sin = sin(angle);
				result.x = v.x * _cos - v.y * _sin;
				result.y = v.x * _sin + v.y * _cos;
				return result;
			}
			void main() {
				float f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;
				vec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));
			   gl_FragColor = vec4(color,1.0);
			}
			`,it.registerNodeType("texture/gradient",Zt);function Jt(){this.addInput("A","Texture"),this.addInput("B","Texture"),this.addInput("Mixer","Texture"),this.addOutput("Texture","Texture"),this.properties={factor:.5,size_from_biggest:!0,invert:!1,precision:st.DEFAULT},this._uniforms={u_textureA:0,u_textureB:1,u_textureMix:2,u_mix:vec4.create()}}Jt.title="Mix",Jt.desc="Generates a texture mixing two textures",Jt.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},Jt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!this.isOutputConnected(0)){if(this.properties.precision===st.PASS_THROUGH){this.setOutputData(0,Nt);return}var Ft=this.getInputData(1);if(!(!Nt||!Ft)){var Xt=this.getInputData(2),Qt=this.getInputData(3);this._tex=st.getTargetTexture(this.properties.size_from_biggest&&Ft.width>Nt.width?Ft:Nt,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var ti=Mesh.getScreenQuad(),si=null,Vt=this._uniforms;if(Xt)si=Jt._shader_tex,si||(si=Jt._shader_tex=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Jt.pixel_shader,{MIX_TEX:""}));else{si=Jt._shader_factor,si||(si=Jt._shader_factor=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Jt.pixel_shader));var Kt=Qt==null?this.properties.factor:Qt;Vt.u_mix.set([Kt,Kt,Kt,Kt])}var ni=this.properties.invert;this._tex.drawTo(function(){Nt.bind(ni?1:0),Ft.bind(ni?0:1),Xt&&Xt.bind(2),si.uniforms(Vt).draw(ti)}),this.setOutputData(0,this._tex)}}},Jt.prototype.onGetInputs=function(){return[["factor","number"]]},Jt.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_textureA;
			uniform sampler2D u_textureB;
			#ifdef MIX_TEX
				uniform sampler2D u_textureMix;
			#else
				uniform vec4 u_mix;
			#endif
			
			void main() {
				#ifdef MIX_TEX
				   vec4 f = texture2D(u_textureMix, v_coord);
				#else
				   vec4 f = u_mix;
				#endif
			   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );
			}
			`,it.registerNodeType("texture/mix",Jt);function ei(){this.addInput("Tex.","Texture"),this.addOutput("Edges","Texture"),this.properties={invert:!0,threshold:!1,factor:1,precision:st.DEFAULT},ei._shader||(ei._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,ei.pixel_shader))}ei.title="Edges",ei.desc="Detects edges",ei.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},ei.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getInputData(0);if(this.properties.precision===st.PASS_THROUGH){this.setOutputData(0,Nt);return}if(!!Nt){this._tex=st.getTargetTexture(Nt,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Ft=Mesh.getScreenQuad(),Xt=ei._shader,Qt=this.properties.invert,ti=this.properties.factor,si=this.properties.threshold?1:0;this._tex.drawTo(function(){Nt.bind(0),Xt.uniforms({u_texture:0,u_isize:[1/Nt.width,1/Nt.height],u_factor:ti,u_threshold:si,u_invert:Qt?1:0}).draw(Ft)}),this.setOutputData(0,this._tex)}}},ei.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_isize;
			uniform int u_invert;
			uniform float u_factor;
			uniform float u_threshold;
			
			void main() {
				vec4 center = texture2D(u_texture, v_coord);
				vec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );
				vec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );
				vec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );
				vec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );
				vec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);
				diff *= u_factor;
				if(u_invert == 1)
					diff.xyz = vec3(1.0) - diff.xyz;
				if( u_threshold == 0.0 )
					gl_FragColor = vec4( diff.xyz, center.a );
				else
					gl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );
			}
			`,it.registerNodeType("texture/edges",ei);function ii(){this.addInput("Texture","Texture"),this.addInput("Distance","number"),this.addInput("Range","number"),this.addOutput("Texture","Texture"),this.properties={distance:100,range:50,only_depth:!1,high_precision:!1},this._uniforms={u_texture:0,u_distance:100,u_range:50,u_camera_planes:null}}ii.title="Depth Range",ii.desc="Generates a texture with a depth range",ii.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getInputData(0);if(!!Nt){var Ft=gl.UNSIGNED_BYTE;this.properties.high_precision&&(Ft=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=Ft||this._temp_texture.width!=Nt.width||this._temp_texture.height!=Nt.height)&&(this._temp_texture=new GL.Texture(Nt.width,Nt.height,{type:Ft,format:gl.RGBA,filter:gl.LINEAR}));var Xt=this._uniforms,Qt=this.properties.distance;this.isInputConnected(1)&&(Qt=this.getInputData(1),this.properties.distance=Qt);var ti=this.properties.range;this.isInputConnected(2)&&(ti=this.getInputData(2),this.properties.range=ti),Xt.u_distance=Qt,Xt.u_range=ti,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var si=Mesh.getScreenQuad();ii._shader||(ii._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,ii.pixel_shader),ii._shader_onlydepth=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,ii.pixel_shader,{ONLY_DEPTH:""}));var Vt=this.properties.only_depth?ii._shader_onlydepth:ii._shader,Kt=null;Nt.near_far_planes?Kt=Nt.near_far_planes:window.LS&&LS.Renderer._main_camera?Kt=LS.Renderer._main_camera._uniforms.u_camera_planes:Kt=[.1,1e3],Xt.u_camera_planes=Kt,this._temp_texture.drawTo(function(){Nt.bind(0),Vt.uniforms(Xt).draw(si)}),this._temp_texture.near_far_planes=Kt,this.setOutputData(0,this._temp_texture)}}},ii.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_camera_planes;
			uniform float u_distance;
			uniform float u_range;
			
			float LinearDepth()
			{
				float zNear = u_camera_planes.x;
				float zFar = u_camera_planes.y;
				float depth = texture2D(u_texture, v_coord).x;
				depth = depth * 2.0 - 1.0;
				return zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
			}
			
			void main() {
				float depth = LinearDepth();
				#ifdef ONLY_DEPTH
				   gl_FragColor = vec4(depth);
				#else
					float diff = abs(depth * u_camera_planes.y - u_distance);
					float dof = 1.0;
					if(diff <= u_range)
						dof = diff / u_range;
				   gl_FragColor = vec4(dof);
				#endif
			}
			`,it.registerNodeType("texture/depth_range",ii);function li(){this.addInput("Texture","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:st.DEFAULT,invert:!1},this._uniforms={u_texture:0,u_camera_planes:null,u_ires:vec2.create()}}li.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},li.title="Linear Depth",li.desc="Creates a color texture with linear depth",li.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getInputData(0);if(!(!Nt||Nt.format!=gl.DEPTH_COMPONENT&&Nt.format!=gl.DEPTH_STENCIL)){var Ft=this.properties.precision==st.HIGH?gl.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._temp_texture||this._temp_texture.type!=Ft||this._temp_texture.width!=Nt.width||this._temp_texture.height!=Nt.height)&&(this._temp_texture=new GL.Texture(Nt.width,Nt.height,{type:Ft,format:gl.RGB,filter:gl.LINEAR}));var Xt=this._uniforms;Xt.u_invert=this.properties.invert?1:0,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Qt=Mesh.getScreenQuad();li._shader||(li._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,li.pixel_shader));var ti=li._shader,si=null;Nt.near_far_planes?si=Nt.near_far_planes:window.LS&&LS.Renderer._main_camera?si=LS.Renderer._main_camera._uniforms.u_camera_planes:si=[.1,1e3],Xt.u_camera_planes=si,Xt.u_ires.set([0,0]),this._temp_texture.drawTo(function(){Nt.bind(0),ti.uniforms(Xt).draw(Qt)}),this._temp_texture.near_far_planes=si,this.setOutputData(0,this._temp_texture)}}},li.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_camera_planes;
			uniform int u_invert;
			uniform vec2 u_ires;
			
			void main() {
				float zNear = u_camera_planes.x;
				float zFar = u_camera_planes.y;
				float depth = texture2D(u_texture, v_coord + u_ires*0.5).x * 2.0 - 1.0;
				float f = zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
				if( u_invert == 1 )
					f = 1.0 - f;
				gl_FragColor = vec4(vec3(f),1.0);
			}
			`,it.registerNodeType("texture/linear_depth",li);function pi(){this.addInput("Texture","Texture"),this.addInput("Iterations","number"),this.addInput("Intensity","number"),this.addOutput("Blurred","Texture"),this.properties={intensity:1,iterations:1,preserve_aspect:!1,scale:[1,1],precision:st.DEFAULT}}pi.title="Blur",pi.desc="Blur a texture",pi.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},pi.max_iterations=20,pi.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt&&!!this.isOutputConnected(0)){var Ft=this._final_texture;(!Ft||Ft.width!=Nt.width||Ft.height!=Nt.height||Ft.type!=Nt.type)&&(Ft=this._final_texture=new GL.Texture(Nt.width,Nt.height,{type:Nt.type,format:gl.RGBA,filter:gl.LINEAR}));var Xt=this.properties.iterations;if(this.isInputConnected(1)&&(Xt=this.getInputData(1),this.properties.iterations=Xt),Xt=Math.min(Math.floor(Xt),pi.max_iterations),Xt==0){this.setOutputData(0,Nt);return}var Qt=this.properties.intensity;this.isInputConnected(2)&&(Qt=this.getInputData(2),this.properties.intensity=Qt);var ti=it.camera_aspect;!ti&&window.gl!==void 0&&(ti=gl.canvas.height/gl.canvas.width),ti||(ti=1),ti=this.properties.preserve_aspect?ti:1;var si=this.properties.scale||[1,1];Nt.applyBlur(ti*si[0],si[1],Qt,Ft);for(var Vt=1;Vt<Xt;++Vt)Ft.applyBlur(ti*si[0]*(Vt+1),si[1]*(Vt+1),Qt);this.setOutputData(0,Ft)}},it.registerNodeType("texture/blur",pi);function ci(){this.intensity=.5,this.persistence=.6,this.iterations=8,this.threshold=.8,this.scale=1,this.dirt_texture=null,this.dirt_factor=.5,this._textures=[],this._uniforms={u_intensity:1,u_texture:0,u_glow_texture:1,u_threshold:0,u_texel_size:vec2.create()}}ci.prototype.applyFX=function(Nt,Ft,Xt,Qt){var ti=Nt.width,si=Nt.height,Vt={format:Nt.format,type:Nt.type,minFilter:GL.LINEAR,magFilter:GL.LINEAR,wrap:gl.CLAMP_TO_EDGE},Kt=this._uniforms,ni=this._textures,_i=ci._cut_shader;_i||(_i=ci._cut_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,ci.cut_pixel_shader)),gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),Kt.u_threshold=this.threshold;var hi=ni[0]=GL.Texture.getTemporary(ti,si,Vt);Nt.blit(hi,_i.uniforms(Kt));var ui=hi,gi=this.iterations;gi=clamp(gi,1,16)|0;var mi=Kt.u_texel_size,yi=this.intensity;Kt.u_intensity=1,Kt.u_delta=this.scale;var _i=ci._shader;_i||(_i=ci._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,ci.scale_pixel_shader));for(var vi=1;vi<gi&&(ti=ti>>1,(si|0)>1&&(si=si>>1),!(ti<2));vi++)hi=ni[vi]=GL.Texture.getTemporary(ti,si,Vt),mi[0]=1/ui.width,mi[1]=1/ui.height,ui.blit(hi,_i.uniforms(Kt)),ui=hi;for(Qt&&(mi[0]=1/ui.width,mi[1]=1/ui.height,Kt.u_intensity=yi,Kt.u_delta=1,ui.blit(Qt,_i.uniforms(Kt))),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),Kt.u_intensity=this.persistence,Kt.u_delta=.5,vi-=2;vi>=0;vi--)hi=ni[vi],ni[vi]=null,mi[0]=1/ui.width,mi[1]=1/ui.height,ui.blit(hi,_i.uniforms(Kt)),GL.Texture.releaseTemporary(ui),ui=hi;if(gl.disable(gl.BLEND),Xt&&ui.blit(Xt),Ft){var Ti=Ft,xi=this.dirt_texture,Ei=this.dirt_factor;Kt.u_intensity=yi,_i=xi?ci._dirt_final_shader:ci._final_shader,_i||(xi?_i=ci._dirt_final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,ci.final_pixel_shader,{USE_DIRT:""}):_i=ci._final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,ci.final_pixel_shader)),Ti.drawTo(function(){Nt.bind(0),ui.bind(1),xi&&(_i.setUniform("u_dirt_factor",Ei),_i.setUniform("u_dirt_texture",xi.bind(2))),_i.toViewport(Kt)})}GL.Texture.releaseTemporary(ui)},ci.cut_pixel_shader=`precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform float u_threshold;
		void main() {
			gl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );
		}`,ci.scale_pixel_shader=`precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform vec2 u_texel_size;
		uniform float u_delta;
		uniform float u_intensity;
		
		vec4 sampleBox(vec2 uv) {
			vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
			vec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);
			return s * 0.25;
		}
		void main() {
			gl_FragColor = u_intensity * sampleBox( v_coord );
		}`,ci.final_pixel_shader=`precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform sampler2D u_glow_texture;
		#ifdef USE_DIRT
			uniform sampler2D u_dirt_texture;
		#endif
		uniform vec2 u_texel_size;
		uniform float u_delta;
		uniform float u_intensity;
		uniform float u_dirt_factor;
		
		vec4 sampleBox(vec2 uv) {
			vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
			vec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);
			return s * 0.25;
		}
		void main() {
			vec4 glow = sampleBox( v_coord );
			#ifdef USE_DIRT
				glow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );
			#endif
			gl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;
		}`;function Wt(){this.addInput("in","Texture"),this.addInput("dirt","Texture"),this.addOutput("out","Texture"),this.addOutput("glow","Texture"),this.properties={enabled:!0,intensity:1,persistence:.99,iterations:16,threshold:0,scale:1,dirt_factor:.5,precision:st.DEFAULT},this.fx=new ci}Wt.title="Glow",Wt.desc="Filters a texture giving it a glow effect",Wt.widgets_info={iterations:{type:"number",min:0,max:16,step:1,precision:0},threshold:{type:"number",min:0,max:10,step:.01,precision:2},precision:{widget:"combo",values:st.MODE_VALUES}},Wt.prototype.onGetInputs=function(){return[["enabled","boolean"],["threshold","number"],["intensity","number"],["persistence","number"],["iterations","number"],["dirt_factor","number"]]},Wt.prototype.onGetOutputs=function(){return[["average","Texture"]]},Wt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt&&!!this.isAnyOutputConnected()){if(this.properties.precision===st.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,Nt);return}Nt.width,Nt.height;var Ft=this.fx;Ft.threshold=this.getInputOrProperty("threshold"),Ft.iterations=this.getInputOrProperty("iterations"),Ft.intensity=this.getInputOrProperty("intensity"),Ft.persistence=this.getInputOrProperty("persistence"),Ft.dirt_texture=this.getInputData(1),Ft.dirt_factor=this.getInputOrProperty("dirt_factor"),Ft.scale=this.properties.scale;var Xt=st.getTextureType(this.properties.precision,Nt),Qt=null;this.isOutputConnected(2)&&(Qt=this._average_texture,(!Qt||Qt.type!=Nt.type||Qt.format!=Nt.format)&&(Qt=this._average_texture=new GL.Texture(1,1,{type:Nt.type,format:Nt.format,filter:gl.LINEAR})));var ti=null;this.isOutputConnected(1)&&(ti=this._glow_texture,(!ti||ti.width!=Nt.width||ti.height!=Nt.height||ti.type!=Xt||ti.format!=Nt.format)&&(ti=this._glow_texture=new GL.Texture(Nt.width,Nt.height,{type:Xt,format:Nt.format,filter:gl.LINEAR})));var si=null;this.isOutputConnected(0)&&(si=this._final_texture,(!si||si.width!=Nt.width||si.height!=Nt.height||si.type!=Xt||si.format!=Nt.format)&&(si=this._final_texture=new GL.Texture(Nt.width,Nt.height,{type:Xt,format:Nt.format,filter:gl.LINEAR}))),Ft.applyFX(Nt,si,ti,Qt),this.isOutputConnected(0)&&this.setOutputData(0,si),this.isOutputConnected(1)&&this.setOutputData(1,Qt),this.isOutputConnected(2)&&this.setOutputData(2,ti)}},it.registerNodeType("texture/glow",Wt);function $t(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={intensity:1,radius:5}}$t.title="Kuwahara Filter",$t.desc="Filters a texture giving an artistic oil canvas painting",$t.max_radius=10,$t._shaders=[],$t.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt&&!!this.isOutputConnected(0)){var Ft=this._temp_texture;(!Ft||Ft.width!=Nt.width||Ft.height!=Nt.height||Ft.type!=Nt.type)&&(this._temp_texture=new GL.Texture(Nt.width,Nt.height,{type:Nt.type,format:gl.RGBA,filter:gl.LINEAR}));var Xt=this.properties.radius;if(Xt=Math.min(Math.floor(Xt),$t.max_radius),Xt==0){this.setOutputData(0,Nt);return}var Qt=this.properties.intensity,ti=it.camera_aspect;!ti&&window.gl!==void 0&&(ti=gl.canvas.height/gl.canvas.width),ti||(ti=1),ti=this.properties.preserve_aspect?ti:1,$t._shaders[Xt]||($t._shaders[Xt]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,$t.pixel_shader,{RADIUS:Xt.toFixed(0)}));var si=$t._shaders[Xt],Vt=GL.Mesh.getScreenQuad();Nt.bind(0),this._temp_texture.drawTo(function(){si.uniforms({u_texture:0,u_intensity:Qt,u_resolution:[Nt.width,Nt.height],u_iResolution:[1/Nt.width,1/Nt.height]}).draw(Vt)}),this.setOutputData(0,this._temp_texture)}},$t.pixel_shader=`
	precision highp float;
	varying vec2 v_coord;
	uniform sampler2D u_texture;
	uniform float u_intensity;
	uniform vec2 u_resolution;
	uniform vec2 u_iResolution;
	#ifndef RADIUS
		#define RADIUS 7
	#endif
	void main() {
	
		const int radius = RADIUS;
		vec2 fragCoord = v_coord;
		vec2 src_size = u_iResolution;
		vec2 uv = v_coord;
		float n = float((radius + 1) * (radius + 1));
		int i;
		int j;
		vec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);
		vec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);
		vec3 c;
		
		for (int j = -radius; j <= 0; ++j)  {
			for (int i = -radius; i <= 0; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m0 += c;
				s0 += c * c;
			}
		}
		
		for (int j = -radius; j <= 0; ++j)  {
			for (int i = 0; i <= radius; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m1 += c;
				s1 += c * c;
			}
		}
		
		for (int j = 0; j <= radius; ++j)  {
			for (int i = 0; i <= radius; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m2 += c;
				s2 += c * c;
			}
		}
		
		for (int j = 0; j <= radius; ++j)  {
			for (int i = -radius; i <= 0; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m3 += c;
				s3 += c * c;
			}
		}
		
		float min_sigma2 = 1e+2;
		m0 /= n;
		s0 = abs(s0 / n - m0 * m0);
		
		float sigma2 = s0.r + s0.g + s0.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m0, 1.0);
		}
		
		m1 /= n;
		s1 = abs(s1 / n - m1 * m1);
		
		sigma2 = s1.r + s1.g + s1.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m1, 1.0);
		}
		
		m2 /= n;
		s2 = abs(s2 / n - m2 * m2);
		
		sigma2 = s2.r + s2.g + s2.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m2, 1.0);
		}
		
		m3 /= n;
		s3 = abs(s3 / n - m3 * m3);
		
		sigma2 = s3.r + s3.g + s3.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m3, 1.0);
		}
	}
	`,it.registerNodeType("texture/kuwahara",$t);function Rt(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={sigma:1.4,k:1.6,p:21.7,epsilon:79,phi:.017}}Rt.title="XDoG Filter",Rt.desc="Filters a texture giving an artistic ink style",Rt.max_radius=10,Rt._shaders=[],Rt.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt&&!!this.isOutputConnected(0)){var Ft=this._temp_texture;(!Ft||Ft.width!=Nt.width||Ft.height!=Nt.height||Ft.type!=Nt.type)&&(this._temp_texture=new GL.Texture(Nt.width,Nt.height,{type:Nt.type,format:gl.RGBA,filter:gl.LINEAR})),Rt._xdog_shader||(Rt._xdog_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Rt.xdog_pixel_shader));var Xt=Rt._xdog_shader,Qt=GL.Mesh.getScreenQuad(),ti=this.properties.sigma,si=this.properties.k,Vt=this.properties.p,Kt=this.properties.epsilon,ni=this.properties.phi;Nt.bind(0),this._temp_texture.drawTo(function(){Xt.uniforms({src:0,sigma:ti,k:si,p:Vt,epsilon:Kt,phi:ni,cvsWidth:Nt.width,cvsHeight:Nt.height}).draw(Qt)}),this.setOutputData(0,this._temp_texture)}},Rt.xdog_pixel_shader=`
	precision highp float;
	uniform sampler2D src;

	uniform float cvsHeight;
	uniform float cvsWidth;

	uniform float sigma;
	uniform float k;
	uniform float p;
	uniform float epsilon;
	uniform float phi;
	varying vec2 v_coord;

	float cosh(float val)
	{
		float tmp = exp(val);
		float cosH = (tmp + 1.0 / tmp) / 2.0;
		return cosH;
	}

	float tanh(float val)
	{
		float tmp = exp(val);
		float tanH = (tmp - 1.0 / tmp) / (tmp + 1.0 / tmp);
		return tanH;
	}

	float sinh(float val)
	{
		float tmp = exp(val);
		float sinH = (tmp - 1.0 / tmp) / 2.0;
		return sinH;
	}

	void main(void){
		vec3 destColor = vec3(0.0);
		float tFrag = 1.0 / cvsHeight;
		float sFrag = 1.0 / cvsWidth;
		vec2 Frag = vec2(sFrag,tFrag);
		vec2 uv = gl_FragCoord.st;
		float twoSigmaESquared = 2.0 * sigma * sigma;
		float twoSigmaRSquared = twoSigmaESquared * k * k;
		int halfWidth = int(ceil( 1.0 * sigma * k ));

		const int MAX_NUM_ITERATION = 99999;
		vec2 sum = vec2(0.0);
		vec2 norm = vec2(0.0);

		for(int cnt=0;cnt<MAX_NUM_ITERATION;cnt++){
			if(cnt > (2*halfWidth+1)*(2*halfWidth+1)){break;}
			int i = int(cnt / (2*halfWidth+1)) - halfWidth;
			int j = cnt - halfWidth - int(cnt / (2*halfWidth+1)) * (2*halfWidth+1);

			float d = length(vec2(i,j));
			vec2 kernel = vec2( exp( -d * d / twoSigmaESquared ), 
								exp( -d * d / twoSigmaRSquared ));

			vec2 L = texture2D(src, (uv + vec2(i,j)) * Frag).xx;

			norm += kernel;
			sum += kernel * L;
		}

		sum /= norm;

		float H = 100.0 * ((1.0 + p) * sum.x - p * sum.y);
		float edge = ( H > epsilon )? 1.0 : 1.0 + tanh( phi * (H - epsilon));
		destColor = vec3(edge);
		gl_FragColor = vec4(destColor, 1.0);
	}`,it.registerNodeType("texture/xDoG",Rt);function Yt(){this.addOutput("Webcam","Texture"),this.properties={texture_name:"",facingMode:"user"},this.boxcolor="black",this.version=0}Yt.title="Webcam",Yt.desc="Webcam texture",Yt.is_webcam_open=!1,Yt.prototype.openStream=function(){if(!navigator.getUserMedia)return;this._waiting_confirmation=!0;var Nt={audio:!1,video:{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(Nt).then(this.streamReady.bind(this)).catch(Xt);var Ft=this;function Xt(Qt){Yt.is_webcam_open=!1,console.log("Webcam rejected",Qt),Ft._webcam_stream=!1,Ft.boxcolor="red",Ft.trigger("stream_error")}},Yt.prototype.closeStream=function(){if(this._webcam_stream){var Nt=this._webcam_stream.getTracks();if(Nt.length)for(var Ft=0;Ft<Nt.length;++Ft)Nt[Ft].stop();Yt.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},Yt.prototype.streamReady=function(Nt){this._webcam_stream=Nt,this.boxcolor="green";var Ft=this._video;Ft||(Ft=document.createElement("video"),Ft.autoplay=!0,Ft.srcObject=Nt,this._video=Ft,Ft.onloadedmetadata=function(Xt){Yt.is_webcam_open=!0,console.log(Xt)}),this.trigger("stream_ready",Ft)},Yt.prototype.onPropertyChanged=function(Nt,Ft){Nt=="facingMode"&&(this.properties.facingMode=Ft,this.closeStream(),this.openStream())},Yt.prototype.onRemoved=function(){if(!!this._webcam_stream){var Nt=this._webcam_stream.getTracks();if(Nt.length)for(var Ft=0;Ft<Nt.length;++Ft)Nt[Ft].stop();this._webcam_stream=null,this._video=null}},Yt.prototype.onDrawBackground=function(Nt){this.flags.collapsed||this.size[1]<=20||!this._video||(Nt.save(),Nt.webgl?this._video_texture&&Nt.drawImage(this._video_texture,0,0,this.size[0],this.size[1]):Nt.drawImage(this._video,0,0,this.size[0],this.size[1]),Nt.restore())},Yt.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){var Nt=this._video.videoWidth,Ft=this._video.videoHeight,Xt=this._video_texture;if((!Xt||Xt.width!=Nt||Xt.height!=Ft)&&(this._video_texture=new GL.Texture(Nt,Ft,{format:gl.RGB,filter:gl.LINEAR})),this._video_texture.uploadImage(this._video),this._video_texture.version=++this.version,this.properties.texture_name){var Qt=st.getTexturesContainer();Qt[this.properties.texture_name]=this._video_texture}this.setOutputData(0,this._video_texture);for(var ti=1;ti<this.outputs.length;++ti)if(!!this.outputs[ti])switch(this.outputs[ti].name){case"width":this.setOutputData(ti,this._video.videoWidth);break;case"height":this.setOutputData(ti,this._video.videoHeight);break}}},Yt.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",it.EVENT],["stream_closed",it.EVENT],["stream_error",it.EVENT]]},it.registerNodeType("texture/webcam",Yt);function Ht(){this.addInput("in","Texture"),this.addInput("f","number"),this.addOutput("out","Texture"),this.properties={enabled:!0,factor:1,precision:st.LOW},this._uniforms={u_texture:0,u_factor:1}}Ht.title="Lens FX",Ht.desc="distortion and chromatic aberration",Ht.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},Ht.prototype.onGetInputs=function(){return[["enabled","boolean"]]},Ht.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt&&!!this.isOutputConnected(0)){if(this.properties.precision===st.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,Nt);return}var Ft=this._temp_texture;(!Ft||Ft.width!=Nt.width||Ft.height!=Nt.height||Ft.type!=Nt.type)&&(Ft=this._temp_texture=new GL.Texture(Nt.width,Nt.height,{type:Nt.type,format:gl.RGBA,filter:gl.LINEAR}));var Xt=Ht._shader;Xt||(Xt=Ht._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Ht.pixel_shader));var Qt=this.getInputData(1);Qt==null&&(Qt=this.properties.factor);var ti=this._uniforms;ti.u_factor=Qt,gl.disable(gl.DEPTH_TEST),Ft.drawTo(function(){Nt.bind(0),Xt.uniforms(ti).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,Ft)}},Ht.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_factor;
			vec2 barrelDistortion(vec2 coord, float amt) {
				vec2 cc = coord - 0.5;
				float dist = dot(cc, cc);
				return coord + cc * dist * amt;
			}
			
			float sat( float t )
			{
				return clamp( t, 0.0, 1.0 );
			}
			
			float linterp( float t ) {
				return sat( 1.0 - abs( 2.0*t - 1.0 ) );
			}
			
			float remap( float t, float a, float b ) {
				return sat( (t - a) / (b - a) );
			}
			
			vec4 spectrum_offset( float t ) {
				vec4 ret;
				float lo = step(t,0.5);
				float hi = 1.0-lo;
				float w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );
				ret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);
			
				return pow( ret, vec4(1.0/2.2) );
			}
			
			const float max_distort = 2.2;
			const int num_iter = 12;
			const float reci_num_iter_f = 1.0 / float(num_iter);
			
			void main()
			{	
				vec2 uv=v_coord;
				vec4 sumcol = vec4(0.0);
				vec4 sumw = vec4(0.0);	
				for ( int i=0; i<num_iter;++i )
				{
					float t = float(i) * reci_num_iter_f;
					vec4 w = spectrum_offset( t );
					sumw += w;
					sumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );
				}
				gl_FragColor = sumcol / sumw;
			}`,it.registerNodeType("texture/lensfx",Ht);function jt(){this.addInput("in",""),this.properties={precision:st.LOW,width:0,height:0,channels:1},this.addOutput("out","Texture")}jt.title="Data->Tex",jt.desc="Generates or applies a curve to a texture",jt.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},jt.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getInputData(0);if(!!Nt){var Ft=this.properties.channels,Xt=this.properties.width,Qt=this.properties.height;(!Xt||!Qt)&&(Xt=Math.floor(Nt.length/Ft),Qt=1);var ti=gl.RGBA;Ft==3?ti=gl.RGB:Ft==1&&(ti=gl.LUMINANCE);var si=this._temp_texture,Vt=st.getTextureType(this.properties.precision);(!si||si.width!=Xt||si.height!=Qt||si.type!=Vt)&&(si=this._temp_texture=new GL.Texture(Xt,Qt,{type:Vt,format:ti,filter:gl.LINEAR})),si.uploadData(Nt),this.setOutputData(0,si)}}},it.registerNodeType("texture/fromdata",jt);function qt(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={precision:st.LOW,split_channels:!1},this._values=new Uint8Array(256*4),this._values.fill(255),this._curve_texture=null,this._uniforms={u_texture:0,u_curve:1,u_range:1},this._must_update=!0,this._points={RGB:[[0,0],[1,1]],R:[[0,0],[1,1]],G:[[0,0],[1,1]],B:[[0,0],[1,1]]},this.curve_editor=null,this.addWidget("toggle","Split Channels",!1,"split_channels"),this.addWidget("combo","Channel","RGB",{values:["RGB","R","G","B"]}),this.curve_offset=68,this.size=[240,160]}qt.title="Curve",qt.desc="Generates or applies a curve to a texture",qt.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},qt.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getInputData(0),Ft=this._temp_texture;if(!Nt){(this._must_update||!this._curve_texture)&&this.updateCurve(),this.setOutputData(0,this._curve_texture);return}var Xt=st.getTextureType(this.properties.precision,Nt);(!Ft||Ft.type!=Xt||Ft.width!=Nt.width||Ft.height!=Nt.height||Ft.format!=Nt.format)&&(Ft=this._temp_texture=new GL.Texture(Nt.width,Nt.height,{type:Xt,format:Nt.format,filter:gl.LINEAR}));var Qt=qt._shader;Qt||(Qt=qt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,qt.pixel_shader)),(this._must_update||!this._curve_texture)&&this.updateCurve();var ti=this._uniforms,si=this._curve_texture;Ft.drawTo(function(){gl.disable(gl.DEPTH_TEST),Nt.bind(0),si.bind(1),Qt.uniforms(ti).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,Ft)}},qt.prototype.sampleCurve=function(Nt,Xt){var Xt=Xt||this._points.RGB;if(!!Xt){for(var Qt=0;Qt<Xt.length-1;++Qt){var ti=Xt[Qt],si=Xt[Qt+1];if(!(si[0]<Nt)){var Vt=si[0]-ti[0];if(Math.abs(Vt)<1e-5)return ti[1];var Kt=(Nt-ti[0])/Vt;return ti[1]*(1-Kt)+si[1]*Kt}}return 0}},qt.prototype.updateCurve=function(){for(var Nt=this._values,Ft=Nt.length/4,Xt=this.properties.split_channels,Qt=0;Qt<Ft;++Qt){if(Xt)Nt[Qt*4]=clamp(this.sampleCurve(Qt/Ft,this._points.R)*255,0,255),Nt[Qt*4+1]=clamp(this.sampleCurve(Qt/Ft,this._points.G)*255,0,255),Nt[Qt*4+2]=clamp(this.sampleCurve(Qt/Ft,this._points.B)*255,0,255);else{var ti=this.sampleCurve(Qt/Ft);Nt[Qt*4]=Nt[Qt*4+1]=Nt[Qt*4+2]=clamp(ti*255,0,255)}Nt[Qt*4+3]=255}this._curve_texture||(this._curve_texture=new GL.Texture(256,1,{format:gl.RGBA,magFilter:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE})),this._curve_texture.uploadData(Nt,null,!0)},qt.prototype.onSerialize=function(Nt){var Ft={};for(var Xt in this._points)Ft[Xt]=this._points[Xt].concat();Nt.curves=Ft},qt.prototype.onConfigure=function(Nt){this._points=Nt.curves,this.curve_editor&&(curve_editor.points=this._points),this._must_update=!0},qt.prototype.onMouseDown=function(Nt,Ft,Xt){if(this.curve_editor){var Qt=this.curve_editor.onMouseDown([Ft[0],Ft[1]-this.curve_offset],Xt);return Qt&&this.captureInput(!0),Qt}},qt.prototype.onMouseMove=function(Nt,Ft,Xt){if(this.curve_editor)return this.curve_editor.onMouseMove([Ft[0],Ft[1]-this.curve_offset],Xt)},qt.prototype.onMouseUp=function(Nt,Ft,Xt){if(this.curve_editor)return this.curve_editor.onMouseUp([Ft[0],Ft[1]-this.curve_offset],Xt);this.captureInput(!1)},qt.channel_line_colors={RGB:"#666",R:"#F33",G:"#3F3",B:"#33F"},qt.prototype.onDrawBackground=function(Nt,Ft){if(!this.flags.collapsed){this.curve_editor||(this.curve_editor=new it.CurveEditor(this._points.R)),Nt.save(),Nt.translate(0,this.curve_offset);var Xt=this.widgets[1].value;this.properties.split_channels?(Xt=="RGB"&&(this.widgets[1].value=Xt="R",this.widgets[1].disabled=!1),this.curve_editor.points=this._points.R,this.curve_editor.draw(Nt,[this.size[0],this.size[1]-this.curve_offset],Ft,"#111",qt.channel_line_colors.R,!0),Nt.globalCompositeOperation="lighten",this.curve_editor.points=this._points.G,this.curve_editor.draw(Nt,[this.size[0],this.size[1]-this.curve_offset],Ft,null,qt.channel_line_colors.G,!0),this.curve_editor.points=this._points.B,this.curve_editor.draw(Nt,[this.size[0],this.size[1]-this.curve_offset],Ft,null,qt.channel_line_colors.B,!0),Nt.globalCompositeOperation="source-over"):(this.widgets[1].value=Xt="RGB",this.widgets[1].disabled=!0),this.curve_editor.points=this._points[Xt],this.curve_editor.draw(Nt,[this.size[0],this.size[1]-this.curve_offset],Ft,this.properties.split_channels?null:"#111",qt.channel_line_colors[Xt]),Nt.restore()}},qt.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_curve;
			uniform float u_range;
			
			void main() {
				vec4 color = texture2D( u_texture, v_coord ) * u_range;
				color.x = texture2D( u_curve, vec2( color.x, 0.5 ) ).x;
				color.y = texture2D( u_curve, vec2( color.y, 0.5 ) ).y;
				color.z = texture2D( u_curve, vec2( color.z, 0.5 ) ).z;
				//color.w = texture2D( u_curve, vec2( color.w, 0.5 ) ).w;
				gl_FragColor = color;
			}`,it.registerNodeType("texture/curve",qt);function ri(){this.addInput("in","Texture"),this.addInput("exp","number"),this.addOutput("out","Texture"),this.properties={exposition:1,precision:st.LOW},this._uniforms={u_texture:0,u_exposition:1}}ri.title="Exposition",ri.desc="Controls texture exposition",ri.widgets_info={exposition:{widget:"slider",min:0,max:3},precision:{widget:"combo",values:st.MODE_VALUES}},ri.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt&&!!this.isOutputConnected(0)){var Ft=this._temp_texture;(!Ft||Ft.width!=Nt.width||Ft.height!=Nt.height||Ft.type!=Nt.type)&&(Ft=this._temp_texture=new GL.Texture(Nt.width,Nt.height,{type:Nt.type,format:gl.RGBA,filter:gl.LINEAR}));var Xt=ri._shader;Xt||(Xt=ri._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,ri.pixel_shader)),this.properties.exposition;var Qt=this.getInputData(1);Qt!=null&&(this.properties.exposition=Qt);var ti=this._uniforms;Ft.drawTo(function(){gl.disable(gl.DEPTH_TEST),Nt.bind(0),Xt.uniforms(ti).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,Ft)}},ri.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_exposition;
			
			void main() {
				vec4 color = texture2D( u_texture, v_coord );
				gl_FragColor = vec4( color.xyz * u_exposition, color.a );
			}`,it.registerNodeType("texture/exposition",ri);function oi(){this.addInput("in","Texture"),this.addInput("avg","number,Texture"),this.addOutput("out","Texture"),this.properties={enabled:!0,scale:1,gamma:1,average_lum:1,lum_white:1,precision:st.LOW},this._uniforms={u_texture:0,u_lumwhite2:1,u_igamma:1,u_scale:1,u_average_lum:1}}oi.title="Tone Mapping",oi.desc="Applies Tone Mapping to convert from high to low",oi.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES}},oi.prototype.onGetInputs=function(){return[["enabled","boolean"]]},oi.prototype.onExecute=function(){var Nt=this.getInputData(0);if(!!Nt&&!!this.isOutputConnected(0)){if(this.properties.precision===st.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,Nt);return}var Ft=this._temp_texture;(!Ft||Ft.width!=Nt.width||Ft.height!=Nt.height||Ft.type!=Nt.type)&&(Ft=this._temp_texture=new GL.Texture(Nt.width,Nt.height,{type:Nt.type,format:gl.RGBA,filter:gl.LINEAR}));var Xt=this.getInputData(1);Xt==null&&(Xt=this.properties.average_lum);var Qt=this._uniforms,ti=null;Xt.constructor===Number?(this.properties.average_lum=Xt,Qt.u_average_lum=this.properties.average_lum,ti=oi._shader,ti||(ti=oi._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,oi.pixel_shader))):Xt.constructor===GL.Texture&&(Qt.u_average_texture=Xt.bind(1),ti=oi._shader_texture,ti||(ti=oi._shader_texture=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,oi.pixel_shader,{AVG_TEXTURE:""}))),Qt.u_lumwhite2=this.properties.lum_white*this.properties.lum_white,Qt.u_scale=this.properties.scale,Qt.u_igamma=1/this.properties.gamma,gl.disable(gl.DEPTH_TEST),Ft.drawTo(function(){Nt.bind(0),ti.uniforms(Qt).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._temp_texture)}},oi.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_scale;
			#ifdef AVG_TEXTURE
				uniform sampler2D u_average_texture;
			#else
				uniform float u_average_lum;
			#endif
			uniform float u_lumwhite2;
			uniform float u_igamma;
			vec3 RGB2xyY (vec3 rgb)
			{
				 const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,
										   0.2126, 0.7152, 0.0722,
										   0.0193, 0.1192, 0.9505);
				vec3 XYZ = RGB2XYZ * rgb;
				
				float f = (XYZ.x + XYZ.y + XYZ.z);
				return vec3(XYZ.x / f,
							XYZ.y / f,
							XYZ.y);
			}
			
			void main() {
				vec4 color = texture2D( u_texture, v_coord );
				vec3 rgb = color.xyz;
				float average_lum = 0.0;
				#ifdef AVG_TEXTURE
					vec3 pixel = texture2D(u_average_texture,vec2(0.5)).xyz;
					average_lum = (pixel.x + pixel.y + pixel.z) / 3.0;
				#else
					average_lum = u_average_lum;
				#endif
				//Ld - this part of the code is the same for both versions
				float lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));
				float L = (u_scale / average_lum) * lum;
				float Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);
				//first
				//vec3 xyY = RGB2xyY(rgb);
				//xyY.z *= Ld;
				//rgb = xyYtoRGB(xyY);
				//second
				rgb = (rgb / lum) * Ld;
				rgb = max(rgb,vec3(0.001));
				rgb = pow( rgb, vec3( u_igamma ) );
				gl_FragColor = vec4( rgb, color.a );
			}`,it.registerNodeType("texture/tonemapping",oi);function fi(){this.addOutput("out","Texture"),this.properties={width:512,height:512,seed:0,persistence:.1,octaves:8,scale:1,offset:[0,0],amplitude:1,precision:st.DEFAULT},this._key=0,this._texture=null,this._uniforms={u_persistence:.1,u_seed:0,u_offset:vec2.create(),u_scale:1,u_viewport:vec2.create()}}fi.title="Perlin",fi.desc="Generates a perlin noise texture",fi.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1},octaves:{type:"number",precision:0,step:1,min:1,max:50}},fi.prototype.onGetInputs=function(){return[["seed","number"],["persistence","number"],["octaves","number"],["scale","number"],["amplitude","number"],["offset","vec2"]]},fi.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.properties.width|0,Ft=this.properties.height|0;Nt==0&&(Nt=gl.viewport_data[2]),Ft==0&&(Ft=gl.viewport_data[3]);var Xt=st.getTextureType(this.properties.precision),Qt=this._texture;(!Qt||Qt.width!=Nt||Qt.height!=Ft||Qt.type!=Xt)&&(Qt=this._texture=new GL.Texture(Nt,Ft,{type:Xt,format:gl.RGB,filter:gl.LINEAR}));var ti=this.getInputOrProperty("persistence"),si=this.getInputOrProperty("octaves"),Vt=this.getInputOrProperty("offset"),Kt=this.getInputOrProperty("scale"),ni=this.getInputOrProperty("amplitude"),hi=this.getInputOrProperty("seed"),ui=""+Nt+Ft+Xt+ti+si+Kt+hi+Vt[0]+Vt[1]+ni;if(ui==this._key){this.setOutputData(0,Qt);return}this._key=ui;var gi=this._uniforms;gi.u_persistence=ti,gi.u_octaves=si,gi.u_offset.set(Vt),gi.u_scale=Kt,gi.u_amplitude=ni,gi.u_seed=hi*128,gi.u_viewport[0]=Nt,gi.u_viewport[1]=Ft;var mi=fi._shader;mi||(mi=fi._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,fi.pixel_shader)),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),Qt.drawTo(function(){mi.uniforms(gi).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,Qt)}},fi.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform vec2 u_offset;
			uniform float u_scale;
			uniform float u_persistence;
			uniform int u_octaves;
			uniform float u_amplitude;
			uniform vec2 u_viewport;
			uniform float u_seed;
			#define M_PI 3.14159265358979323846
			
			float rand(vec2 c){	return fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }
			
			float noise(vec2 p, float freq ){
				float unit = u_viewport.x/freq;
				vec2 ij = floor(p/unit);
				vec2 xy = mod(p,unit)/unit;
				//xy = 3.*xy*xy-2.*xy*xy*xy;
				xy = .5*(1.-cos(M_PI*xy));
				float a = rand((ij+vec2(0.,0.)));
				float b = rand((ij+vec2(1.,0.)));
				float c = rand((ij+vec2(0.,1.)));
				float d = rand((ij+vec2(1.,1.)));
				float x1 = mix(a, b, xy.x);
				float x2 = mix(c, d, xy.x);
				return mix(x1, x2, xy.y);
			}
			
			float pNoise(vec2 p, int res){
				float persistance = u_persistence;
				float n = 0.;
				float normK = 0.;
				float f = 4.;
				float amp = 1.0;
				int iCount = 0;
				for (int i = 0; i<50; i++){
					n+=amp*noise(p, f);
					f*=2.;
					normK+=amp;
					amp*=persistance;
					if (iCount >= res)
						break;
					iCount++;
				}
				float nf = n/normK;
				return nf*nf*nf*nf;
			}
			void main() {
				vec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;
				vec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );
				gl_FragColor = color;
			}`,it.registerNodeType("texture/perlin",fi);function bi(){this.addInput("v"),this.addOutput("out","Texture"),this.properties={code:bi.default_code,width:512,height:512,clear:!0,precision:st.DEFAULT,use_html_canvas:!1},this._func=null,this._temp_texture=null,this.compileCode()}bi.title="Canvas2D",bi.desc="Executes Canvas2D code inside a texture or the viewport.",bi.help="Set width and height to 0 to match viewport size.",bi.default_code=`//vars: canvas,ctx,time
ctx.fillStyle='red';
ctx.fillRect(0,0,50,50);
`,bi.widgets_info={precision:{widget:"combo",values:st.MODE_VALUES},code:{type:"code"},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1}},bi.prototype.onPropertyChanged=function(Nt,Ft){Nt=="code"&&this.compileCode(Ft)},bi.prototype.compileCode=function(Nt){if(this._func=null,!!it.allow_scripts)try{this._func=new Function("canvas","ctx","time","script","v",Nt),this.boxcolor="#00FF00"}catch(Ft){this.boxcolor="#FF0000",console.error("Error parsing script"),console.error(Ft)}},bi.prototype.onExecute=function(){var Nt=this._func;!Nt||!this.isOutputConnected(0)||this.executeDraw(Nt)},bi.prototype.executeDraw=function(Nt){var Ft=this.properties.width||gl.canvas.width,Xt=this.properties.height||gl.canvas.height,Qt=this._temp_texture,ti=st.getTextureType(this.properties.precision);(!Qt||Qt.width!=Ft||Qt.height!=Xt||Qt.type!=ti)&&(Qt=this._temp_texture=new GL.Texture(Ft,Xt,{format:gl.RGBA,filter:gl.LINEAR,type:ti}));var si=this.getInputData(0),Vt=this.properties,Kt=this,ni=this.graph.getTime(),hi=gl,ui=gl.canvas;if((this.properties.use_html_canvas||!rt.enableWebGLCanvas)&&(this._canvas?(ui=this._canvas,hi=this._ctx):(ui=this._canvas=createCanvas(Ft.height),hi=this._ctx=ui.getContext("2d")),ui.width=Ft,ui.height=Xt),hi==gl)Qt.drawTo(function(){gl.start2D(),Vt.clear&&(gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT));try{Nt.draw?Nt.draw.call(Kt,ui,hi,ni,Nt,si):Nt.call(Kt,ui,hi,ni,Nt,si),Kt.boxcolor="#00FF00"}catch(gi){Kt.boxcolor="#FF0000",console.error("Error executing script"),console.error(gi)}gl.finish2D()});else{Vt.clear&&hi.clearRect(0,0,ui.width,ui.height);try{Nt.draw?Nt.draw.call(this,ui,hi,ni,Nt,si):Nt.call(this,ui,hi,ni,Nt,si),this.boxcolor="#00FF00"}catch(gi){this.boxcolor="#FF0000",console.error("Error executing script"),console.error(gi)}Qt.uploadImage(ui)}this.setOutputData(0,Qt)},it.registerNodeType("texture/canvas2D",bi);function ai(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={key_color:vec3.fromValues(0,1,0),threshold:.8,slope:.2,precision:st.DEFAULT}}ai.title="Matte",ai.desc="Extracts background",ai.widgets_info={key_color:{widget:"color"},precision:{widget:"combo",values:st.MODE_VALUES}},ai.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getInputData(0);if(this.properties.precision===st.PASS_THROUGH){this.setOutputData(0,Nt);return}if(!!Nt){this._tex=st.getTargetTexture(Nt,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),this._uniforms||(this._uniforms={u_texture:0,u_key_color:this.properties.key_color,u_threshold:1,u_slope:1});var Ft=this._uniforms,Xt=Mesh.getScreenQuad(),Qt=ai._shader;Qt||(Qt=ai._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,ai.pixel_shader)),Ft.u_key_color=this.properties.key_color,Ft.u_threshold=this.properties.threshold,Ft.u_slope=this.properties.slope,this._tex.drawTo(function(){Nt.bind(0),Qt.uniforms(Ft).draw(Xt)}),this.setOutputData(0,this._tex)}}},ai.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec3 u_key_color;
			uniform float u_threshold;
			uniform float u_slope;
			
			void main() {
				vec3 color = texture2D( u_texture, v_coord ).xyz;
				float diff = length( normalize(color) - normalize(u_key_color) );
				float edge = u_threshold * (1.0 - u_slope);
				float alpha = smoothstep( edge, u_threshold, diff);
				gl_FragColor = vec4( color, alpha );
			}`,it.registerNodeType("texture/matte",ai);function di(){this.addInput("in","texture"),this.addInput("yaw","number"),this.addOutput("out","texture"),this.properties={yaw:0}}di.title="CubemapToTexture2D",di.desc="Transforms a CUBEMAP texture into a TEXTURE2D in Polar Representation",di.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Nt=this.getInputData(0);if(!(!Nt||Nt.texture_type!=GL.TEXTURE_CUBE_MAP)){this._last_tex&&(this._last_tex.height!=Nt.height||this._last_tex.type!=Nt.type)&&(this._last_tex=null);var Ft=this.getInputOrProperty("yaw");this._last_tex=GL.Texture.cubemapToTexture2D(Nt,Nt.height,this._last_tex,!0,Ft),this.setOutputData(0,this._last_tex)}}},it.registerNodeType("texture/cubemapToTexture2D",di)}(commonjsGlobal),function(rt){if(typeof GL>"u")return;var it=rt.LiteGraph;rt.LGraphCanvas;var nt="#345",st=it.Shaders={};st.GLSL_types=["float","vec2","vec3","vec4","mat3","mat4","sampler2D","samplerCube"];var vt=st.GLSL_types_const=["float","vec2","vec3","vec4"],_t={radians:"T radians(T degrees)",degrees:"T degrees(T radians)",sin:"T sin(T angle)",cos:"T cos(T angle)",tan:"T tan(T angle)",asin:"T asin(T x)",acos:"T acos(T x)",atan:"T atan(T x)",atan2:"T atan(T x,T y)",pow:"T pow(T x,T y)",exp:"T exp(T x)",log:"T log(T x)",exp2:"T exp2(T x)",log2:"T log2(T x)",sqrt:"T sqrt(T x)",inversesqrt:"T inversesqrt(T x)",abs:"T abs(T x)",sign:"T sign(T x)",floor:"T floor(T x)",round:"T round(T x)",ceil:"T ceil(T x)",fract:"T fract(T x)",mod:"T mod(T x,T y)",min:"T min(T x,T y)",max:"T max(T x,T y)",clamp:"T clamp(T x,T minVal = 0.0,T maxVal = 1.0)",mix:"T mix(T x,T y,T a)",step:"T step(T edge, T edge2, T x)",smoothstep:"T smoothstep(T edge, T edge2, T x)",length:"float length(T x)",distance:"float distance(T p0, T p1)",normalize:"T normalize(T x)",dot:"float dot(T x,T y)",cross:"vec3 cross(vec3 x,vec3 y)",reflect:"vec3 reflect(vec3 V,vec3 N)",refract:"vec3 refract(vec3 V,vec3 N, float IOR)"},bt={},xt=[];Tt(),st.ALL_TYPES="float,vec2,vec3,vec4";function Tt(){xt.length=0;for(var Ht in _t){var jt=_t[Ht],qt=jt.indexOf(" "),ri=jt.substr(0,qt),oi=jt.indexOf("(",qt),fi=jt.substr(qt,oi-qt).trim(),bi=jt.substr(oi+1,jt.length-oi-2).split(",");for(var ai in bi){var di=bi[ai].split(" ").filter(function(Nt){return Nt});bi[ai]={type:di[0].trim(),name:di[1].trim()},di[2]=="="&&(bi[ai].value=di[3].trim())}bt[Ht]={return_type:ri,func:fi,params:bi},xt.push(fi)}}function Et(Ht,jt){jt.color=nt,jt.filter="shader",jt.prototype.clearDestination=function(){this.shader_destination={}},jt.prototype.propagateDestination=function(ri){if(this.shader_destination[ri]=!0,this.inputs)for(var oi=0;oi<this.inputs.length;++oi){var fi=this.getInputNode(oi);fi&&fi.propagateDestination(ri)}},jt.prototype.onPropertyChanged||(jt.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++}),it.registerNodeType("shader::"+Ht,jt)}function wt(Ht,jt){return"VAR_"+(jt||"TEMP")+"_"+Ht.id}function Ot(Ht,jt){if(!Ht.inputs)return null;var qt=Ht.getInputLink(jt);if(!qt)return null;var ri=Ht.graph.getNodeById(qt.origin_id);return ri?ri.getOutputVarName?ri.getOutputVarName(qt.origin_slot):"link_"+ri.id+"_"+qt.origin_slot:null}function It(Ht,jt){return Ht.isOutputConnected(jt)?"link_"+Ht.id+"_"+jt:null}st.registerShaderNode=Et,st.getInputLinkID=Ot,st.getOutputLinkID=It,st.getShaderNodeVarName=wt,st.parseGLSLDescriptions=Tt;var At=it.valueToGLSL=function(jt,qt,ri){var oi=5;if(ri!=null&&(oi=ri),!qt)if(jt.constructor===Number)qt="float";else if(jt.length)switch(jt.length){case 2:qt="vec2";break;case 3:qt="vec3";break;case 4:qt="vec4";break;case 9:qt="mat3";break;case 16:qt="mat4";break;default:throw"unknown type for glsl value size"}else throw"unknown type for glsl value: "+jt.constructor;switch(qt){case"float":return jt.toFixed(oi);case"vec2":return"vec2("+jt[0].toFixed(oi)+","+jt[1].toFixed(oi)+")";case"color3":case"vec3":return"vec3("+jt[0].toFixed(oi)+","+jt[1].toFixed(oi)+","+jt[2].toFixed(oi)+")";case"color4":case"vec4":return"vec4("+jt[0].toFixed(oi)+","+jt[1].toFixed(oi)+","+jt[2].toFixed(oi)+","+jt[3].toFixed(oi)+")";case"mat3":return"mat3(1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0)";case"mat4":return"mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0)";default:throw qt}return""},Dt=it.varToTypeGLSL=function(jt,qt,ri){if(qt==ri)return jt;if(jt==null)switch(ri){case"float":return"0.0";case"vec2":return"vec2(0.0)";case"vec3":return"vec3(0.0)";case"vec4":return"vec4(0.0,0.0,0.0,1.0)";default:return null}if(!ri)throw"error: no output type specified";if(ri=="float")switch(qt){case"vec2":case"vec3":case"vec4":return jt+".x";default:return"0.0"}else if(ri=="vec2")switch(qt){case"float":return"vec2("+jt+")";case"vec3":case"vec4":return jt+".xy";default:return"vec2(0.0)"}else if(ri=="vec3")switch(qt){case"float":return"vec3("+jt+")";case"vec2":return"vec3("+jt+",0.0)";case"vec4":return jt+".xyz";default:return"vec3(0.0)"}else if(ri=="vec4")switch(qt){case"float":return"vec4("+jt+")";case"vec2":return"vec4("+jt+",0.0,1.0)";case"vec3":return"vec4("+jt+",1.0)";default:return"vec4(0.0,0.0,0.0,1.0)"}throw"type cannot be converted"},kt=it.convertVarToGLSLType=function(jt,qt,ri){if(qt==ri)return jt;if(qt=="float")return ri+"("+jt+")";if(ri=="vec2")return"vec2("+jt+".xy)";if(ri=="vec3"){if(qt=="vec2")return"vec3("+jt+",0.0)";if(qt=="vec4")return"vec4("+jt+".xyz)"}if(ri=="vec4"){if(qt=="vec2")return"vec4("+jt+",0.0,0.0)";if(ri=="vec3")return"vec4("+jt+",1.0)"}return null};function Mt(){this.vs_template="",this.fs_template="",this.buffer_names={uvs:"v_coord"},this.extra={},this._functions={},this._uniforms={},this._codeparts={},this._uniform_value=null}Mt.prototype.clear=function(){this._uniforms={},this._functions={},this._codeparts={},this._uniform_value=null,this.extra={}},Mt.prototype.addUniform=function(Ht,jt,qt){this._uniforms[Ht]=jt,qt!=null&&(this._uniform_value||(this._uniform_value={}),this._uniform_value[Ht]=qt)},Mt.prototype.addFunction=function(Ht,jt){this._functions[Ht]=jt},Mt.prototype.addCode=function(Ht,jt,qt){qt=qt||{"":""};for(var ri in qt){var oi=ri?ri+"_"+Ht:Ht;this._codeparts[oi]?this._codeparts[oi]+=jt+`
`:this._codeparts[oi]=jt+`
`}},Mt.prototype.computeCodeBlocks=function(Ht,jt){this.clear();var qt=Ht.findNodesByType("shader::output/vertex");qt=qt&&qt.length?qt[0]:null;var ri=Ht.findNodesByType("shader::output/fragcolor");if(ri=ri&&ri.length?ri[0]:null,!ri)return null;Ht.sendEventToAllNodes("clearDestination"),qt&&qt.propagateDestination("vs"),ri&&ri.propagateDestination("fs"),Ht.sendEventToAllNodes("onGetCode",this);var oi="";for(var fi in this._uniforms)oi+="uniform "+this._uniforms[fi]+" "+fi+`;
`;if(jt)for(var fi in jt)oi+="uniform "+jt[fi]+" "+fi+`;
`;var bi="";for(var fi in this._functions)bi+="//"+fi+`
`+this._functions[fi]+`
`;var ai=this._codeparts;return ai.uniforms=oi,ai.functions=bi,ai},Mt.prototype.computeShaderCode=function(Ht){var jt=this.computeCodeBlocks(Ht),qt=GL.Shader.replaceCodeUsingContext(this.vs_template,jt),ri=GL.Shader.replaceCodeUsingContext(this.fs_template,jt);return{vs_code:qt,fs_code:ri}},Mt.prototype.computeShader=function(Ht,jt){var qt=this.computeShaderCode(Ht);if(console.log(qt.vs_code,qt.fs_code),!it.catch_exceptions)return this._shader_error=!0,jt?jt.updateShader(qt.vs_code,qt.fs_code):jt=new GL.Shader(qt.vs_code,qt.fs_code),this._shader_error=!1,jt;try{return jt?jt.updateShader(qt.vs_code,qt.fs_code):jt=new GL.Shader(qt.vs_code,qt.fs_code),this._shader_error=!1,jt}catch(ri){return this._shader_error||(console.error(ri),ri.indexOf("Fragment shader")!=-1?console.log(qt.fs_code.split(`
`).map(function(oi,fi){return fi+".- "+oi}).join(`
`)):console.log(qt.vs_code)),this._shader_error=!0,null}return null},Mt.prototype.getShader=function(Ht){if(this._shader&&this._shader._version==Ht._version)return this._shader;var jt=this.computeShader(Ht,this._shader);return jt?(this._shader=jt,jt._version=Ht._version,jt):null},Mt.prototype.fillUniforms=function(Ht,jt){if(!!this._uniform_value)for(var qt in this._uniform_value){var ri=this._uniform_value[qt];ri!=null&&(ri.constructor===Function?Ht[qt]=ri.call(this,jt):ri.constructor===GL.Texture||(Ht[qt]=ri))}},it.ShaderContext=it.Shaders.Context=Mt;function zt(){this.subgraph=new it.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.filter="shader",this.addInput("in","texture"),this.addOutput("out","texture"),this.properties={width:0,height:0,alpha:!1,precision:typeof LGraphTexture<"u"?LGraphTexture.DEFAULT:2};var Ht=this.subgraph.findNodesByType("shader::input/uniform")[0];Ht.pos=[200,300];var jt=it.createNode("shader::texture/sampler2D");jt.pos=[400,300],this.subgraph.add(jt);var qt=it.createNode("shader::output/fragcolor");qt.pos=[600,300],this.subgraph.add(qt),Ht.connect(0,jt),jt.connect(0,qt),this.size=[180,60],this.redraw_on_mouse=!0,this._uniforms={},this._shader=null,this._context=new Mt,this._context.vs_template=`#define VERTEX
`+GL.Shader.SCREEN_VERTEX_SHADER,this._context.fs_template=zt.template}zt.template=`
	#define FRAGMENT
	precision highp float;
	varying vec2 v_coord;
	{{varying}}
	{{uniforms}}
	{{functions}}
	{{fs_functions}}
	void main() {

	vec2 uv = v_coord;
	vec4 fragcolor = vec4(0.0);
	vec4 fragcolor1 = vec4(0.0);
	{{fs_code}}
	gl_FragColor = fragcolor;
	}
		`,zt.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},zt.title="ShaderGraph",zt.desc="Builds a shader using a graph",zt.input_node_type="input/uniform",zt.output_node_type="output/fragcolor",zt.title_color=nt,zt.prototype.onSerialize=function(Ht){Ht.subgraph=this.subgraph.serialize()},zt.prototype.onConfigure=function(Ht){this.subgraph.configure(Ht.subgraph)},zt.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Ht=this.getInputData(0);Ht&&Ht.constructor!=GL.Texture&&(Ht=null);var jt=this.properties.width|0,qt=this.properties.height|0;jt==0&&(jt=Ht?Ht.width:gl.viewport_data[2]),qt==0&&(qt=Ht?Ht.height:gl.viewport_data[3]);var ri=LGraphTexture.getTextureType(this.properties.precision,Ht),oi=this._texture;(!oi||oi.width!=jt||oi.height!=qt||oi.type!=ri)&&(oi=this._texture=new GL.Texture(jt,qt,{type:ri,format:this.alpha?gl.RGBA:gl.RGB,filter:gl.LINEAR}));var fi=this.getShader(this.subgraph);if(!!fi){var bi=this._uniforms;this._context.fillUniforms(bi);var ai=0;if(this.inputs)for(var di=0;di<this.inputs.length;++di){var Nt=this.inputs[di],Ft=this.getInputData(di);Nt.type=="texture"&&(Ft||(Ft=GL.Texture.getWhiteTexture()),Ft=Ft.bind(ai++)),Ft!=null&&(bi["u_"+Nt.name]=Ft)}var Xt=GL.Mesh.getScreenQuad();gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),oi.drawTo(function(){fi.uniforms(bi),fi.draw(Xt)}),this.setOutputData(0,oi)}}},zt.prototype.onInputAdded=function(Ht){var jt=it.createNode("shader::input/uniform");jt.setProperty("name",Ht.name),jt.setProperty("type",Ht.type),this.subgraph.add(jt)},zt.prototype.onInputRemoved=function(Ht,jt){for(var qt=this.subgraph.findNodesByType("shader::input/uniform"),ri=0;ri<qt.length;++ri){var oi=qt[ri];oi.properties.name==jt.name&&this.subgraph.remove(oi)}},zt.prototype.computeSize=function(){var Ht=this.inputs?this.inputs.length:0,jt=this.outputs?this.outputs.length:0;return[200,Math.max(Ht,jt)*it.NODE_SLOT_HEIGHT+it.NODE_TITLE_HEIGHT+10]},zt.prototype.getShader=function(){var Ht=this._context.getShader(this.subgraph);return Ht?this.boxcolor=null:this.boxcolor="red",Ht},zt.prototype.onDrawBackground=function(Ht,jt,qt,ri){if(!this.flags.collapsed){var oi=this.getOutputData(0),fi=this.inputs?this.inputs.length*it.NODE_SLOT_HEIGHT:0;oi&&Ht==oi.gl&&this.size[1]>fi+it.NODE_TITLE_HEIGHT&&Ht.drawImage(oi,10,bi,this.size[0]-20,this.size[1]-fi-it.NODE_TITLE_HEIGHT);var bi=this.size[1]-it.NODE_TITLE_HEIGHT+.5,ai=it.isInsideRectangle(ri[0],ri[1],this.pos[0],this.pos[1]+bi,this.size[0],it.NODE_TITLE_HEIGHT);Ht.fillStyle=ai?"#555":"#222",Ht.beginPath(),this._shape==it.BOX_SHAPE?Ht.rect(0,bi,this.size[0]+1,it.NODE_TITLE_HEIGHT):Ht.roundRect(0,bi,this.size[0]+1,it.NODE_TITLE_HEIGHT,0,8),Ht.fill(),Ht.textAlign="center",Ht.font="24px Arial",Ht.fillStyle=ai?"#DDD":"#999",Ht.fillText("+",this.size[0]*.5,bi+24)}},zt.prototype.onMouseDown=function(Ht,jt,qt){var ri=this.size[1]-it.NODE_TITLE_HEIGHT+.5;jt[1]>ri&&qt.showSubgraphPropertiesDialog(this)},zt.prototype.onDrawSubgraphBackground=function(Ht){},zt.prototype.getExtraMenuOptions=function(Ht){var jt=this,qt=[{content:"Print Code",callback:function(){var ri=jt._context.computeShaderCode();console.log(ri.vs_code,ri.fs_code)}}];return qt},it.registerNodeType("texture/shaderGraph",zt);function Pt(){this.addOutput("out",""),this.properties={name:"",type:""}}Pt.title="Uniform",Pt.desc="Input data for the shader",Pt.prototype.getTitle=function(){return this.properties.name&&this.flags.collapsed?this.properties.type+" "+this.properties.name:"Uniform"},Pt.prototype.onPropertyChanged=function(Ht,jt){this.outputs[0].name=this.properties.type+" "+this.properties.name},Pt.prototype.onGetCode=function(Ht){if(!!this.shader_destination){var jt=this.properties.type;if(!jt){if(!Ht.onGetPropertyInfo)return;var qt=Ht.onGetPropertyInfo(this.property.name);if(!qt)return;jt=qt.type}jt=="number"?jt="float":jt=="texture"&&(jt="sampler2D"),st.GLSL_types.indexOf(jt)!=-1&&(Ht.addUniform("u_"+this.properties.name,jt),this.setOutputData(0,jt))}},Pt.prototype.getOutputVarName=function(Ht){return"u_"+this.properties.name},Et("input/uniform",Pt);function Lt(){this.addOutput("out","vec2"),this.properties={name:"coord",type:"vec2"}}Lt.title="Attribute",Lt.desc="Input data from mesh attribute",Lt.prototype.getTitle=function(){return"att. "+this.properties.name},Lt.prototype.onGetCode=function(Ht){if(!!this.shader_destination){var jt=this.properties.type;!jt||st.GLSL_types.indexOf(jt)==-1||(jt=="number"&&(jt="float"),this.properties.name!="coord"&&Ht.addCode("varying"," varying "+jt+" v_"+this.properties.name+";"),this.setOutputData(0,jt))}},Lt.prototype.getOutputVarName=function(Ht){return"v_"+this.properties.name},Et("input/attribute",Lt);function Bt(){this.addInput("tex","sampler2D"),this.addInput("uv","vec2"),this.addOutput("rgba","vec4"),this.addOutput("rgb","vec3")}Bt.title="Sampler2D",Bt.desc="Reads a pixel from a texture",Bt.prototype.onGetCode=function(Ht){if(!!this.shader_destination){var jt=Ot(this,0),qt=wt(this),ri="vec4 "+qt+` = vec4(0.0);
`;if(jt){var oi=Ot(this,1)||Ht.buffer_names.uvs;ri+=qt+" = texture2D("+jt+","+oi+`);
`}var fi=It(this,0);fi&&(ri+="vec4 "+It(this,0)+" = "+qt+`;
`);var bi=It(this,1);bi&&(ri+="vec3 "+It(this,1)+" = "+qt+`.xyz;
`),Ht.addCode("code",ri,this.shader_destination),this.setOutputData(0,"vec4"),this.setOutputData(1,"vec3")}},Et("texture/sampler2D",Bt);function Gt(){this.addOutput("","float"),this.properties={type:"float",value:0},this.addWidget("combo","type","float",null,{values:vt,property:"type"}),this.updateWidgets()}Gt.title="const",Gt.prototype.getTitle=function(){return this.flags.collapsed?At(this.properties.value,this.properties.type,2):"Const"},Gt.prototype.onPropertyChanged=function(Ht,jt){Ht=="type"&&(this.outputs[0].type!=jt&&(this.disconnectOutput(0),this.outputs[0].type=jt),this.widgets.length=1,this.updateWidgets()),Ht=="value"&&(jt.length?(this.widgets[1].value=jt[1],jt.length>2&&(this.widgets[2].value=jt[2]),jt.length>3&&(this.widgets[3].value=jt[3])):this.widgets[1].value=jt)},Gt.prototype.updateWidgets=function(qt){var jt=this,qt=this.properties.value,ri={step:.01};switch(this.properties.type){case"float":this.properties.value=0,this.addWidget("number","v",0,{step:.01,property:"value"});break;case"vec2":this.properties.value=qt&&qt.length==2?[qt[0],qt[1]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(oi){jt.properties.value[0]=oi},ri),this.addWidget("number","y",this.properties.value[1],function(oi){jt.properties.value[1]=oi},ri);break;case"vec3":this.properties.value=qt&&qt.length==3?[qt[0],qt[1],qt[2]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(oi){jt.properties.value[0]=oi},ri),this.addWidget("number","y",this.properties.value[1],function(oi){jt.properties.value[1]=oi},ri),this.addWidget("number","z",this.properties.value[2],function(oi){jt.properties.value[2]=oi},ri);break;case"vec4":this.properties.value=qt&&qt.length==4?[qt[0],qt[1],qt[2],qt[3]]:[0,0,0,0],this.addWidget("number","x",this.properties.value[0],function(oi){jt.properties.value[0]=oi},ri),this.addWidget("number","y",this.properties.value[1],function(oi){jt.properties.value[1]=oi},ri),this.addWidget("number","z",this.properties.value[2],function(oi){jt.properties.value[2]=oi},ri),this.addWidget("number","w",this.properties.value[3],function(oi){jt.properties.value[3]=oi},ri);break;default:console.error("unknown type for constant")}},Gt.prototype.onGetCode=function(Ht){if(!!this.shader_destination){var jt=At(this.properties.value,this.properties.type),qt=It(this,0);if(!!qt){var ri="	"+this.properties.type+" "+qt+" = "+jt+";";Ht.addCode("code",ri,this.shader_destination),this.setOutputData(0,this.properties.type)}}},Et("const/const",Gt);function Ut(){this.addInput("xy","vec2"),this.addInput("x","float"),this.addInput("y","float"),this.addOutput("xy","vec2"),this.addOutput("x","float"),this.addOutput("y","float"),this.properties={x:0,y:0}}Ut.title="vec2",Ut.varmodes=["xy","x","y"],Ut.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},Ut.prototype.onGetCode=function(Ht){if(!!this.shader_destination){for(var jt=this.properties,qt=wt(this),ri="	vec2 "+qt+" = "+At([jt.x,jt.y])+`;
`,oi=0;oi<Ut.varmodes.length;++oi){var fi=Ut.varmodes[oi],bi=Ot(this,oi);!bi||(ri+="	"+qt+"."+fi+" = "+bi+`;
`)}for(var oi=0;oi<Ut.varmodes.length;++oi){var fi=Ut.varmodes[oi],ai=It(this,oi);if(!!ai){var di=vt[fi.length-1];ri+="	"+di+" "+ai+" = "+qt+"."+fi+`;
`,this.setOutputData(oi,di)}}Ht.addCode("code",ri,this.shader_destination)}},Et("const/vec2",Ut);function Zt(){this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("xy","vec2"),this.addInput("xz","vec2"),this.addInput("yz","vec2"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("xz","vec2"),this.addOutput("yz","vec2"),this.properties={x:0,y:0,z:0}}Zt.title="vec3",Zt.varmodes=["xyz","x","y","z","xy","xz","yz"],Zt.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},Zt.prototype.onGetCode=function(Ht){if(!!this.shader_destination){for(var jt=this.properties,qt=wt(this),ri="vec3 "+qt+" = "+At([jt.x,jt.y,jt.z])+`;
`,oi=0;oi<Zt.varmodes.length;++oi){var fi=Zt.varmodes[oi],bi=Ot(this,oi);!bi||(ri+="	"+qt+"."+fi+" = "+bi+`;
`)}for(var oi=0;oi<Zt.varmodes.length;++oi){var fi=Zt.varmodes[oi],ai=It(this,oi);if(!!ai){var di=vt[fi.length-1];ri+="	"+di+" "+ai+" = "+qt+"."+fi+`;
`,this.setOutputData(oi,di)}}Ht.addCode("code",ri,this.shader_destination)}},Et("const/vec3",Zt);function Jt(){this.addInput("xyzw","vec4"),this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("w","float"),this.addInput("xy","vec2"),this.addInput("yz","vec2"),this.addInput("zw","vec2"),this.addOutput("xyzw","vec4"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("yz","vec2"),this.addOutput("zw","vec2"),this.properties={x:0,y:0,z:0,w:0}}Jt.title="vec4",Jt.varmodes=["xyzw","xyz","x","y","z","w","xy","yz","zw"],Jt.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},Jt.prototype.onGetCode=function(Ht){if(!!this.shader_destination){for(var jt=this.properties,qt=wt(this),ri="vec4 "+qt+" = "+At([jt.x,jt.y,jt.z,jt.w])+`;
`,oi=0;oi<Jt.varmodes.length;++oi){var fi=Jt.varmodes[oi],bi=Ot(this,oi);!bi||(ri+="	"+qt+"."+fi+" = "+bi+`;
`)}for(var oi=0;oi<Jt.varmodes.length;++oi){var fi=Jt.varmodes[oi],ai=It(this,oi);if(!!ai){var di=vt[fi.length-1];ri+="	"+di+" "+ai+" = "+qt+"."+fi+`;
`,this.setOutputData(oi,di)}}Ht.addCode("code",ri,this.shader_destination)}},Et("const/vec4",Jt);function ei(){this.addInput("color",st.ALL_TYPES),this.block_delete=!0}ei.title="FragColor",ei.desc="Pixel final color",ei.prototype.onGetCode=function(Ht){var jt=Ot(this,0);if(!!jt){var qt=this.getInputData(0),ri=Dt(jt,qt,"vec4");Ht.addCode("fs_code","fragcolor = "+ri+";")}},Et("output/fragcolor",ei);function ii(){this.addInput("A",st.ALL_TYPES),this.addInput("B",st.ALL_TYPES),this.addOutput("out",""),this.properties={operation:"*"},this.addWidget("combo","op.",this.properties.operation,{property:"operation",values:ii.operations})}ii.title="Operation",ii.operations=["+","-","*","/"],ii.prototype.getTitle=function(){return this.flags.collapsed?"A"+this.properties.operation+"B":"Operation"},ii.prototype.onGetCode=function(Ht){if(!!this.shader_destination&&!!this.isOutputConnected(0)){for(var jt=[],qt=0;qt<3;++qt)jt.push({name:Ot(this,qt),type:this.getInputData(qt)||"float"});var ri=It(this,0);if(!!ri){for(var oi=jt[0].type,fi=oi,bi=this.properties.operation,ai=[],qt=0;qt<2;++qt){var di=jt[qt].name;di==null&&(di=p.value!=null?p.value:"(1.0)",jt[qt].type="float"),jt[qt].type!=oi&&(jt[qt].type=="float"&&(bi=="*"||bi=="/")||(di=kt(di,jt[qt].type,oi))),ai.push(di)}Ht.addCode("code",fi+" "+ri+" = "+ai[0]+bi+ai[1]+";",this.shader_destination),this.setOutputData(0,fi)}}},Et("math/operation",ii);function li(){this.addInput("A",st.ALL_TYPES),this.addInput("B",st.ALL_TYPES),this.addOutput("out",""),this.properties={func:"floor"},this._current="floor",this.addWidget("combo","func",this.properties.func,{property:"func",values:xt})}li.title="Func",li.prototype.onPropertyChanged=function(Ht,jt){if(this.graph&&this.graph._version++,Ht=="func"){var qt=bt[jt];if(!qt)return;for(var ri=qt.params.length;ri<this.inputs.length;++ri)this.removeInput(ri);for(var ri=0;ri<qt.params.length;++ri){var oi=qt.params[ri];this.inputs[ri]?this.inputs[ri].name=oi.name+(oi.value?" ("+oi.value+")":""):this.addInput(oi.name,st.ALL_TYPES)}}},li.prototype.getTitle=function(){return this.flags.collapsed?this.properties.func:"Func"},li.prototype.onGetCode=function(Ht){if(!!this.shader_destination&&!!this.isOutputConnected(0)){for(var jt=[],qt=0;qt<3;++qt)jt.push({name:Ot(this,qt),type:this.getInputData(qt)||"float"});var ri=It(this,0);if(!!ri){var oi=bt[this.properties.func];if(!!oi){var fi=jt[0].type,bi=oi.return_type;bi=="T"&&(bi=fi);for(var ai=[],qt=0;qt<oi.params.length;++qt){var di=oi.params[qt],Nt=jt[qt].name;Nt==null&&(Nt=di.value!=null?di.value:"(1.0)",jt[qt].type="float"),(di.type=="T"&&jt[qt].type!=fi||di.type!="T"&&jt[qt].type!=fi)&&(Nt=kt(Nt,jt[qt].type,fi)),ai.push(Nt)}Ht.addFunction("round",`float round(float v){ return floor(v+0.5); }
vec2 round(vec2 v){ return floor(v+vec2(0.5));}
vec3 round(vec3 v){ return floor(v+vec3(0.5));}
vec4 round(vec4 v){ return floor(v+vec4(0.5)); }
`),Ht.addCode("code",bi+" "+ri+" = "+oi.func+"("+ai.join(",")+");",this.shader_destination),this.setOutputData(0,bi)}}}},Et("math/func",li);function pi(){this.addInput("A",st.ALL_TYPES),this.addInput("B",st.ALL_TYPES),this.addOutput("C","vec4"),this.properties={code:"C = A+B",type:"vec4"},this.addWidget("text","code",this.properties.code,{property:"code"}),this.addWidget("combo","type",this.properties.type,{values:["float","vec2","vec3","vec4"],property:"type"})}pi.title="Snippet",pi.prototype.onPropertyChanged=function(Ht,jt){this.graph&&this.graph._version++,Ht=="type"&&this.outputs[0].type!=jt&&(this.disconnectOutput(0),this.outputs[0].type=jt)},pi.prototype.getTitle=function(){return this.flags.collapsed?this.properties.code:"Snippet"},pi.prototype.onGetCode=function(Ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var jt=Ot(this,0);jt||(jt="1.0");var qt=Ot(this,1);qt||(qt="1.0");var ri=It(this,0);if(!!ri){var oi=this.getInputData(0)||"float",fi=this.getInputData(1)||"float",bi=this.properties.type;if(oi=="T"||fi=="T")return null;var ai="funcSnippet"+this.id,di=`
`+bi+" "+ai+"( "+oi+" A, "+fi+` B) {
`;di+="	"+bi+" C = "+bi+`(0.0);
`,di+="	"+this.properties.code+`;
`,di+=`	return C;
}
`,Ht.addCode("functions",di,this.shader_destination),Ht.addCode("code",bi+" "+ri+" = "+ai+"("+jt+","+qt+");",this.shader_destination),this.setOutputData(0,bi)}}},Et("utils/snippet",pi);function ci(){this.addOutput("out","float")}ci.title="Rand",ci.prototype.onGetCode=function(Ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var jt=It(this,0);Ht.addUniform("u_rand"+this.id,"float",function(){return Math.random()}),Ht.addCode("code","float "+jt+" = u_rand"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},Et("input/rand",ci);function Wt(){this.addInput("out",st.ALL_TYPES),this.addInput("scale","float"),this.addOutput("out","float"),this.properties={type:"noise",scale:1},this.addWidget("combo","type",this.properties.type,{property:"type",values:Wt.NOISE_TYPES}),this.addWidget("number","scale",this.properties.scale,{property:"scale"})}Wt.NOISE_TYPES=["noise","rand"],Wt.title="noise",Wt.prototype.onGetCode=function(Ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var jt=Ot(this,0),qt=It(this,0),ri=this.getInputData(0);jt||(ri="vec2",jt=Ht.buffer_names.uvs),Ht.addFunction("noise",Wt.shader_functions),Ht.addUniform("u_noise_scale"+this.id,"float",this.properties.scale),ri=="float"?Ht.addCode("code","float "+qt+" = snoise( vec2("+jt+") * u_noise_scale"+this.id+");",this.shader_destination):ri=="vec2"||ri=="vec3"?Ht.addCode("code","float "+qt+" = snoise("+jt+" * u_noise_scale"+this.id+");",this.shader_destination):ri=="vec4"&&Ht.addCode("code","float "+qt+" = snoise("+jt+".xyz * u_noise_scale"+this.id+");",this.shader_destination),this.setOutputData(0,"float")}},Et("math/noise",Wt),Wt.shader_functions=`
	vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }
	
	float snoise(vec2 v){
	  const vec4 C = vec4(0.211324865405187, 0.366025403784439,-0.577350269189626, 0.024390243902439);
	  vec2 i  = floor(v + dot(v, C.yy) );
	  vec2 x0 = v -   i + dot(i, C.xx);
	  vec2 i1;
	  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
	  vec4 x12 = x0.xyxy + C.xxzz;
	  x12.xy -= i1;
	  i = mod(i, 289.0);
	  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
	  + i.x + vec3(0.0, i1.x, 1.0 ));
	  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)), 0.0);
	  m = m*m ;
	  m = m*m ;
	  vec3 x = 2.0 * fract(p * C.www) - 1.0;
	  vec3 h = abs(x) - 0.5;
	  vec3 ox = floor(x + 0.5);
	  vec3 a0 = x - ox;
	  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
	  vec3 g;
	  g.x  = a0.x  * x0.x  + h.x  * x0.y;
	  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
	  return 130.0 * dot(m, g);
	}
	vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
	vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}
	
	float snoise(vec3 v){ 
	  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
	  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
	
	// First corner
	  vec3 i  = floor(v + dot(v, C.yyy) );
	  vec3 x0 =   v - i + dot(i, C.xxx) ;
	
	// Other corners
	  vec3 g = step(x0.yzx, x0.xyz);
	  vec3 l = 1.0 - g;
	  vec3 i1 = min( g.xyz, l.zxy );
	  vec3 i2 = max( g.xyz, l.zxy );
	
	  //  x0 = x0 - 0. + 0.0 * C 
	  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
	  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
	  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
	
	// Permutations
	  i = mod(i, 289.0 ); 
	  vec4 p = permute( permute( permute( 
	             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
	           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
	           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
	
	// Gradients
	// ( N*N points uniformly over a square, mapped onto an octahedron.)
	  float n_ = 1.0/7.0; // N=7
	  vec3  ns = n_ * D.wyz - D.xzx;
	
	  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
	
	  vec4 x_ = floor(j * ns.z);
	  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
	
	  vec4 x = x_ *ns.x + ns.yyyy;
	  vec4 y = y_ *ns.x + ns.yyyy;
	  vec4 h = 1.0 - abs(x) - abs(y);
	
	  vec4 b0 = vec4( x.xy, y.xy );
	  vec4 b1 = vec4( x.zw, y.zw );
	
	  vec4 s0 = floor(b0)*2.0 + 1.0;
	  vec4 s1 = floor(b1)*2.0 + 1.0;
	  vec4 sh = -step(h, vec4(0.0));
	
	  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
	  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
	
	  vec3 p0 = vec3(a0.xy,h.x);
	  vec3 p1 = vec3(a0.zw,h.y);
	  vec3 p2 = vec3(a1.xy,h.z);
	  vec3 p3 = vec3(a1.zw,h.w);
	
	//Normalise gradients
	  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
	  p0 *= norm.x;
	  p1 *= norm.y;
	  p2 *= norm.z;
	  p3 *= norm.w;
	
	// Mix final noise value
	  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
	  m = m * m;
	  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),dot(p2,x2), dot(p3,x3) ) );
	}
	
	vec3 hash3( vec2 p ){
	    vec3 q = vec3( dot(p,vec2(127.1,311.7)), 
					   dot(p,vec2(269.5,183.3)), 
					   dot(p,vec2(419.2,371.9)) );
		return fract(sin(q)*43758.5453);
	}
	vec4 hash4( vec3 p ){
	    vec4 q = vec4( dot(p,vec3(127.1,311.7,257.3)), 
					   dot(p,vec3(269.5,183.3,335.1)), 
					   dot(p,vec3(314.5,235.1,467.3)), 
					   dot(p,vec3(419.2,371.9,114.9)) );
		return fract(sin(q)*43758.5453);
	}
	
	float iqnoise( in vec2 x, float u, float v ){
	    vec2 p = floor(x);
	    vec2 f = fract(x);
		
		float k = 1.0+63.0*pow(1.0-v,4.0);
		
		float va = 0.0;
		float wt = 0.0;
	    for( int j=-2; j<=2; j++ )
	    for( int i=-2; i<=2; i++ )
	    {
	        vec2 g = vec2( float(i),float(j) );
			vec3 o = hash3( p + g )*vec3(u,u,1.0);
			vec2 r = g - f + o.xy;
			float d = dot(r,r);
			float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );
			va += o.z*ww;
			wt += ww;
	    }
		
	    return va/wt;
	}
	`;function $t(){this.addOutput("out","float")}$t.title="Time",$t.prototype.onGetCode=function(Ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var jt=It(this,0);Ht.addUniform("u_time"+this.id,"float",function(){return getTime()*.001}),Ht.addCode("code","float "+jt+" = u_time"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},Et("input/time",$t);function Rt(){this.addInput("in","T"),this.addOutput("out","float")}Rt.title="Dither",Rt.prototype.onGetCode=function(Ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var jt=Ot(this,0),qt="float",ri=It(this,0),oi=this.getInputData(0);jt=Dt(jt,oi,"float"),Ht.addFunction("dither8x8",Rt.dither_func),Ht.addCode("code",qt+" "+ri+" = dither8x8("+jt+");",this.shader_destination),this.setOutputData(0,qt)}},Rt.dither_values=[.515625,.140625,.640625,.046875,.546875,.171875,.671875,.765625,.265625,.890625,.390625,.796875,.296875,.921875,.421875,.203125,.703125,.078125,.578125,.234375,.734375,.109375,.609375,.953125,.453125,.828125,.328125,.984375,.484375,.859375,.359375,.0625,.5625,.1875,.6875,.03125,.53125,.15625,.65625,.8125,.3125,.9375,.4375,.78125,.28125,.90625,.40625,.25,.75,.125,.625,.21875,.71875,.09375,.59375,1.0001,.5,.875,.375,.96875,.46875,.84375,.34375],Rt.dither_func=`
			float dither8x8(float brightness) {
			  vec2 position = vec2(0.0);
			  #ifdef FRAGMENT
				position = gl_FragCoord.xy;
			  #endif
			  int x = int(mod(position.x, 8.0));
			  int y = int(mod(position.y, 8.0));
			  int index = x + y * 8;
			  float limit = 0.0;
			  if (x < 8) {
				if(index==0) limit = 0.015625;
				`+Rt.dither_values.map(function(Ht,jt){return"else if(index== "+(jt+1)+") limit = "+Ht+";"}).join(`
`)+`
			  }
			  return brightness < limit ? 0.0 : 1.0;
			}
`,Et("math/dither",Rt);function Yt(){this.addInput("",st.ALL_TYPES),this.addOutput("",""),this.properties={min_value:0,max_value:1,min_value2:0,max_value2:1},this.addWidget("number","min",0,{step:.1,property:"min_value"}),this.addWidget("number","max",1,{step:.1,property:"max_value"}),this.addWidget("number","min2",0,{step:.1,property:"min_value2"}),this.addWidget("number","max2",1,{step:.1,property:"max_value2"})}Yt.title="Remap",Yt.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},Yt.prototype.onConnectionsChange=function(){var Ht=this.getInputDataType(0);this.outputs[0].type=Ht||"T"},Yt.prototype.onGetCode=function(Ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var jt=Ot(this,0),qt=It(this,0);if(!(!jt&&!qt)){var ri=this.getInputDataType(0);if(this.outputs[0].type=ri,ri=="T"){console.warn("node type is T and cannot be resolved");return}if(!jt){Ht.addCode("code","	"+ri+" "+qt+" = "+ri+`(0.0);
`);return}var oi=At(this.properties.min_value),fi=At(this.properties.max_value),bi=At(this.properties.min_value2),ai=At(this.properties.max_value2);Ht.addCode("code",ri+" "+qt+" = ( ("+jt+" - "+oi+") / ("+fi+" - "+oi+") ) * ("+ai+" - "+bi+") + "+bi+";",this.shader_destination),this.setOutputData(0,ri)}}},Et("math/remap",Yt)}(commonjsGlobal),function(rt){var it=rt.LiteGraph,nt=new Float32Array(16),st=new Float32Array(16),vt=new Float32Array(16),_t=new Float32Array(16),bt={u_view:nt,u_projection:st,u_viewprojection:vt,u_model:_t};it.LGraphRender={onRequestCameraMatrices:null};function xt(){return Math.random()*1e5|0}function Tt(){this.addInput("obj",""),this.addInput("radius","number"),this.addOutput("out","geometry"),this.addOutput("points","[vec3]"),this.properties={radius:1,num_points:4096,generate_normals:!0,regular:!1,mode:Tt.SPHERE,force_update:!1},this.points=new Float32Array(this.properties.num_points*3),this.normals=new Float32Array(this.properties.num_points*3),this.must_update=!0,this.version=0;var Gt=this;this.addWidget("button","update",null,function(){Gt.must_update=!0}),this.geometry={vertices:null,_id:xt()},this._old_obj=null,this._last_radius=null}rt.LGraphPoints3D=Tt,Tt.RECTANGLE=1,Tt.CIRCLE=2,Tt.CUBE=10,Tt.SPHERE=11,Tt.HEMISPHERE=12,Tt.INSIDE_SPHERE=13,Tt.OBJECT=20,Tt.OBJECT_UNIFORMLY=21,Tt.OBJECT_INSIDE=22,Tt.MODE_VALUES={rectangle:Tt.RECTANGLE,circle:Tt.CIRCLE,cube:Tt.CUBE,sphere:Tt.SPHERE,hemisphere:Tt.HEMISPHERE,inside_sphere:Tt.INSIDE_SPHERE,object:Tt.OBJECT,object_uniformly:Tt.OBJECT_UNIFORMLY,object_inside:Tt.OBJECT_INSIDE},Tt.widgets_info={mode:{widget:"combo",values:Tt.MODE_VALUES}},Tt.title="list of points",Tt.desc="returns an array of points",Tt.prototype.onPropertyChanged=function(Gt,Ut){this.must_update=!0},Tt.prototype.onExecute=function(){var Gt=this.getInputData(0);(Gt!=this._old_obj||Gt&&Gt._version!=this._old_obj_version)&&(this._old_obj=Gt,this.must_update=!0);var Ut=this.getInputData(1);Ut==null&&(Ut=this.properties.radius),this._last_radius!=Ut&&(this._last_radius=Ut,this.must_update=!0),(this.must_update||this.properties.force_update)&&(this.must_update=!1,this.updatePoints()),this.geometry.vertices=this.points,this.geometry.normals=this.normals,this.geometry._version=this.version,this.setOutputData(0,this.geometry)},Tt.prototype.updatePoints=function(){var Gt=this.properties.num_points|0;Gt<1&&(Gt=1),(!this.points||this.points.length!=Gt*3)&&(this.points=new Float32Array(Gt*3)),this.properties.generate_normals?(!this.normals||this.normals.length!=this.points.length)&&(this.normals=new Float32Array(this.points.length)):this.normals=null;var Ut=this._last_radius||this.properties.radius,Zt=this.properties.mode,Jt=this.getInputData(0);this._old_obj_version=Jt?Jt._version:null,this.points=Tt.generatePoints(Ut,Gt,Zt,this.points,this.normals,this.properties.regular,Jt),this.version++},Tt.generatePoints=function(Gt,Ut,Zt,Jt,ei,ii,li){var pi=Ut*3;(!Jt||Jt.length!=pi)&&(Jt=new Float32Array(pi));var ci=new Float32Array(3),Wt=new Float32Array([0,1,0]);if(ii){if(Zt==Tt.RECTANGLE){for(var $t=Math.floor(Math.sqrt(Ut)),Rt=0;Rt<$t;++Rt)for(var Yt=0;Yt<$t;++Yt){var Ht=Rt*3+Yt*3*$t;Jt[Ht]=(Rt/$t-.5)*Gt*2,Jt[Ht+1]=0,Jt[Ht+2]=(Yt/$t-.5)*Gt*2}if(Jt=new Float32Array(Jt.subarray(0,$t*$t*3)),ei)for(var Rt=0;Rt<ei.length;Rt+=3)ei.set(Wt,Rt)}else if(Zt==Tt.SPHERE){for(var $t=Math.floor(Math.sqrt(Ut)),Rt=0;Rt<$t;++Rt)for(var Yt=0;Yt<$t;++Yt){var Ht=Rt*3+Yt*3*$t;polarToCartesian(ci,Rt/$t*2*Math.PI,(Yt/$t-.5)*2*Math.PI,Gt),Jt[Ht]=ci[0],Jt[Ht+1]=ci[1],Jt[Ht+2]=ci[2]}Jt=new Float32Array(Jt.subarray(0,$t*$t*3)),ei&&Tt.generateSphericalNormals(Jt,ei)}else if(Zt==Tt.CIRCLE){for(var Rt=0;Rt<pi;Rt+=3){var jt=2*Math.PI*(Rt/pi);Jt[Rt]=Math.cos(jt)*Gt,Jt[Rt+1]=0,Jt[Rt+2]=Math.sin(jt)*Gt}if(ei)for(var Rt=0;Rt<ei.length;Rt+=3)ei.set(Wt,Rt)}}else if(Zt==Tt.RECTANGLE){for(var Rt=0;Rt<pi;Rt+=3)Jt[Rt]=(Math.random()-.5)*Gt*2,Jt[Rt+1]=0,Jt[Rt+2]=(Math.random()-.5)*Gt*2;if(ei)for(var Rt=0;Rt<ei.length;Rt+=3)ei.set(Wt,Rt)}else if(Zt==Tt.CUBE){for(var Rt=0;Rt<pi;Rt+=3)Jt[Rt]=(Math.random()-.5)*Gt*2,Jt[Rt+1]=(Math.random()-.5)*Gt*2,Jt[Rt+2]=(Math.random()-.5)*Gt*2;if(ei)for(var Rt=0;Rt<ei.length;Rt+=3)ei.set(Wt,Rt)}else Zt==Tt.SPHERE?(Tt.generateSphere(Jt,pi,Gt),ei&&Tt.generateSphericalNormals(Jt,ei)):Zt==Tt.HEMISPHERE?(Tt.generateHemisphere(Jt,pi,Gt),ei&&Tt.generateSphericalNormals(Jt,ei)):Zt==Tt.CIRCLE?(Tt.generateInsideCircle(Jt,pi,Gt),ei&&Tt.generateSphericalNormals(Jt,ei)):Zt==Tt.INSIDE_SPHERE?(Tt.generateInsideSphere(Jt,pi,Gt),ei&&Tt.generateSphericalNormals(Jt,ei)):Zt==Tt.OBJECT?Tt.generateFromObject(Jt,ei,pi,li,!1):Zt==Tt.OBJECT_UNIFORMLY?Tt.generateFromObject(Jt,ei,pi,li,!0):Zt==Tt.OBJECT_INSIDE?Tt.generateFromInsideObject(Jt,pi,li):console.warn("wrong mode in LGraphPoints3D");return Jt},Tt.generateSphericalNormals=function(Gt,Ut){for(var Zt=new Float32Array(3),Jt=0;Jt<Ut.length;Jt+=3)Zt[0]=Gt[Jt],Zt[1]=Gt[Jt+1],Zt[2]=Gt[Jt+2],vec3.normalize(Zt,Zt),Ut.set(Zt,Jt)},Tt.generateSphere=function(Gt,Ut,Zt){for(var Jt=0;Jt<Ut;Jt+=3){var ei=Math.random(),ii=Math.random(),li=2*Math.cos(2*Math.PI*ei)*Math.sqrt(ii*(1-ii)),pi=1-2*ii,ci=2*Math.sin(2*Math.PI*ei)*Math.sqrt(ii*(1-ii));Gt[Jt]=li*Zt,Gt[Jt+1]=pi*Zt,Gt[Jt+2]=ci*Zt}},Tt.generateHemisphere=function(Gt,Ut,Zt){for(var Jt=0;Jt<Ut;Jt+=3){var ei=Math.random(),ii=Math.random(),li=Math.cos(2*Math.PI*ei)*Math.sqrt(1-ii*ii),pi=ii,ci=Math.sin(2*Math.PI*ei)*Math.sqrt(1-ii*ii);Gt[Jt]=li*Zt,Gt[Jt+1]=pi*Zt,Gt[Jt+2]=ci*Zt}},Tt.generateInsideCircle=function(Gt,Ut,Zt){for(var Jt=0;Jt<Ut;Jt+=3){var ei=Math.random(),ii=Math.random(),li=Math.cos(2*Math.PI*ei)*Math.sqrt(1-ii*ii),pi=Math.sin(2*Math.PI*ei)*Math.sqrt(1-ii*ii);Gt[Jt]=li*Zt,Gt[Jt+1]=0,Gt[Jt+2]=pi*Zt}},Tt.generateInsideSphere=function(Gt,Ut,Zt){for(var Jt=0;Jt<Ut;Jt+=3){var ei=Math.random(),ii=Math.random(),li=ei*2*Math.PI,pi=Math.acos(2*ii-1),ci=Math.cbrt(Math.random())*Zt,Wt=Math.sin(li),$t=Math.cos(li),Rt=Math.sin(pi),Yt=Math.cos(pi);Gt[Jt]=ci*Rt*$t,Gt[Jt+1]=ci*Rt*Wt,Gt[Jt+2]=ci*Yt}};function Et(Gt,Ut){var Zt=Gt.length,Jt=0,ei=0,ii=Zt;if(Zt==0)return-1;if(Zt==1)return 0;for(;ii>=Jt;){ei=(ii+Jt)*.5|0;var li=Gt[ei];if(li==Ut)return ei;if(Jt==ii-1)return Jt;li<Ut?Jt=ei:ii=ei}return ei}Tt.generateFromObject=function(Gt,Ut,Zt,Jt,ei){if(!!Jt){var ii=null,li=null,pi=null,ci=null;if(Jt.constructor===GL.Mesh&&(ii=Jt.vertexBuffers.vertices.data,li=Jt.vertexBuffers.normals?Jt.vertexBuffers.normals.data:null,pi=Jt.indexBuffers.indices?Jt.indexBuffers.indices.data:null,pi||(pi=Jt.indexBuffers.triangles?Jt.indexBuffers.triangles.data:null)),!ii)return null;var Wt=pi?pi.length/3:ii.length/(3*3),$t=0;if(ei){ci=new Float32Array(Wt);for(var Rt=0;Rt<Wt;++Rt){pi?(di=pi[Rt*3]*3,Nt=pi[Rt*3+1]*3,Ft=pi[Rt*3+2]*3):(di=Rt*9,Nt=Rt*9+3,Ft=Rt*9+6);var Yt=ii.subarray(di,di+3),Ht=ii.subarray(Nt,Nt+3),jt=ii.subarray(Ft,Ft+3),qt=vec3.distance(Yt,Ht),ri=vec3.distance(Ht,jt),oi=vec3.distance(jt,Yt),fi=(qt+ri+oi)/2;$t+=Math.sqrt(fi*(fi-qt)*(fi-ri)*(fi-oi)),ci[Rt]=$t}for(var Rt=0;Rt<Wt;++Rt)ci[Rt]/=$t}for(var Rt=0;Rt<Zt;Rt+=3){var bi=Math.random(),ai=ei?Et(ci,bi):Math.floor(bi*Wt),di=0,Nt=0,Ft=0;pi?(di=pi[ai*3]*3,Nt=pi[ai*3+1]*3,Ft=pi[ai*3+2]*3):(di=ai*9,Nt=ai*9+3,Ft=ai*9+6);var fi=Math.random(),Xt=Math.random(),Qt=Math.sqrt(fi),ti=1-Qt,si=Qt*(1-Xt),Vt=Xt*Qt;if(Gt[Rt]=ti*ii[di]+si*ii[Nt]+Vt*ii[Ft],Gt[Rt+1]=ti*ii[di+1]+si*ii[Nt+1]+Vt*ii[Ft+1],Gt[Rt+2]=ti*ii[di+2]+si*ii[Nt+2]+Vt*ii[Ft+2],Ut&&li){Ut[Rt]=ti*li[di]+si*li[Nt]+Vt*li[Ft],Ut[Rt+1]=ti*li[di+1]+si*li[Nt+1]+Vt*li[Ft+1],Ut[Rt+2]=ti*li[di+2]+si*li[Nt+2]+Vt*li[Ft+2];var Kt=Ut.subarray(Rt,Rt+3);vec3.normalize(Kt,Kt)}}}},Tt.generateFromInsideObject=function(Gt,Ut,Zt){if(!(!Zt||Zt.constructor!==GL.Mesh)){var Jt=Zt.getBoundingBox();Zt.octree||(Zt.octree=new GL.Octree(Zt));for(var ei=Zt.octree,ii=vec3.create(),li=vec3.fromValues(1,0,0),pi=vec3.create(),ci=0,Wt=0;ci<Ut&&Wt<Gt.length*10;){Wt+=1;var $t=vec3.random(pi);$t[0]=($t[0]*2-1)*Jt[3]+Jt[0],$t[1]=($t[1]*2-1)*Jt[4]+Jt[1],$t[2]=($t[2]*2-1)*Jt[5]+Jt[2],ii.set($t);var Rt=ei.testRay(ii,li,0,1e4,!0,GL.Octree.ALL);!Rt||Rt.length%2==0||(Gt.set($t,ci),ci+=3)}}},it.registerNodeType("geometry/points3D",Tt);function wt(){this.addInput("points","geometry"),this.addOutput("instances","[mat4]"),this.properties={mode:1,autoupdate:!0},this.must_update=!0,this.matrices=[],this.first_time=!0}wt.NORMAL=0,wt.VERTICAL=1,wt.SPHERICAL=2,wt.RANDOM=3,wt.RANDOM_VERTICAL=4,wt.modes={normal:0,vertical:1,spherical:2,random:3,random_vertical:4},wt.widgets_info={mode:{widget:"combo",values:wt.modes}},wt.title="points to inst",wt.prototype.onExecute=function(){var Gt=this.getInputData(0);if(!Gt){this.setOutputData(0,null);return}if(!!this.isOutputConnected(0)){var Ut=Gt._version!=this._version||Gt._id!=this._geometry_id;(Ut&&this.properties.autoupdate||this.first_time)&&(this.first_time=!1,this.updateInstances(Gt)),this.setOutputData(0,this.matrices)}},wt.prototype.updateInstances=function(Gt){var Ut=Gt.vertices;if(!Ut)return null;var Zt=Gt.normals,Jt=this.matrices,ei=Ut.length/3;Jt.length!=ei&&(Jt.length=ei);var ii=mat4.create(),li=vec3.create();vec3.create();var pi=vec3.fromValues(0,1,0),ci=vec3.fromValues(0,0,-1);vec3.fromValues(1,0,0);for(var Wt=quat.create(),$t=vec3.create(),Rt=vec3.create(),Yt=vec3.create(),Ht=0;Ht<Ut.length;Ht+=3){var jt=Ht/3,qt=Jt[jt];qt||(qt=Jt[jt]=mat4.create()),qt.set(ii);var ri=Ut.subarray(Ht,Ht+3);switch(this.properties.mode){case wt.NORMAL:if(mat4.setTranslation(qt,ri),Zt){var oi=Zt.subarray(Ht,Ht+3);Yt.set(oi),vec3.normalize(Yt,Yt),vec3.cross(Rt,ci,Yt),vec3.normalize(Rt,Rt),vec3.cross($t,Rt,Yt),vec3.normalize($t,$t),qt.set(Rt,0),qt.set(Yt,4),qt.set($t,8),mat4.setTranslation(qt,ri)}break;case wt.VERTICAL:mat4.setTranslation(qt,ri);break;case wt.SPHERICAL:$t.set(ri),vec3.normalize($t,$t),vec3.cross(Rt,pi,$t),vec3.normalize(Rt,Rt),vec3.cross(Yt,$t,Rt),vec3.normalize(Yt,Yt),qt.set(Rt,0),qt.set(Yt,4),qt.set($t,8),mat4.setTranslation(qt,ri);break;case wt.RANDOM:li[0]=Math.random()*2-1,li[1]=Math.random()*2-1,li[2]=Math.random()*2-1,vec3.normalize(li,li),quat.setAxisAngle(Wt,li,Math.random()*2*Math.PI),mat4.fromQuat(qt,Wt),mat4.setTranslation(qt,ri);break;case wt.RANDOM_VERTICAL:quat.setAxisAngle(Wt,pi,Math.random()*2*Math.PI),mat4.fromQuat(qt,Wt),mat4.setTranslation(qt,ri);break}}this._version=Gt._version,this._geometry_id=Gt._id},it.registerNodeType("geometry/points_to_instances",wt);function Ot(){this.addInput("in","geometry,[mat4]"),this.addInput("mat4","mat4"),this.addOutput("out","geometry"),this.properties={},this.geometry={type:"triangles",vertices:null,_id:xt(),_version:0},this._last_geometry_id=-1,this._last_version=-1,this._last_key="",this.must_update=!0}Ot.title="Transform",Ot.prototype.onExecute=function(){var Gt=this.getInputData(0),Ut=this.getInputData(1);if(!!Gt){if(Gt.constructor===Array){if(Gt.length==0||(this.outputs[0].type="[mat4]",!this.isOutputConnected(0)))return;if(!Ut){this.setOutputData(0,Gt);return}this._output||(this._output=new Array),this._output.length!=Gt.length&&(this._output.length=Gt.length);for(var Zt=0;Zt<Gt.length;++Zt){var Jt=this._output[Zt];Jt||(Jt=this._output[Zt]=mat4.create()),mat4.multiply(Jt,Gt[Zt],Ut)}this.setOutputData(0,this._output);return}if(!(!Gt.vertices||!Gt.vertices.length)){var ei=Gt;if(this.outputs[0].type="geometry",!!this.isOutputConnected(0)){if(!Ut){this.setOutputData(0,ei);return}var ii=typedArrayToArray(Ut).join(",");(this.must_update||ei._id!=this._last_geometry_id||ei._version!=this._last_version||ii!=this._last_key)&&(this.updateGeometry(ei,Ut),this._last_key=ii,this._last_version=ei._version,this._last_geometry_id=ei._id,this.must_update=!1),this.setOutputData(0,this.geometry)}}}},Ot.prototype.updateGeometry=function(Gt,Ut){var Zt=Gt.vertices,Jt=this.geometry.vertices;(!Jt||Jt.length!=Zt.length)&&(Jt=this.geometry.vertices=new Float32Array(Zt.length));for(var ei=vec3.create(),ii=0,li=Jt.length;ii<li;ii+=3)ei[0]=Zt[ii],ei[1]=Zt[ii+1],ei[2]=Zt[ii+2],mat4.multiplyVec3(ei,Ut,ei),Jt[ii]=ei[0],Jt[ii+1]=ei[1],Jt[ii+2]=ei[2];if(Gt.normals){(!this.geometry.normals||this.geometry.normals.length!=Gt.normals.length)&&(this.geometry.normals=new Float32Array(Gt.normals.length));var pi=this.geometry.normals,ci=mat4.invert(mat4.create(),Ut);ci&&mat4.transpose(ci,ci);for(var Wt=Gt.normals,ii=0,li=pi.length;ii<li;ii+=3)ei[0]=Wt[ii],ei[1]=Wt[ii+1],ei[2]=Wt[ii+2],mat4.multiplyVec3(ei,ci,ei),pi[ii]=ei[0],pi[ii+1]=ei[1],pi[ii+2]=ei[2]}this.geometry.type=Gt.type,this.geometry._version++},it.registerNodeType("geometry/transform",Ot);function It(){this.addInput("sides","number"),this.addInput("radius","number"),this.addOutput("out","geometry"),this.properties={sides:6,radius:1,uvs:!1},this.geometry={type:"line_loop",vertices:null,_id:xt()},this.geometry_id=-1,this.version=-1,this.must_update=!0,this.last_info={sides:-1,radius:-1}}It.title="Polygon",It.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Gt=this.getInputOrProperty("sides"),Ut=this.getInputOrProperty("radius");Gt=Math.max(3,Gt)|0,(this.last_info.sides!=Gt||this.last_info.radius!=Ut)&&this.updateGeometry(Gt,Ut),this.setOutputData(0,this.geometry)}},It.prototype.updateGeometry=function(Gt,Ut){var Zt=3*Gt,Jt=this.geometry.vertices;(!Jt||Jt.length!=Zt)&&(Jt=this.geometry.vertices=new Float32Array(3*Gt));var ei=Math.PI*2/Gt,ii=this.properties.uvs;ii&&(uvs=this.geometry.coords=new Float32Array(3*Gt));for(var li=0;li<Gt;++li){var pi=ei*-li,ci=Math.cos(pi)*Ut,Wt=0,$t=Math.sin(pi)*Ut;Jt[li*3]=ci,Jt[li*3+1]=Wt,Jt[li*3+2]=$t}this.geometry._id=++this.geometry_id,this.geometry._version=++this.version,this.last_info.sides=Gt,this.last_info.radius=Ut},it.registerNodeType("geometry/polygon",It);function At(){this.addInput("","geometry"),this.addOutput("","geometry"),this.properties={top_cap:!0,bottom_cap:!0,offset:[0,100,0]},this.version=-1,this._last_geo_version=-1,this._must_update=!0}At.title="extrude",At.prototype.onPropertyChanged=function(Gt,Ut){this._must_update=!0},At.prototype.onExecute=function(){var Gt=this.getInputData(0);!Gt||!this.isOutputConnected(0)||((Gt.version!=this._last_geo_version||this._must_update)&&(this._geo=this.extrudeGeometry(Gt,this._geo),this._geo&&(this._geo.version=this.version++),this._must_update=!1),this.setOutputData(0,this._geo))},At.prototype.extrudeGeometry=function(Gt){var Ut=Gt.vertices,Zt=Ut.length/3,Jt=vec3.create(),ei=vec3.create(),ii=vec3.create(),li=vec3.create(),pi=new Float32Array(this.properties.offset);if(Gt.type=="line_loop")for(var ci=new Float32Array(Zt*6*3),Wt=0,$t=0,Rt=Ut.length;$t<Rt;$t+=3)Jt[0]=Ut[$t],Jt[1]=Ut[$t+1],Jt[2]=Ut[$t+2],$t+3<Rt?(ei[0]=Ut[$t+3],ei[1]=Ut[$t+4],ei[2]=Ut[$t+5]):(ei[0]=Ut[0],ei[1]=Ut[1],ei[2]=Ut[2]),vec3.add(ii,Jt,pi),vec3.add(li,ei,pi),ci.set(Jt,Wt),Wt+=3,ci.set(ei,Wt),Wt+=3,ci.set(ii,Wt),Wt+=3,ci.set(ei,Wt),Wt+=3,ci.set(li,Wt),Wt+=3,ci.set(ii,Wt),Wt+=3;var Yt={_id:xt(),type:"triangles",vertices:ci};return Yt},it.registerNodeType("geometry/extrude",At);function Dt(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={code:"V[1] += 0.01 * Math.sin(I + T*0.001);",execute_every_frame:!1},this.geometry=null,this.geometry_id=-1,this.version=-1,this.must_update=!0,this.vertices=null,this.func=null}Dt.title="geoeval",Dt.desc="eval code",Dt.widgets_info={code:{widget:"code"}},Dt.prototype.onConfigure=function(Gt){this.compileCode()},Dt.prototype.compileCode=function(){if(!!this.properties.code)try{this.func=new Function("V","I","T",this.properties.code),this.boxcolor="#AFA",this.must_update=!0}catch{this.boxcolor="red"}},Dt.prototype.onPropertyChanged=function(Gt,Ut){Gt=="code"&&(this.properties.code=Ut,this.compileCode())},Dt.prototype.onExecute=function(){var Gt=this.getInputData(0);if(!!Gt){if(!this.func){this.setOutputData(0,Gt);return}if(this.geometry_id!=Gt._id||this.version!=Gt._version||this.must_update||this.properties.execute_every_frame){this.must_update=!1,this.geometry_id=Gt._id,this.properties.execute_every_frame?this.version++:this.version=Gt._version;var Ut=this.func,Zt=getTime();this.geometry||(this.geometry={});for(var Jt in Gt)Gt[Jt]!=null&&(Gt[Jt].constructor==Float32Array?this.geometry[Jt]=new Float32Array(Gt[Jt]):this.geometry[Jt]=Gt[Jt]);this.geometry._id=Gt._id,this.properties.execute_every_frame?this.geometry._version=this.version:this.geometry._version=Gt._version+1;var ei=vec3.create(),ii=this.vertices;!ii||this.vertices.length!=Gt.vertices.length?ii=this.vertices=new Float32Array(Gt.vertices):ii.set(Gt.vertices);for(var Jt=0;Jt<ii.length;Jt+=3)ei[0]=ii[Jt],ei[1]=ii[Jt+1],ei[2]=ii[Jt+2],Ut(ei,Jt/3,Zt),ii[Jt]=ei[0],ii[Jt+1]=ei[1],ii[Jt+2]=ei[2];this.geometry.vertices=ii}this.setOutputData(0,this.geometry)}},it.registerNodeType("geometry/eval",Dt);function kt(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={min_dist:.4,max_dist:.5,max_connections:0,probability:1},this.geometry_id=-1,this.version=-1,this.my_version=1,this.must_update=!0}if(kt.title="connect points",kt.desc="adds indices between near points",kt.prototype.onPropertyChanged=function(Gt,Ut){this.must_update=!0},kt.prototype.onExecute=function(){var Gt=this.getInputData(0);if(!!Gt){if(this.geometry_id!=Gt._id||this.version!=Gt._version||this.must_update){this.must_update=!1,this.geometry_id=Gt._id,this.version=Gt._version,this.geometry={};for(var Ut in Gt)this.geometry[Ut]=Gt[Ut];this.geometry._id=xt(),this.geometry._version=this.my_version++;for(var Zt=Gt.vertices,Jt=Zt.length,ei=this.properties.min_dist,ii=this.properties.max_dist,li=this.properties.probability,pi=this.properties.max_connections,ci=[],Ut=0;Ut<Jt;Ut+=3)for(var Wt=Zt[Ut],$t=Zt[Ut+1],Rt=Zt[Ut+2],Yt=0,Ht=Ut+3;Ht<Jt;Ht+=3){var jt=Zt[Ht],qt=Zt[Ht+1],ri=Zt[Ht+2],oi=Math.sqrt((Wt-jt)*(Wt-jt)+($t-qt)*($t-qt)+(Rt-ri)*(Rt-ri));if(!(oi>ii||oi<ei||li<1&&li<Math.random())&&(ci.push(Ut/3,Ht/3),Yt+=1,pi&&Yt>pi))break}this.geometry.indices=this.indices=new Uint32Array(ci)}this.indices&&this.indices.length?(this.geometry.indices=this.indices,this.setOutputData(0,this.geometry)):this.setOutputData(0,null)}},it.registerNodeType("geometry/connectPoints",kt),typeof GL>"u")return;function Mt(){this.addInput("mesh","mesh"),this.addOutput("out","geometry"),this.geometry={},this.last_mesh=null}Mt.title="to geometry",Mt.desc="converts a mesh to geometry",Mt.prototype.onExecute=function(){var Gt=this.getInputData(0);if(!!Gt){if(Gt!=this.last_mesh){this.last_mesh=Gt;for(i in Gt.vertexBuffers){var Ut=Gt.vertexBuffers[i];this.geometry[i]=Ut.data}Gt.indexBuffers.triangles&&(this.geometry.indices=Gt.indexBuffers.triangles.data),this.geometry._id=xt(),this.geometry._version=0}this.setOutputData(0,this.geometry),this.geometry&&this.setOutputData(1,this.geometry.vertices)}},it.registerNodeType("geometry/toGeometry",Mt);function zt(){this.addInput("in","geometry"),this.addOutput("mesh","mesh"),this.properties={},this.version=-1,this.mesh=null}zt.title="Geo to Mesh",zt.prototype.updateMesh=function(Gt){this.mesh||(this.mesh=new GL.Mesh);for(var Ut in Gt)if(Ut[0]!="_"){var Zt=Gt[Ut],Jt=GL.Mesh.common_buffers[Ut];if(!(!Jt&&Ut!="indices")){var ei=Jt?Jt.spacing:3,ii=this.mesh.vertexBuffers[Ut];!ii||ii.data.length!=Zt.length?ii=new GL.Buffer(Ut=="indices"?GL.ELEMENT_ARRAY_BUFFER:GL.ARRAY_BUFFER,Zt,ei,GL.DYNAMIC_DRAW):(ii.data.set(Zt),ii.upload(GL.DYNAMIC_DRAW)),this.mesh.addBuffer(Ut,ii)}}if(this.mesh.vertexBuffers.normals&&this.mesh.vertexBuffers.normals.data.length!=this.mesh.vertexBuffers.vertices.data.length){for(var li=new Float32Array([0,1,0]),pi=new Float32Array(this.mesh.vertexBuffers.vertices.data.length),Ut=0;Ut<pi.length;Ut+=3)pi.set(li,Ut);ii=new GL.Buffer(GL.ARRAY_BUFFER,pi,3),this.mesh.addBuffer("normals",ii)}return this.mesh.updateBoundingBox(),this.geometry_id=this.mesh.id=Gt._id,this.version=this.mesh.version=Gt._version,this.mesh},zt.prototype.onExecute=function(){var Gt=this.getInputData(0);!Gt||((this.version!=Gt._version||this.geometry_id!=Gt._id)&&this.updateMesh(Gt),this.setOutputData(0,this.mesh))},it.registerNodeType("geometry/toMesh",zt);function Pt(){this.addInput("mesh","mesh"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,primitive:GL.TRIANGLES,additive:!1,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.model_matrix=mat4.create(),this.uniforms={u_color:this.color,u_model:this.model_matrix}}Pt.title="Render Mesh",Pt.desc="renders a mesh flat",Pt.PRIMITIVE_VALUES={points:GL.POINTS,lines:GL.LINES,line_loop:GL.LINE_LOOP,line_strip:GL.LINE_STRIP,triangles:GL.TRIANGLES,triangle_fan:GL.TRIANGLE_FAN,triangle_strip:GL.TRIANGLE_STRIP},Pt.widgets_info={primitive:{widget:"combo",values:Pt.PRIMITIVE_VALUES},color:{widget:"color"}},Pt.prototype.onExecute=function(){if(!!this.properties.enabled){var Gt=this.getInputData(0);if(!!Gt){if(!it.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}it.LGraphRender.onRequestCameraMatrices(nt,st,vt);var Ut=null,Zt=this.getInputData(2);Zt?(Ut=gl.shaders.textured,Ut||(Ut=gl.shaders.textured=new GL.Shader(Bt.vertex_shader_code,Bt.fragment_shader_code,{USE_TEXTURE:""}))):(Ut=gl.shaders.flat,Ut||(Ut=gl.shaders.flat=new GL.Shader(Bt.vertex_shader_code,Bt.fragment_shader_code))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var Jt=this.model_matrix,ei=this.getInputData(1);ei?Jt.set(ei):mat4.identity(Jt),this.uniforms.u_point_size=1;var ii=this.properties.primitive;Ut.uniforms(bt),Ut.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);var li="indices";Gt.indexBuffers.triangles&&(li="triangles"),Ut.draw(Gt,ii,li),gl.disable(gl.BLEND),gl.depthMask(!0)}}},it.registerNodeType("geometry/render_mesh",Pt);function Lt(){this.addInput("size","number"),this.addOutput("out","mesh"),this.properties={type:1,size:1,subdivisions:32},this.version=Math.random()*1e5|0,this.last_info={type:-1,size:-1,subdivisions:-1}}Lt.title="Primitive",Lt.VALID={CUBE:1,PLANE:2,CYLINDER:3,SPHERE:4,CIRCLE:5,HEMISPHERE:6,ICOSAHEDRON:7,CONE:8,QUAD:9},Lt.widgets_info={type:{widget:"combo",values:Lt.VALID}},Lt.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var Gt=this.getInputOrProperty("size");(this.last_info.type!=this.properties.type||this.last_info.size!=Gt||this.last_info.subdivisions!=this.properties.subdivisions)&&this.updateMesh(this.properties.type,Gt,this.properties.subdivisions),this.setOutputData(0,this._mesh)}},Lt.prototype.updateMesh=function(Gt,Ut,Zt){switch(Zt=Math.max(0,Zt)|0,Gt){case 1:this._mesh=GL.Mesh.cube({size:Ut,normals:!0,coords:!0});break;case 2:this._mesh=GL.Mesh.plane({size:Ut,xz:!0,detail:Zt,normals:!0,coords:!0});break;case 3:this._mesh=GL.Mesh.cylinder({size:Ut,subdivisions:Zt,normals:!0,coords:!0});break;case 4:this._mesh=GL.Mesh.sphere({size:Ut,long:Zt,lat:Zt,normals:!0,coords:!0});break;case 5:this._mesh=GL.Mesh.circle({size:Ut,slices:Zt,normals:!0,coords:!0});break;case 6:this._mesh=GL.Mesh.sphere({size:Ut,long:Zt,lat:Zt,normals:!0,coords:!0,hemi:!0});break;case 7:this._mesh=GL.Mesh.icosahedron({size:Ut,subdivisions:Zt});break;case 8:this._mesh=GL.Mesh.cone({radius:Ut,height:Ut,subdivisions:Zt});break;case 9:this._mesh=GL.Mesh.plane({size:Ut,xz:!1,detail:Zt,normals:!0,coords:!0});break}this.last_info.type=Gt,this.last_info.size=Ut,this.last_info.subdivisions=Zt,this._mesh.version=this.version++},it.registerNodeType("geometry/mesh_primitive",Lt);function Bt(){this.addInput("in","geometry"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,point_size:.1,fixed_size:!1,additive:!0,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.uniforms={u_point_size:1,u_perspective:1,u_point_perspective:1,u_color:this.color},this.geometry_id=-1,this.version=-1,this.mesh=null}Bt.title="renderPoints",Bt.desc="render points with a texture",Bt.widgets_info={color:{widget:"color"}},Bt.prototype.updateMesh=function(Gt){this.buffer,!this.buffer||!this.buffer.data||this.buffer.data.length!=Gt.vertices.length?this.buffer=new GL.Buffer(GL.ARRAY_BUFFER,Gt.vertices,3,GL.DYNAMIC_DRAW):(this.buffer.data.set(Gt.vertices),this.buffer.upload(GL.DYNAMIC_DRAW)),this.mesh||(this.mesh=new GL.Mesh),this.mesh.addBuffer("vertices",this.buffer),this.geometry_id=this.mesh.id=Gt._id,this.version=this.mesh.version=Gt._version},Bt.prototype.onExecute=function(){if(!!this.properties.enabled){var Gt=this.getInputData(0);if(!!Gt){if((this.version!=Gt._version||this.geometry_id!=Gt._id)&&this.updateMesh(Gt),!it.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}it.LGraphRender.onRequestCameraMatrices(nt,st,vt);var Ut=null,Zt=this.getInputData(2);Zt?(Ut=gl.shaders.textured_points,Ut||(Ut=gl.shaders.textured_points=new GL.Shader(Bt.vertex_shader_code,Bt.fragment_shader_code,{USE_TEXTURED_POINTS:""}))):(Ut=gl.shaders.points,Ut||(Ut=gl.shaders.points=new GL.Shader(Bt.vertex_shader_code,Bt.fragment_shader_code,{USE_POINTS:""}))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var Jt=this.getInputData(1);Jt?_t.set(Jt):mat4.identity(_t),this.uniforms.u_point_size=this.properties.point_size,this.uniforms.u_point_perspective=this.properties.fixed_size?0:1,this.uniforms.u_perspective=gl.viewport_data[3]*st[5],Ut.uniforms(bt),Ut.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),Ut.draw(this.mesh,GL.POINTS),gl.disable(gl.BLEND),gl.depthMask(!0)}}},it.registerNodeType("geometry/render_points",Bt),Bt.vertex_shader_code=`			precision mediump float;
			attribute vec3 a_vertex;
			varying vec3 v_vertex;
			attribute vec3 a_normal;
			varying vec3 v_normal;
			#ifdef USE_COLOR
				attribute vec4 a_color;
				varying vec4 v_color;
			#endif
			attribute vec2 a_coord;
			varying vec2 v_coord;
			#ifdef USE_SIZE
				attribute float a_extra;
			#endif
			#ifdef USE_INSTANCING
				attribute mat4 u_model;
			#else
				uniform mat4 u_model;
			#endif
			uniform mat4 u_viewprojection;
			uniform float u_point_size;
			uniform float u_perspective;
			uniform float u_point_perspective;
			float computePointSize(float radius, float w)
			{
				if(radius < 0.0)
					return -radius;
				return u_perspective * radius / w;
			}
			void main() {
				v_coord = a_coord;
				#ifdef USE_COLOR
					v_color = a_color;
				#endif
				v_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;
				v_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;
				gl_Position = u_viewprojection * vec4(v_vertex,1.0);
				gl_PointSize = u_point_size;
				#ifdef USE_SIZE
					gl_PointSize = a_extra;
				#endif
				if(u_point_perspective != 0.0)
					gl_PointSize = computePointSize( gl_PointSize, gl_Position.w );
			}		`,Bt.fragment_shader_code=`			precision mediump float;
			uniform vec4 u_color;
			#ifdef USE_COLOR
				varying vec4 v_color;
			#endif
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			void main() {
				vec4 color = u_color;
				#ifdef USE_TEXTURED_POINTS
					color *= texture2D(u_texture, gl_PointCoord.xy);
				#else
					#ifdef USE_TEXTURE
					  color *= texture2D(u_texture, v_coord);
					  if(color.a < 0.1)
						discard;
					#endif
					#ifdef USE_POINTS
						float dist = length( gl_PointCoord.xy - vec2(0.5) );
						if( dist > 0.45 )
							discard;
					#endif
				#endif
				#ifdef USE_COLOR
					color *= v_color;
				#endif
				gl_FragColor = color;
			}		`}(commonjsGlobal),function(rt){var it=rt.LiteGraph,nt=rt.LGraphTexture;if(typeof GL<"u"){let st=function(){this.addInput("Texture","Texture"),this.addInput("Aberration","number"),this.addInput("Distortion","number"),this.addInput("Blur","number"),this.addOutput("Texture","Texture"),this.properties={aberration:1,distortion:1,blur:1,precision:nt.DEFAULT},st._shader||(st._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,st.pixel_shader),st._texture=new GL.Texture(3,1,{format:gl.RGB,wrap:gl.CLAMP_TO_EDGE,magFilter:gl.LINEAR,minFilter:gl.LINEAR,pixel_data:[255,0,0,0,255,0,0,0,255]}))},vt=function(){this.addInput("Texture","Texture"),this.addInput("Blurred","Texture"),this.addInput("Mask","Texture"),this.addInput("Threshold","number"),this.addOutput("Texture","Texture"),this.properties={shape:"",size:10,alpha:1,threshold:1,high_precision:!1}},_t=function(){this.addInput("Texture","Texture"),this.addInput("value1","number"),this.addInput("value2","number"),this.addOutput("Texture","Texture"),this.properties={fx:"halftone",value1:1,value2:1,precision:nt.DEFAULT}},bt=function(){this.addInput("Tex.","Texture"),this.addInput("intensity","number"),this.addOutput("Texture","Texture"),this.properties={intensity:1,invert:!1,precision:nt.DEFAULT},bt._shader||(bt._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,bt.pixel_shader))};st.title="Lens",st.desc="Camera Lens distortion",st.widgets_info={precision:{widget:"combo",values:nt.MODE_VALUES}},st.prototype.onExecute=function(){var xt=this.getInputData(0);if(this.properties.precision===nt.PASS_THROUGH){this.setOutputData(0,xt);return}if(!!xt){this._tex=nt.getTargetTexture(xt,this._tex,this.properties.precision);var Tt=this.properties.aberration;this.isInputConnected(1)&&(Tt=this.getInputData(1),this.properties.aberration=Tt);var Et=this.properties.distortion;this.isInputConnected(2)&&(Et=this.getInputData(2),this.properties.distortion=Et);var wt=this.properties.blur;this.isInputConnected(3)&&(wt=this.getInputData(3),this.properties.blur=wt),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Ot=Mesh.getScreenQuad(),It=st._shader;this._tex.drawTo(function(){xt.bind(0),It.uniforms({u_texture:0,u_aberration:Tt,u_distortion:Et,u_blur:wt}).draw(Ot)}),this.setOutputData(0,this._tex)}},st.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform float u_aberration;
				uniform float u_distortion;
				uniform float u_blur;
				
				void main() {
					vec2 coord = v_coord;
					float dist = distance(vec2(0.5), coord);
					vec2 dist_coord = coord - vec2(0.5);
					float percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;
					dist_coord *= percent;
					coord = dist_coord + vec2(0.5);
					vec4 color = texture2D(u_texture,coord, u_blur * dist);
					color.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;
					color.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;
					gl_FragColor = color;
				}
				`,it.registerNodeType("fx/lens",st),rt.LGraphFXLens=st,vt.title="Bokeh",vt.desc="applies an Bokeh effect",vt.widgets_info={shape:{widget:"texture"}},vt.prototype.onExecute=function(){var xt=this.getInputData(0),Tt=this.getInputData(1),Et=this.getInputData(2);if(!xt||!Et||!this.properties.shape){this.setOutputData(0,xt);return}Tt||(Tt=xt);var wt=nt.getTexture(this.properties.shape);if(!!wt){var Ot=this.properties.threshold;this.isInputConnected(3)&&(Ot=this.getInputData(3),this.properties.threshold=Ot);var It=gl.UNSIGNED_BYTE;this.properties.high_precision&&(It=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=It||this._temp_texture.width!=xt.width||this._temp_texture.height!=xt.height)&&(this._temp_texture=new GL.Texture(xt.width,xt.height,{type:It,format:gl.RGBA,filter:gl.LINEAR})),this.properties.size;var At=vt._first_shader;At||(At=vt._first_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,vt._first_pixel_shader));var Dt=vt._second_shader;Dt||(Dt=vt._second_shader=new GL.Shader(vt._second_vertex_shader,vt._second_pixel_shader));var kt=this._points_mesh;(!kt||kt._width!=xt.width||kt._height!=xt.height||kt._spacing!=2)&&(kt=this.createPointsMesh(xt.width,xt.height,2));var Mt=Mesh.getScreenQuad(),zt=this.properties.size;this.properties.min_light;var Pt=this.properties.alpha;gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){xt.bind(0),Tt.bind(1),Et.bind(2),At.uniforms({u_texture:0,u_texture_blur:1,u_mask:2,u_texsize:[xt.width,xt.height]}).draw(Mt)}),this._temp_texture.drawTo(function(){gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),xt.bind(0),wt.bind(3),Dt.uniforms({u_texture:0,u_mask:2,u_shape:3,u_alpha:Pt,u_threshold:Ot,u_pointSize:zt,u_itexsize:[1/xt.width,1/xt.height]}).draw(kt,gl.POINTS)}),this.setOutputData(0,this._temp_texture)}},vt.prototype.createPointsMesh=function(xt,Tt,Et){for(var wt=Math.round(xt/Et),Ot=Math.round(Tt/Et),It=new Float32Array(wt*Ot*2),At=-1,Dt=2/xt*Et,kt=2/Tt*Et,Mt=0;Mt<Ot;++Mt){for(var zt=-1,Pt=0;Pt<wt;++Pt){var Lt=Mt*wt*2+Pt*2;It[Lt]=zt,It[Lt+1]=At,zt+=Dt}At+=kt}return this._points_mesh=GL.Mesh.load({vertices2D:It}),this._points_mesh._width=xt,this._points_mesh._height=Tt,this._points_mesh._spacing=Et,this._points_mesh},vt._first_pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_texture_blur;
				uniform sampler2D u_mask;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					vec4 blurred_color = texture2D(u_texture_blur, v_coord);
					float mask = texture2D(u_mask, v_coord).x;
				   gl_FragColor = mix(color, blurred_color, mask);
				}
				`,vt._second_vertex_shader=`precision highp float;
				attribute vec2 a_vertex2D;
				varying vec4 v_color;
				uniform sampler2D u_texture;
				uniform sampler2D u_mask;
				uniform vec2 u_itexsize;
				uniform float u_pointSize;
				uniform float u_threshold;
				void main() {
					vec2 coord = a_vertex2D * 0.5 + 0.5;
					v_color = texture2D( u_texture, coord );
					v_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );
					v_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));
					v_color += texture2D( u_texture, coord + u_itexsize);
					v_color *= 0.25;
					float mask = texture2D(u_mask, coord).x;
					float luminance = length(v_color) * mask;
					/*luminance /= (u_pointSize*u_pointSize)*0.01 */;
					luminance -= u_threshold;
					if(luminance < 0.0)
					{
						gl_Position.x = -100.0;
						return;
					}
					gl_PointSize = u_pointSize;
					gl_Position = vec4(a_vertex2D,0.0,1.0);
				}
				`,vt._second_pixel_shader=`precision highp float;
				varying vec4 v_color;
				uniform sampler2D u_shape;
				uniform float u_alpha;
				
				void main() {
					vec4 color = texture2D( u_shape, gl_PointCoord );
					color *= v_color * u_alpha;
					gl_FragColor = color;
				}
`,it.registerNodeType("fx/bokeh",vt),rt.LGraphFXBokeh=vt,_t.title="FX",_t.desc="applies an FX from a list",_t.widgets_info={fx:{widget:"combo",values:["halftone","pixelate","lowpalette","noise","gamma"]},precision:{widget:"combo",values:nt.MODE_VALUES}},_t.shaders={},_t.prototype.onExecute=function(){if(!!this.isOutputConnected(0)){var xt=this.getInputData(0);if(this.properties.precision===nt.PASS_THROUGH){this.setOutputData(0,xt);return}if(!!xt){this._tex=nt.getTargetTexture(xt,this._tex,this.properties.precision);var Tt=this.properties.value1;this.isInputConnected(1)&&(Tt=this.getInputData(1),this.properties.value1=Tt);var Et=this.properties.value2;this.isInputConnected(2)&&(Et=this.getInputData(2),this.properties.value2=Et);var wt=this.properties.fx,Ot=_t.shaders[wt];if(!Ot){var It=_t["pixel_shader_"+wt];if(!It)return;Ot=_t.shaders[wt]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,It)}gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var At=Mesh.getScreenQuad(),Dt=rt.LS?LS.Renderer._current_camera:null,kt;Dt?kt=[LS.Renderer._current_camera.near,LS.Renderer._current_camera.far]:kt=[1,100];var Mt=null;wt=="noise"&&(Mt=nt.getNoiseTexture()),this._tex.drawTo(function(){xt.bind(0),wt=="noise"&&Mt.bind(1),Ot.uniforms({u_texture:0,u_noise:1,u_size:[xt.width,xt.height],u_rand:[Math.random(),Math.random()],u_value1:Tt,u_value2:Et,u_camera_planes:kt}).draw(At)}),this.setOutputData(0,this._tex)}}},_t.pixel_shader_halftone=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				
				float pattern() {
					float s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);
					vec2 tex = v_coord * u_size.xy;
					vec2 point = vec2(
					   c * tex.x - s * tex.y ,
					   s * tex.x + c * tex.y 
					) * u_value2;
					return (sin(point.x) * sin(point.y)) * 4.0;
				}
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					float average = (color.r + color.g + color.b) / 3.0;
					gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);
				}
`,_t.pixel_shader_pixelate=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				
				void main() {
					vec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );
					vec4 color = texture2D(u_texture, coord);
					gl_FragColor = color;
				}
`,_t.pixel_shader_lowpalette=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					gl_FragColor = floor(color * u_value1) / u_value1;
				}
`,_t.pixel_shader_noise=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_noise;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				uniform vec2 u_rand;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					vec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);
					gl_FragColor = vec4( color.xyz + noise * u_value1, color.a );
				}
`,_t.pixel_shader_gamma=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_value1;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					float gamma = 1.0 / u_value1;
					gl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );
				}
`,it.registerNodeType("fx/generic",_t),rt.LGraphFXGeneric=_t,bt.title="Vigneting",bt.desc="Vigneting",bt.widgets_info={precision:{widget:"combo",values:nt.MODE_VALUES}},bt.prototype.onExecute=function(){var xt=this.getInputData(0);if(this.properties.precision===nt.PASS_THROUGH){this.setOutputData(0,xt);return}if(!!xt){this._tex=nt.getTargetTexture(xt,this._tex,this.properties.precision);var Tt=this.properties.intensity;this.isInputConnected(1)&&(Tt=this.getInputData(1),this.properties.intensity=Tt),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Et=Mesh.getScreenQuad(),wt=bt._shader,Ot=this.properties.invert;this._tex.drawTo(function(){xt.bind(0),wt.uniforms({u_texture:0,u_intensity:Tt,u_isize:[1/xt.width,1/xt.height],u_invert:Ot?1:0}).draw(Et)}),this.setOutputData(0,this._tex)}},bt.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_intensity;
				uniform int u_invert;
				
				void main() {
					float luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;
					vec4 color = texture2D(u_texture, v_coord);
					if(u_invert == 1)
						luminance = 1.0 - luminance;
					luminance = mix(1.0, luminance, u_intensity);
				   gl_FragColor = vec4( luminance * color.xyz, color.a);
				}
				`,it.registerNodeType("fx/vigneting",bt),rt.LGraphFXVigneting=bt}}(commonjsGlobal),function(rt){var it=rt.LiteGraph,nt="#243";function st(Pt){this.channel=0,this.cmd=0,this.data=new Uint32Array(3),Pt&&this.setup(Pt)}it.MIDIEvent=st,st.prototype.fromJSON=function(Pt){this.setup(Pt.data)},st.prototype.setup=function(Pt){var Lt=Pt;Pt.constructor===Object&&(Lt=Pt.data),this.data.set(Lt);var Bt=Lt[0];this.status=Bt;var Gt=Bt&240;Bt>=240?this.cmd=Bt:this.cmd=Gt,this.cmd==st.NOTEON&&this.velocity==0&&(this.cmd=st.NOTEOFF),this.cmd_str=st.commands[this.cmd]||"",(Gt>=st.NOTEON||Gt<=st.NOTEOFF)&&(this.channel=Bt&15)},Object.defineProperty(st.prototype,"velocity",{get:function(){return this.cmd==st.NOTEON?this.data[2]:-1},set:function(Pt){this.data[2]=Pt},enumerable:!0}),st.notes=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],st.note_to_index={A:0,"A#":1,B:2,C:3,"C#":4,D:5,"D#":6,E:7,F:8,"F#":9,G:10,"G#":11},Object.defineProperty(st.prototype,"note",{get:function(){return this.cmd!=st.NOTEON?-1:st.toNoteString(this.data[1],!0)},set:function(Pt){throw"notes cannot be assigned this way, must modify the data[1]"},enumerable:!0}),Object.defineProperty(st.prototype,"octave",{get:function(){if(this.cmd!=st.NOTEON)return-1;var Pt=this.data[1]-24;return Math.floor(Pt/12+1)},set:function(Pt){throw"octave cannot be assigned this way, must modify the data[1]"},enumerable:!0}),st.prototype.getPitch=function(){return Math.pow(2,(this.data[1]-69)/12)*440},st.computePitch=function(Pt){return Math.pow(2,(Pt-69)/12)*440},st.prototype.getCC=function(){return this.data[1]},st.prototype.getCCValue=function(){return this.data[2]},st.prototype.getPitchBend=function(){return this.data[1]+(this.data[2]<<7)-8192},st.computePitchBend=function(Pt,Lt){return Pt+(Lt<<7)-8192},st.prototype.setCommandFromString=function(Pt){this.cmd=st.computeCommandFromString(Pt)},st.computeCommandFromString=function(Pt){if(!Pt)return 0;if(Pt&&Pt.constructor===Number)return Pt;switch(Pt=Pt.toUpperCase(),Pt){case"NOTE ON":case"NOTEON":return st.NOTEON;case"NOTE OFF":case"NOTEOFF":return st.NOTEON;case"KEY PRESSURE":case"KEYPRESSURE":return st.KEYPRESSURE;case"CONTROLLER CHANGE":case"CONTROLLERCHANGE":case"CC":return st.CONTROLLERCHANGE;case"PROGRAM CHANGE":case"PROGRAMCHANGE":case"PC":return st.PROGRAMCHANGE;case"CHANNEL PRESSURE":case"CHANNELPRESSURE":return st.CHANNELPRESSURE;case"PITCH BEND":case"PITCHBEND":return st.PITCHBEND;case"TIME TICK":case"TIMETICK":return st.TIMETICK;default:return Number(Pt)}},st.toNoteString=function(Pt,Lt){Pt=Math.round(Pt);var Bt=Pt-21,Gt=Math.floor((Pt-24)/12+1);return Bt=Bt%12,Bt<0&&(Bt=12+Bt),st.notes[Bt]+(Lt?"":Gt)},st.NoteStringToPitch=function(Pt){Pt=Pt.toUpperCase();var Lt=Pt[0],Bt=4;Pt[1]=="#"?(Lt+="#",Pt.length>2&&(Bt=Number(Pt[2]))):Pt.length>1&&(Bt=Number(Pt[1]));var Gt=st.note_to_index[Lt];return Gt==null?null:(Bt-1)*12+Gt+21},st.prototype.toString=function(){var Pt=""+this.channel+". ";switch(this.cmd){case st.NOTEON:Pt+="NOTEON "+st.toNoteString(this.data[1]);break;case st.NOTEOFF:Pt+="NOTEOFF "+st.toNoteString(this.data[1]);break;case st.CONTROLLERCHANGE:Pt+="CC "+this.data[1]+" "+this.data[2];break;case st.PROGRAMCHANGE:Pt+="PC "+this.data[1];break;case st.PITCHBEND:Pt+="PITCHBEND "+this.getPitchBend();break;case st.KEYPRESSURE:Pt+="KEYPRESS "+this.data[1];break}return Pt},st.prototype.toHexString=function(){for(var Pt="",Lt=0;Lt<this.data.length;Lt++)Pt+=this.data[Lt].toString(16)+" "},st.prototype.toJSON=function(){return{data:[this.data[0],this.data[1],this.data[2]],object_class:"MIDIEvent"}},st.NOTEOFF=128,st.NOTEON=144,st.KEYPRESSURE=160,st.CONTROLLERCHANGE=176,st.PROGRAMCHANGE=192,st.CHANNELPRESSURE=208,st.PITCHBEND=224,st.TIMETICK=248,st.commands={128:"note off",144:"note on",160:"key pressure",176:"controller change",192:"program change",208:"channel pressure",224:"pitch bend",240:"system",242:"Song pos",243:"Song select",246:"Tune request",248:"time tick",250:"Start Song",251:"Continue Song",252:"Stop Song",254:"Sensing",255:"Reset"},st.commands_short={128:"NOTEOFF",144:"NOTEOFF",160:"KEYP",176:"CC",192:"PC",208:"CP",224:"PB",240:"SYS",242:"POS",243:"SELECT",246:"TUNEREQ",248:"TT",250:"START",251:"CONTINUE",252:"STOP",254:"SENS",255:"RESET"},st.commands_reversed={};for(var vt in st.commands)st.commands_reversed[st.commands[vt]]=vt;function _t(Pt,Lt){if(!navigator.requestMIDIAccess){this.error="not suppoorted",Lt?Lt("Not supported"):console.error("MIDI NOT SUPPORTED, enable by chrome://flags");return}this.on_ready=Pt,this.state={note:[],cc:[]},this.input_ports=null,this.input_ports_info=[],this.output_ports=null,this.output_ports_info=[],navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this))}_t.input=null,_t.MIDIEvent=st,_t.prototype.onMIDISuccess=function(Pt){console.log("MIDI ready!"),console.log(Pt),this.midi=Pt,this.updatePorts(),this.on_ready&&this.on_ready(this)},_t.prototype.updatePorts=function(){var Pt=this.midi;this.input_ports=Pt.inputs,this.input_ports_info=[],this.output_ports=Pt.outputs,this.output_ports_info=[];for(var Lt=0,Gt=this.input_ports.values(),Ut=Gt.next();Ut&&Ut.done===!1;){var Bt=Ut.value;this.input_ports_info.push(Bt),console.log("Input port [type:'"+Bt.type+"'] id:'"+Bt.id+"' manufacturer:'"+Bt.manufacturer+"' name:'"+Bt.name+"' version:'"+Bt.version+"'"),Lt++,Ut=Gt.next()}this.num_input_ports=Lt,Lt=0;for(var Gt=this.output_ports.values(),Ut=Gt.next();Ut&&Ut.done===!1;){var Bt=Ut.value;this.output_ports_info.push(Bt),console.log("Output port [type:'"+Bt.type+"'] id:'"+Bt.id+"' manufacturer:'"+Bt.manufacturer+"' name:'"+Bt.name+"' version:'"+Bt.version+"'"),Lt++,Ut=Gt.next()}this.num_output_ports=Lt},_t.prototype.onMIDIFailure=function(Pt){console.error("Failed to get MIDI access - "+Pt)},_t.prototype.openInputPort=function(Pt,Lt){var Bt=this.input_ports.get("input-"+Pt);if(!Bt)return!1;_t.input=this;var Gt=this;return Bt.onmidimessage=function(Ut){var Zt=new st(Ut.data);Gt.updateState(Zt),Lt&&Lt(Ut.data,Zt),_t.on_message&&_t.on_message(Ut.data,Zt)},console.log("port open: ",Bt),!0},_t.parseMsg=function(Pt){},_t.prototype.updateState=function(Pt){switch(Pt.cmd){case st.NOTEON:this.state.note[Pt.value1|0]=Pt.value2;break;case st.NOTEOFF:this.state.note[Pt.value1|0]=0;break;case st.CONTROLLERCHANGE:this.state.cc[Pt.getCC()]=Pt.getCCValue();break}},_t.prototype.sendMIDI=function(Pt,Lt){if(!!Lt){var Bt=this.output_ports_info[Pt];!Bt||(_t.output=this,Lt.constructor===st?Bt.send(Lt.data):Bt.send(Lt))}};function bt(){this.addOutput("on_midi",it.EVENT),this.addOutput("out","midi"),this.properties={port:0},this._last_midi_event=null,this._current_midi_event=null,this.boxcolor="#AAA",this._last_time=0;var Pt=this;new _t(function(Lt){Pt._midi=Lt,Pt._waiting&&Pt.onStart(),Pt._waiting=!1})}bt.MIDIInterface=_t,bt.title="MIDI Input",bt.desc="Reads MIDI from a input port",bt.color=nt,bt.prototype.getPropertyInfo=function(Pt){if(!!this._midi&&Pt=="port"){for(var Lt={},Bt=0;Bt<this._midi.input_ports_info.length;++Bt){var Gt=this._midi.input_ports_info[Bt];Lt[Bt]=Bt+".- "+Gt.name+" version:"+Gt.version}return{type:"enum",values:Lt}}},bt.prototype.onStart=function(){this._midi?this._midi.openInputPort(this.properties.port,this.onMIDIEvent.bind(this)):this._waiting=!0},bt.prototype.onMIDIEvent=function(Pt,Lt){this._last_midi_event=Lt,this.boxcolor="#AFA",this._last_time=it.getTime(),this.trigger("on_midi",Lt),Lt.cmd==st.NOTEON?this.trigger("on_noteon",Lt):Lt.cmd==st.NOTEOFF?this.trigger("on_noteoff",Lt):Lt.cmd==st.CONTROLLERCHANGE?this.trigger("on_cc",Lt):Lt.cmd==st.PROGRAMCHANGE?this.trigger("on_pc",Lt):Lt.cmd==st.PITCHBEND&&this.trigger("on_pitchbend",Lt)},bt.prototype.onDrawBackground=function(Pt){if(this.boxcolor="#AAA",!this.flags.collapsed&&this._last_midi_event){Pt.fillStyle="white";var Lt=it.getTime(),Bt=1-Math.max(0,(Lt-this._last_time)*.001);if(Bt>0){var Gt=Pt.globalAlpha;Pt.globalAlpha*=Bt,Pt.font="12px Tahoma",Pt.fillText(this._last_midi_event.toString(),2,this.size[1]*.5+3),Pt.globalAlpha=Gt}}},bt.prototype.onExecute=function(){if(this.outputs)for(var Pt=this._last_midi_event,Lt=0;Lt<this.outputs.length;++Lt){var Bt=this.outputs[Lt],Gt=null;switch(Bt.name){case"midi":Gt=this._midi;break;case"last_midi":Gt=Pt;break;default:continue}this.setOutputData(Lt,Gt)}},bt.prototype.onGetOutputs=function(){return[["last_midi","midi"],["on_midi",it.EVENT],["on_noteon",it.EVENT],["on_noteoff",it.EVENT],["on_cc",it.EVENT],["on_pc",it.EVENT],["on_pitchbend",it.EVENT]]},it.registerNodeType("midi/input",bt);function xt(){this.addInput("send",it.EVENT),this.properties={port:0};var Pt=this;new _t(function(Lt){Pt._midi=Lt,Pt.widget.options.values=Pt.getMIDIOutputs()}),this.widget=this.addWidget("combo","Device",this.properties.port,{property:"port",values:this.getMIDIOutputs.bind(this)}),this.size=[340,60]}xt.MIDIInterface=_t,xt.title="MIDI Output",xt.desc="Sends MIDI to output channel",xt.color=nt,xt.prototype.onGetPropertyInfo=function(Pt){if(!!this._midi&&Pt=="port"){var Lt=this.getMIDIOutputs();return{type:"enum",values:Lt}}},xt.default_ports={0:"unknown"},xt.prototype.getMIDIOutputs=function(){var Pt={};if(!this._midi)return xt.default_ports;if(this._midi.output_ports_info)for(var Lt=0;Lt<this._midi.output_ports_info.length;++Lt){var Bt=this._midi.output_ports_info[Lt];if(!!Bt){var Gt=Lt+".- "+Bt.name+" version:"+Bt.version;Pt[Lt]=Gt}}return Pt},xt.prototype.onAction=function(Pt,Lt){!this._midi||(Pt=="send"&&this._midi.sendMIDI(this.properties.port,Lt),this.trigger("midi",Lt))},xt.prototype.onGetInputs=function(){return[["send",it.ACTION]]},xt.prototype.onGetOutputs=function(){return[["on_midi",it.EVENT]]},it.registerNodeType("midi/output",xt);function Tt(){this.addInput("on_midi",it.EVENT),this._str="",this.size=[200,40]}Tt.title="MIDI Show",Tt.desc="Shows MIDI in the graph",Tt.color=nt,Tt.prototype.getTitle=function(){return this.flags.collapsed?this._str:this.title},Tt.prototype.onAction=function(Pt,Lt){!Lt||(Lt.constructor===st?this._str=Lt.toString():this._str="???")},Tt.prototype.onDrawForeground=function(Pt){!this._str||this.flags.collapsed||(Pt.font="30px Arial",Pt.fillText(this._str,10,this.size[1]*.8))},Tt.prototype.onGetInputs=function(){return[["in",it.ACTION]]},Tt.prototype.onGetOutputs=function(){return[["on_midi",it.EVENT]]},it.registerNodeType("midi/show",Tt);function Et(){this.properties={channel:-1,cmd:-1,min_value:-1,max_value:-1};var Pt=this;this._learning=!1,this.addWidget("button","Learn","",function(){Pt._learning=!0,Pt.boxcolor="#FA3"}),this.addInput("in",it.EVENT),this.addOutput("on_midi",it.EVENT),this.boxcolor="#AAA"}Et.title="MIDI Filter",Et.desc="Filters MIDI messages",Et.color=nt,Et["@cmd"]={type:"enum",title:"Command",values:st.commands_reversed},Et.prototype.getTitle=function(){var Pt=null;return this.properties.cmd==-1?Pt="Nothing":Pt=st.commands_short[this.properties.cmd]||"Unknown",this.properties.min_value!=-1&&this.properties.max_value!=-1&&(Pt+=" "+(this.properties.min_value==this.properties.max_value?this.properties.max_value:this.properties.min_value+".."+this.properties.max_value)),"Filter: "+Pt},Et.prototype.onPropertyChanged=function(Pt,Lt){if(Pt=="cmd"){var Bt=Number(Lt);isNaN(Bt)&&(Bt=st.commands[Lt]||0),this.properties.cmd=Bt}},Et.prototype.onAction=function(Pt,Lt){if(!(!Lt||Lt.constructor!==st)){if(this._learning)this._learning=!1,this.boxcolor="#AAA",this.properties.channel=Lt.channel,this.properties.cmd=Lt.cmd,this.properties.min_value=this.properties.max_value=Lt.data[1];else if(this.properties.channel!=-1&&Lt.channel!=this.properties.channel||this.properties.cmd!=-1&&Lt.cmd!=this.properties.cmd||this.properties.min_value!=-1&&Lt.data[1]<this.properties.min_value||this.properties.max_value!=-1&&Lt.data[1]>this.properties.max_value)return;this.trigger("on_midi",Lt)}},it.registerNodeType("midi/filter",Et);function wt(){this.properties={channel:0,cmd:144,value1:1,value2:1},this.addInput("send",it.EVENT),this.addInput("assign",it.EVENT),this.addOutput("on_midi",it.EVENT),this.midi_event=new st,this.gate=!1}wt.title="MIDIEvent",wt.desc="Create a MIDI Event",wt.color=nt,wt.prototype.onAction=function(Pt,Bt){if(Pt=="assign"){this.properties.channel=Bt.channel,this.properties.cmd=Bt.cmd,this.properties.value1=Bt.data[1],this.properties.value2=Bt.data[2],Bt.cmd==st.NOTEON?this.gate=!0:Bt.cmd==st.NOTEOFF&&(this.gate=!1);return}var Bt=this.midi_event;Bt.channel=this.properties.channel,this.properties.cmd&&this.properties.cmd.constructor===String?Bt.setCommandFromString(this.properties.cmd):Bt.cmd=this.properties.cmd,Bt.data[0]=Bt.cmd|Bt.channel,Bt.data[1]=Number(this.properties.value1),Bt.data[2]=Number(this.properties.value2),this.trigger("on_midi",Bt)},wt.prototype.onExecute=function(){var Pt=this.properties;if(this.inputs)for(var Lt=0;Lt<this.inputs.length;++Lt){var Bt=this.inputs[Lt];if(Bt.link!=-1)switch(Bt.name){case"note":var Gt=this.getInputData(Lt);Gt!=null&&(Gt.constructor===String&&(Gt=st.NoteStringToPitch(Gt)),this.properties.value1=(Gt|0)%255);break;case"cmd":var Gt=this.getInputData(Lt);Gt!=null&&(this.properties.cmd=Gt);break;case"value1":var Gt=this.getInputData(Lt);Gt!=null&&(this.properties.value1=clamp(Gt|0,0,127));break;case"value2":var Gt=this.getInputData(Lt);Gt!=null&&(this.properties.value2=clamp(Gt|0,0,127));break}}if(this.outputs)for(var Lt=0;Lt<this.outputs.length;++Lt){var Ut=this.outputs[Lt],Gt=null;switch(Ut.name){case"midi":Gt=new st,Gt.setup([Pt.cmd,Pt.value1,Pt.value2]),Gt.channel=Pt.channel;break;case"command":Gt=Pt.cmd;break;case"cc":Gt=Pt.value1;break;case"cc_value":Gt=Pt.value2;break;case"note":Gt=Pt.cmd==st.NOTEON||Pt.cmd==st.NOTEOFF?Pt.value1:null;break;case"velocity":Gt=Pt.cmd==st.NOTEON?Pt.value2:null;break;case"pitch":Gt=Pt.cmd==st.NOTEON?st.computePitch(Pt.value1):null;break;case"pitchbend":Gt=Pt.cmd==st.PITCHBEND?st.computePitchBend(Pt.value1,Pt.value2):null;break;case"gate":Gt=this.gate;break;default:continue}Gt!==null&&this.setOutputData(Lt,Gt)}},wt.prototype.onPropertyChanged=function(Pt,Lt){Pt=="cmd"&&(this.properties.cmd=st.computeCommandFromString(Lt))},wt.prototype.onGetInputs=function(){return[["cmd","number"],["note","number"],["value1","number"],["value2","number"]]},wt.prototype.onGetOutputs=function(){return[["midi","midi"],["on_midi",it.EVENT],["command","number"],["note","number"],["velocity","number"],["cc","number"],["cc_value","number"],["pitch","number"],["gate","bool"],["pitchbend","number"]]},it.registerNodeType("midi/event",wt);function Ot(){this.properties={cc:1,value:0},this.addOutput("value","number")}Ot.title="MIDICC",Ot.desc="gets a Controller Change",Ot.color=nt,Ot.prototype.onExecute=function(){this.properties,_t.input&&(this.properties.value=_t.input.state.cc[this.properties.cc]),this.setOutputData(0,this.properties.value)},it.registerNodeType("midi/cc",Ot);function It(){this.addInput("generate",it.ACTION),this.addInput("scale","string"),this.addInput("octave","number"),this.addOutput("note",it.EVENT),this.properties={notes:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#",octave:2,duration:.5,mode:"sequence"},this.notes_pitches=It.processScale(this.properties.notes),this.sequence_index=0}It.title="MIDI Generator",It.desc="Generates a random MIDI note",It.color=nt,It.processScale=function(Pt){for(var Lt=Pt.split(","),Bt=0;Bt<Lt.length;++Bt){var Gt=Lt[Bt];Gt.length==2&&Gt[1]!="#"||Gt.length>2?Lt[Bt]=-it.MIDIEvent.NoteStringToPitch(Gt):Lt[Bt]=st.note_to_index[Gt]||0}return Lt},It.prototype.onPropertyChanged=function(Pt,Lt){Pt=="notes"&&(this.notes_pitches=It.processScale(Lt))},It.prototype.onExecute=function(){var Pt=this.getInputData(2);Pt!=null&&(this.properties.octave=Pt);var Lt=this.getInputData(1);Lt&&(this.notes_pitches=It.processScale(Lt))},It.prototype.onAction=function(Pt,Jt){var Bt=0,Gt=this.notes_pitches.length,Ut=0;this.properties.mode=="sequence"?Ut=this.sequence_index=(this.sequence_index+1)%Gt:this.properties.mode=="random"&&(Ut=Math.floor(Math.random()*Gt));var Zt=this.notes_pitches[Ut];Zt>=0?Bt=Zt+(this.properties.octave-1)*12+33:Bt=-Zt;var Jt=new st;Jt.setup([st.NOTEON,Bt,10]);var ei=this.properties.duration||1;this.trigger("note",Jt),setTimeout(function(){var ii=new st;ii.setup([st.NOTEOFF,Bt,0]),this.trigger("note",ii)}.bind(this),ei*1e3)},it.registerNodeType("midi/generator",It);function At(){this.properties={amount:0},this.addInput("in",it.ACTION),this.addInput("amount","number"),this.addOutput("out",it.EVENT),this.midi_event=new st}At.title="MIDI Transpose",At.desc="Transpose a MIDI note",At.color=nt,At.prototype.onAction=function(Pt,Lt){!Lt||Lt.constructor!==st||(Lt.data[0]==st.NOTEON||Lt.data[0]==st.NOTEOFF?(this.midi_event=new st,this.midi_event.setup(Lt.data),this.midi_event.data[1]=Math.round(this.midi_event.data[1]+this.properties.amount),this.trigger("out",this.midi_event)):this.trigger("out",Lt))},At.prototype.onExecute=function(){var Pt=this.getInputData(1);Pt!=null&&(this.properties.amount=Pt)},it.registerNodeType("midi/transpose",At);function Dt(){this.properties={scale:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#"},this.addInput("note",it.ACTION),this.addInput("scale","string"),this.addOutput("out",it.EVENT),this.valid_notes=new Array(12),this.offset_notes=new Array(12),this.processScale(this.properties.scale)}Dt.title="MIDI Quantize Pitch",Dt.desc="Transpose a MIDI note tp fit an scale",Dt.color=nt,Dt.prototype.onPropertyChanged=function(Pt,Lt){Pt=="scale"&&this.processScale(Lt)},Dt.prototype.processScale=function(Pt){this._current_scale=Pt,this.notes_pitches=It.processScale(Pt);for(var Lt=0;Lt<12;++Lt)this.valid_notes[Lt]=this.notes_pitches.indexOf(Lt)!=-1;for(var Lt=0;Lt<12;++Lt){if(this.valid_notes[Lt]){this.offset_notes[Lt]=0;continue}for(var Bt=1;Bt<12;++Bt){if(this.valid_notes[(Lt-Bt)%12]){this.offset_notes[Lt]=-Bt;break}if(this.valid_notes[(Lt+Bt)%12]){this.offset_notes[Lt]=Bt;break}}}},Dt.prototype.onAction=function(Pt,Lt){if(!(!Lt||Lt.constructor!==st))if(Lt.data[0]==st.NOTEON||Lt.data[0]==st.NOTEOFF){this.midi_event=new st,this.midi_event.setup(Lt.data);var Bt=Lt.note,Gt=st.note_to_index[Bt],Ut=this.offset_notes[Gt];this.midi_event.data[1]+=Ut,this.trigger("out",this.midi_event)}else this.trigger("out",Lt)},Dt.prototype.onExecute=function(){var Pt=this.getInputData(1);Pt!=null&&Pt!=this._current_scale&&this.processScale(Pt)},it.registerNodeType("midi/quantize",Dt);function kt(){this.properties={url:"",autoplay:!0},this.addInput("play",it.ACTION),this.addInput("pause",it.ACTION),this.addOutput("note",it.EVENT),this._midi=null,this._current_time=0,this._playing=!1,typeof MidiParser>"u"&&(console.error("midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js"),this.boxcolor="red")}kt.title="MIDI fromFile",kt.desc="Plays a MIDI file",kt.color=nt,kt.prototype.onAction=function(Pt){Pt=="play"?this.play():Pt=="pause"&&(this._playing=!this._playing)},kt.prototype.onPropertyChanged=function(Pt,Lt){Pt=="url"&&this.loadMIDIFile(Lt)},kt.prototype.onExecute=function(){if(!!this._midi&&!!this._playing){this._current_time+=this.graph.elapsed_time;for(var Pt=this._current_time*100,Lt=0;Lt<this._midi.tracks;++Lt){var Bt=this._midi.track[Lt];Bt._last_pos||(Bt._last_pos=0,Bt._time=0);var Gt=Bt.event[Bt._last_pos];if(Gt&&Bt._time+Gt.deltaTime<=Pt&&(Bt._last_pos++,Bt._time+=Gt.deltaTime,Gt.data)){var Ut=Gt.type<<4+Gt.channel,Zt=new st;Zt.setup([Ut,Gt.data[0],Gt.data[1]]),this.trigger("note",Zt)}}}},kt.prototype.play=function(){if(this._playing=!0,this._current_time=0,!!this._midi)for(var Pt=0;Pt<this._midi.tracks;++Pt){var Lt=this._midi.track[Pt];Lt._last_pos=0,Lt._time=0}},kt.prototype.loadMIDIFile=function(Pt){var Lt=this;it.fetchFile(Pt,"arraybuffer",function(Bt){Lt.boxcolor="#AFA",Lt._midi=MidiParser.parse(new Uint8Array(Bt)),Lt.properties.autoplay&&Lt.play()},function(Bt){Lt.boxcolor="#FAA",Lt._midi=null})},kt.prototype.onDropFile=function(Pt){this.properties.url="",this.loadMIDIFile(Pt)},it.registerNodeType("midi/fromFile",kt);function Mt(){if(this.properties={volume:.5,duration:1},this.addInput("note",it.ACTION),this.addInput("volume","number"),this.addInput("duration","number"),this.addOutput("note",it.EVENT),typeof AudioSynth>"u")console.error("Audiosynth.js not included, LGMidiPlay requires that library"),this.boxcolor="red";else{var Pt=this.synth=new AudioSynth;this.instrument=Pt.createInstrument("piano")}}Mt.title="MIDI Play",Mt.desc="Plays a MIDI note",Mt.color=nt,Mt.prototype.onAction=function(Pt,Lt){if(!(!Lt||Lt.constructor!==st)){if(this.instrument&&Lt.data[0]==st.NOTEON){var Bt=Lt.note;if(!Bt||Bt=="undefined"||Bt.constructor!==String)return;this.instrument.play(Bt,Lt.octave,this.properties.duration,this.properties.volume)}this.trigger("note",Lt)}},Mt.prototype.onExecute=function(){var Pt=this.getInputData(1);Pt!=null&&(this.properties.volume=Pt);var Lt=this.getInputData(2);Lt!=null&&(this.properties.duration=Lt)},it.registerNodeType("midi/play",Mt);function zt(){this.properties={num_octaves:2,start_octave:2},this.addInput("note",it.ACTION),this.addInput("reset",it.ACTION),this.addOutput("note",it.EVENT),this.size=[400,100],this.keys=[],this._last_key=-1}zt.title="MIDI Keys",zt.desc="Keyboard to play notes",zt.color=nt,zt.keys=[{x:0,w:1,h:1,t:0},{x:.75,w:.5,h:.6,t:1},{x:1,w:1,h:1,t:0},{x:1.75,w:.5,h:.6,t:1},{x:2,w:1,h:1,t:0},{x:2.75,w:.5,h:.6,t:1},{x:3,w:1,h:1,t:0},{x:4,w:1,h:1,t:0},{x:4.75,w:.5,h:.6,t:1},{x:5,w:1,h:1,t:0},{x:5.75,w:.5,h:.6,t:1},{x:6,w:1,h:1,t:0}],zt.prototype.onDrawForeground=function(Pt){if(!this.flags.collapsed){var Lt=this.properties.num_octaves*12;this.keys.length=Lt;var Bt=this.size[0]/(this.properties.num_octaves*7),Gt=this.size[1];Pt.globalAlpha=1;for(var Ut=0;Ut<2;Ut++)for(var Zt=0;Zt<Lt;++Zt){var Jt=zt.keys[Zt%12];if(Jt.t==Ut){var ei=Math.floor(Zt/12),ii=ei*7*Bt+Jt.x*Bt;Ut==0?Pt.fillStyle=this.keys[Zt]?"#CCC":"white":Pt.fillStyle=this.keys[Zt]?"#333":"black",Pt.fillRect(ii+1,0,Bt*Jt.w-2,Gt*Jt.h)}}}},zt.prototype.getKeyIndex=function(Pt){this.properties.num_octaves*12;for(var Lt=this.size[0]/(this.properties.num_octaves*7),Bt=this.size[1],Gt=1;Gt>=0;Gt--)for(var Ut=0;Ut<this.keys.length;++Ut){var Zt=zt.keys[Ut%12];if(Zt.t==Gt){var Jt=Math.floor(Ut/12),ei=Jt*7*Lt+Zt.x*Lt,ii=Lt*Zt.w,li=Bt*Zt.h;if(!(Pt[0]<ei||Pt[0]>ei+ii||Pt[1]>li))return Ut}}return-1},zt.prototype.onAction=function(Pt,Lt){if(Pt=="reset"){for(var Bt=0;Bt<this.keys.length;++Bt)this.keys[Bt]=!1;return}if(!(!Lt||Lt.constructor!==st)){var Gt=Lt,Ut=(this.properties.start_octave-1)*12+29,Zt=Gt.data[1]-Ut;Zt>=0&&Zt<this.keys.length&&(Gt.data[0]==st.NOTEON?this.keys[Zt]=!0:Gt.data[0]==st.NOTEOFF&&(this.keys[Zt]=!1)),this.trigger("note",Gt)}},zt.prototype.onMouseDown=function(Pt,Lt){if(!(Lt[1]<0)){var Bt=this.getKeyIndex(Lt);this.keys[Bt]=!0,this._last_key=Bt;var Gt=(this.properties.start_octave-1)*12+29+Bt,Ut=new st;return Ut.setup([st.NOTEON,Gt,100]),this.trigger("note",Ut),!0}},zt.prototype.onMouseMove=function(Pt,Lt){if(!(Lt[1]<0||this._last_key==-1)){this.setDirtyCanvas(!0);var Bt=this.getKeyIndex(Lt);if(this._last_key==Bt)return!0;this.keys[this._last_key]=!1;var Gt=(this.properties.start_octave-1)*12+29+this._last_key,Ut=new st;Ut.setup([st.NOTEOFF,Gt,100]),this.trigger("note",Ut),this.keys[Bt]=!0;var Gt=(this.properties.start_octave-1)*12+29+Bt,Ut=new st;return Ut.setup([st.NOTEON,Gt,100]),this.trigger("note",Ut),this._last_key=Bt,!0}},zt.prototype.onMouseUp=function(Pt,Lt){if(!(Lt[1]<0)){var Bt=this.getKeyIndex(Lt);this.keys[Bt]=!1,this._last_key=-1;var Gt=(this.properties.start_octave-1)*12+29+Bt,Ut=new st;return Ut.setup([st.NOTEOFF,Gt,100]),this.trigger("note",Ut),!0}},it.registerNodeType("midi/keys",zt)}(commonjsGlobal),function(rt){var it=rt.LiteGraph,nt={};rt.LGAudio=nt,nt.getAudioContext=function(){if(!this._audio_context){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return console.error("AudioContext not supported by browser"),null;this._audio_context=new AudioContext,this._audio_context.onmessage=function(Lt){console.log("msg",Lt)},this._audio_context.onended=function(Lt){console.log("ended",Lt)},this._audio_context.oncomplete=function(Lt){console.log("complete",Lt)}}return this._audio_context},nt.connect=function(Lt,Bt){try{Lt.connect(Bt)}catch(Gt){console.warn("LGraphAudio:",Gt)}},nt.disconnect=function(Lt,Bt){try{Lt.disconnect(Bt)}catch(Gt){console.warn("LGraphAudio:",Gt)}},nt.changeAllAudiosConnections=function(Lt,Bt){if(Lt.inputs)for(var Gt=0;Gt<Lt.inputs.length;++Gt){var Ut=Lt.inputs[Gt],Zt=Lt.graph.links[Ut.link];if(!!Zt){var Jt=Lt.graph.getNodeById(Zt.origin_id),ei=null;Jt.getAudioNodeInOutputSlot?ei=Jt.getAudioNodeInOutputSlot(Zt.origin_slot):ei=Jt.audionode;var ii=null;Lt.getAudioNodeInInputSlot?ii=Lt.getAudioNodeInInputSlot(Gt):ii=Lt.audionode,Bt?nt.connect(ei,ii):nt.disconnect(ei,ii)}}if(Lt.outputs)for(var Gt=0;Gt<Lt.outputs.length;++Gt)for(var li=Lt.outputs[Gt],pi=0;pi<li.links.length;++pi){var Zt=Lt.graph.links[li.links[pi]];if(!!Zt){var ei=null;Lt.getAudioNodeInOutputSlot?ei=Lt.getAudioNodeInOutputSlot(Gt):ei=Lt.audionode;var ci=Lt.graph.getNodeById(Zt.target_id),ii=null;ci.getAudioNodeInInputSlot?ii=ci.getAudioNodeInInputSlot(Zt.target_slot):ii=ci.audionode,Bt?nt.connect(ei,ii):nt.disconnect(ei,ii)}}},nt.onConnectionsChange=function(Lt,Bt,Gt,Ut){if(Lt==it.OUTPUT){var Zt=null;if(Ut&&(Zt=this.graph.getNodeById(Ut.target_id)),!!Zt){var Jt=null;this.getAudioNodeInOutputSlot?Jt=this.getAudioNodeInOutputSlot(Bt):Jt=this.audionode;var ei=null;Zt.getAudioNodeInInputSlot?ei=Zt.getAudioNodeInInputSlot(Ut.target_slot):ei=Zt.audionode,Gt?nt.connect(Jt,ei):nt.disconnect(Jt,ei)}}},nt.createAudioNodeWrapper=function(Lt){var Bt=Lt.prototype.onPropertyChanged;Lt.prototype.onPropertyChanged=function(Gt,Ut){Bt&&Bt.call(this,Gt,Ut),!!this.audionode&&this.audionode[Gt]!==void 0&&(this.audionode[Gt].value!==void 0?this.audionode[Gt].value=Ut:this.audionode[Gt]=Ut)},Lt.prototype.onConnectionsChange=nt.onConnectionsChange},nt.cached_audios={},nt.loadSound=function(Lt,Bt,Gt){if(nt.cached_audios[Lt]&&Lt.indexOf("blob:")==-1){Bt&&Bt(nt.cached_audios[Lt]);return}nt.onProcessAudioURL&&(Lt=nt.onProcessAudioURL(Lt));var Ut=new XMLHttpRequest;Ut.open("GET",Lt,!0),Ut.responseType="arraybuffer";var Zt=nt.getAudioContext();Ut.onload=function(){console.log("AudioSource loaded"),Zt.decodeAudioData(Ut.response,function(ei){console.log("AudioSource decoded"),nt.cached_audios[Lt]=ei,Bt&&Bt(ei)},Jt)},Ut.send();function Jt(ei){console.log("Audio loading sample error:",ei),Gt&&Gt(ei)}return Ut};function st(){this.properties={src:"",gain:.5,loop:!0,autoplay:!0,playbackRate:1},this._loading_audio=!1,this._audiobuffer=null,this._audionodes=[],this._last_sourcenode=null,this.addOutput("out","audio"),this.addInput("gain","number");var Lt=nt.getAudioContext();this.audionode=Lt.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain,this.properties.src&&this.loadSound(this.properties.src)}st.desc="Plays an audio file",st["@src"]={widget:"resource"},st.supported_extensions=["wav","ogg","mp3"],st.prototype.onAdded=function(Lt){Lt.status===LGraph.STATUS_RUNNING&&this.onStart()},st.prototype.onStart=function(){!this._audiobuffer||this.properties.autoplay&&this.playBuffer(this._audiobuffer)},st.prototype.onStop=function(){this.stopAllSounds()},st.prototype.onPause=function(){this.pauseAllSounds()},st.prototype.onUnpause=function(){this.unpauseAllSounds()},st.prototype.onRemoved=function(){this.stopAllSounds(),this._dropped_url&&URL.revokeObjectURL(this._url)},st.prototype.stopAllSounds=function(){for(var Lt=0;Lt<this._audionodes.length;++Lt)this._audionodes[Lt].started&&(this._audionodes[Lt].started=!1,this._audionodes[Lt].stop());this._audionodes.length=0},st.prototype.pauseAllSounds=function(){nt.getAudioContext().suspend()},st.prototype.unpauseAllSounds=function(){nt.getAudioContext().resume()},st.prototype.onExecute=function(){if(this.inputs)for(var Lt=0;Lt<this.inputs.length;++Lt){var Bt=this.inputs[Lt];if(Bt.link!=null){var Gt=this.getInputData(Lt);if(Gt!==void 0){if(Bt.name=="gain")this.audionode.gain.value=Gt;else if(Bt.name=="src")this.setProperty("src",Gt);else if(Bt.name=="playbackRate"){this.properties.playbackRate=Gt;for(var Ut=0;Ut<this._audionodes.length;++Ut)this._audionodes[Ut].playbackRate.value=Gt}}}}if(this.outputs)for(var Lt=0;Lt<this.outputs.length;++Lt){var Zt=this.outputs[Lt];Zt.name=="buffer"&&this._audiobuffer&&this.setOutputData(Lt,this._audiobuffer)}},st.prototype.onAction=function(Lt){this._audiobuffer&&(Lt=="Play"?this.playBuffer(this._audiobuffer):Lt=="Stop"&&this.stopAllSounds())},st.prototype.onPropertyChanged=function(Lt,Bt){if(Lt=="src")this.loadSound(Bt);else if(Lt=="gain")this.audionode.gain.value=Bt;else if(Lt=="playbackRate")for(var Gt=0;Gt<this._audionodes.length;++Gt)this._audionodes[Gt].playbackRate.value=Bt},st.prototype.playBuffer=function(Lt){var Bt=this,Gt=nt.getAudioContext(),Ut=Gt.createBufferSource();return this._last_sourcenode=Ut,Ut.graphnode=this,Ut.buffer=Lt,Ut.loop=this.properties.loop,Ut.playbackRate.value=this.properties.playbackRate,this._audionodes.push(Ut),Ut.connect(this.audionode),this._audionodes.push(Ut),this.trigger("start"),Ut.onended=function(){Bt.trigger("ended");var Zt=Bt._audionodes.indexOf(Ut);Zt!=-1&&Bt._audionodes.splice(Zt,1)},Ut.started||(Ut.started=!0,Ut.start()),Ut},st.prototype.loadSound=function(Lt){var Bt=this;if(this._request&&(this._request.abort(),this._request=null),this._audiobuffer=null,this._loading_audio=!1,!Lt)return;this._request=nt.loadSound(Lt,Gt),this._loading_audio=!0,this.boxcolor="#AA4";function Gt(Ut){this.boxcolor=it.NODE_DEFAULT_BOXCOLOR,Bt._audiobuffer=Ut,Bt._loading_audio=!1,Bt.graph&&Bt.graph.status===LGraph.STATUS_RUNNING&&Bt.onStart()}},st.prototype.onConnectionsChange=nt.onConnectionsChange,st.prototype.onGetInputs=function(){return[["playbackRate","number"],["src","string"],["Play",it.ACTION],["Stop",it.ACTION]]},st.prototype.onGetOutputs=function(){return[["buffer","audiobuffer"],["start",it.EVENT],["ended",it.EVENT]]},st.prototype.onDropFile=function(Lt){this._dropped_url&&URL.revokeObjectURL(this._dropped_url);var Bt=URL.createObjectURL(Lt);this.properties.src=Bt,this.loadSound(Bt),this._dropped_url=Bt},st.title="Source",st.desc="Plays audio",it.registerNodeType("audio/source",st);function vt(){this.properties={gain:.5},this._audionodes=[],this._media_stream=null,this.addOutput("out","audio"),this.addInput("gain","number");var Lt=nt.getAudioContext();this.audionode=Lt.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain}vt.prototype.onAdded=function(Lt){Lt.status===LGraph.STATUS_RUNNING&&this.onStart()},vt.prototype.onStart=function(){this._media_stream==null&&!this._waiting_confirmation&&this.openStream()},vt.prototype.onStop=function(){this.audionode.gain.value=0},vt.prototype.onPause=function(){this.audionode.gain.value=0},vt.prototype.onUnpause=function(){this.audionode.gain.value=this.properties.gain},vt.prototype.onRemoved=function(){if(this.audionode.gain.value=0,this.audiosource_node&&(this.audiosource_node.disconnect(this.audionode),this.audiosource_node=null),this._media_stream){var Lt=this._media_stream.getTracks();Lt.length&&Lt[0].stop()}},vt.prototype.openStream=function(){if(!navigator.mediaDevices){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.streamReady.bind(this)).catch(Bt);var Lt=this;function Bt(Gt){console.log("Media rejected",Gt),Lt._media_stream=!1,Lt.boxcolor="red"}},vt.prototype.streamReady=function(Lt){this._media_stream=Lt,this.audiosource_node&&this.audiosource_node.disconnect(this.audionode);var Bt=nt.getAudioContext();this.audiosource_node=Bt.createMediaStreamSource(Lt),this.audiosource_node.graphnode=this,this.audiosource_node.connect(this.audionode),this.boxcolor="white"},vt.prototype.onExecute=function(){if(this._media_stream==null&&!this._waiting_confirmation&&this.openStream(),this.inputs)for(var Lt=0;Lt<this.inputs.length;++Lt){var Bt=this.inputs[Lt];if(Bt.link!=null){var Gt=this.getInputData(Lt);Gt!==void 0&&Bt.name=="gain"&&(this.audionode.gain.value=this.properties.gain=Gt)}}},vt.prototype.onAction=function(Lt){Lt=="Play"?this.audionode.gain.value=this.properties.gain:Lt=="Stop"&&(this.audionode.gain.value=0)},vt.prototype.onPropertyChanged=function(Lt,Bt){Lt=="gain"&&(this.audionode.gain.value=Bt)},vt.prototype.onConnectionsChange=nt.onConnectionsChange,vt.prototype.onGetInputs=function(){return[["playbackRate","number"],["Play",it.ACTION],["Stop",it.ACTION]]},vt.title="MediaSource",vt.desc="Plays microphone",it.registerNodeType("audio/media_source",vt);function _t(){this.properties={fftSize:2048,minDecibels:-100,maxDecibels:-10,smoothingTimeConstant:.5};var Lt=nt.getAudioContext();this.audionode=Lt.createAnalyser(),this.audionode.graphnode=this,this.audionode.fftSize=this.properties.fftSize,this.audionode.minDecibels=this.properties.minDecibels,this.audionode.maxDecibels=this.properties.maxDecibels,this.audionode.smoothingTimeConstant=this.properties.smoothingTimeConstant,this.addInput("in","audio"),this.addOutput("freqs","array"),this.addOutput("samples","array"),this._freq_bin=null,this._time_bin=null}_t.prototype.onPropertyChanged=function(Lt,Bt){this.audionode[Lt]=Bt},_t.prototype.onExecute=function(){if(this.isOutputConnected(0)){var Lt=this.audionode.frequencyBinCount;(!this._freq_bin||this._freq_bin.length!=Lt)&&(this._freq_bin=new Uint8Array(Lt)),this.audionode.getByteFrequencyData(this._freq_bin),this.setOutputData(0,this._freq_bin)}if(this.isOutputConnected(1)){var Lt=this.audionode.frequencyBinCount;(!this._time_bin||this._time_bin.length!=Lt)&&(this._time_bin=new Uint8Array(Lt)),this.audionode.getByteTimeDomainData(this._time_bin),this.setOutputData(1,this._time_bin)}for(var Bt=1;Bt<this.inputs.length;++Bt){var Gt=this.inputs[Bt];if(Gt.link!=null){var Ut=this.getInputData(Bt);Ut!==void 0&&(this.audionode[Gt.name].value=Ut)}}},_t.prototype.onGetInputs=function(){return[["minDecibels","number"],["maxDecibels","number"],["smoothingTimeConstant","number"]]},_t.prototype.onGetOutputs=function(){return[["freqs","array"],["samples","array"]]},_t.title="Analyser",_t.desc="Audio Analyser",it.registerNodeType("audio/analyser",_t);function bt(){this.properties={gain:1},this.audionode=nt.getAudioContext().createGain(),this.addInput("in","audio"),this.addInput("gain","number"),this.addOutput("out","audio")}bt.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var Lt=1;Lt<this.inputs.length;++Lt){var Bt=this.inputs[Lt],Gt=this.getInputData(Lt);Gt!==void 0&&(this.audionode[Bt.name].value=Gt)}},nt.createAudioNodeWrapper(bt),bt.title="Gain",bt.desc="Audio gain",it.registerNodeType("audio/gain",bt);function xt(){this.properties={impulse_src:"",normalize:!0},this.audionode=nt.getAudioContext().createConvolver(),this.addInput("in","audio"),this.addOutput("out","audio")}nt.createAudioNodeWrapper(xt),xt.prototype.onRemove=function(){this._dropped_url&&URL.revokeObjectURL(this._dropped_url)},xt.prototype.onPropertyChanged=function(Lt,Bt){Lt=="impulse_src"?this.loadImpulse(Bt):Lt=="normalize"&&(this.audionode.normalize=Bt)},xt.prototype.onDropFile=function(Lt){this._dropped_url&&URL.revokeObjectURL(this._dropped_url),this._dropped_url=URL.createObjectURL(Lt),this.properties.impulse_src=this._dropped_url,this.loadImpulse(this._dropped_url)},xt.prototype.loadImpulse=function(Lt){var Bt=this;if(this._request&&(this._request.abort(),this._request=null),this._impulse_buffer=null,this._loading_impulse=!1,!Lt)return;this._request=nt.loadSound(Lt,Gt),this._loading_impulse=!0;function Gt(Ut){Bt._impulse_buffer=Ut,Bt.audionode.buffer=Ut,console.log("Impulse signal set"),Bt._loading_impulse=!1}},xt.title="Convolver",xt.desc="Convolves the signal (used for reverb)",it.registerNodeType("audio/convolver",xt);function Tt(){this.properties={threshold:-50,knee:40,ratio:12,reduction:-20,attack:0,release:.25},this.audionode=nt.getAudioContext().createDynamicsCompressor(),this.addInput("in","audio"),this.addOutput("out","audio")}nt.createAudioNodeWrapper(Tt),Tt.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var Lt=1;Lt<this.inputs.length;++Lt){var Bt=this.inputs[Lt];if(Bt.link!=null){var Gt=this.getInputData(Lt);Gt!==void 0&&(this.audionode[Bt.name].value=Gt)}}},Tt.prototype.onGetInputs=function(){return[["threshold","number"],["knee","number"],["ratio","number"],["reduction","number"],["attack","number"],["release","number"]]},Tt.title="DynamicsCompressor",Tt.desc="Dynamics Compressor",it.registerNodeType("audio/dynamicsCompressor",Tt);function Et(){this.properties={},this.audionode=nt.getAudioContext().createWaveShaper(),this.addInput("in","audio"),this.addInput("shape","waveshape"),this.addOutput("out","audio")}Et.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length)){var Lt=this.getInputData(1);Lt!==void 0&&(this.audionode.curve=Lt)}},Et.prototype.setWaveShape=function(Lt){this.audionode.curve=Lt},nt.createAudioNodeWrapper(Et);function wt(){this.properties={gain1:.5,gain2:.5},this.audionode=nt.getAudioContext().createGain(),this.audionode1=nt.getAudioContext().createGain(),this.audionode1.gain.value=this.properties.gain1,this.audionode2=nt.getAudioContext().createGain(),this.audionode2.gain.value=this.properties.gain2,this.audionode1.connect(this.audionode),this.audionode2.connect(this.audionode),this.addInput("in1","audio"),this.addInput("in1 gain","number"),this.addInput("in2","audio"),this.addInput("in2 gain","number"),this.addOutput("out","audio")}wt.prototype.getAudioNodeInInputSlot=function(Lt){if(Lt==0)return this.audionode1;if(Lt==2)return this.audionode2},wt.prototype.onPropertyChanged=function(Lt,Bt){Lt=="gain1"?this.audionode1.gain.value=Bt:Lt=="gain2"&&(this.audionode2.gain.value=Bt)},wt.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var Lt=1;Lt<this.inputs.length;++Lt){var Bt=this.inputs[Lt];if(!(Bt.link==null||Bt.type=="audio")){var Gt=this.getInputData(Lt);Gt!==void 0&&(Lt==1?this.audionode1.gain.value=Gt:Lt==3&&(this.audionode2.gain.value=Gt))}}},nt.createAudioNodeWrapper(wt),wt.title="Mixer",wt.desc="Audio mixer",it.registerNodeType("audio/mixer",wt);function Ot(){this.properties={A:.1,D:.1,S:.1,R:.1},this.audionode=nt.getAudioContext().createGain(),this.audionode.gain.value=0,this.addInput("in","audio"),this.addInput("gate","boolean"),this.addOutput("out","audio"),this.gate=!1}Ot.prototype.onExecute=function(){var Lt=nt.getAudioContext(),Bt=Lt.currentTime,Gt=this.audionode,Ut=Gt.gain,Zt=this.getInputData(1),Jt=this.getInputOrProperty("A"),ei=this.getInputOrProperty("D"),ii=this.getInputOrProperty("S"),li=this.getInputOrProperty("R");!this.gate&&Zt?(Ut.cancelScheduledValues(0),Ut.setValueAtTime(0,Bt),Ut.linearRampToValueAtTime(1,Bt+Jt),Ut.linearRampToValueAtTime(ii,Bt+Jt+ei)):this.gate&&!Zt&&(Ut.cancelScheduledValues(0),Ut.setValueAtTime(Ut.value,Bt),Ut.linearRampToValueAtTime(0,Bt+li)),this.gate=Zt},Ot.prototype.onGetInputs=function(){return[["A","number"],["D","number"],["S","number"],["R","number"]]},nt.createAudioNodeWrapper(Ot),Ot.title="ADSR",Ot.desc="Audio envelope",it.registerNodeType("audio/adsr",Ot);function It(){this.properties={delayTime:.5},this.audionode=nt.getAudioContext().createDelay(10),this.audionode.delayTime.value=this.properties.delayTime,this.addInput("in","audio"),this.addInput("time","number"),this.addOutput("out","audio")}nt.createAudioNodeWrapper(It),It.prototype.onExecute=function(){var Lt=this.getInputData(1);Lt!==void 0&&(this.audionode.delayTime.value=Lt)},It.title="Delay",It.desc="Audio delay",it.registerNodeType("audio/delay",It);function At(){this.properties={frequency:350,detune:0,Q:1},this.addProperty("type","lowpass","enum",{values:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}),this.audionode=nt.getAudioContext().createBiquadFilter(),this.addInput("in","audio"),this.addOutput("out","audio")}At.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var Lt=1;Lt<this.inputs.length;++Lt){var Bt=this.inputs[Lt];if(Bt.link!=null){var Gt=this.getInputData(Lt);Gt!==void 0&&(this.audionode[Bt.name].value=Gt)}}},At.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["Q","number"]]},nt.createAudioNodeWrapper(At),At.title="BiquadFilter",At.desc="Audio filter",it.registerNodeType("audio/biquadfilter",At);function Dt(){this.properties={frequency:440,detune:0,type:"sine"},this.addProperty("type","sine","enum",{values:["sine","square","sawtooth","triangle","custom"]}),this.audionode=nt.getAudioContext().createOscillator(),this.addOutput("out","audio")}Dt.prototype.onStart=function(){if(!this.audionode.started){this.audionode.started=!0;try{this.audionode.start()}catch{}}},Dt.prototype.onStop=function(){this.audionode.started&&(this.audionode.started=!1,this.audionode.stop())},Dt.prototype.onPause=function(){this.onStop()},Dt.prototype.onUnpause=function(){this.onStart()},Dt.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var Lt=0;Lt<this.inputs.length;++Lt){var Bt=this.inputs[Lt];if(Bt.link!=null){var Gt=this.getInputData(Lt);Gt!==void 0&&(this.audionode[Bt.name].value=Gt)}}},Dt.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["type","string"]]},nt.createAudioNodeWrapper(Dt),Dt.title="Oscillator",Dt.desc="Oscillator",it.registerNodeType("audio/oscillator",Dt);function kt(){this.properties={continuous:!0,mark:-1},this.addInput("data","array"),this.addInput("mark","number"),this.size=[300,200],this._last_buffer=null}kt.prototype.onExecute=function(){this._last_buffer=this.getInputData(0);var Lt=this.getInputData(1);Lt!==void 0&&(this.properties.mark=Lt),this.setDirtyCanvas(!0,!1)},kt.prototype.onDrawForeground=function(Lt){if(!!this._last_buffer){var Bt=this._last_buffer,Gt=Bt.length/this.size[0],Ut=this.size[1];Lt.fillStyle="black",Lt.fillRect(0,0,this.size[0],this.size[1]),Lt.strokeStyle="white",Lt.beginPath();var Zt=0;if(this.properties.continuous){Lt.moveTo(Zt,Ut);for(var Jt=0;Jt<Bt.length;Jt+=Gt)Lt.lineTo(Zt,Ut-Bt[Jt|0]/255*Ut),Zt++}else for(var Jt=0;Jt<Bt.length;Jt+=Gt)Lt.moveTo(Zt+.5,Ut),Lt.lineTo(Zt+.5,Ut-Bt[Jt|0]/255*Ut),Zt++;if(Lt.stroke(),this.properties.mark>=0){var ei=nt.getAudioContext().sampleRate,ii=ei/Bt.length,Zt=2*(this.properties.mark/ii)/Gt;Zt>=this.size[0]&&(Zt=this.size[0]-1),Lt.strokeStyle="red",Lt.beginPath(),Lt.moveTo(Zt,Ut),Lt.lineTo(Zt,0),Lt.stroke()}}},kt.title="Visualization",kt.desc="Audio Visualization",it.registerNodeType("audio/visualization",kt);function Mt(){this.properties={band:440,amplitude:1},this.addInput("freqs","array"),this.addOutput("signal","number")}Mt.prototype.onExecute=function(){if(this._freqs=this.getInputData(0),!!this._freqs){var Lt=this.properties.band,Zt=this.getInputData(1);Zt!==void 0&&(Lt=Zt);var Bt=nt.getAudioContext().sampleRate,Gt=Bt/this._freqs.length,Ut=2*(Lt/Gt),Zt=0;if(Ut<0&&(Zt=this._freqs[0]),Ut>=this._freqs.length)Zt=this._freqs[this._freqs.length-1];else{var Jt=Ut|0,ei=this._freqs[Jt],ii=this._freqs[Jt+1],li=Ut-Jt;Zt=ei*(1-li)+ii*li}this.setOutputData(0,Zt/255*this.properties.amplitude)}},Mt.prototype.onGetInputs=function(){return[["band","number"]]},Mt.title="Signal",Mt.desc="extract the signal of some frequency",it.registerNodeType("audio/signal",Mt);function zt(){if(!zt.default_code){var Lt=zt.default_function.toString(),Bt=Lt.indexOf("{")+1,Gt=Lt.lastIndexOf("}");zt.default_code=Lt.substr(Bt,Gt-Bt)}this.properties={code:zt.default_code};var Ut=nt.getAudioContext();Ut.createScriptProcessor?this.audionode=Ut.createScriptProcessor(4096,1,1):(console.warn("ScriptProcessorNode deprecated"),this.audionode=Ut.createGain()),this.processCode(),zt._bypass_function||(zt._bypass_function=this.audionode.onaudioprocess),this.addInput("in","audio"),this.addOutput("out","audio")}zt.prototype.onAdded=function(Lt){Lt.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback)},zt["@code"]={widget:"code",type:"code"},zt.prototype.onStart=function(){this.audionode.onaudioprocess=this._callback},zt.prototype.onStop=function(){this.audionode.onaudioprocess=zt._bypass_function},zt.prototype.onPause=function(){this.audionode.onaudioprocess=zt._bypass_function},zt.prototype.onUnpause=function(){this.audionode.onaudioprocess=this._callback},zt.prototype.onExecute=function(){},zt.prototype.onRemoved=function(){this.audionode.onaudioprocess=zt._bypass_function},zt.prototype.processCode=function(){try{var Lt=new Function("properties",this.properties.code);this._script=new Lt(this.properties),this._old_code=this.properties.code,this._callback=this._script.onaudioprocess}catch(Bt){console.error("Error in onaudioprocess code",Bt),this._callback=zt._bypass_function,this.audionode.onaudioprocess=this._callback}},zt.prototype.onPropertyChanged=function(Lt,Bt){Lt=="code"&&(this.properties.code=Bt,this.processCode(),this.graph&&this.graph.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback))},zt.default_function=function(){this.onaudioprocess=function(Lt){for(var Bt=Lt.inputBuffer,Gt=Lt.outputBuffer,Ut=0;Ut<Gt.numberOfChannels;Ut++)for(var Zt=Bt.getChannelData(Ut),Jt=Gt.getChannelData(Ut),ei=0;ei<Bt.length;ei++)Jt[ei]=Zt[ei]}},nt.createAudioNodeWrapper(zt),zt.title="Script",zt.desc="apply script to signal",it.registerNodeType("audio/script",zt);function Pt(){this.audionode=nt.getAudioContext().destination,this.addInput("in","audio")}Pt.title="Destination",Pt.desc="Audio output",it.registerNodeType("audio/destination",Pt)}(commonjsGlobal),function(rt){var it=rt.LiteGraph;function nt(){this.size=[60,20],this.addInput("send",it.ACTION),this.addOutput("received",it.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph",only_send_changes:!0},this._ws=null,this._last_sent_data=[],this._last_received_data=[]}nt.title="WebSocket",nt.desc="Send data through a websocket",nt.prototype.onPropertyChanged=function(_t,bt){_t=="url"&&this.connectSocket()},nt.prototype.onExecute=function(){if(!this._ws&&this.properties.url&&this.connectSocket(),!(!this._ws||this._ws.readyState!=WebSocket.OPEN)){for(var _t=this.properties.room,bt=this.properties.only_send_changes,xt=1;xt<this.inputs.length;++xt){var Tt=this.getInputData(xt);if(Tt!=null){var Et;try{Et=JSON.stringify({type:0,room:_t,channel:xt,data:Tt})}catch{continue}bt&&this._last_sent_data[xt]==Et||(this._last_sent_data[xt]=Et,this._ws.send(Et))}}for(var xt=1;xt<this.outputs.length;++xt)this.setOutputData(xt,this._last_received_data[xt]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},nt.prototype.connectSocket=function(){var _t=this,bt=this.properties.url;bt.substr(0,2)!="ws"&&(bt="ws://"+bt),this._ws=new WebSocket(bt),this._ws.onopen=function(){console.log("ready"),_t.boxcolor="#6C6"},this._ws.onmessage=function(xt){_t.boxcolor="#AFA";var Tt=JSON.parse(xt.data);if(!(Tt.room&&Tt.room!=_t.properties.room))if(Tt.type==1)if(Tt.data.object_class&&it[Tt.data.object_class]){var Et=null;try{Et=new it[Tt.data.object_class](Tt.data),_t.triggerSlot(0,Et)}catch{return}}else _t.triggerSlot(0,Tt.data);else _t._last_received_data[Tt.channel||0]=Tt.data},this._ws.onerror=function(xt){console.log("couldnt connect to websocket"),_t.boxcolor="#E88"},this._ws.onclose=function(xt){console.log("connection closed"),_t.boxcolor="#000"}},nt.prototype.send=function(_t){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send(JSON.stringify({type:1,msg:_t}))},nt.prototype.onAction=function(_t,bt){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send({type:1,room:this.properties.room,action:_t,data:bt})},nt.prototype.onGetInputs=function(){return[["in",0]]},nt.prototype.onGetOutputs=function(){return[["out",0]]},it.registerNodeType("network/websocket",nt);function st(){this.room_widget=this.addWidget("text","Room","lgraph",this.setRoom.bind(this)),this.addWidget("button","Reconnect",null,this.connectSocket.bind(this)),this.addInput("send",it.ACTION),this.addOutput("received",it.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"tamats.com:55000",room:"lgraph",only_send_changes:!0},this._server=null,this.connectSocket(),this._last_sent_data=[],this._last_received_data=[],typeof SillyClient>"u"&&console.warn("remember to add SillyClient.js to your project: https://tamats.com/projects/sillyserver/src/sillyclient.js")}st.title="SillyClient",st.desc="Connects to SillyServer to broadcast messages",st.prototype.onPropertyChanged=function(_t,bt){_t=="room"&&(this.room_widget.value=bt),this.connectSocket()},st.prototype.setRoom=function(_t){this.properties.room=_t,this.room_widget.value=_t,this.connectSocket()},st.prototype.onDrawForeground=function(){for(var _t=1;_t<this.inputs.length;++_t){var bt=this.inputs[_t];bt.label="in_"+_t}for(var _t=1;_t<this.outputs.length;++_t){var bt=this.outputs[_t];bt.label="out_"+_t}},st.prototype.onExecute=function(){if(!(!this._server||!this._server.is_connected)){for(var _t=this.properties.only_send_changes,bt=1;bt<this.inputs.length;++bt){var xt=this.getInputData(bt),Tt=this._last_sent_data[bt];if(xt!=null){if(_t){var Et=!0;if(xt&&xt.length&&Tt&&Tt.length==xt.length&&xt.constructor!==String){for(var wt=0;wt<xt.length;++wt)if(Tt[wt]!=xt[wt]){Et=!1;break}}else this._last_sent_data[bt]!=xt&&(Et=!1);if(Et)continue}if(this._server.sendMessage({type:0,channel:bt,data:xt}),xt.length&&xt.constructor!==String)if(this._last_sent_data[bt]){this._last_sent_data[bt].length=xt.length;for(var wt=0;wt<xt.length;++wt)this._last_sent_data[bt][wt]=xt[wt]}else xt.constructor===Array?this._last_sent_data[bt]=xt.concat():this._last_sent_data[bt]=new xt.constructor(xt);else this._last_sent_data[bt]=xt}}for(var bt=1;bt<this.outputs.length;++bt)this.setOutputData(bt,this._last_received_data[bt]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},st.prototype.connectSocket=function(){var _t=this;if(typeof SillyClient>"u"){this._error||console.error("SillyClient node cannot be used, you must include SillyServer.js"),this._error=!0;return}if(this._server=new SillyClient,this._server.on_ready=function(){console.log("ready"),_t.boxcolor="#6C6"},this._server.on_message=function(bt,xt){var Tt=null;try{Tt=JSON.parse(xt)}catch{return}if(Tt.type==1)if(Tt.data.object_class&&it[Tt.data.object_class]){var Et=null;try{Et=new it[Tt.data.object_class](Tt.data),_t.triggerSlot(0,Et)}catch{return}}else _t.triggerSlot(0,Tt.data);else _t._last_received_data[Tt.channel||0]=Tt.data;_t.boxcolor="#AFA"},this._server.on_error=function(bt){console.log("couldnt connect to websocket"),_t.boxcolor="#E88"},this._server.on_close=function(bt){console.log("connection closed"),_t.boxcolor="#000"},this.properties.url&&this.properties.room){try{this._server.connect(this.properties.url,this.properties.room)}catch(bt){console.error("SillyServer error: "+bt),this._server=null;return}this._final_url=this.properties.url+"/"+this.properties.room}},st.prototype.send=function(_t){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,data:_t})},st.prototype.onAction=function(_t,bt){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,action:_t,data:bt})},st.prototype.onGetInputs=function(){return[["in",0]]},st.prototype.onGetOutputs=function(){return[["out",0]]},it.registerNodeType("network/sillyclient",st);function vt(){this.addInput("request",it.ACTION),this.addInput("url","string"),this.addProperty("url",""),this.addOutput("ready",it.EVENT),this.addOutput("data","string"),this.addWidget("button","Fetch",null,this.fetch.bind(this)),this._data=null,this._fetching=null}vt.title="HTTP Request",vt.desc="Fetch data through HTTP",vt.prototype.fetch=function(){var _t=this.properties.url;if(!!_t){this.boxcolor="#FF0";var bt=this;this._fetching=fetch(_t).then(xt=>{if(!xt.ok)this.boxcolor="#F00",bt.trigger("error");else return this.boxcolor="#0F0",xt.text()}).then(xt=>{bt._data=xt,bt._fetching=null,bt.trigger("ready")})}},vt.prototype.onAction=function(_t){_t=="request"&&this.fetch()},vt.prototype.onExecute=function(){this.setOutputData(1,this._data)},vt.prototype.onGetOutputs=function(){return[["error",it.EVENT]]},it.registerNodeType("network/httprequest",vt)}(commonjsGlobal)})(litegraph);const _sfc_main$b={},_hoisted_1$b={class:"w-4 h-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},_hoisted_2$b=createBaseVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1),_hoisted_3$a=[_hoisted_2$b];function _sfc_render$5(rt,it){return openBlock(),createElementBlock("svg",_hoisted_1$b,_hoisted_3$a)}const IconCancel=_export_sfc(_sfc_main$b,[["render",_sfc_render$5]]),_sfc_main$a={},_hoisted_1$a={class:"w-4 h-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},_hoisted_2$a=createBaseVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"},null,-1),_hoisted_3$9=[_hoisted_2$a];function _sfc_render$4(rt,it){return openBlock(),createElementBlock("svg",_hoisted_1$a,_hoisted_3$9)}const IconCopy=_export_sfc(_sfc_main$a,[["render",_sfc_render$4]]),_sfc_main$9={},_hoisted_1$9={class:"w-4 h-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},_hoisted_2$9=createBaseVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"},null,-1),_hoisted_3$8=[_hoisted_2$9];function _sfc_render$3(rt,it){return openBlock(),createElementBlock("svg",_hoisted_1$9,_hoisted_3$8)}const IconDownload=_export_sfc(_sfc_main$9,[["render",_sfc_render$3]]),_hoisted_1$8={key:0,class:"backdrop-blur fixed top-0 left-0 right-0 z-50 w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full"},_hoisted_2$8={class:"w-full flex justify-end gap-3"},_hoisted_3$7=createTextVNode(" Save "),_sfc_main$8={__name:"Modal",props:{show:{type:Boolean}},emits:["close","save"],setup(rt,{emit:it}){const nt=ref(null),st=computed(()=>{var vt;return{width:"300px",height:"auto",left:"calc(50% - 150px)",top:`calc(50% - ${((vt=nt.value)==null?void 0:vt.offsetHeight)/2||0}px)`}});return(vt,_t)=>rt.show?(openBlock(),createElementBlock("div",_hoisted_1$8,[createBaseVNode("div",{ref_key:"modalEl",ref:nt,style:normalizeStyle(unref(st)),class:"rounded-lg p-3 fixed z-10 flex flex-col gap-3 items-center justify-center bg-slate-50 shadow dark:bg-slate-900"},[renderSlot(vt.$slots,"default"),createBaseVNode("div",_hoisted_2$8,[createBaseVNode("button",{onClick:_t[0]||(_t[0]=bt=>it("close")),class:"inline-flex items-center py-2.5 px-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700",title:"close"},[createVNode(IconCancel,{style:{margin:"0"}})]),createBaseVNode("button",{onClick:_t[1]||(_t[1]=bt=>it("save")),class:"inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},[createVNode(IconDownload),_hoisted_3$7])])],4)])):createCommentVNode("",!0)}},ComfyPrompt_vue_vue_type_style_index_0_lang="",_hoisted_1$7={key:0,class:"flex flex-col items-center justify-center"},_hoisted_2$7={class:"flex justify-between w-full max-w-xl flex-col sm:flex-row"},_hoisted_3$6=createTextVNode(" Remove prompt & save "),_hoisted_4$2={class:"py-2 flex justify-end w-full max-w-xl flex-col sm:flex-row"},_hoisted_5$2=createTextVNode(" Save as ComfyUI workflow "),_hoisted_6$2=createBaseVNode("label",{for:"prompt",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400"},"Filename",-1),_hoisted_7$2=["value"],_hoisted_8$2=createTextVNode(" Copy all "),_hoisted_9$2={class:"flex flex-col items-start w-full max-w-xl"},_hoisted_10$2={class:"flex justify-between items-center bg-slate-50 dark:bg-slate-900 border-gray-200 dark:border-bray-700 m-2 p-2 rounded-lg"},_hoisted_11$2=createBaseVNode("div",{class:"font-semibold text-slate-500"},"Text node",-1),_hoisted_12$2=["onClick"],_hoisted_13$1={class:"w-full p-4"},_hoisted_14=createBaseVNode("h2",{class:"pt-8 pb-4 text-xl font-bold"},"Workflow preview",-1),_hoisted_15=createBaseVNode("canvas",{class:"w-full rounded-lg",height:"500",id:"myCanvas"},null,-1),_sfc_main$7={__name:"ComfyPrompt",props:{params:{type:Object},filename:{type:String}},emits:["copy","save","clear","save-picture","update:filename"],setup(rt,{emit:it}){const nt=rt;let st=ref(null);const vt=ref(!1),_t=new litegraph.LiteGraph.LGraph;onMounted(()=>{bt(),xt()}),watch(nt,()=>{xt()}),onUnmounted(()=>{_t.stop(),_t.clear(),_t.detachCanvas()});function bt(){const Ot=document.getElementById("myCanvas");let It=new litegraph.LiteGraph.LGraphCanvas("#myCanvas",_t);function At(){Ot.width=Ot.offsetWidth,Ot.height=Ot.offsetHeight,It.draw(!0,!0)}It.setZoom(.1),At(),_t.start()}function xt(){const Ot=JSON.parse(nt.params.prompt),It=Object.values(Ot).filter(Mt=>Mt.class_type==="CLIPTextEncode").map(Mt=>({text:Mt.inputs.text,id:nanoid()}));st.value=It,bt();const At=JSON.parse(nt.params.workflow),Dt={};Array.from(new Set(At.nodes.map(Mt=>(Dt[Mt.type]=Mt,Mt.type))).values()).forEach(Mt=>{function zt(){}zt.title=Mt,litegraph.LiteGraph.registerNodeType(Mt,zt)}),_t.configure(At),At.nodes.map(Mt=>{const zt=_t.getNodeById(Mt.id);Mt.widgets_values&&Mt.widgets_values.forEach(Pt=>{zt.addWidget("text","",Pt)})})}function Tt(){it("save"),vt.value=!1}function Et(){navigator.clipboard.writeText(st.value.reduce((Ot,It)=>Ot+It.text+`

`,"")),it("copy")}function wt(Ot){navigator.clipboard.writeText(Ot.text),it("copy")}return(Ot,It)=>(openBlock(),createElementBlock(Fragment,null,[unref(st)?(openBlock(),createElementBlock("div",_hoisted_1$7,[createBaseVNode("div",_hoisted_2$7,[createBaseVNode("button",{onClick:It[0]||(It[0]=At=>Ot.$emit("clear")),class:"inline-flex items-center py-2.5 px-3 sm:mb-0 mb-2 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700",title:"clear"},[createVNode(IconCancel,{style:{margin:"0"}})]),createBaseVNode("button",{onClick:It[1]||(It[1]=At=>it("save-picture")),class:"h-10 inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},[createVNode(IconDownload),_hoisted_3$6])]),createBaseVNode("div",_hoisted_4$2,[createBaseVNode("button",{onClick:It[2]||(It[2]=At=>vt.value=!0),class:"inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center sm:mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},[createVNode(IconDownload),_hoisted_5$2]),createVNode(_sfc_main$8,{show:vt.value,onClose:It[4]||(It[4]=At=>vt.value=!1),onSave:Tt},{default:withCtx(()=>[_hoisted_6$2,createBaseVNode("textarea",{class:"w-full p-3 dark:bg-black dark:text-gray-400",value:rt.filename,onInput:It[3]||(It[3]=At=>Ot.$emit("update:filename",At.target.value))},`
        `,40,_hoisted_7$2)]),_:1},8,["show"]),createBaseVNode("button",{onClick:Et,class:"inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},[createVNode(IconCopy),_hoisted_8$2])]),createBaseVNode("div",_hoisted_9$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(st),At=>(openBlock(),createElementBlock("div",{key:At.id,class:"block w-full mb-3 p-0 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700"},[createBaseVNode("div",_hoisted_10$2,[_hoisted_11$2,createBaseVNode("div",null,[createBaseVNode("button",{onClick:Dt=>wt(At),class:"px-2.5 py-2.5 inline-flex items-center text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"},[createVNode(IconCopy,{style:{margin:"0"}})],8,_hoisted_12$2)])]),createBaseVNode("div",_hoisted_13$1,toDisplayString(At.text),1)]))),128))])])):createCommentVNode("",!0),_hoisted_14,_hoisted_15],64))}};function splitToGroups(rt){const it=rt.trim(),nt=["(","{","["],st=[")","}","]"],vt={"(":"accent","[":"accent","{":"dynamic"};return it.split("").reduce((bt,xt,Tt,Et)=>(nt.includes(xt)&&(bt.group=!0,bt.groupType=vt[xt]),st.includes(xt)&&(bt.group=!1),xt===","&&!bt.group?(bt.groups.push({value:bt.current.trim().replace(`
`,""),group:bt.groupType}),bt.current="",bt.groupType=null,bt):(bt.current+=xt,Tt===Et.length-1&&(bt.groups.push({value:bt.current.trim(),group:bt.groupType}),bt.current=""),bt)),{groups:[],current:"",group:!1,groupType:null}).groups}function parseTags(rt){const nt=splitToGroups(rt).map(st=>{const vt=nanoid(),{value:_t,group:bt}=st;if(bt==="dynamic")return parseDynamicTag(_t);if(bt==="accent"){const xt=parseGroupTags(_t);return{type:"group",...parseTag(_t),tags:xt,id:vt}}return!bt&&_t.includes("<")?parseLoraTag(_t):parseTag(_t)});return console.log("Parsed",nt),nt}function parseLoraTag(rt){const it=nanoid(),[nt,st,vt]=rt.replace("<","").replace(">","").split(":");return console.log("parseLora",nt,st,vt),{type:"additionalNet",name:nt,value:st,weight:vt?parseFloat(vt):1,accent:0,id:it}}function parseDynamicTag(rt){const it=nanoid();return{type:"dynamic",value:rt.replace("{","").replace("}",""),accent:0,weight:1,id:it}}function parseTag(rt){const it=Array.from(rt.matchAll(/\(/g)).length||0,nt=rt.replaceAll("(","").replaceAll(")","").split(":"),st=nt[0],vt=parseFloat(nt[1])||1,_t=nanoid();return{value:st,accent:it,weight:vt,id:_t}}function parseGroupTags(rt){return rt.split(",").map(st=>st.trim()).filter(st=>!!st).map(st=>parseTag(st))}function parseFullMeta(rt){var st,vt;const it=parseTextMeta(rt),nt={};if(it.meta){const _t=/([\w\s]+):\s*(".*?"|[\w\s.-]+)/g;let bt,xt=it.meta;for(xt=xt.replaceAll(":","");(bt=_t.exec(it.meta))!==null;){const Et=(st=bt[1])==null?void 0:st.trim();let wt=(vt=bt[2])==null?void 0:vt.trim();xt=xt.replace(Et,""),xt=xt.replace(wt,""),wt.startsWith('"')&&wt.endsWith('"')&&(wt=wt.slice(1,-1)),nt[Et]=wt}xt=xt.replaceAll('"',"");const Tt=xt.split(",").map(Et=>Et.trim()).filter(Et=>!!Et);Tt.length&&Tt.forEach(Et=>{nt[Et]=Et})}return{pos:parseTags(it.pos),neg:it.neg?parseTags(it.neg):null,meta:nt}}function parseTextMeta(rt){const[it,nt]=rt.trim().replace(/Negative prompt:/gmi,"$negative$").split("$negative$"),st=it;if(!nt){if(it.includes("Steps:")){const[xt,Tt]=it.split("Steps:");return{pos:xt,meta:`Steps:${Tt}`}}return{pos:st}}const[vt,_t]=nt.trim().split(`
`),bt=vt;return _t?{pos:st,neg:bt,meta:_t}:{pos:st,neg:bt}}const parameterToKey={Sampler:"sampler_name",Steps:"steps","CFG scale":"cfg_scale",Seed:"seed"},_hoisted_1$6={class:"flex justify-between w-full max-w-xl flex-col sm:flex-row"},_hoisted_2$6=createTextVNode(" Remove prompt & save "),_hoisted_3$5={class:"py-2 flex justify-end w-full max-w-xl flex-col sm:flex-row"},_hoisted_4$1=createTextVNode(" Save txt "),_hoisted_5$1=createBaseVNode("label",{for:"prompt",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400"},"Filename",-1),_hoisted_6$1=["value"],_hoisted_7$1=createTextVNode(" Copy for textbox "),_hoisted_8$1=createTextVNode(" Copy all "),_hoisted_9$1={class:"flex flex-col items-start w-full max-w-xl"},_hoisted_10$1={class:"flex justify-between items-center bg-slate-50 dark:bg-slate-900 border-gray-200 dark:border-bray-700 m-2 p-2 rounded-lg"},_hoisted_11$1={class:"font-semibold text-slate-500"},_hoisted_12$1=["onClick"],_hoisted_13={class:"w-full p-4"},_sfc_main$6={__name:"DefaultPrompt",props:{params:{type:String},filename:{type:String}},emits:["copy","save","save-picture","clear","update:filename"],setup(rt,{emit:it}){const nt=rt,st={pos:"Prompt",neg:"Negative Prompt",meta:"Parameters"},vt=computed(()=>parseTextMeta(nt.params)),_t=ref(!1);function bt(){navigator.clipboard.writeText(nt.params),it("copy")}function xt(wt){navigator.clipboard.writeText(vt.value[wt]),it("copy")}function Tt(){it("save"),_t.value=!1}function Et(){const wt=parseFullMeta(nt.params),Ot=[];if(Ot.push(`--prompt "${vt.value.pos.trim()}"`),wt.neg&&Ot.push(`--negative_prompt "${vt.value.neg.trim()}"`),wt.meta){const It=wt.meta.Size;if(It){const[At,Dt]=It.split("x");At&&Dt&&Ot.push(`--width "${At}"`,`--height "${Dt}"`)}Object.keys(wt.meta).forEach(At=>{parameterToKey[At]&&Ot.push(`--${parameterToKey[At]} "${wt.meta[At].trim()}"`)})}navigator.clipboard.writeText(Ot.join(" ")),it("copy")}return(wt,Ot)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$6,[createBaseVNode("button",{onClick:Ot[0]||(Ot[0]=It=>wt.$emit("clear")),class:"inline-flex items-center py-2.5 px-3 sm:mb-0 mb-2 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700",title:"clear"},[createVNode(IconCancel,{style:{margin:"0"}})]),createBaseVNode("button",{onClick:Ot[1]||(Ot[1]=It=>it("save-picture")),class:"h-10 inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},[createVNode(IconDownload),_hoisted_2$6])]),createBaseVNode("div",_hoisted_3$5,[createBaseVNode("button",{onClick:Ot[2]||(Ot[2]=It=>_t.value=!0),class:"inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center sm:mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},[createVNode(IconDownload),_hoisted_4$1]),createVNode(_sfc_main$8,{show:_t.value,onClose:Ot[4]||(Ot[4]=It=>_t.value=!1),onSave:Tt},{default:withCtx(()=>[_hoisted_5$1,createBaseVNode("textarea",{class:"w-full p-3 dark:bg-black dark:text-gray-400",value:rt.filename,onInput:Ot[3]||(Ot[3]=It=>wt.$emit("update:filename",It.target.value))},`
      `,40,_hoisted_6$1)]),_:1},8,["show"]),createBaseVNode("button",{onClick:Et,class:"inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center sm:mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},[createVNode(IconCopy),_hoisted_7$1]),createBaseVNode("button",{onClick:bt,class:"inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},[createVNode(IconCopy),_hoisted_8$1])]),createBaseVNode("div",_hoisted_9$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(vt),(It,At)=>(openBlock(),createElementBlock("div",{key:It,class:"block w-full mb-3 p-0 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700"},[createBaseVNode("div",_hoisted_10$1,[createBaseVNode("div",_hoisted_11$1,toDisplayString(st[At]),1),createBaseVNode("div",null,[createBaseVNode("button",{onClick:Dt=>xt(At),class:"px-2.5 py-2.5 inline-flex items-center text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"},[createVNode(IconCopy,{style:{margin:"0"},title:"copy to clipboard"})],8,_hoisted_12$1)])]),createBaseVNode("div",_hoisted_13,toDisplayString(It),1)]))),128))])],64))}},_sfc_main$5={},_hoisted_1$5={class:"w-4 h-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},_hoisted_2$5=createBaseVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12.75l6 6 9-13.5"},null,-1),_hoisted_3$4=[_hoisted_2$5];function _sfc_render$2(rt,it){return openBlock(),createElementBlock("svg",_hoisted_1$5,_hoisted_3$4)}const IconCheck=_export_sfc(_sfc_main$5,[["render",_sfc_render$2]]),_sfc_main$4={},_hoisted_1$4={class:"w-4 h-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},_hoisted_2$4=createBaseVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"},null,-1),_hoisted_3$3=[_hoisted_2$4];function _sfc_render$1(rt,it){return openBlock(),createElementBlock("svg",_hoisted_1$4,_hoisted_3$3)}const IconExclamation=_export_sfc(_sfc_main$4,[["render",_sfc_render$1]]),_sfc_main$3={},_hoisted_1$3={class:"flex items-center justify-center w-full max-w-screen-lg"},_hoisted_2$3={for:"dropzone-file",class:"flex flex-col items-center justify-center w-full h-64 border-2 border-slate-300 border-dashed rounded-lg cursor-pointer bg-slate-50 dark:hover:bg-bray-800 dark:bg-slate-700 hover:bg-slate-100 dark:border-slate-600 dark:hover:border-slate-500 dark:hover:bg-slate-600"},_hoisted_3$2=createStaticVNode('<div class="flex flex-col items-center justify-center pt-5 pb-6"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10 mb-3 text-slate-400"><path stroke-linecap="round" stroke-linejoin="round" d="M9 8.25H7.5a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25H15m0-3l-3-3m0 0l-3 3m3-3V15"></path></svg><p class="mb-2 text-sm text-slate-500 dark:text-slate-400"><span class="font-semibold">Click to upload</span> or drag and drop </p><p class="text-xs text-slate-500 dark:text-slate-400">PNG or JPG</p><p class="text-xs py-2 text-center text-slate-500 dark:text-slate-400"> *It runs directly in your browser, no image is sent to the server </p></div>',1);function _sfc_render(rt,it){return openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("label",_hoisted_2$3,[_hoisted_3$2,createBaseVNode("input",{id:"dropzone-file",type:"file",multiple:"",class:"w-full h-full absolute opacity-0 cursor-pointer",onChange:it[0]||(it[0]=nt=>{var st;return rt.$emit("files-change",(st=nt.target)==null?void 0:st.files)})},null,32)])])}const FileUploader=_export_sfc(_sfc_main$3,[["render",_sfc_render]]),_hoisted_1$2={class:"hover:saturate-150 hover:drop-shadow-md max-w-xs rounded-lg shadow"},_hoisted_2$2={href:"#"},_hoisted_3$1=["src"],_sfc_main$2={__name:"Card",props:{url:{type:String}},setup(rt){const it=rt;return(nt,st)=>(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("a",_hoisted_2$2,[createBaseVNode("img",{class:"rounded-lg",src:it.url,alt:""},null,8,_hoisted_3$1)])]))}},_hoisted_1$1={class:"flex items-center overflow-auto gap-2 bg-slate-200 dark:bg-slate-900 p-2 w-fit max-w-screen-md rounded-lg cursor-pointer"},_hoisted_2$1=["onClick"],_sfc_main$1={__name:"ImageSelector",props:{rImages:{type:Array},rSelected:{type:Object}},emits:["select"],setup(rt,{emit:it}){const nt=rt;return(st,vt)=>(openBlock(),createElementBlock("div",_hoisted_1$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(nt.rImages,_t=>(openBlock(),createElementBlock("div",{key:_t.id,onClick:bt=>it("select",_t),class:normalizeClass(["hover:saturate-150 hover:drop-shadow-md w-16 h-16 rounded-lg overflow-hidden bg-center bg-no-repeat bg-cover",{"saturate-150 ring ":_t.id===nt.rSelected.id}]),style:normalizeStyle({"max-width":"4rem","min-width":"4rem","background-image":`url(${_t.imageURL})`})},null,14,_hoisted_2$1))),128))]))}};/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */function ownKeys(rt,it){var nt=Object.keys(rt);if(Object.getOwnPropertySymbols){var st=Object.getOwnPropertySymbols(rt);it&&(st=st.filter(function(vt){return Object.getOwnPropertyDescriptor(rt,vt).enumerable})),nt.push.apply(nt,st)}return nt}function _objectSpread2(rt){for(var it=1;it<arguments.length;it++){var nt=arguments[it]!=null?arguments[it]:{};it%2?ownKeys(Object(nt),!0).forEach(function(st){_defineProperty(rt,st,nt[st])}):Object.getOwnPropertyDescriptors?Object.defineProperties(rt,Object.getOwnPropertyDescriptors(nt)):ownKeys(Object(nt)).forEach(function(st){Object.defineProperty(rt,st,Object.getOwnPropertyDescriptor(nt,st))})}return rt}function _classCallCheck(rt,it){if(!(rt instanceof it))throw new TypeError("Cannot call a class as a function")}function _defineProperties(rt,it){for(var nt=0;nt<it.length;nt++){var st=it[nt];st.enumerable=st.enumerable||!1,st.configurable=!0,"value"in st&&(st.writable=!0),Object.defineProperty(rt,_toPropertyKey(st.key),st)}}function _createClass(rt,it,nt){return it&&_defineProperties(rt.prototype,it),nt&&_defineProperties(rt,nt),Object.defineProperty(rt,"prototype",{writable:!1}),rt}function _defineProperty(rt,it,nt){return it=_toPropertyKey(it),it in rt?Object.defineProperty(rt,it,{value:nt,enumerable:!0,configurable:!0,writable:!0}):rt[it]=nt,rt}function _extends(){return _extends=Object.assign?Object.assign.bind():function(rt){for(var it=1;it<arguments.length;it++){var nt=arguments[it];for(var st in nt)Object.prototype.hasOwnProperty.call(nt,st)&&(rt[st]=nt[st])}return rt},_extends.apply(this,arguments)}function _toPrimitive(rt,it){if(typeof rt!="object"||rt===null)return rt;var nt=rt[Symbol.toPrimitive];if(nt!==void 0){var st=nt.call(rt,it||"default");if(typeof st!="object")return st;throw new TypeError("@@toPrimitive must return a primitive value.")}return(it==="string"?String:Number)(rt)}function _toPropertyKey(rt){var it=_toPrimitive(rt,"string");return typeof it=="symbol"?it:String(it)}var canvasToBlob={exports:{}};(function(rt){typeof window>"u"||function(it){var nt=it.HTMLCanvasElement&&it.HTMLCanvasElement.prototype,st=it.Blob&&function(){try{return Boolean(new Blob)}catch{return!1}}(),vt=st&&it.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}}(),_t=it.BlobBuilder||it.WebKitBlobBuilder||it.MozBlobBuilder||it.MSBlobBuilder,bt=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,xt=(st||_t)&&it.atob&&it.ArrayBuffer&&it.Uint8Array&&function(Tt){var Et,wt,Ot,It,At,Dt,kt,Mt,zt;if(Et=Tt.match(bt),!Et)throw new Error("invalid data URI");for(wt=Et[2]?Et[1]:"text/plain"+(Et[3]||";charset=US-ASCII"),Ot=!!Et[4],It=Tt.slice(Et[0].length),Ot?At=atob(It):At=decodeURIComponent(It),Dt=new ArrayBuffer(At.length),kt=new Uint8Array(Dt),Mt=0;Mt<At.length;Mt+=1)kt[Mt]=At.charCodeAt(Mt);return st?new Blob([vt?kt:Dt],{type:wt}):(zt=new _t,zt.append(Dt),zt.getBlob(wt))};it.HTMLCanvasElement&&!nt.toBlob&&(nt.mozGetAsFile?nt.toBlob=function(Tt,Et,wt){var Ot=this;setTimeout(function(){wt&&nt.toDataURL&&xt?Tt(xt(Ot.toDataURL(Et,wt))):Tt(Ot.mozGetAsFile("blob",Et))})}:nt.toDataURL&&xt&&(nt.msToBlob?nt.toBlob=function(Tt,Et,wt){var Ot=this;setTimeout(function(){(Et&&Et!=="image/png"||wt)&&nt.toDataURL&&xt?Tt(xt(Ot.toDataURL(Et,wt))):Tt(Ot.msToBlob(Et))})}:nt.toBlob=function(Tt,Et,wt){var Ot=this;setTimeout(function(){Tt(xt(Ot.toDataURL(Et,wt)))})})),rt.exports?rt.exports=xt:it.dataURLtoBlob=xt}(window)})(canvasToBlob);var toBlob=canvasToBlob.exports,isBlob=function rt(it){return typeof Blob>"u"?!1:it instanceof Blob||Object.prototype.toString.call(it)==="[object Blob]"},DEFAULTS={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},IS_BROWSER=typeof window<"u"&&typeof window.document<"u",WINDOW=IS_BROWSER?window:{},isPositiveNumber=function rt(it){return it>0&&it<1/0},slice=Array.prototype.slice;function toArray(rt){return Array.from?Array.from(rt):slice.call(rt)}var REGEXP_IMAGE_TYPE=/^image\/.+$/;function isImageType(rt){return REGEXP_IMAGE_TYPE.test(rt)}function imageTypeToExtension(rt){var it=isImageType(rt)?rt.substr(6):"";return it==="jpeg"&&(it="jpg"),".".concat(it)}var fromCharCode=String.fromCharCode;function getStringFromCharCode(rt,it,nt){var st="",vt;for(nt+=it,vt=it;vt<nt;vt+=1)st+=fromCharCode(rt.getUint8(vt));return st}var btoa=WINDOW.btoa;function arrayBufferToDataURL(rt,it){for(var nt=[],st=8192,vt=new Uint8Array(rt);vt.length>0;)nt.push(fromCharCode.apply(null,toArray(vt.subarray(0,st)))),vt=vt.subarray(st);return"data:".concat(it,";base64,").concat(btoa(nt.join("")))}function resetAndGetOrientation(rt){var it=new DataView(rt),nt;try{var st,vt,_t;if(it.getUint8(0)===255&&it.getUint8(1)===216)for(var bt=it.byteLength,xt=2;xt+1<bt;){if(it.getUint8(xt)===255&&it.getUint8(xt+1)===225){vt=xt;break}xt+=1}if(vt){var Tt=vt+4,Et=vt+10;if(getStringFromCharCode(it,Tt,4)==="Exif"){var wt=it.getUint16(Et);if(st=wt===18761,(st||wt===19789)&&it.getUint16(Et+2,st)===42){var Ot=it.getUint32(Et+4,st);Ot>=8&&(_t=Et+Ot)}}}if(_t){var It=it.getUint16(_t,st),At,Dt;for(Dt=0;Dt<It;Dt+=1)if(At=_t+Dt*12+2,it.getUint16(At,st)===274){At+=8,nt=it.getUint16(At,st),it.setUint16(At,1,st);break}}}catch{nt=1}return nt}function parseOrientation(rt){var it=0,nt=1,st=1;switch(rt){case 2:nt=-1;break;case 3:it=-180;break;case 4:st=-1;break;case 5:it=90,st=-1;break;case 6:it=90;break;case 7:it=90,nt=-1;break;case 8:it=-90;break}return{rotate:it,scaleX:nt,scaleY:st}}var REGEXP_DECIMALS=/\.\d*(?:0|9){12}\d*$/;function normalizeDecimalNumber(rt){var it=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return REGEXP_DECIMALS.test(rt)?Math.round(rt*it)/it:rt}function getAdjustedSizes(rt){var it=rt.aspectRatio,nt=rt.height,st=rt.width,vt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",_t=isPositiveNumber(st),bt=isPositiveNumber(nt);if(_t&&bt){var xt=nt*it;(vt==="contain"||vt==="none")&&xt>st||vt==="cover"&&xt<st?nt=st/it:st=nt*it}else _t?nt=st/it:bt&&(st=nt*it);return{width:st,height:nt}}function getExif(rt){for(var it=toArray(new Uint8Array(rt)),nt=it.length,st=[],vt=0;vt+3<nt;){var _t=it[vt],bt=it[vt+1];if(_t===255&&bt===218)break;if(_t===255&&bt===216)vt+=2;else{var xt=it[vt+2]*256+it[vt+3],Tt=vt+xt+2,Et=it.slice(vt,Tt);st.push(Et),vt=Tt}}return st.reduce(function(wt,Ot){return Ot[0]===255&&Ot[1]===225?wt.concat(Ot):wt},[])}function insertExif(rt,it){var nt=toArray(new Uint8Array(rt));if(nt[2]!==255||nt[3]!==224)return rt;var st=nt[4]*256+nt[5],vt=[255,216].concat(it,nt.slice(4+st));return new Uint8Array(vt)}var ArrayBuffer$1=WINDOW.ArrayBuffer,FileReader$1=WINDOW.FileReader,URL$1=WINDOW.URL||WINDOW.webkitURL,REGEXP_EXTENSION=/\.\w+$/,AnotherCompressor=WINDOW.Compressor,Compressor=function(){function rt(it,nt){_classCallCheck(this,rt),this.file=it,this.exif=[],this.image=new Image,this.options=_objectSpread2(_objectSpread2({},DEFAULTS),nt),this.aborted=!1,this.result=null,this.init()}return _createClass(rt,[{key:"init",value:function(){var nt=this,st=this.file,vt=this.options;if(!isBlob(st)){this.fail(new Error("The first argument must be a File or Blob object."));return}var _t=st.type;if(!isImageType(_t)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!URL$1||!FileReader$1){this.fail(new Error("The current browser does not support image compression."));return}ArrayBuffer$1||(vt.checkOrientation=!1,vt.retainExif=!1);var bt=_t==="image/jpeg",xt=bt&&vt.checkOrientation,Tt=bt&&vt.retainExif;if(URL$1&&!xt&&!Tt)this.load({url:URL$1.createObjectURL(st)});else{var Et=new FileReader$1;this.reader=Et,Et.onload=function(wt){var Ot=wt.target,It=Ot.result,At={},Dt=1;xt&&(Dt=resetAndGetOrientation(It),Dt>1&&_extends(At,parseOrientation(Dt))),Tt&&(nt.exif=getExif(It)),xt||Tt?!URL$1||Dt>1?At.url=arrayBufferToDataURL(It,_t):At.url=URL$1.createObjectURL(st):At.url=It,nt.load(At)},Et.onabort=function(){nt.fail(new Error("Aborted to read the image with FileReader."))},Et.onerror=function(){nt.fail(new Error("Failed to read the image with FileReader."))},Et.onloadend=function(){nt.reader=null},xt||Tt?Et.readAsArrayBuffer(st):Et.readAsDataURL(st)}}},{key:"load",value:function(nt){var st=this,vt=this.file,_t=this.image;_t.onload=function(){st.draw(_objectSpread2(_objectSpread2({},nt),{},{naturalWidth:_t.naturalWidth,naturalHeight:_t.naturalHeight}))},_t.onabort=function(){st.fail(new Error("Aborted to load the image."))},_t.onerror=function(){st.fail(new Error("Failed to load the image."))},WINDOW.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(WINDOW.navigator.userAgent)&&(_t.crossOrigin="anonymous"),_t.alt=vt.name,_t.src=nt.url}},{key:"draw",value:function(nt){var st=this,vt=nt.naturalWidth,_t=nt.naturalHeight,bt=nt.rotate,xt=bt===void 0?0:bt,Tt=nt.scaleX,Et=Tt===void 0?1:Tt,wt=nt.scaleY,Ot=wt===void 0?1:wt,It=this.file,At=this.image,Dt=this.options,kt=document.createElement("canvas"),Mt=kt.getContext("2d"),zt=Math.abs(xt)%180===90,Pt=(Dt.resize==="contain"||Dt.resize==="cover")&&isPositiveNumber(Dt.width)&&isPositiveNumber(Dt.height),Lt=Math.max(Dt.maxWidth,0)||1/0,Bt=Math.max(Dt.maxHeight,0)||1/0,Gt=Math.max(Dt.minWidth,0)||0,Ut=Math.max(Dt.minHeight,0)||0,Zt=vt/_t,Jt=Dt.width,ei=Dt.height;if(zt){var ii=[Bt,Lt];Lt=ii[0],Bt=ii[1];var li=[Ut,Gt];Gt=li[0],Ut=li[1];var pi=[ei,Jt];Jt=pi[0],ei=pi[1]}Pt&&(Zt=Jt/ei);var ci=getAdjustedSizes({aspectRatio:Zt,width:Lt,height:Bt},"contain");Lt=ci.width,Bt=ci.height;var Wt=getAdjustedSizes({aspectRatio:Zt,width:Gt,height:Ut},"cover");if(Gt=Wt.width,Ut=Wt.height,Pt){var $t=getAdjustedSizes({aspectRatio:Zt,width:Jt,height:ei},Dt.resize);Jt=$t.width,ei=$t.height}else{var Rt=getAdjustedSizes({aspectRatio:Zt,width:Jt,height:ei}),Yt=Rt.width;Jt=Yt===void 0?vt:Yt;var Ht=Rt.height;ei=Ht===void 0?_t:Ht}Jt=Math.floor(normalizeDecimalNumber(Math.min(Math.max(Jt,Gt),Lt))),ei=Math.floor(normalizeDecimalNumber(Math.min(Math.max(ei,Ut),Bt)));var jt=-Jt/2,qt=-ei/2,ri=Jt,oi=ei,fi=[];if(Pt){var bi=0,ai=0,di=vt,Nt=_t,Ft=getAdjustedSizes({aspectRatio:Zt,width:vt,height:_t},{contain:"cover",cover:"contain"}[Dt.resize]);di=Ft.width,Nt=Ft.height,bi=(vt-di)/2,ai=(_t-Nt)/2,fi.push(bi,ai,di,Nt)}if(fi.push(jt,qt,ri,oi),zt){var Xt=[ei,Jt];Jt=Xt[0],ei=Xt[1]}kt.width=Jt,kt.height=ei,isImageType(Dt.mimeType)||(Dt.mimeType=It.type);var Qt="transparent";It.size>Dt.convertSize&&Dt.convertTypes.indexOf(Dt.mimeType)>=0&&(Dt.mimeType="image/jpeg");var ti=Dt.mimeType==="image/jpeg";if(ti&&(Qt="#fff"),Mt.fillStyle=Qt,Mt.fillRect(0,0,Jt,ei),Dt.beforeDraw&&Dt.beforeDraw.call(this,Mt,kt),!this.aborted&&(Mt.save(),Mt.translate(Jt/2,ei/2),Mt.rotate(xt*Math.PI/180),Mt.scale(Et,Ot),Mt.drawImage.apply(Mt,[At].concat(fi)),Mt.restore(),Dt.drew&&Dt.drew.call(this,Mt,kt),!this.aborted)){var si=function(Kt){if(!st.aborted){var ni=function(mi){return st.done({naturalWidth:vt,naturalHeight:_t,result:mi})};if(Kt&&ti&&Dt.retainExif&&st.exif&&st.exif.length>0){var hi=function(mi){return ni(toBlob(arrayBufferToDataURL(insertExif(mi,st.exif),Dt.mimeType)))};if(Kt.arrayBuffer)Kt.arrayBuffer().then(hi).catch(function(){st.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var ui=new FileReader$1;st.reader=ui,ui.onload=function(gi){var mi=gi.target;hi(mi.result)},ui.onabort=function(){st.fail(new Error("Aborted to read the compressed image with FileReader."))},ui.onerror=function(){st.fail(new Error("Failed to read the compressed image with FileReader."))},ui.onloadend=function(){st.reader=null},ui.readAsArrayBuffer(Kt)}}else ni(Kt)}};kt.toBlob?kt.toBlob(si,Dt.mimeType,Dt.quality):si(toBlob(kt.toDataURL(Dt.mimeType,Dt.quality)))}}},{key:"done",value:function(nt){var st=nt.naturalWidth,vt=nt.naturalHeight,_t=nt.result,bt=this.file,xt=this.image,Tt=this.options;if(URL$1&&xt.src.indexOf("blob:")===0&&URL$1.revokeObjectURL(xt.src),_t)if(Tt.strict&&!Tt.retainExif&&_t.size>bt.size&&Tt.mimeType===bt.type&&!(Tt.width>st||Tt.height>vt||Tt.minWidth>st||Tt.minHeight>vt||Tt.maxWidth<st||Tt.maxHeight<vt))_t=bt;else{var Et=new Date;_t.lastModified=Et.getTime(),_t.lastModifiedDate=Et,_t.name=bt.name,_t.name&&_t.type!==bt.type&&(_t.name=_t.name.replace(REGEXP_EXTENSION,imageTypeToExtension(_t.type)))}else _t=bt;this.result=_t,Tt.success&&Tt.success.call(this,_t)}},{key:"fail",value:function(nt){var st=this.options;if(st.error)st.error.call(this,nt);else throw nt}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=AnotherCompressor,rt}},{key:"setDefaults",value:function(nt){_extends(DEFAULTS,nt)}}]),rt}();const extensions={txt:"text/plain",json:"text/json"};function saveFile(rt,it,nt){const st=new Blob([rt],{type:extensions[nt]}),vt=document.createElement("a");vt.href=URL.createObjectURL(st),vt.download=`${it||"prompt"}.${nt}`,vt.click(),URL.revokeObjectURL(vt.href)}function saveImage(rt,it){const nt=URL.createObjectURL(rt),st=document.createElement("a");st.download=it,st.href=nt,st.click(),URL.revokeObjectURL(nt)}async function removeExif(rt,it={}){return new Promise((nt,st)=>{new Compressor(rt,{quality:1,strict:!1,retainExif:!1,...it,success(vt){nt(vt)},error(vt){st(vt)}})})}function getFileName(rt){return rt.split(".").slice(0,-1).join(".")}const _hoisted_1={key:0,class:"fixed flex z-50 items-center w-full max-w-xs p-4 space-x-4 text-gray-500 bg-white divide-x divide-gray-200 rounded-lg shadow top-5 right-5 dark:text-gray-400 dark:divide-gray-700 space-x dark:bg-gray-800"},_hoisted_2={key:1,class:"flex flex-col h-full items-center"},_hoisted_3={key:0,class:"w-full h-full flex items-center"},_hoisted_4={class:"flex flex-col items-center justify-center w-full h-64 border-2 border-slate-300 rounded-lg bg-slate-50 dark:bg-slate-700 dark:border-slate-600"},_hoisted_5=createBaseVNode("span",{class:"font-bold p-4 text-slate-500 dark:text-slate-400"}," Prompt not found ",-1),_hoisted_6={class:"fixed z-50 w-full bottom-24 left-0 flex justify-center items-center"},_hoisted_7={key:2},_hoisted_8=createTextVNode(" Clear "),_hoisted_9={class:"columns-2 md:columns-3 lg:columns-4 mt-1"},_hoisted_10={key:3,class:"w-full h-full flex items-center"},_hoisted_11=createBaseVNode("label",{for:"prompt",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400"},"Filename",-1),_hoisted_12=["value"],_sfc_main={__name:"HomeView",setup(rt){let it=ref(null),nt=ref(null),st=ref(null),vt=ref(!1),_t=ref(null);function bt(Dt){const kt=new TextDecoder("utf-8"),Mt=Uint8Array.from(Dt.filter(zt=>zt!==0));return kt.decode(Mt)}async function xt(Dt){let kt=null,Mt=null,zt=nanoid();const Pt=getFileName(Dt.name),Lt=URL.createObjectURL(Dt);return new Promise(Bt=>{tt.parse(Dt,!0).then(Gt=>{Gt.userComment?(kt=bt(Gt.userComment).replace("UNICODE",""),Mt="default"):Gt.parameters?(kt=Gt.parameters,Mt="default"):Gt.workflow?(kt=Gt,Mt="comfyui"):Mt="notFound",Bt({params:kt,type:Mt,imageURL:Lt,id:zt,filename:Pt,file:Dt})})})}function Tt(Dt){const Mt=Array.from(Dt).map(zt=>xt(zt));Promise.all(Mt).then(zt=>{zt.length===1?st.value=zt[0]:nt.value=zt})}function Et(){it.value="Copied to clipboard!",setTimeout(()=>{it.value=null},1e3)}function wt(){Et()}function Ot(){const{params:Dt,type:kt,filename:Mt}=st.value;kt==="comfyui"?saveFile(Dt.workflow,Mt,"json"):kt==="default"&&saveFile(Dt,Mt,"txt")}async function It(){_t.value=st.value.filename,vt.value=!0}async function At(){vt.value=!1;const Dt=await removeExif(st.value.file);saveImage(Dt,_t.value)}return(Dt,kt)=>{var Mt,zt;return openBlock(),createElementBlock(Fragment,null,[unref(it)?(openBlock(),createElementBlock("div",_hoisted_1,[createVNode(IconCheck),createTextVNode(" "+toDisplayString(unref(it)),1)])):createCommentVNode("",!0),unref(st)?(openBlock(),createElementBlock("div",_hoisted_2,[unref(st).type==="notFound"?(openBlock(),createElementBlock("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[createVNode(IconExclamation,{class:"!w-10 !h-10 text-slate-500 dark:text-slate-400"}),_hoisted_5,createBaseVNode("button",{onClick:kt[0]||(kt[0]=Pt=>isRef(st)?st.value=null:st=null),class:"inline-flex items-center py-2.5 px-5 sm:mr-2 mb-2 text-sm font-medium text-slate-900 focus:outline-none bg-white rounded-lg border border-slate-200 hover:bg-slate-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-slate-200 dark:focus:ring-slate-700 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-600 dark:hover:text-white dark:hover:bg-slate-700"}," Return ")])])):createCommentVNode("",!0),unref(st).type==="default"?(openBlock(),createBlock(_sfc_main$6,{key:1,params:unref(st).params,filename:unref(st).filename,"onUpdate:filename":kt[1]||(kt[1]=Pt=>unref(st).filename=Pt),onSave:Ot,onCopy:wt,onClear:kt[2]||(kt[2]=Pt=>isRef(st)?st.value=null:st=null),onSavePicture:It},null,8,["params","filename"])):createCommentVNode("",!0),unref(st).type==="comfyui"?(openBlock(),createBlock(_sfc_main$7,{key:2,params:unref(st).params,filename:unref(st).filename,"onUpdate:filename":kt[3]||(kt[3]=Pt=>unref(st).filename=Pt),onSave:Ot,onCopy:wt,onClear:kt[4]||(kt[4]=Pt=>isRef(st)?st.value=null:st=null),onSavePicture:It},null,8,["params","filename"])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_6,[((Mt=unref(nt))==null?void 0:Mt.length)>1?(openBlock(),createBlock(_sfc_main$1,{key:0,onSelect:kt[5]||(kt[5]=Pt=>isRef(st)?st.value=Pt:st=Pt),rImages:unref(nt),rSelected:unref(st)},null,8,["rImages","rSelected"])):createCommentVNode("",!0)])])):(zt=unref(nt))!=null&&zt.length?(openBlock(),createElementBlock("div",_hoisted_7,[createBaseVNode("button",{onClick:kt[6]||(kt[6]=Pt=>isRef(nt)?nt.value=null:nt=null),class:"inline-flex items-center py-2.5 px-5 sm:mr-2 mb-2 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"},[createVNode(IconCancel),_hoisted_8]),createBaseVNode("div",_hoisted_9,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(nt),Pt=>(openBlock(),createElementBlock("div",{key:Pt.id,class:"inline-block mb-2"},[createVNode(_sfc_main$2,{url:Pt.imageURL,onClick:()=>isRef(st)?st.value=Pt:st=Pt},null,8,["url","onClick"])]))),128))])])):(openBlock(),createElementBlock("div",_hoisted_10,[createVNode(FileUploader,{onFilesChange:Tt})])),createVNode(_sfc_main$8,{show:unref(vt),onClose:kt[8]||(kt[8]=Pt=>isRef(vt)?vt.value=!1:vt=!1),onSave:At},{default:withCtx(()=>[_hoisted_11,createBaseVNode("textarea",{class:"w-full p-3 dark:bg-black dark:text-gray-400",value:unref(_t),onInput:kt[7]||(kt[7]=Pt=>isRef(_t)?_t.value=Pt.target.value:_t=Pt.target.value)},`
    `,40,_hoisted_12)]),_:1},8,["show"])],64)}}},router=createRouter({history:createWebHistory("/"),routes:[{path:"/",name:"home",component:_sfc_main},{path:"/about",name:"about",component:()=>__vitePreload(()=>import("./AboutView.02d6c6cb.js"),[])}]}),main="",app=createApp(_sfc_main$c);app.use(createPinia());app.use(router);app.mount("#app");export{_export_sfc as _,createStaticVNode as a,createElementBlock as c,openBlock as o};
